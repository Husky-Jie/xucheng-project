{"remainingRequest":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\src\\module-organization\\pages\\media-manage\\components\\media-add-dialog.vue?vue&type=script&lang=ts&","dependencies":[{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\src\\module-organization\\pages\\media-manage\\components\\media-add-dialog.vue","mtime":1610858383180},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660903053464},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\babel-loader\\lib\\index.js","mtime":1576202003988},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\ts-loader\\index.js","mtime":1660903053026},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660903053464},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\vue-loader\\lib\\index.js","mtime":1660903053930}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCmltcG9ydCB7IENvbXBvbmVudCwgVnVlLCBQcm9wU3luYyB9IGZyb20gJ3Z1ZS1wcm9wZXJ0eS1kZWNvcmF0b3InDQppbXBvcnQgew0KICBFbFVwbG9hZEludGVybmFsUmF3RmlsZSwNCiAgRWxVcGxvYWRJbnRlcm5hbEZpbGVEZXRhaWwsDQogIEh0dHBSZXF1ZXN0T3B0aW9ucw0KfSBmcm9tICdlbGVtZW50LXVpL3R5cGVzL3VwbG9hZCcNCg0KaW1wb3J0ICogYXMgcWluaXUgZnJvbSAncWluaXUtanMnDQppbXBvcnQgeyBCYXNlNjQgfSBmcm9tICdqcy1iYXNlNjQnDQppbXBvcnQgeyBJUW5QYXJhbXNEVE8sIElWb2RUb2tlbkRUTyB9IGZyb20gJ0AvZW50aXR5L21lZGlhLXBhZ2UtbGlzdCcNCmltcG9ydCB7IGdldFFuUGFyYW1zIH0gZnJvbSAnQC9hcGkvY29tbW9uJw0KaW1wb3J0IHsgZ2V0Vm9kVG9rZW4sIHNhdmVNZWRpYSB9IGZyb20gJ0AvYXBpL21lZGlhJw0KDQpAQ29tcG9uZW50DQpleHBvcnQgZGVmYXVsdCBjbGFzcyBNZWRpYUFkZERpYWxvZyBleHRlbmRzIFZ1ZSB7DQogIEBQcm9wU3luYygnZGlhbG9nVmlzaWJsZScsIHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogZmFsc2UgfSkNCiAgc3luY0RpYWxvZ1Zpc2libGUhOiBib29sZWFuDQoNCiAgLy8g5paH5qGj5ZCO57yA5ZCN5YiX6KGoDQogIHByaXZhdGUgbXNEb2N1bWVudFN1ZmZpeDogc3RyaW5nW10gPSBbDQogICAgJy5kb2MnLA0KICAgICcuZG9jeCcsDQogICAgJy54bHMnLA0KICAgICcueGxzeCcsDQogICAgJy5wcHQnLA0KICAgICcucHB0eCcsDQogICAgJy5wZGYnDQogIF0NCiAgLy8g6Z+zL+inhumikeWQjue8gOWQjeWIl+ihqA0KICBwcml2YXRlIGF1ZGlvVmlkZW9TdWZmaXg6IHN0cmluZ1tdID0gWycubXAzJywgJy53bWEnLCAnLmF2aScsICcubXA0J10NCiAgLy8g5LiK5Lyg55qE5paH5Lu25YiX6KGoDQogIHByaXZhdGUgZmlsZUxpc3Q6IEVsVXBsb2FkSW50ZXJuYWxGaWxlRGV0YWlsW10gPSBbXQ0KDQogIC8qKg0KICAgKiDnlJ/lkb3lkajmnJ/pkqnlrZANCiAgICovDQogIGNyZWF0ZWQoKSB7fQ0KDQogIC8qKg0KICAgKiDmlofku7bnirbmgIHmlLnlj5jml7bnmoTpkqnlrZANCiAgICovDQogIHByaXZhdGUgaGFuZGxlQ2hhbmdlKA0KICAgIGZpbGU6IEVsVXBsb2FkSW50ZXJuYWxGaWxlRGV0YWlsLA0KICAgIGZpbGVMaXN0OiBFbFVwbG9hZEludGVybmFsRmlsZURldGFpbFtdDQogICkgew0KICAgIHRoaXMuZmlsZUxpc3QgPSBmaWxlTGlzdA0KICB9DQoNCiAgLyoqDQogICAqIOS4iuS8oOaWh+S7tuS5i+WJjeeahOmSqeWtkA0KICAgKi8NCiAgcHJpdmF0ZSBoYW5kbGVCZWZvcmVVcGxvYWQoZmlsZTogRWxVcGxvYWRJbnRlcm5hbFJhd0ZpbGUpIHsNCiAgICBsZXQgdmFsaWRTdWZmaXggPSB0aGlzLm1zRG9jdW1lbnRTdWZmaXguY29uY2F0KHRoaXMuYXVkaW9WaWRlb1N1ZmZpeCkNCiAgICBsZXQgZmlsZW5hbWUgPSBmaWxlLm5hbWUNCiAgICBsZXQgaW5kZXggPSBmaWxlbmFtZS5sYXN0SW5kZXhPZignLicpDQogICAgbGV0IHN1ZmZpeCA9IGZpbGVuYW1lLnN1YnN0cihpbmRleCkNCg0KICAgIGNvbnN0IGlzVmFsaWQgPSB2YWxpZFN1ZmZpeC5pbmRleE9mKHN1ZmZpeCkgIT09IC0xDQogICAgaWYgKCFpc1ZhbGlkKSB7DQogICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGDkuIrkvKDlqpLotYTmlofku7blj6rog73mmK8gJHt2YWxpZFN1ZmZpeC50b1N0cmluZygpfSDmoLzlvI/vvIFgKQ0KICAgIH0NCiAgICByZXR1cm4gaXNWYWxpZA0KICB9DQoNCiAgLyoqDQogICAqIOimhueblum7mOiupOeahOS4iuS8oOihjOS4ug0KICAgKi8NCiAgcHJpdmF0ZSBoYW5kbGVIdHRwUmVxdWVzdChvcHRpb25zOiBIdHRwUmVxdWVzdE9wdGlvbnMpIHsNCiAgICBsZXQgZmlsZSA9IG9wdGlvbnMuZmlsZQ0KICAgIGxldCBmaWxlbmFtZSA9IGZpbGUubmFtZQ0KICAgIGxldCBpbmRleCA9IGZpbGVuYW1lLmxhc3RJbmRleE9mKCcuJykNCiAgICBsZXQgc3VmZml4ID0gZmlsZW5hbWUuc3Vic3RyKGluZGV4KQ0KDQogICAgaWYgKHRoaXMuYXVkaW9WaWRlb1N1ZmZpeC5pbmRleE9mKHN1ZmZpeCkgIT09IC0xKSB7DQogICAgICAvLyDpn7Mv6KeG6aKR5LiK5Lyg5Yiw6Zi/6YeM5LqRDQogICAgICB0aGlzLmFsaXl1blVwbG9hZChmaWxlKQ0KICAgIH0gZWxzZSB7DQogICAgICAvLyDmlofmoaPkuIrkvKDliLDkuIPniZvkupENCiAgICAgIHRoaXMucWluaXV5dW5VcGxvYWQoZmlsZSkNCiAgICB9DQogIH0NCg0KICAvKioNCiAgICog5paH5qGj5LiK5Lyg5Yiw5LiD54mb5LqRDQogICAqIFRPRE86IOW8guW4uOezu+iAg+iZkSA0MDENCiAgICovDQogIHByaXZhdGUgYXN5bmMgcWluaXV5dW5VcGxvYWQoZmlsZTogRWxVcGxvYWRJbnRlcm5hbEZpbGVEZXRhaWwpIHsNCiAgICAvLyDlh4blpIflt6XkvZwNCiAgICBsZXQgcW5QYXJhbXM6IElRblBhcmFtc0RUTyA9IGF3YWl0IGdldFFuUGFyYW1zKCkNCg0KICAgIC8vIOW8gOWni+S4iuS8oA0KICAgIGxldCB0b2tlbiA9IHFuUGFyYW1zLnFuVG9rZW4NCiAgICBsZXQgY29uZmlnID0gew0KICAgICAgdXNlQ2RuRG9tYWluOiB0cnVlLA0KICAgICAgcmVnaW9uOiBudWxsIC8vIOiHquWKqOWIhuaekOS4iuS8oOWfn+WQjeWMuuWfnw0KICAgIH0NCiAgICBsZXQgcHV0RXh0cmEgPSB7DQogICAgICBmbmFtZTogJycsDQogICAgICBwYXJhbXM6IHt9LA0KICAgICAgbWltZVR5cGU6IG51bGwNCiAgICB9DQogICAgbGV0IGtleSA9IHFuUGFyYW1zLmtleQ0KDQogICAgbGV0IG5leHQgPSByZXNwb25zZSA9PiB7DQogICAgICBsZXQgdG90YWwgPSByZXNwb25zZS50b3RhbA0KICAgICAgbGV0IHBlcmNlbnRhZ2UgPSBNYXRoLmNlaWwodG90YWwucGVyY2VudCkNCiAgICAgIGNvbnNvbGUubG9nKGDlqpLotYTkuIrkvKDliLDkuIPniZvkupHov5vluqYuLi4ke3BlcmNlbnRhZ2V9JWApDQogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSkNCg0KICAgICAgLy8g5pu05paw5LiK5Lyg6L+b5bqmDQogICAgICBsZXQgY3VycmVudEZpbGUgPSB0aGlzLmZpbGVMaXN0LmZpbmQoDQogICAgICAgIChpdGVtOiBFbFVwbG9hZEludGVybmFsRmlsZURldGFpbCkgPT4gew0KICAgICAgICAgIHJldHVybiBmaWxlLnVpZCA9PSBpdGVtLnVpZA0KICAgICAgICB9DQogICAgICApDQogICAgICBpZiAoY3VycmVudEZpbGUpIHsNCiAgICAgICAgY3VycmVudEZpbGUucGVyY2VudGFnZSA9IHBlcmNlbnRhZ2UNCiAgICAgIH0NCiAgICB9DQogICAgbGV0IGVycm9yID0gcmVzcG9uc2UgPT4gew0KICAgICAgY29uc29sZS5sb2coJ+Wqkui1hOS4iuS8oOWIsOS4g+eJm+S6keWksei0pS4uLicpDQogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSkNCiAgICB9DQogICAgbGV0IGNvbXBsZXRlID0gcmVzcG9uc2UgPT4gew0KICAgICAgY29uc29sZS5sb2coJ+Wqkui1hOS4iuS8oOWIsOS4g+eJm+S6keWujOaIkC4uLicpDQogICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSkNCg0KICAgICAgLy8g5L+d5a2Y5aqS6LWE5L+h5oGvDQogICAgICB0aGlzLnNhdmVRaW5pdXl1bk1lZGlhKGZpbGUubmFtZSwgcW5QYXJhbXMpDQogICAgfQ0KDQogICAgbGV0IHN1YnNjcmlwdGlvbg0KICAgIC8vIOiwg+eUqHNka+S4iuS8oOaOpeWPo+iOt+W+l+ebuOW6lOeahG9ic2VydmFibGXvvIzmjqfliLbkuIrkvKDlkozmmoLlgZwNCiAgICBsZXQgb2JzZXJ2YWJsZSA9IHFpbml1LnVwbG9hZChmaWxlLCBrZXksIHRva2VuLCBwdXRFeHRyYSwgY29uZmlnKQ0KICAgIG9ic2VydmFibGUuc3Vic2NyaWJlKG5leHQsIGVycm9yLCBjb21wbGV0ZSkNCiAgICBjb25zb2xlLmxvZygn5aqS6LWE5LiK5Lyg5Yiw5LiD54mb5LqR5byA5aeLLi4uJykNCiAgfQ0KDQogIC8qKg0KICAgKiDpn7Mv6KeG6aKR5LiK5Lyg5Yiw6Zi/6YeM5LqRDQogICAqIFRPRE86IOW8guW4uOezu+iAg+iZkQ0KICAgKi8NCiAgcHJpdmF0ZSBhc3luYyBhbGl5dW5VcGxvYWQoZmlsZTogRWxVcGxvYWRJbnRlcm5hbEZpbGVEZXRhaWwpIHsNCiAgICBsZXQgZmlsZU5hbWUgPSBmaWxlLm5hbWUNCiAgICBsZXQgaW5kZXggPSBmaWxlTmFtZS5sYXN0SW5kZXhPZignLicpDQogICAgbGV0IHRpdGxlID0gZmlsZU5hbWUuc3Vic3RyKDAsIGluZGV4KQ0KICAgIGxldCBib2R5ID0gew0KICAgICAgZmlsZU5hbWU6IGZpbGVOYW1lLA0KICAgICAgdGl0bGU6IHRpdGxlDQogICAgfQ0KICAgIGxldCB2b2RUb2tlbjogSVZvZFRva2VuRFRPID0gYXdhaXQgZ2V0Vm9kVG9rZW4oYm9keSkNCg0KICAgIGxldCB1c2VyRGF0YSA9ICd7IlZvZCI6e319Jw0KICAgIGxldCB1cGxvYWRlciA9IHRoaXMuY3JlYXRlVXBsb2FkZXIodm9kVG9rZW4pDQogICAgdXBsb2FkZXIuYWRkRmlsZShmaWxlLCBudWxsLCBudWxsLCBudWxsLCB1c2VyRGF0YSkNCiAgICAvLyDnhLblkI7osIPnlKggc3RhcnRVcGxvYWQg5pa55rOVLCDlvIDlp4vkuIrkvKANCiAgICBpZiAodXBsb2FkZXIgIT09IG51bGwpIHsNCiAgICAgIHVwbG9hZGVyLnN0YXJ0VXBsb2FkKCkNCiAgICB9DQogIH0NCg0KICBwcml2YXRlIGNyZWF0ZVVwbG9hZGVyKHZvZFRva2VuOiBJVm9kVG9rZW5EVE8pIHsNCiAgICBsZXQgdXBsb2FkZXIgPSBuZXcgQWxpeXVuVXBsb2FkLlZvZCh7DQogICAgICB1c2VySWQ6IHZvZFRva2VuLnVzZXJJZCwNCiAgICAgIC8vIOW8gOWni+S4iuS8oA0KICAgICAgb25VcGxvYWRzdGFydGVkOiB1cGxvYWRJbmZvID0+IHsNCiAgICAgICAgY29uc29sZS5sb2coJ+Wqkui1hOS4iuS8oOWIsOmYv+mHjOS6keW8gOWniy4uLicpDQogICAgICAgIGNvbnNvbGUubG9nKHVwbG9hZEluZm8pDQoNCiAgICAgICAgdXBsb2FkZXIuc2V0VXBsb2FkQXV0aEFuZEFkZHJlc3MoDQogICAgICAgICAgdXBsb2FkSW5mbywNCiAgICAgICAgICB2b2RUb2tlbi51cGxvYWRBdXRoLA0KICAgICAgICAgIHZvZFRva2VuLnVwbG9hZEFkZHJlc3MsDQogICAgICAgICAgdm9kVG9rZW4udmlkZW9JZA0KICAgICAgICApDQogICAgICB9LA0KICAgICAgLy8g5paH5Lu25LiK5Lyg6L+b5bqm77yM5Y2V5L2N77ya5a2X6IqCLCDlj6/ku6XlnKjov5nkuKrlh73mlbDkuK3mi7/liLDkuIrkvKDov5vluqblubbmmL7npLrlnKjpobXpnaLkuIoNCiAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M6ICh1cGxvYWRJbmZvLCB0b3RhbFNpemUsIHByb2dyZXNzKSA9PiB7DQogICAgICAgIGxldCBwZXJjZW50YWdlID0gTWF0aC5jZWlsKHByb2dyZXNzICogMTAwKQ0KICAgICAgICBjb25zb2xlLmxvZyhg5aqS6LWE5LiK5Lyg5Yiw6Zi/6YeM5LqR6L+b5bqmLi4uJHtwZXJjZW50YWdlfSVgKQ0KICAgICAgICBjb25zb2xlLmxvZyh1cGxvYWRJbmZvKQ0KDQogICAgICAgIC8vIOabtOaWsOS4iuS8oOi/m+W6pg0KICAgICAgICBsZXQgY3VycmVudEZpbGUgPSB0aGlzLmZpbGVMaXN0LmZpbmQoDQogICAgICAgICAgKGl0ZW06IEVsVXBsb2FkSW50ZXJuYWxGaWxlRGV0YWlsKSA9PiB7DQogICAgICAgICAgICByZXR1cm4gdXBsb2FkSW5mby5maWxlLnVpZCA9PSBpdGVtLnVpZA0KICAgICAgICAgIH0NCiAgICAgICAgKQ0KICAgICAgICBpZiAoY3VycmVudEZpbGUpIHsNCiAgICAgICAgICBjdXJyZW50RmlsZS5wZXJjZW50YWdlID0gcGVyY2VudGFnZQ0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgLy8g5paH5Lu25LiK5Lyg5aSx6LSlDQogICAgICBvblVwbG9hZEZhaWxlZDogKHVwbG9hZEluZm8sIGNvZGUsIG1lc3NhZ2UpID0+IHsNCiAgICAgICAgY29uc29sZS5sb2coJ+Wqkui1hOS4iuS8oOWIsOmYv+mHjOS6keWksei0pS4uLicpDQogICAgICAgIGNvbnNvbGUubG9nKHVwbG9hZEluZm8pDQogICAgICB9LA0KICAgICAgLy8g5paH5Lu25LiK5Lyg5oiQ5YqfDQogICAgICBvblVwbG9hZFN1Y2NlZWQ6IHVwbG9hZEluZm8gPT4gew0KICAgICAgICBjb25zb2xlLmxvZygn5aqS6LWE5LiK5Lyg5Yiw6Zi/6YeM5LqR5a6M5oiQLi4uJykNCiAgICAgICAgY29uc29sZS5sb2codXBsb2FkSW5mbykNCg0KICAgICAgICAvLyDkv53lrZjlqpLotYTkv6Hmga8NCiAgICAgICAgdGhpcy5zYXZlQWxpeXVuTWVkaWEodXBsb2FkSW5mby5maWxlLm5hbWUsIHZvZFRva2VuKQ0KICAgICAgfQ0KICAgIH0pDQogICAgcmV0dXJuIHVwbG9hZGVyDQogIH0NCg0KICAvKioNCiAgICog5L+d5a2Y5LiD54mb5LqR5aqS6LWE5L+h5oGvDQogICAqLw0KICBwcml2YXRlIGFzeW5jIHNhdmVRaW5pdXl1bk1lZGlhKGZpbGVuYW1lOiBzdHJpbmcsIHFuUGFyYW1zOiBJUW5QYXJhbXNEVE8pIHsNCiAgICBsZXQgYm9keSA9IHsNCiAgICAgIGJ1Y2tldDogcW5QYXJhbXMuc2NvcGUsDQogICAgICBmaWxlSWQ6IHFuUGFyYW1zLmtleSwNCiAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwNCiAgICAgIHR5cGU6ICcwMDEwMDMnLCAvLyDmlofmoaMNCiAgICAgIHhjX2tleTogcW5QYXJhbXMueGNfa2V5DQogICAgfQ0KICAgIGF3YWl0IHNhdmVNZWRpYShib2R5KQ0KICB9DQoNCiAgLyoqDQogICAqIOS/neWtmOmYv+mHjOS6keWqkui1hOS/oeaBrw0KICAgKi8NCiAgcHJpdmF0ZSBhc3luYyBzYXZlQWxpeXVuTWVkaWEoZmlsZW5hbWU6IHN0cmluZywgdm9kVG9rZW46IElWb2RUb2tlbkRUTykgew0KICAgIGxldCBidWNrZXQgPSBKU09OLnBhcnNlKEJhc2U2NC5kZWNvZGUodm9kVG9rZW4udXBsb2FkQWRkcmVzcykpLkJ1Y2tldA0KICAgIGxldCBib2R5ID0gew0KICAgICAgYnVja2V0OiBidWNrZXQsDQogICAgICBmaWxlSWQ6IHZvZFRva2VuLnZpZGVvSWQsDQogICAgICBmaWxlbmFtZTogZmlsZW5hbWUsDQogICAgICB0eXBlOiAnMDAxMDAyJyAvLyDop4bpopENCiAgICB9DQogICAgYXdhaXQgc2F2ZU1lZGlhKGJvZHkpDQogIH0NCg0KICAvKioNCiAgICog5Yig6Zmk5paH5Lu2DQogICAqIFRPRE86IOiwg+eUqOWIoOmZpOaOpeWPow0KICAgKi8NCiAgcHJpdmF0ZSBoYW5kbGVEZWxldGVGaWxlKCkgew0KICAgIHRoaXMuJGNvbmZpcm0oJ+atpOaTjeS9nOWwhuawuOS5heenu+mZpOivpeaWh+S7tiwg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7DQogICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsDQogICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywNCiAgICAgIHR5cGU6ICd3YXJuaW5nJw0KICAgIH0pDQogICAgICAudGhlbigoKSA9PiB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICBtZXNzYWdlOiAn56e76Zmk5oiQ5YqfIScNCiAgICAgICAgfSkNCiAgICAgIH0pDQogICAgICAuY2F0Y2goKCkgPT4gew0KICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAnaW5mbycsDQogICAgICAgICAgbWVzc2FnZTogJ+W3suWPlua2iOenu+mZpCcNCiAgICAgICAgfSkNCiAgICAgIH0pDQogIH0NCg0KICAvKioNCiAgICog5YWz6Zet5a+56K+d5qGG5ZCO5Yi35paw5YiX6KGoDQogICAqLw0KICBwcml2YXRlIGhhbmRsZUNsb3NlZERpYWxvZygpIHsNCiAgICB0aGlzLiRlbWl0KCdjbG9zZURpYWxvZycpDQogIH0NCn0NCg=="},{"version":3,"sources":["media-add-dialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"media-add-dialog.vue","sourceRoot":"src/module-organization/pages/media-manage/components","sourcesContent":["<template>\r\n  <el-dialog title=\"上传文件\" :visible.sync=\"syncDialogVisible\" @closed=\"handleClosedDialog\">\r\n    <!-- 数据列表 -->\r\n    <el-table\r\n      class=\"dataList\"\r\n      :data=\"fileList\"\r\n      border\r\n      style=\"width: 100%\"\r\n      :header-cell-style=\"{ textAlign: 'center' }\"\r\n    >\r\n      <el-table-column prop=\"name\" label=\"文件名\" align=\"center\"></el-table-column>\r\n      <el-table-column prop=\"size\" label=\"大小\" align=\"center\"></el-table-column>\r\n      <el-table-column label=\"状态\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-progress :percentage=\"scope.row.percentage\"></el-progress>\r\n        </template>\r\n      </el-table-column>\r\n\r\n      <!-- <el-table-column label=\"操作\" align=\"center\">\r\n        <el-button type=\"text\" size=\"mini\" @click=\"handleDeleteFile\">移除</el-button>\r\n      </el-table-column>-->\r\n    </el-table>\r\n    <span slot=\"footer\" class=\"dialog-footer\">\r\n      <el-upload\r\n        action\r\n        :accept=\"msDocumentSuffix.concat(audioVideoSuffix).toString()\"\r\n        :show-file-list=\"false\"\r\n        :on-change=\"handleChange\"\r\n        :before-upload=\"handleBeforeUpload\"\r\n        :http-request=\"handleHttpRequest\"\r\n      >\r\n        <el-button>添加文件</el-button>\r\n        <!-- <el-button type=\"primary\" @click=\"dialogVisible = false\">上传</el-button> -->\r\n      </el-upload>\r\n    </span>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Vue, PropSync } from 'vue-property-decorator'\r\nimport {\r\n  ElUploadInternalRawFile,\r\n  ElUploadInternalFileDetail,\r\n  HttpRequestOptions\r\n} from 'element-ui/types/upload'\r\n\r\nimport * as qiniu from 'qiniu-js'\r\nimport { Base64 } from 'js-base64'\r\nimport { IQnParamsDTO, IVodTokenDTO } from '@/entity/media-page-list'\r\nimport { getQnParams } from '@/api/common'\r\nimport { getVodToken, saveMedia } from '@/api/media'\r\n\r\n@Component\r\nexport default class MediaAddDialog extends Vue {\r\n  @PropSync('dialogVisible', { type: Boolean, default: false })\r\n  syncDialogVisible!: boolean\r\n\r\n  // 文档后缀名列表\r\n  private msDocumentSuffix: string[] = [\r\n    '.doc',\r\n    '.docx',\r\n    '.xls',\r\n    '.xlsx',\r\n    '.ppt',\r\n    '.pptx',\r\n    '.pdf'\r\n  ]\r\n  // 音/视频后缀名列表\r\n  private audioVideoSuffix: string[] = ['.mp3', '.wma', '.avi', '.mp4']\r\n  // 上传的文件列表\r\n  private fileList: ElUploadInternalFileDetail[] = []\r\n\r\n  /**\r\n   * 生命周期钩子\r\n   */\r\n  created() {}\r\n\r\n  /**\r\n   * 文件状态改变时的钩子\r\n   */\r\n  private handleChange(\r\n    file: ElUploadInternalFileDetail,\r\n    fileList: ElUploadInternalFileDetail[]\r\n  ) {\r\n    this.fileList = fileList\r\n  }\r\n\r\n  /**\r\n   * 上传文件之前的钩子\r\n   */\r\n  private handleBeforeUpload(file: ElUploadInternalRawFile) {\r\n    let validSuffix = this.msDocumentSuffix.concat(this.audioVideoSuffix)\r\n    let filename = file.name\r\n    let index = filename.lastIndexOf('.')\r\n    let suffix = filename.substr(index)\r\n\r\n    const isValid = validSuffix.indexOf(suffix) !== -1\r\n    if (!isValid) {\r\n      this.$message.error(`上传媒资文件只能是 ${validSuffix.toString()} 格式！`)\r\n    }\r\n    return isValid\r\n  }\r\n\r\n  /**\r\n   * 覆盖默认的上传行为\r\n   */\r\n  private handleHttpRequest(options: HttpRequestOptions) {\r\n    let file = options.file\r\n    let filename = file.name\r\n    let index = filename.lastIndexOf('.')\r\n    let suffix = filename.substr(index)\r\n\r\n    if (this.audioVideoSuffix.indexOf(suffix) !== -1) {\r\n      // 音/视频上传到阿里云\r\n      this.aliyunUpload(file)\r\n    } else {\r\n      // 文档上传到七牛云\r\n      this.qiniuyunUpload(file)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 文档上传到七牛云\r\n   * TODO: 异常系考虑 401\r\n   */\r\n  private async qiniuyunUpload(file: ElUploadInternalFileDetail) {\r\n    // 准备工作\r\n    let qnParams: IQnParamsDTO = await getQnParams()\r\n\r\n    // 开始上传\r\n    let token = qnParams.qnToken\r\n    let config = {\r\n      useCdnDomain: true,\r\n      region: null // 自动分析上传域名区域\r\n    }\r\n    let putExtra = {\r\n      fname: '',\r\n      params: {},\r\n      mimeType: null\r\n    }\r\n    let key = qnParams.key\r\n\r\n    let next = response => {\r\n      let total = response.total\r\n      let percentage = Math.ceil(total.percent)\r\n      console.log(`媒资上传到七牛云进度...${percentage}%`)\r\n      console.log(response)\r\n\r\n      // 更新上传进度\r\n      let currentFile = this.fileList.find(\r\n        (item: ElUploadInternalFileDetail) => {\r\n          return file.uid == item.uid\r\n        }\r\n      )\r\n      if (currentFile) {\r\n        currentFile.percentage = percentage\r\n      }\r\n    }\r\n    let error = response => {\r\n      console.log('媒资上传到七牛云失败...')\r\n      console.log(response)\r\n    }\r\n    let complete = response => {\r\n      console.log('媒资上传到七牛云完成...')\r\n      console.log(response)\r\n\r\n      // 保存媒资信息\r\n      this.saveQiniuyunMedia(file.name, qnParams)\r\n    }\r\n\r\n    let subscription\r\n    // 调用sdk上传接口获得相应的observable，控制上传和暂停\r\n    let observable = qiniu.upload(file, key, token, putExtra, config)\r\n    observable.subscribe(next, error, complete)\r\n    console.log('媒资上传到七牛云开始...')\r\n  }\r\n\r\n  /**\r\n   * 音/视频上传到阿里云\r\n   * TODO: 异常系考虑\r\n   */\r\n  private async aliyunUpload(file: ElUploadInternalFileDetail) {\r\n    let fileName = file.name\r\n    let index = fileName.lastIndexOf('.')\r\n    let title = fileName.substr(0, index)\r\n    let body = {\r\n      fileName: fileName,\r\n      title: title\r\n    }\r\n    let vodToken: IVodTokenDTO = await getVodToken(body)\r\n\r\n    let userData = '{\"Vod\":{}}'\r\n    let uploader = this.createUploader(vodToken)\r\n    uploader.addFile(file, null, null, null, userData)\r\n    // 然后调用 startUpload 方法, 开始上传\r\n    if (uploader !== null) {\r\n      uploader.startUpload()\r\n    }\r\n  }\r\n\r\n  private createUploader(vodToken: IVodTokenDTO) {\r\n    let uploader = new AliyunUpload.Vod({\r\n      userId: vodToken.userId,\r\n      // 开始上传\r\n      onUploadstarted: uploadInfo => {\r\n        console.log('媒资上传到阿里云开始...')\r\n        console.log(uploadInfo)\r\n\r\n        uploader.setUploadAuthAndAddress(\r\n          uploadInfo,\r\n          vodToken.uploadAuth,\r\n          vodToken.uploadAddress,\r\n          vodToken.videoId\r\n        )\r\n      },\r\n      // 文件上传进度，单位：字节, 可以在这个函数中拿到上传进度并显示在页面上\r\n      onUploadProgress: (uploadInfo, totalSize, progress) => {\r\n        let percentage = Math.ceil(progress * 100)\r\n        console.log(`媒资上传到阿里云进度...${percentage}%`)\r\n        console.log(uploadInfo)\r\n\r\n        // 更新上传进度\r\n        let currentFile = this.fileList.find(\r\n          (item: ElUploadInternalFileDetail) => {\r\n            return uploadInfo.file.uid == item.uid\r\n          }\r\n        )\r\n        if (currentFile) {\r\n          currentFile.percentage = percentage\r\n        }\r\n      },\r\n      // 文件上传失败\r\n      onUploadFailed: (uploadInfo, code, message) => {\r\n        console.log('媒资上传到阿里云失败...')\r\n        console.log(uploadInfo)\r\n      },\r\n      // 文件上传成功\r\n      onUploadSucceed: uploadInfo => {\r\n        console.log('媒资上传到阿里云完成...')\r\n        console.log(uploadInfo)\r\n\r\n        // 保存媒资信息\r\n        this.saveAliyunMedia(uploadInfo.file.name, vodToken)\r\n      }\r\n    })\r\n    return uploader\r\n  }\r\n\r\n  /**\r\n   * 保存七牛云媒资信息\r\n   */\r\n  private async saveQiniuyunMedia(filename: string, qnParams: IQnParamsDTO) {\r\n    let body = {\r\n      bucket: qnParams.scope,\r\n      fileId: qnParams.key,\r\n      filename: filename,\r\n      type: '001003', // 文档\r\n      xc_key: qnParams.xc_key\r\n    }\r\n    await saveMedia(body)\r\n  }\r\n\r\n  /**\r\n   * 保存阿里云媒资信息\r\n   */\r\n  private async saveAliyunMedia(filename: string, vodToken: IVodTokenDTO) {\r\n    let bucket = JSON.parse(Base64.decode(vodToken.uploadAddress)).Bucket\r\n    let body = {\r\n      bucket: bucket,\r\n      fileId: vodToken.videoId,\r\n      filename: filename,\r\n      type: '001002' // 视频\r\n    }\r\n    await saveMedia(body)\r\n  }\r\n\r\n  /**\r\n   * 删除文件\r\n   * TODO: 调用删除接口\r\n   */\r\n  private handleDeleteFile() {\r\n    this.$confirm('此操作将永久移除该文件, 是否继续?', '提示', {\r\n      confirmButtonText: '确定',\r\n      cancelButtonText: '取消',\r\n      type: 'warning'\r\n    })\r\n      .then(() => {\r\n        this.$message({\r\n          type: 'success',\r\n          message: '移除成功!'\r\n        })\r\n      })\r\n      .catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '已取消移除'\r\n        })\r\n      })\r\n  }\r\n\r\n  /**\r\n   * 关闭对话框后刷新列表\r\n   */\r\n  private handleClosedDialog() {\r\n    this.$emit('closeDialog')\r\n  }\r\n}\r\n</script>\r\n"]}]}