{"remainingRequest":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\babel-loader\\lib\\index.js!E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\static\\plugins\\webuploader\\dist\\webuploader.js","dependencies":[{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\static\\plugins\\webuploader\\dist\\webuploader.js","mtime":1520131502865},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660903053464},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\babel-loader\\lib\\index.js","mtime":1576202003988},{"path":"E:\\course\\2022\\学成在线\\front_code\\project-xczx2-portal-vue-ts\\node_modules\\eslint-loader\\index.js","mtime":1577501200723}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0YS12aWV3IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnBhcnNlLWZsb2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtaW50IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLm1hdGNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnVpbnQ4LWFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuY29weS13aXRoaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5ldmVyeSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbGwiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1pbmRleCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lmxhc3QtaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UtcmlnaHQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZXZlcnNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnN1YmFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tbG9jYWxlLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsIjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiRTpcXGNvdXJzZVxcMjAyMlxcXHU1QjY2XHU2MjEwXHU1NzI4XHU3RUJGXFxmcm9udF9jb2RlXFxwcm9qZWN0LXhjengyLXBvcnRhbC12dWUtdHNcXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lLWNvcmVqczMvaGVscGVycy9lc20vdHlwZW9mIjsKCi8qISBXZWJVcGxvYWRlciAwLjEuNy1hbHBoYSAqLwoKLyoqCiAqIEBmaWxlT3ZlcnZpZXcg6K6p5YaF6YOo5ZCE5Liq6YOo5Lu255qE5Luj56CB5Y+v5Lul55SoW2FtZF0oaHR0cHM6Ly9naXRodWIuY29tL2FtZGpzL2FtZGpzLWFwaS93aWtpL0FNRCnmqKHlnZflrprkuYnmlrnlvI/nu4Tnu4fotbfmnaXjgIIKICoKICogQU1EIEFQSSDlhoXpg6jnmoTnroDljZXkuI3lrozlhajlrp7njrDvvIzor7flv73nlaXjgILlj6rmnInlvZNXZWJVcGxvYWRlcuiiq+WQiOW5tuaIkOS4gOS4quaWh+S7tueahOaXtuWAmeaJjeS8muW8leWFpeOAggogKi8KaW1wb3J0IGpRdWVyeSBmcm9tICIuL2pxdWVyeS5qcyI7CgooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsKICB2YXIgbW9kdWxlcyA9IHt9LAogICAgICAvLyDlhoXpg6hyZXF1aXJlLCDnroDljZXkuI3lrozlhajlrp7njrDjgIIKICAvLyBodHRwczovL2dpdGh1Yi5jb20vYW1kanMvYW1kanMtYXBpL3dpa2kvcmVxdWlyZQogIF9yZXF1aXJlID0gZnVuY3Rpb24gX3JlcXVpcmUoZGVwcywgY2FsbGJhY2spIHsKICAgIHZhciBhcmdzLCBsZW4sIGk7IC8vIOWmguaenGRlcHPkuI3mmK/mlbDnu4TvvIzliJnnm7TmjqXov5Tlm57mjIflrpptb2R1bGUKCiAgICBpZiAodHlwZW9mIGRlcHMgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBnZXRNb2R1bGUoZGVwcyk7CiAgICB9IGVsc2UgewogICAgICBhcmdzID0gW107CgogICAgICBmb3IgKGxlbiA9IGRlcHMubGVuZ3RoLCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgYXJncy5wdXNoKGdldE1vZHVsZShkZXBzW2ldKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseShudWxsLCBhcmdzKTsKICAgIH0KICB9LAogICAgICAvLyDlhoXpg6hkZWZpbmXvvIzmmoLml7bkuI3mlK/mjIHkuI3mjIflrpppZC4KICBfZGVmaW5lID0gZnVuY3Rpb24gX2RlZmluZShpZCwgZGVwcywgZmFjdG9yeSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgZmFjdG9yeSA9IGRlcHM7CiAgICAgIGRlcHMgPSBudWxsOwogICAgfQoKICAgIF9yZXF1aXJlKGRlcHMgfHwgW10sIGZ1bmN0aW9uICgpIHsKICAgICAgc2V0TW9kdWxlKGlkLCBmYWN0b3J5LCBhcmd1bWVudHMpOwogICAgfSk7CiAgfSwKICAgICAgLy8g6K6+572ubW9kdWxlLCDlhbzlrrlDb21tb25Kc+WGmeazleOAggogIHNldE1vZHVsZSA9IGZ1bmN0aW9uIHNldE1vZHVsZShpZCwgZmFjdG9yeSwgYXJncykgewogICAgdmFyIG1vZHVsZSA9IHsKICAgICAgZXhwb3J0czogZmFjdG9yeQogICAgfSwKICAgICAgICByZXR1cm5lZDsKCiAgICBpZiAodHlwZW9mIGZhY3RvcnkgPT09ICdmdW5jdGlvbicpIHsKICAgICAgYXJncy5sZW5ndGggfHwgKGFyZ3MgPSBbX3JlcXVpcmUsIG1vZHVsZS5leHBvcnRzLCBtb2R1bGVdKTsKICAgICAgcmV0dXJuZWQgPSBmYWN0b3J5LmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICByZXR1cm5lZCAhPT0gdW5kZWZpbmVkICYmIChtb2R1bGUuZXhwb3J0cyA9IHJldHVybmVkKTsKICAgIH0KCiAgICBtb2R1bGVzW2lkXSA9IG1vZHVsZS5leHBvcnRzOwogIH0sCiAgICAgIC8vIOagueaNrmlk6I635Y+WbW9kdWxlCiAgZ2V0TW9kdWxlID0gZnVuY3Rpb24gZ2V0TW9kdWxlKGlkKSB7CiAgICB2YXIgbW9kdWxlID0gbW9kdWxlc1tpZF0gfHwgcm9vdFtpZF07CgogICAgaWYgKCFtb2R1bGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdgJyArIGlkICsgJ2AgaXMgdW5kZWZpbmVkJyk7CiAgICB9CgogICAgcmV0dXJuIG1vZHVsZTsKICB9LAogICAgICAvLyDlsIbmiYDmnIltb2R1bGVz77yM5bCG6Lev5b6EaWRz6KOF5o2i5oiQ5a+56LGh44CCCiAgZXhwb3J0c1RvID0gZnVuY3Rpb24gZXhwb3J0c1RvKG9iaikgewogICAgdmFyIGtleSwgaG9zdCwgcGFydHMsIHBhcnQsIGxhc3QsIHVjRmlyc3Q7IC8vIG1ha2UgdGhlIGZpcnN0IGNoYXJhY3RlciB1cHBlciBjYXNlLgoKICAgIHVjRmlyc3QgPSBmdW5jdGlvbiB1Y0ZpcnN0KHN0cikgewogICAgICByZXR1cm4gc3RyICYmIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zdWJzdHIoMSk7CiAgICB9OwoKICAgIGZvciAoa2V5IGluIG1vZHVsZXMpIHsKICAgICAgaG9zdCA9IG9iajsKCiAgICAgIGlmICghbW9kdWxlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHBhcnRzID0ga2V5LnNwbGl0KCcvJyk7CiAgICAgIGxhc3QgPSB1Y0ZpcnN0KHBhcnRzLnBvcCgpKTsKCiAgICAgIHdoaWxlIChwYXJ0ID0gdWNGaXJzdChwYXJ0cy5zaGlmdCgpKSkgewogICAgICAgIGhvc3RbcGFydF0gPSBob3N0W3BhcnRdIHx8IHt9OwogICAgICAgIGhvc3QgPSBob3N0W3BhcnRdOwogICAgICB9CgogICAgICBob3N0W2xhc3RdID0gbW9kdWxlc1trZXldOwogICAgfQoKICAgIHJldHVybiBvYmo7CiAgfSwKICAgICAgbWFrZUV4cG9ydCA9IGZ1bmN0aW9uIG1ha2VFeHBvcnQoZG9sbGFyKSB7CiAgICByb290Ll9fZG9sbGFyID0gZG9sbGFyOyAvLyBleHBvcnRzIGV2ZXJ5IG1vZHVsZS4KCiAgICByZXR1cm4gZXhwb3J0c1RvKGZhY3Rvcnkocm9vdCwgX2RlZmluZSwgX3JlcXVpcmUpKTsKICB9LAogICAgICBvcmlnaW47CgogIGlmICgodHlwZW9mIG1vZHVsZSA9PT0gInVuZGVmaW5lZCIgPyAidW5kZWZpbmVkIiA6IF90eXBlb2YobW9kdWxlKSkgPT09ICdvYmplY3QnICYmIF90eXBlb2YobW9kdWxlLmV4cG9ydHMpID09PSAnb2JqZWN0JykgewogICAgLy8gRm9yIENvbW1vbkpTIGFuZCBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB3aGVyZSBhIHByb3BlciB3aW5kb3cgaXMgcHJlc2VudCwKICAgIG1vZHVsZS5leHBvcnRzID0gbWFrZUV4cG9ydCgpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAvLyBBbGxvdyB1c2luZyB0aGlzIGJ1aWx0IGxpYnJhcnkgYXMgYW4gQU1EIG1vZHVsZQogICAgLy8gaW4gYW5vdGhlciBwcm9qZWN0LiBUaGF0IG90aGVyIHByb2plY3Qgd2lsbCBvbmx5CiAgICAvLyBzZWUgdGhpcyBBTUQgY2FsbCwgbm90IHRoZSBpbnRlcm5hbCBtb2R1bGVzIGluCiAgICAvLyB0aGUgY2xvc3VyZSBiZWxvdy4KICAgIGRlZmluZShbJ2pxdWVyeSddLCBtYWtlRXhwb3J0KTsKICB9IGVsc2UgewogICAgLy8gQnJvd3NlciBnbG9iYWxzIGNhc2UuIEp1c3QgYXNzaWduIHRoZQogICAgLy8gcmVzdWx0IHRvIGEgcHJvcGVydHkgb24gdGhlIGdsb2JhbC4KICAgIG9yaWdpbiA9IHJvb3QuV2ViVXBsb2FkZXI7CiAgICByb290LldlYlVwbG9hZGVyID0gbWFrZUV4cG9ydCgpOwoKICAgIHJvb3QuV2ViVXBsb2FkZXIubm9Db25mbGljdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcm9vdC5XZWJVcGxvYWRlciA9IG9yaWdpbjsKICAgIH07CiAgfQp9KSh3aW5kb3csIGZ1bmN0aW9uICh3aW5kb3csIGRlZmluZSwgcmVxdWlyZSkgewogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgalF1ZXJ5IG9yIFplcHRvCiAgICogQHJlcXVpcmUgImpxdWVyeSIKICAgKiBAcmVxdWlyZSAiemVwdG8iCiAgICovCiAgZGVmaW5lKCdkb2xsYXItdGhpcmQnLCBbXSwgZnVuY3Rpb24gKCkgewogICAgdmFyIHJlcSA9IHdpbmRvdy5yZXF1aXJlOyAvLyB2YXIgJCA9IHdpbmRvdy5fX2RvbGxhciB8fAogICAgLy8gICAgIHdpbmRvdy5qUXVlcnkgfHwKICAgIC8vICAgICB3aW5kb3cuWmVwdG8gfHwKICAgIC8vICAgICByZXEoJ2pxdWVyeScpIHx8CiAgICAvLyAgICAgcmVxKCd6ZXB0bycpOwoKICAgIHZhciAkID0gd2luZG93Ll9fZG9sbGFyIHx8IGpRdWVyeSB8fCB3aW5kb3cuWmVwdG87CgogICAgaWYgKCEkKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignalF1ZXJ5IG9yIFplcHRvIG5vdCBmb3VuZCEnKTsKICAgIH0KCiAgICByZXR1cm4gJDsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IERvbSDmk43kvZznm7jlhbMKICAgKi8KCiAgZGVmaW5lKCdkb2xsYXInLCBbJ2RvbGxhci10aGlyZCddLCBmdW5jdGlvbiAoXykgewogICAgcmV0dXJuIF87CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDkvb/nlKhqUXVlcnnnmoRQcm9taXNlCiAgICovCgogIGRlZmluZSgncHJvbWlzZS10aGlyZCcsIFsnZG9sbGFyJ10sIGZ1bmN0aW9uICgkKSB7CiAgICByZXR1cm4gewogICAgICBEZWZlcnJlZDogJC5EZWZlcnJlZCwKICAgICAgd2hlbjogJC53aGVuLAogICAgICBpc1Byb21pc2U6IGZ1bmN0aW9uIGlzUHJvbWlzZShhbnl0aGluZykgewogICAgICAgIHJldHVybiBhbnl0aGluZyAmJiB0eXBlb2YgYW55dGhpbmcudGhlbiA9PT0gJ2Z1bmN0aW9uJzsKICAgICAgfQogICAgfTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IFByb21pc2UvQSsKICAgKi8KCiAgZGVmaW5lKCdwcm9taXNlJywgWydwcm9taXNlLXRoaXJkJ10sIGZ1bmN0aW9uIChfKSB7CiAgICByZXR1cm4gXzsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IOWfuuehgOexu+aWueazleOAggogICAqLwoKICAvKioKICAgKiBXZWIgVXBsb2FkZXLlhoXpg6jnsbvnmoTor6bnu4bor7TmmI7vvIzku6XkuIvmj5Dlj4rnmoTlip/og73nsbvvvIzpg73lj6/ku6XlnKhgV2ViVXBsb2FkZXJg6L+Z5Liq5Y+Y6YeP5Lit6K6/6Zeu5Yiw44CCCiAgICoKICAgKiBBcyB5b3Uga25vdywgV2ViIFVwbG9hZGVy55qE5q+P5Liq5paH5Lu26YO95piv55So6L+HW0FNRF0oaHR0cHM6Ly9naXRodWIuY29tL2FtZGpzL2FtZGpzLWFwaS93aWtpL0FNRCnop4TojIPkuK3nmoRgZGVmaW5lYOe7hOe7h+i1t+adpeeahCwg5q+P5LiqTW9kdWxl6YO95Lya5pyJ5LiqbW9kdWxlIGlkLgogICAqIOm7mOiupG1vZHVsZSBpZOS4uuivpeaWh+S7tueahOi3r+W+hO+8jOiAjOatpOi3r+W+hOWwhuS8mui9rOWMluaIkOWQjeWtl+epuumXtOWtmOaUvuWcqFdlYlVwbG9hZGVy5Lit44CC5aaC77yaCiAgICoKICAgKiAqIG1vZHVsZSBgYmFzZWDvvJpXZWJVcGxvYWRlci5CYXNlCiAgICogKiBtb2R1bGUgYGZpbGVgOiBXZWJVcGxvYWRlci5GaWxlCiAgICogKiBtb2R1bGUgYGxpYi9kbmRgOiBXZWJVcGxvYWRlci5MaWIuRG5kCiAgICogKiBtb2R1bGUgYHJ1bnRpbWUvaHRtbDUvZG5kYDogV2ViVXBsb2FkZXIuUnVudGltZS5IdG1sNS5EbmQKICAgKgogICAqCiAgICog5Lul5LiL5paH5qGj5Lit5a+557G755qE5L2/55So5Y+v6IO955yB55Wl5o6J5LqGYFdlYlVwbG9hZGVyYOWJjee8gOOAggogICAqIEBtb2R1bGUgV2ViVXBsb2FkZXIKICAgKiBAdGl0bGUgV2ViVXBsb2FkZXIgQVBJ5paH5qGjCiAgICovCgogIGRlZmluZSgnYmFzZScsIFsnZG9sbGFyJywgJ3Byb21pc2UnXSwgZnVuY3Rpb24gKCQsIHByb21pc2UpIHsKICAgIHZhciBub29wID0gZnVuY3Rpb24gbm9vcCgpIHt9LAogICAgICAgIGNhbGwgPSBGdW5jdGlvbi5jYWxsOyAvLyBodHRwOi8vanNwZXJmLmNvbS91bmN1cnJ5dGhpcwogICAgLy8g5Y+N56eR6YeM5YyWCgoKICAgIGZ1bmN0aW9uIHVuY3VycnlUaGlzKGZuKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGNhbGwuYXBwbHkoZm4sIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYmluZEZuKGZuLCBjb250ZXh0KSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlT2JqZWN0KHByb3RvKSB7CiAgICAgIHZhciBmOwoKICAgICAgaWYgKE9iamVjdC5jcmVhdGUpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShwcm90byk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZiA9IGZ1bmN0aW9uIGYoKSB7fTsKCiAgICAgICAgZi5wcm90b3R5cGUgPSBwcm90bzsKICAgICAgICByZXR1cm4gbmV3IGYoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiDln7rnoYDnsbvvvIzmj5DkvpvkuIDkupvnroDljZXluLjnlKjnmoTmlrnms5XjgIIKICAgICAqIEBjbGFzcyBCYXNlCiAgICAgKi8KCgogICAgcmV0dXJuIHsKICAgICAgLyoqCiAgICAgICAqIEBwcm9wZXJ0eSB7U3RyaW5nfSB2ZXJzaW9uIOW9k+WJjeeJiOacrOWPt+OAggogICAgICAgKi8KICAgICAgdmVyc2lvbjogJzAuMS43LWFscGhhJywKCiAgICAgIC8qKgogICAgICAgKiBAcHJvcGVydHkge2pRdWVyeXxaZXB0b30gJCDlvJXnlKjkvp3otZbnmoRqUXVlcnnmiJbogIVaZXB0b+WvueixoeOAggogICAgICAgKi8KICAgICAgJDogJCwKICAgICAgRGVmZXJyZWQ6IHByb21pc2UuRGVmZXJyZWQsCiAgICAgIGlzUHJvbWlzZTogcHJvbWlzZS5pc1Byb21pc2UsCiAgICAgIHdoZW46IHByb21pc2Uud2hlbiwKCiAgICAgIC8qKgogICAgICAgKiBAZGVzY3JpcHRpb24gIOeugOWNleeahOa1j+iniOWZqOajgOafpee7k+aenOOAggogICAgICAgKgogICAgICAgKiAqIGB3ZWJraXRgICB3ZWJraXTniYjmnKzlj7fvvIzlpoLmnpzmtY/op4jlmajkuLrpnZ53ZWJraXTlhoXmoLjvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKiAqIGBjaHJvbWVgICBjaHJvbWXmtY/op4jlmajniYjmnKzlj7fvvIzlpoLmnpzmtY/op4jlmajkuLpjaHJvbWXvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKiAqIGBpZWAgIGll5rWP6KeI5Zmo54mI5pys5Y+377yM5aaC5p6c5rWP6KeI5Zmo5Li66Z2eaWXvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAgioq5pqC5LiN5pSv5oyBaWUxMCsqKgogICAgICAgKiAqIGBmaXJlZm94YCAgZmlyZWZveOa1j+iniOWZqOeJiOacrOWPt++8jOWmguaenOa1j+iniOWZqOS4uumdnmZpcmVmb3jvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKiAqIGBzYWZhcmlgICBzYWZhcmnmtY/op4jlmajniYjmnKzlj7fvvIzlpoLmnpzmtY/op4jlmajkuLrpnZ5zYWZhcmnvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKiAqIGBvcGVyYWAgIG9wZXJh5rWP6KeI5Zmo54mI5pys5Y+377yM5aaC5p6c5rWP6KeI5Zmo5Li66Z2eb3BlcmHvvIzmraTlsZ7mgKfkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKgogICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gW2Jyb3dzZXJdCiAgICAgICAqLwogICAgICBicm93c2VyOiBmdW5jdGlvbiAodWEpIHsKICAgICAgICB2YXIgcmV0ID0ge30sCiAgICAgICAgICAgIHdlYmtpdCA9IHVhLm1hdGNoKC9XZWJLaXRcLyhbXGQuXSspLyksCiAgICAgICAgICAgIGNocm9tZSA9IHVhLm1hdGNoKC9DaHJvbWVcLyhbXGQuXSspLykgfHwgdWEubWF0Y2goL0NyaU9TXC8oW1xkLl0rKS8pLAogICAgICAgICAgICBpZSA9IHVhLm1hdGNoKC9NU0lFXHMoW1xkXC5dKykvKSB8fCB1YS5tYXRjaCgvKD86dHJpZGVudCkoPzouKnJ2OihbXHcuXSspKT8vaSksCiAgICAgICAgICAgIGZpcmVmb3ggPSB1YS5tYXRjaCgvRmlyZWZveFwvKFtcZC5dKykvKSwKICAgICAgICAgICAgc2FmYXJpID0gdWEubWF0Y2goL1NhZmFyaVwvKFtcZC5dKykvKSwKICAgICAgICAgICAgb3BlcmEgPSB1YS5tYXRjaCgvT1BSXC8oW1xkLl0rKS8pOwogICAgICAgIHdlYmtpdCAmJiAocmV0LndlYmtpdCA9IHBhcnNlRmxvYXQod2Via2l0WzFdKSk7CiAgICAgICAgY2hyb21lICYmIChyZXQuY2hyb21lID0gcGFyc2VGbG9hdChjaHJvbWVbMV0pKTsKICAgICAgICBpZSAmJiAocmV0LmllID0gcGFyc2VGbG9hdChpZVsxXSkpOwogICAgICAgIGZpcmVmb3ggJiYgKHJldC5maXJlZm94ID0gcGFyc2VGbG9hdChmaXJlZm94WzFdKSk7CiAgICAgICAgc2FmYXJpICYmIChyZXQuc2FmYXJpID0gcGFyc2VGbG9hdChzYWZhcmlbMV0pKTsKICAgICAgICBvcGVyYSAmJiAocmV0Lm9wZXJhID0gcGFyc2VGbG9hdChvcGVyYVsxXSkpOwogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0obmF2aWdhdG9yLnVzZXJBZ2VudCksCgogICAgICAvKioKICAgICAgICogQGRlc2NyaXB0aW9uICDmk43kvZzns7vnu5/mo4Dmn6Xnu5PmnpzjgIIKICAgICAgICoKICAgICAgICogKiBgYW5kcm9pZGAgIOWmguaenOWcqGFuZHJvaWTmtY/op4jlmajnjq/looPkuIvvvIzmraTlgLzkuLrlr7nlupTnmoRhbmRyb2lk54mI5pys5Y+377yM5ZCm5YiZ5Li6YHVuZGVmaW5lZGDjgIIKICAgICAgICogKiBgaW9zYCDlpoLmnpzlnKhpb3PmtY/op4jlmajnjq/looPkuIvvvIzmraTlgLzkuLrlr7nlupTnmoRpb3PniYjmnKzlj7fvvIzlkKbliJnkuLpgdW5kZWZpbmVkYOOAggogICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gW29zXQogICAgICAgKi8KICAgICAgb3M6IGZ1bmN0aW9uICh1YSkgewogICAgICAgIHZhciByZXQgPSB7fSwKICAgICAgICAgICAgLy8gb3N4ID0gISF1YS5tYXRjaCggL1woTWFjaW50b3NoXDsgSW50ZWwgLyApLAogICAgICAgIGFuZHJvaWQgPSB1YS5tYXRjaCgvKD86QW5kcm9pZCk7P1tcc1wvXSsoW1xkLl0rKT8vKSwKICAgICAgICAgICAgaW9zID0gdWEubWF0Y2goLyg/OmlQYWR8aVBvZHxpUGhvbmUpLipPU1xzKFtcZF9dKykvKTsgLy8gb3N4ICYmIChyZXQub3N4ID0gdHJ1ZSk7CgogICAgICAgIGFuZHJvaWQgJiYgKHJldC5hbmRyb2lkID0gcGFyc2VGbG9hdChhbmRyb2lkWzFdKSk7CiAgICAgICAgaW9zICYmIChyZXQuaW9zID0gcGFyc2VGbG9hdChpb3NbMV0ucmVwbGFjZSgvXy9nLCAnLicpKSk7CiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfShuYXZpZ2F0b3IudXNlckFnZW50KSwKCiAgICAgIC8qKgogICAgICAgKiDlrp7njrDnsbvkuI7nsbvkuYvpl7TnmoTnu6fmib/jgIIKICAgICAgICogQG1ldGhvZCBpbmhlcml0cwogICAgICAgKiBAZ3JhbW1hciBCYXNlLmluaGVyaXRzKCBzdXBlciApID0+IGNoaWxkCiAgICAgICAqIEBncmFtbWFyIEJhc2UuaW5oZXJpdHMoIHN1cGVyLCBwcm90b3MgKSA9PiBjaGlsZAogICAgICAgKiBAZ3JhbW1hciBCYXNlLmluaGVyaXRzKCBzdXBlciwgcHJvdG9zLCBzdGF0aWNzICkgPT4gY2hpbGQKICAgICAgICogQHBhcmFtICB7Q2xhc3N9IHN1cGVyIOeItuexuwogICAgICAgKiBAcGFyYW0gIHtPYmplY3QgfCBGdW5jdGlvbn0gW3Byb3Rvc10g5a2Q57G75oiW6ICF5a+56LGh44CC5aaC5p6c5a+56LGh5Lit5YyF5ZCrY29uc3RydWN0b3LvvIzlrZDnsbvlsIbmmK/nlKjmraTlsZ7mgKflgLzjgIIKICAgICAgICogQHBhcmFtICB7RnVuY3Rpb259IFtwcm90b3MuY29uc3RydWN0b3JdIOWtkOexu+aehOmAoOWZqO+8jOS4jeaMh+WumueahOivneWwhuWIm+W7uuS4quS4tOaXtueahOebtOaOpeaJp+ihjOeItuexu+aehOmAoOWZqOeahOaWueazleOAggogICAgICAgKiBAcGFyYW0gIHtPYmplY3R9IFtzdGF0aWNzXSDpnZnmgIHlsZ7mgKfmiJbmlrnms5XjgIIKICAgICAgICogQHJldHVybiB7Q2xhc3N9IOi/lOWbnuWtkOexu+OAggogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiBmdW5jdGlvbiBQZXJzb24oKSB7CiAgICAgICAqICAgICBjb25zb2xlLmxvZyggJ1N1cGVyJyApOwogICAgICAgKiB9CiAgICAgICAqIFBlcnNvbi5wcm90b3R5cGUuaGVsbG8gPSBmdW5jdGlvbigpIHsKICAgICAgICogICAgIGNvbnNvbGUubG9nKCAnaGVsbG8nICk7CiAgICAgICAqIH07CiAgICAgICAqCiAgICAgICAqIHZhciBNYW5hZ2VyID0gQmFzZS5pbmhlcml0cyggUGVyc29uLCB7CiAgICAgICAqICAgICB3b3JsZDogZnVuY3Rpb24oKSB7CiAgICAgICAqICAgICAgICAgY29uc29sZS5sb2coICdXb3JsZCcgKTsKICAgICAgICogICAgIH0KICAgICAgICogfSk7CiAgICAgICAqCiAgICAgICAqIC8vIOWboOS4uuayoeacieaMh+WumuaehOmAoOWZqO+8jOeItuexu+eahOaehOmAoOWZqOWwhuS8muaJp+ihjOOAggogICAgICAgKiB2YXIgaW5zdGFuY2UgPSBuZXcgTWFuYWdlcigpOyAgICAvLyA9PiBTdXBlcgogICAgICAgKgogICAgICAgKiAvLyDnu6fmib/lrZDniLbnsbvnmoTmlrnms5UKICAgICAgICogaW5zdGFuY2UuaGVsbG8oKTsgICAgLy8gPT4gaGVsbG8KICAgICAgICogaW5zdGFuY2Uud29ybGQoKTsgICAgLy8gPT4gV29ybGQKICAgICAgICoKICAgICAgICogLy8g5a2Q57G755qEX19zdXBlcl9f5bGe5oCn5oyH5ZCR54i257G7CiAgICAgICAqIGNvbnNvbGUubG9nKCBNYW5hZ2VyLl9fc3VwZXJfXyA9PT0gUGVyc29uICk7ICAgIC8vID0+IHRydWUKICAgICAgICovCiAgICAgIGluaGVyaXRzOiBmdW5jdGlvbiBpbmhlcml0cyhTdXBlciwgcHJvdG9zLCBzdGF0aWNQcm90b3MpIHsKICAgICAgICB2YXIgY2hpbGQ7CgogICAgICAgIGlmICh0eXBlb2YgcHJvdG9zID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBjaGlsZCA9IHByb3RvczsKICAgICAgICAgIHByb3RvcyA9IG51bGw7CiAgICAgICAgfSBlbHNlIGlmIChwcm90b3MgJiYgcHJvdG9zLmhhc093blByb3BlcnR5KCdjb25zdHJ1Y3RvcicpKSB7CiAgICAgICAgICBjaGlsZCA9IHByb3Rvcy5jb25zdHJ1Y3RvcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2hpbGQgPSBmdW5jdGlvbiBjaGlsZCgpIHsKICAgICAgICAgICAgcmV0dXJuIFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9OwogICAgICAgIH0gLy8g5aSN5Yi26Z2Z5oCB5pa55rOVCgoKICAgICAgICAkLmV4dGVuZCh0cnVlLCBjaGlsZCwgU3VwZXIsIHN0YXRpY1Byb3RvcyB8fCB7fSk7CiAgICAgICAgLyoganNoaW50IGNhbWVsY2FzZTogZmFsc2UgKi8KICAgICAgICAvLyDorqnlrZDnsbvnmoRfX3N1cGVyX1/lsZ7mgKfmjIflkJHniLbnsbvjgIIKCiAgICAgICAgY2hpbGQuX19zdXBlcl9fID0gU3VwZXIucHJvdG90eXBlOyAvLyDmnoTlu7rljp/lnovvvIzmt7vliqDljp/lnovmlrnms5XmiJblsZ7mgKfjgIIKICAgICAgICAvLyDmmoLml7bnlKhPYmplY3QuY3JlYXRl5a6e546w44CCCgogICAgICAgIGNoaWxkLnByb3RvdHlwZSA9IGNyZWF0ZU9iamVjdChTdXBlci5wcm90b3R5cGUpOwogICAgICAgIHByb3RvcyAmJiAkLmV4dGVuZCh0cnVlLCBjaGlsZC5wcm90b3R5cGUsIHByb3Rvcyk7CiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOS4gOS4quS4jeWBmuS7u+S9leS6i+aDheeahOaWueazleOAguWPr+S7peeUqOadpei1i+WAvOe7mem7mOiupOeahGNhbGxiYWNrLgogICAgICAgKiBAbWV0aG9kIG5vb3AKICAgICAgICovCiAgICAgIG5vb3A6IG5vb3AsCgogICAgICAvKioKICAgICAgICog6L+U5Zue5LiA5Liq5paw55qE5pa55rOV77yM5q2k5pa55rOV5bCG5bey5oyH5a6a55qEYGNvbnRleHRg5p2l5omn6KGM44CCCiAgICAgICAqIEBncmFtbWFyIEJhc2UuYmluZEZuKCBmbiwgY29udGV4dCApID0+IEZ1bmN0aW9uCiAgICAgICAqIEBtZXRob2QgYmluZEZuCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIHZhciBkb1NvbWV0aGluZyA9IGZ1bmN0aW9uKCkgewogICAgICAgKiAgICAgICAgIGNvbnNvbGUubG9nKCB0aGlzLm5hbWUgKTsKICAgICAgICogICAgIH0sCiAgICAgICAqICAgICBvYmogPSB7CiAgICAgICAqICAgICAgICAgbmFtZTogJ09iamVjdCBOYW1lJwogICAgICAgKiAgICAgfSwKICAgICAgICogICAgIGFsaWFzRm4gPSBCYXNlLmJpbmQoIGRvU29tZXRoaW5nLCBvYmogKTsKICAgICAgICoKICAgICAgICogIGFsaWFzRm4oKTsgICAgLy8gPT4gT2JqZWN0IE5hbWUKICAgICAgICoKICAgICAgICovCiAgICAgIGJpbmRGbjogYmluZEZuLAoKICAgICAgLyoqCiAgICAgICAqIOW8leeUqENvbnNvbGUubG9n5aaC5p6c5a2Y5Zyo55qE6K+d77yM5ZCm5YiZ5byV55So5LiA5LiqW+epuuWHveaVsG5vb3BdKCNXZWJVcGxvYWRlcjpCYXNlLm5vb3Ap44CCCiAgICAgICAqIEBncmFtbWFyIEJhc2UubG9nKCBhcmdzLi4uICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBtZXRob2QgbG9nCiAgICAgICAqLwogICAgICBsb2c6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAod2luZG93LmNvbnNvbGUpIHsKICAgICAgICAgIHJldHVybiBiaW5kRm4oY29uc29sZS5sb2csIGNvbnNvbGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5vb3A7CiAgICAgIH0oKSwKICAgICAgbmV4dFRpY2s6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNiKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGNiLCAxKTsKICAgICAgICB9OyAvLyBAYnVnIOW9k+a1j+iniOWZqOS4jeWcqOW9k+WJjeeql+WPo+aXtuWwseWBnOS6huOAggogICAgICAgIC8vIHZhciBuZXh0ID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fAogICAgICAgIC8vICAgICB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8CiAgICAgICAgLy8gICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwKICAgICAgICAvLyAgICAgZnVuY3Rpb24oIGNiICkgewogICAgICAgIC8vICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoIGNiLCAxMDAwIC8gNjAgKTsKICAgICAgICAvLyAgICAgfTsKICAgICAgICAvLyAvLyBmaXg6IFVuY2F1Z2h0IFR5cGVFcnJvcjogSWxsZWdhbCBpbnZvY2F0aW9uCiAgICAgICAgLy8gcmV0dXJuIGJpbmRGbiggbmV4dCwgd2luZG93ICk7CiAgICAgIH0oKSwKCiAgICAgIC8qKgogICAgICAgKiDooqtbdW5jdXJyeXRoaXNdKGh0dHA6Ly93d3cuMmFsaXR5LmNvbS8yMDExLzExL3VuY3VycnlpbmctdGhpcy5odG1sKeeahOaVsOe7hHNsaWNl5pa55rOV44CCCiAgICAgICAqIOWwhueUqOadpeWwhumdnuaVsOe7hOWvueixoei9rOWMluaIkOaVsOe7hOWvueixoeOAggogICAgICAgKiBAZ3JhbW1hciBCYXNlLnNsaWNlKCB0YXJnZXQsIHN0YXJ0WywgZW5kXSApID0+IEFycmF5CiAgICAgICAqIEBtZXRob2Qgc2xpY2UKICAgICAgICogQGV4YW1wbGUKICAgICAgICogZnVuY3Rpb24gZG9Tb210aGluZygpIHsKICAgICAgICogICAgIHZhciBhcmdzID0gQmFzZS5zbGljZSggYXJndW1lbnRzLCAxICk7CiAgICAgICAqICAgICBjb25zb2xlLmxvZyggYXJncyApOwogICAgICAgKiB9CiAgICAgICAqCiAgICAgICAqIGRvU29tdGhpbmcoICdpZ25vcmVkJywgJ2FyZzInLCAnYXJnMycgKTsgICAgLy8gPT4gQXJyYXkgWyJhcmcyIiwgImFyZzMiXQogICAgICAgKi8KICAgICAgc2xpY2U6IHVuY3VycnlUaGlzKFtdLnNsaWNlKSwKCiAgICAgIC8qKgogICAgICAgKiDnlJ/miJDllK/kuIDnmoRJRAogICAgICAgKiBAbWV0aG9kIGd1aWQKICAgICAgICogQGdyYW1tYXIgQmFzZS5ndWlkKCkgPT4gU3RyaW5nCiAgICAgICAqIEBncmFtbWFyIEJhc2UuZ3VpZCggcHJlZnggKSA9PiBTdHJpbmcKICAgICAgICovCiAgICAgIGd1aWQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgY291bnRlciA9IDA7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChwcmVmaXgpIHsKICAgICAgICAgIHZhciBndWlkID0gKCtuZXcgRGF0ZSgpKS50b1N0cmluZygzMiksCiAgICAgICAgICAgICAgaSA9IDA7CgogICAgICAgICAgZm9yICg7IGkgPCA1OyBpKyspIHsKICAgICAgICAgICAgZ3VpZCArPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2NTUzNSkudG9TdHJpbmcoMzIpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAocHJlZml4IHx8ICd3dV8nKSArIGd1aWQgKyAoY291bnRlcisrKS50b1N0cmluZygzMik7CiAgICAgICAgfTsKICAgICAgfSgpLAoKICAgICAgLyoqCiAgICAgICAqIOagvOW8j+WMluaWh+S7tuWkp+Wwjywg6L6T5Ye65oiQ5bim5Y2V5L2N55qE5a2X56ym5LiyCiAgICAgICAqIEBtZXRob2QgZm9ybWF0U2l6ZQogICAgICAgKiBAZ3JhbW1hciBCYXNlLmZvcm1hdFNpemUoIHNpemUgKSA9PiBTdHJpbmcKICAgICAgICogQGdyYW1tYXIgQmFzZS5mb3JtYXRTaXplKCBzaXplLCBwb2ludExlbmd0aCApID0+IFN0cmluZwogICAgICAgKiBAZ3JhbW1hciBCYXNlLmZvcm1hdFNpemUoIHNpemUsIHBvaW50TGVuZ3RoLCB1bml0cyApID0+IFN0cmluZwogICAgICAgKiBAcGFyYW0ge051bWJlcn0gc2l6ZSDmlofku7blpKflsI8KICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IFtwb2ludExlbmd0aD0yXSDnsr7noa7liLDnmoTlsI/mlbDngrnmlbDjgIIKICAgICAgICogQHBhcmFtIHtBcnJheX0gW3VuaXRzPVsgJ0InLCAnSycsICdNJywgJ0cnLCAnVEInIF1dIOWNleS9jeaVsOe7hOOAguS7juWtl+iKgu+8jOWIsOWNg+Wtl+iKgu+8jOS4gOebtOW+gOS4iuaMh+WumuOAguWmguaenOWNleS9jeaVsOe7hOmHjOmdouWPquaMh+WumuS6huWIsOS6hkso5Y2D5a2X6IqCKe+8jOWQjOaXtuaWh+S7tuWkp+Wwj+Wkp+S6jk0sIOatpOaWueazleeahOi+k+WHuuWwhui/mOaYr+aYvuekuuaIkOWkmuWwkUsuCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIGNvbnNvbGUubG9nKCBCYXNlLmZvcm1hdFNpemUoIDEwMCApICk7ICAgIC8vID0+IDEwMEIKICAgICAgICogY29uc29sZS5sb2coIEJhc2UuZm9ybWF0U2l6ZSggMTAyNCApICk7ICAgIC8vID0+IDEuMDBLCiAgICAgICAqIGNvbnNvbGUubG9nKCBCYXNlLmZvcm1hdFNpemUoIDEwMjQsIDAgKSApOyAgICAvLyA9PiAxSwogICAgICAgKiBjb25zb2xlLmxvZyggQmFzZS5mb3JtYXRTaXplKCAxMDI0ICogMTAyNCApICk7ICAgIC8vID0+IDEuMDBNCiAgICAgICAqIGNvbnNvbGUubG9nKCBCYXNlLmZvcm1hdFNpemUoIDEwMjQgKiAxMDI0ICogMTAyNCApICk7ICAgIC8vID0+IDEuMDBHCiAgICAgICAqIGNvbnNvbGUubG9nKCBCYXNlLmZvcm1hdFNpemUoIDEwMjQgKiAxMDI0ICogMTAyNCwgMCwgWydCJywgJ0tCJywgJ01CJ10gKSApOyAgICAvLyA9PiAxMDI0TUIKICAgICAgICovCiAgICAgIGZvcm1hdFNpemU6IGZ1bmN0aW9uIGZvcm1hdFNpemUoc2l6ZSwgcG9pbnRMZW5ndGgsIHVuaXRzKSB7CiAgICAgICAgdmFyIHVuaXQ7CiAgICAgICAgdW5pdHMgPSB1bml0cyB8fCBbJ0InLCAnSycsICdNJywgJ0cnLCAnVEInXTsKCiAgICAgICAgd2hpbGUgKCh1bml0ID0gdW5pdHMuc2hpZnQoKSkgJiYgc2l6ZSA+IDEwMjQpIHsKICAgICAgICAgIHNpemUgPSBzaXplIC8gMTAyNDsKICAgICAgICB9CgogICAgICAgIHJldHVybiAodW5pdCA9PT0gJ0InID8gc2l6ZSA6IHNpemUudG9GaXhlZChwb2ludExlbmd0aCB8fCAyKSkgKyB1bml0OwogICAgICB9CiAgICB9OwogIH0pOwogIC8qKgogICAqIOS6i+S7tuWkhOeQhuexu++8jOWPr+S7peeLrOeri+S9v+eUqO+8jOS5n+WPr+S7peaJqeWxlee7meWvueixoeS9v+eUqOOAggogICAqIEBmaWxlT3ZlcnZpZXcgTWVkaWF0b3IKICAgKi8KCiAgZGVmaW5lKCdtZWRpYXRvcicsIFsnYmFzZSddLCBmdW5jdGlvbiAoQmFzZSkgewogICAgdmFyICQgPSBCYXNlLiQsCiAgICAgICAgc2xpY2UgPSBbXS5zbGljZSwKICAgICAgICBzZXBhcmF0b3IgPSAvXHMrLywKICAgICAgICBwcm90b3M7IC8vIOagueaNruadoeS7tui/h+a7pOWHuuS6i+S7tmhhbmRsZXJzLgoKICAgIGZ1bmN0aW9uIGZpbmRIYW5kbGVycyhhcnIsIG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgIHJldHVybiAkLmdyZXAoYXJyLCBmdW5jdGlvbiAoaGFuZGxlcikgewogICAgICAgIHJldHVybiBoYW5kbGVyICYmICghbmFtZSB8fCBoYW5kbGVyLmUgPT09IG5hbWUpICYmICghY2FsbGJhY2sgfHwgaGFuZGxlci5jYiA9PT0gY2FsbGJhY2sgfHwgaGFuZGxlci5jYi5fY2IgPT09IGNhbGxiYWNrKSAmJiAoIWNvbnRleHQgfHwgaGFuZGxlci5jdHggPT09IGNvbnRleHQpOwogICAgICB9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBlYWNoRXZlbnQoZXZlbnRzLCBjYWxsYmFjaywgaXRlcmF0b3IpIHsKICAgICAgLy8g5LiN5pSv5oyB5a+56LGh77yM5Y+q5pSv5oyB5aSa5LiqZXZlbnTnlKjnqbrmoLzpmpTlvIAKICAgICAgJC5lYWNoKChldmVudHMgfHwgJycpLnNwbGl0KHNlcGFyYXRvciksIGZ1bmN0aW9uIChfLCBrZXkpIHsKICAgICAgICBpdGVyYXRvcihrZXksIGNhbGxiYWNrKTsKICAgICAgfSk7CiAgICB9CgogICAgZnVuY3Rpb24gdHJpZ2dlckhhbmRlcnMoZXZlbnRzLCBhcmdzKSB7CiAgICAgIHZhciBzdG9wZWQgPSBmYWxzZSwKICAgICAgICAgIGkgPSAtMSwKICAgICAgICAgIGxlbiA9IGV2ZW50cy5sZW5ndGgsCiAgICAgICAgICBoYW5kbGVyOwoKICAgICAgd2hpbGUgKCsraSA8IGxlbikgewogICAgICAgIGhhbmRsZXIgPSBldmVudHNbaV07CgogICAgICAgIGlmIChoYW5kbGVyLmNiLmFwcGx5KGhhbmRsZXIuY3R4MiwgYXJncykgPT09IGZhbHNlKSB7CiAgICAgICAgICBzdG9wZWQgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gIXN0b3BlZDsKICAgIH0KCiAgICBwcm90b3MgPSB7CiAgICAgIC8qKgogICAgICAgKiDnu5Hlrprkuovku7bjgIIKICAgICAgICoKICAgICAgICogYGNhbGxiYWNrYOaWueazleWcqOaJp+ihjOaXtu+8jGFyZ3VtZW50c+WwhuS8muadpea6kOS6jnRyaWdnZXLnmoTml7blgJnmkLrluKbnmoTlj4LmlbDjgILlpoIKICAgICAgICogYGBgamF2YXNjcmlwdAogICAgICAgKiB2YXIgb2JqID0ge307CiAgICAgICAqCiAgICAgICAqIC8vIOS9v+W+l29iauacieS6i+S7tuihjOS4ugogICAgICAgKiBNZWRpYXRvci5pbnN0YWxsVG8oIG9iaiApOwogICAgICAgKgogICAgICAgKiBvYmoub24oICd0ZXN0YScsIGZ1bmN0aW9uKCBhcmcxLCBhcmcyICkgewogICAgICAgKiAgICAgY29uc29sZS5sb2coIGFyZzEsIGFyZzIgKTsgLy8gPT4gJ2FyZzEnLCAnYXJnMicKICAgICAgICogfSk7CiAgICAgICAqCiAgICAgICAqIG9iai50cmlnZ2VyKCAndGVzdGEnLCAnYXJnMScsICdhcmcyJyApOwogICAgICAgKiBgYGAKICAgICAgICoKICAgICAgICog5aaC5p6cYGNhbGxiYWNrYOS4re+8jOafkOS4gOS4quaWueazlWByZXR1cm4gZmFsc2Vg5LqG77yM5YiZ5ZCO57ut55qE5YW25LuWYGNhbGxiYWNrYOmDveS4jeS8muiiq+aJp+ihjOWIsOOAggogICAgICAgKiDliIfkvJrlvbHlk43liLBgdHJpZ2dlcmDmlrnms5XnmoTov5Tlm57lgLzvvIzkuLpgZmFsc2Vg44CCCiAgICAgICAqCiAgICAgICAqIGBvbmDov5jlj6/ku6XnlKjmnaXmt7vliqDkuIDkuKrnibnmrorkuovku7ZgYWxsYCwg6L+Z5qC35omA5pyJ55qE5LqL5Lu26Kem5Y+R6YO95Lya5ZON5bqU5Yiw44CC5ZCM5pe25q2k57G7YGNhbGxiYWNrYOS4reeahGFyZ3VtZW50c+acieS4gOS4quS4jeWQjOWkhO+8jAogICAgICAgKiDlsLHmmK/nrKzkuIDkuKrlj4LmlbDkuLpgdHlwZWDvvIzorrDlvZXlvZPliY3mmK/ku4DkuYjkuovku7blnKjop6blj5HjgILmraTnsbtgY2FsbGJhY2tg55qE5LyY5YWI57qn5q+U6ISa5L2O77yM5Lya5YaN5q2j5bi4YGNhbGxiYWNrYOaJp+ihjOWujOWQjuinpuWPkeOAggogICAgICAgKiBgYGBqYXZhc2NyaXB0CiAgICAgICAqIG9iai5vbiggJ2FsbCcsIGZ1bmN0aW9uKCB0eXBlLCBhcmcxLCBhcmcyICkgewogICAgICAgKiAgICAgY29uc29sZS5sb2coIHR5cGUsIGFyZzEsIGFyZzIgKTsgLy8gPT4gJ3Rlc3RhJywgJ2FyZzEnLCAnYXJnMicKICAgICAgICogfSk7CiAgICAgICAqIGBgYAogICAgICAgKgogICAgICAgKiBAbWV0aG9kIG9uCiAgICAgICAqIEBncmFtbWFyIG9uKCBuYW1lLCBjYWxsYmFja1ssIGNvbnRleHRdICkgPT4gc2VsZgogICAgICAgKiBAcGFyYW0gIHtTdHJpbmd9ICAgbmFtZSAgICAg5LqL5Lu25ZCN77yM5pSv5oyB5aSa5Liq5LqL5Lu255So56m65qC86ZqU5byACiAgICAgICAqIEBwYXJhbSAge0Z1bmN0aW9ufSBjYWxsYmFjayDkuovku7blpITnkIblmagKICAgICAgICogQHBhcmFtICB7T2JqZWN0fSAgIFtjb250ZXh0XSAg5LqL5Lu25aSE55CG5Zmo55qE5LiK5LiL5paH44CCCiAgICAgICAqIEByZXR1cm4ge3NlbGZ9IOi/lOWbnuiHqui6q++8jOaWueS+v+mTvuW8jwogICAgICAgKiBAY2hhaW5hYmxlCiAgICAgICAqIEBjbGFzcyBNZWRpYXRvcgogICAgICAgKi8KICAgICAgb246IGZ1bmN0aW9uIG9uKG5hbWUsIGNhbGxiYWNrLCBjb250ZXh0KSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgc2V0OwoKICAgICAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIHNldCA9IHRoaXMuX2V2ZW50cyB8fCAodGhpcy5fZXZlbnRzID0gW10pOwogICAgICAgIGVhY2hFdmVudChuYW1lLCBjYWxsYmFjaywgZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgICAgICB2YXIgaGFuZGxlciA9IHsKICAgICAgICAgICAgZTogbmFtZQogICAgICAgICAgfTsKICAgICAgICAgIGhhbmRsZXIuY2IgPSBjYWxsYmFjazsKICAgICAgICAgIGhhbmRsZXIuY3R4ID0gY29udGV4dDsKICAgICAgICAgIGhhbmRsZXIuY3R4MiA9IGNvbnRleHQgfHwgbWU7CiAgICAgICAgICBoYW5kbGVyLmlkID0gc2V0Lmxlbmd0aDsKICAgICAgICAgIHNldC5wdXNoKGhhbmRsZXIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOe7keWumuS6i+S7tu+8jOS4lOW9k2hhbmRsZXLmiafooYzlrozlkI7vvIzoh6rliqjop6PpmaTnu5HlrprjgIIKICAgICAgICogQG1ldGhvZCBvbmNlCiAgICAgICAqIEBncmFtbWFyIG9uY2UoIG5hbWUsIGNhbGxiYWNrWywgY29udGV4dF0gKSA9PiBzZWxmCiAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gICBuYW1lICAgICDkuovku7blkI0KICAgICAgICogQHBhcmFtICB7RnVuY3Rpb259IGNhbGxiYWNrIOS6i+S7tuWkhOeQhuWZqAogICAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICAgW2NvbnRleHRdICDkuovku7blpITnkIblmajnmoTkuIrkuIvmlofjgIIKICAgICAgICogQHJldHVybiB7c2VsZn0g6L+U5Zue6Ieq6Lqr77yM5pa55L6/6ZO+5byPCiAgICAgICAqIEBjaGFpbmFibGUKICAgICAgICovCiAgICAgIG9uY2U6IGZ1bmN0aW9uIG9uY2UobmFtZSwgY2FsbGJhY2ssIGNvbnRleHQpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgICBpZiAoIWNhbGxiYWNrKSB7CiAgICAgICAgICByZXR1cm4gbWU7CiAgICAgICAgfQoKICAgICAgICBlYWNoRXZlbnQobmFtZSwgY2FsbGJhY2ssIGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaykgewogICAgICAgICAgdmFyIG9uY2UgPSBmdW5jdGlvbiBvbmNlKCkgewogICAgICAgICAgICBtZS5vZmYobmFtZSwgb25jZSk7CiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseShjb250ZXh0IHx8IG1lLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbmNlLl9jYiA9IGNhbGxiYWNrOwogICAgICAgICAgbWUub24obmFtZSwgb25jZSwgY29udGV4dCk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIG1lOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOino+mZpOS6i+S7tue7keWumgogICAgICAgKiBAbWV0aG9kIG9mZgogICAgICAgKiBAZ3JhbW1hciBvZmYoIFtuYW1lWywgY2FsbGJhY2tbLCBjb250ZXh0XSBdIF0gKSA9PiBzZWxmCiAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gICBbbmFtZV0gICAgIOS6i+S7tuWQjQogICAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gW2NhbGxiYWNrXSDkuovku7blpITnkIblmagKICAgICAgICogQHBhcmFtICB7T2JqZWN0fSAgIFtjb250ZXh0XSAg5LqL5Lu25aSE55CG5Zmo55qE5LiK5LiL5paH44CCCiAgICAgICAqIEByZXR1cm4ge3NlbGZ9IOi/lOWbnuiHqui6q++8jOaWueS+v+mTvuW8jwogICAgICAgKiBAY2hhaW5hYmxlCiAgICAgICAqLwogICAgICBvZmY6IGZ1bmN0aW9uIG9mZihuYW1lLCBjYiwgY3R4KSB7CiAgICAgICAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50czsKCiAgICAgICAgaWYgKCFldmVudHMpIHsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFuYW1lICYmICFjYiAmJiAhY3R4KSB7CiAgICAgICAgICB0aGlzLl9ldmVudHMgPSBbXTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KCiAgICAgICAgZWFjaEV2ZW50KG5hbWUsIGNiLCBmdW5jdGlvbiAobmFtZSwgY2IpIHsKICAgICAgICAgICQuZWFjaChmaW5kSGFuZGxlcnMoZXZlbnRzLCBuYW1lLCBjYiwgY3R4KSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBkZWxldGUgZXZlbnRzW3RoaXMuaWRdOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICog6Kem5Y+R5LqL5Lu2CiAgICAgICAqIEBtZXRob2QgdHJpZ2dlcgogICAgICAgKiBAZ3JhbW1hciB0cmlnZ2VyKCBuYW1lWywgYXJncy4uLl0gKSA9PiBzZWxmCiAgICAgICAqIEBwYXJhbSAge1N0cmluZ30gICB0eXBlICAgICDkuovku7blkI0KICAgICAgICogQHBhcmFtICB7Kn0gWy4uLl0g5Lu75oSP5Y+C5pWwCiAgICAgICAqIEByZXR1cm4ge0Jvb2xlYW59IOWmguaenGhhbmRsZXLkuK1yZXR1cm4gZmFsc2XkuobvvIzliJnov5Tlm55mYWxzZSwg5ZCm5YiZ6L+U5ZuedHJ1ZQogICAgICAgKi8KICAgICAgdHJpZ2dlcjogZnVuY3Rpb24gdHJpZ2dlcih0eXBlKSB7CiAgICAgICAgdmFyIGFyZ3MsIGV2ZW50cywgYWxsRXZlbnRzOwoKICAgICAgICBpZiAoIXRoaXMuX2V2ZW50cyB8fCAhdHlwZSkgewogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgICAgIGV2ZW50cyA9IGZpbmRIYW5kbGVycyh0aGlzLl9ldmVudHMsIHR5cGUpOwogICAgICAgIGFsbEV2ZW50cyA9IGZpbmRIYW5kbGVycyh0aGlzLl9ldmVudHMsICdhbGwnKTsKICAgICAgICByZXR1cm4gdHJpZ2dlckhhbmRlcnMoZXZlbnRzLCBhcmdzKSAmJiB0cmlnZ2VySGFuZGVycyhhbGxFdmVudHMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH07CiAgICAvKioKICAgICAqIOS4reS7i+iAhe+8jOWug+acrOi6q+aYr+S4quWNleS+i++8jOS9huWPr+S7pemAmui/h1tpbnN0YWxsVG9dKCNXZWJVcGxvYWRlcjpNZWRpYXRvcjppbnN0YWxsVG8p5pa55rOV77yM5L2/5Lu75L2V5a+56LGh5YW35aSH5LqL5Lu26KGM5Li644CCCiAgICAgKiDkuLvopoHnm67nmoTmmK/otJ/otKPmqKHlnZfkuI7mqKHlnZfkuYvpl7TnmoTlkIjkvZzvvIzpmY3kvY7ogKblkIjluqbjgIIKICAgICAqCiAgICAgKiBAY2xhc3MgTWVkaWF0b3IKICAgICAqLwoKICAgIHJldHVybiAkLmV4dGVuZCh7CiAgICAgIC8qKgogICAgICAgKiDlj6/ku6XpgJrov4fov5nkuKrmjqXlj6PvvIzkvb/ku7vkvZXlr7nosaHlhbflpIfkuovku7blip/og73jgIIKICAgICAgICogQG1ldGhvZCBpbnN0YWxsVG8KICAgICAgICogQHBhcmFtICB7T2JqZWN0fSBvYmog6ZyA6KaB5YW35aSH5LqL5Lu26KGM5Li655qE5a+56LGh44CCCiAgICAgICAqIEByZXR1cm4ge09iamVjdH0g6L+U5Zueb2JqLgogICAgICAgKi8KICAgICAgaW5zdGFsbFRvOiBmdW5jdGlvbiBpbnN0YWxsVG8ob2JqKSB7CiAgICAgICAgcmV0dXJuICQuZXh0ZW5kKG9iaiwgcHJvdG9zKTsKICAgICAgfQogICAgfSwgcHJvdG9zKTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IFVwbG9hZGVy5LiK5Lyg57G7CiAgICovCgogIGRlZmluZSgndXBsb2FkZXInLCBbJ2Jhc2UnLCAnbWVkaWF0b3InXSwgZnVuY3Rpb24gKEJhc2UsIE1lZGlhdG9yKSB7CiAgICB2YXIgJCA9IEJhc2UuJDsKICAgIC8qKgogICAgICog5LiK5Lyg5YWl5Y+j57G744CCCiAgICAgKiBAY2xhc3MgVXBsb2FkZXIKICAgICAqIEBjb25zdHJ1Y3RvcgogICAgICogQGdyYW1tYXIgbmV3IFVwbG9hZGVyKCBvcHRzICkgPT4gVXBsb2FkZXIKICAgICAqIEBleGFtcGxlCiAgICAgKiB2YXIgdXBsb2FkZXIgPSBXZWJVcGxvYWRlci5VcGxvYWRlcih7CiAgICAgKiAgICAgc3dmOiAncGF0aF9vZl9zd2YvVXBsb2FkZXIuc3dmJywKICAgICAqCiAgICAgKiAgICAgLy8g5byA6LW35YiG54mH5LiK5Lyg44CCCiAgICAgKiAgICAgY2h1bmtlZDogdHJ1ZQogICAgICogfSk7CiAgICAgKi8KCiAgICBmdW5jdGlvbiBVcGxvYWRlcihvcHRzKSB7CiAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBVcGxvYWRlci5vcHRpb25zLCBvcHRzKTsKCiAgICAgIHRoaXMuX2luaXQodGhpcy5vcHRpb25zKTsKICAgIH0gLy8gZGVmYXVsdCBPcHRpb25zCiAgICAvLyB3aWRnZXRz5Lit5pyJ55u45bqU5omp5bGVCgoKICAgIFVwbG9hZGVyLm9wdGlvbnMgPSB7fTsKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhVcGxvYWRlci5wcm90b3R5cGUpOyAvLyDmibnph4/mt7vliqDnuq/lkb3ku6TlvI/mlrnms5XjgIIKCiAgICAkLmVhY2goewogICAgICB1cGxvYWQ6ICdzdGFydC11cGxvYWQnLAogICAgICBzdG9wOiAnc3RvcC11cGxvYWQnLAogICAgICBnZXRGaWxlOiAnZ2V0LWZpbGUnLAogICAgICBnZXRGaWxlczogJ2dldC1maWxlcycsCiAgICAgIGFkZEZpbGU6ICdhZGQtZmlsZScsCiAgICAgIGFkZEZpbGVzOiAnYWRkLWZpbGUnLAogICAgICBzb3J0OiAnc29ydC1maWxlcycsCiAgICAgIHJlbW92ZUZpbGU6ICdyZW1vdmUtZmlsZScsCiAgICAgIGNhbmNlbEZpbGU6ICdjYW5jZWwtZmlsZScsCiAgICAgIHNraXBGaWxlOiAnc2tpcC1maWxlJywKICAgICAgcmV0cnk6ICdyZXRyeScsCiAgICAgIGlzSW5Qcm9ncmVzczogJ2lzLWluLXByb2dyZXNzJywKICAgICAgbWFrZVRodW1iOiAnbWFrZS10aHVtYicsCiAgICAgIG1kNUZpbGU6ICdtZDUtZmlsZScsCiAgICAgIGdldERpbWVuc2lvbjogJ2dldC1kaW1lbnNpb24nLAogICAgICBhZGRCdXR0b246ICdhZGQtYnRuJywKICAgICAgcHJlZGljdFJ1bnRpbWVUeXBlOiAncHJlZGljdC1ydW50aW1lLXR5cGUnLAogICAgICByZWZyZXNoOiAncmVmcmVzaCcsCiAgICAgIGRpc2FibGU6ICdkaXNhYmxlJywKICAgICAgZW5hYmxlOiAnZW5hYmxlJywKICAgICAgcmVzZXQ6ICdyZXNldCcKICAgIH0sIGZ1bmN0aW9uIChmbiwgY29tbWFuZCkgewogICAgICBVcGxvYWRlci5wcm90b3R5cGVbZm5dID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3QoY29tbWFuZCwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0pOwogICAgJC5leHRlbmQoVXBsb2FkZXIucHJvdG90eXBlLCB7CiAgICAgIHN0YXRlOiAncGVuZGluZycsCiAgICAgIF9pbml0OiBmdW5jdGlvbiBfaW5pdChvcHRzKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICBtZS5yZXF1ZXN0KCdpbml0Jywgb3B0cywgZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUuc3RhdGUgPSAncmVhZHknOwogICAgICAgICAgbWUudHJpZ2dlcigncmVhZHknKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDojrflj5bmiJbogIXorr7nva5VcGxvYWRlcumFjee9rumhueOAggogICAgICAgKiBAbWV0aG9kIG9wdGlvbgogICAgICAgKiBAZ3JhbW1hciBvcHRpb24oIGtleSApID0+ICoKICAgICAgICogQGdyYW1tYXIgb3B0aW9uKCBrZXksIHZhbCApID0+IHNlbGYKICAgICAgICogQGV4YW1wbGUKICAgICAgICoKICAgICAgICogLy8g5Yid5aeL54q25oCB5Zu+54mH5LiK5Lyg5YmN5LiN5Lya5Y6L57ypCiAgICAgICAqIHZhciB1cGxvYWRlciA9IG5ldyBXZWJVcGxvYWRlci5VcGxvYWRlcih7CiAgICAgICAqICAgICBjb21wcmVzczogbnVsbDsKICAgICAgICogfSk7CiAgICAgICAqCiAgICAgICAqIC8vIOS/ruaUueWQjuWbvueJh+S4iuS8oOWJje+8jOWwneivleWwhuWbvueJh+WOi+e8qeWIsDE2MDAgKiAxNjAwCiAgICAgICAqIHVwbG9hZGVyLm9wdGlvbiggJ2NvbXByZXNzJywgewogICAgICAgKiAgICAgd2lkdGg6IDE2MDAsCiAgICAgICAqICAgICBoZWlnaHQ6IDE2MDAKICAgICAgICogfSk7CiAgICAgICAqLwogICAgICBvcHRpb246IGZ1bmN0aW9uIG9wdGlvbihrZXksIHZhbCkgewogICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zOyAvLyBzZXR0ZXIKCiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBpZiAoJC5pc1BsYWluT2JqZWN0KHZhbCkgJiYgJC5pc1BsYWluT2JqZWN0KG9wdHNba2V5XSkpIHsKICAgICAgICAgICAgJC5leHRlbmQob3B0c1trZXldLCB2YWwpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3B0c1trZXldID0gdmFsOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBnZXR0ZXIKICAgICAgICAgIHJldHVybiBrZXkgPyBvcHRzW2tleV0gOiBvcHRzOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDojrflj5bmlofku7bnu5/orqHkv6Hmga/jgILov5Tlm57kuIDkuKrljIXlkKvkuIDkuIvkv6Hmga/nmoTlr7nosaHjgIIKICAgICAgICogKiBgc3VjY2Vzc051bWAg5LiK5Lyg5oiQ5Yqf55qE5paH5Lu25pWwCiAgICAgICAqICogYHByb2dyZXNzTnVtYCDkuIrkvKDkuK3nmoTmlofku7bmlbAKICAgICAgICogKiBgY2FuY2VsTnVtYCDooqvliKDpmaTnmoTmlofku7bmlbAKICAgICAgICogKiBgaW52YWxpZE51bWAg5peg5pWI55qE5paH5Lu25pWwCiAgICAgICAqICogYHVwbG9hZEZhaWxOdW1gIOS4iuS8oOWksei0peeahOaWh+S7tuaVsAogICAgICAgKiAqIGBxdWV1ZU51bWAg6L+Y5Zyo6Zif5YiX5Lit55qE5paH5Lu25pWwCiAgICAgICAqICogYGludGVycnVwdE51bWAg6KKr5pqC5YGc55qE5paH5Lu25pWwCiAgICAgICAqIEBtZXRob2QgZ2V0U3RhdHMKICAgICAgICogQGdyYW1tYXIgZ2V0U3RhdHMoKSA9PiBPYmplY3QKICAgICAgICovCiAgICAgIGdldFN0YXRzOiBmdW5jdGlvbiBnZXRTdGF0cygpIHsKICAgICAgICAvLyByZXR1cm4gdGhpcy5fbWdyLmdldFN0YXRzLmFwcGx5KCB0aGlzLl9tZ3IsIGFyZ3VtZW50cyApOwogICAgICAgIHZhciBzdGF0cyA9IHRoaXMucmVxdWVzdCgnZ2V0LXN0YXRzJyk7CiAgICAgICAgcmV0dXJuIHN0YXRzID8gewogICAgICAgICAgc3VjY2Vzc051bTogc3RhdHMubnVtT2ZTdWNjZXNzLAogICAgICAgICAgcHJvZ3Jlc3NOdW06IHN0YXRzLm51bU9mUHJvZ3Jlc3MsCiAgICAgICAgICAvLyB3aG8gY2FyZT8KICAgICAgICAgIC8vIHF1ZXVlRmFpbE51bTogMCwKICAgICAgICAgIGNhbmNlbE51bTogc3RhdHMubnVtT2ZDYW5jZWwsCiAgICAgICAgICBpbnZhbGlkTnVtOiBzdGF0cy5udW1PZkludmFsaWQsCiAgICAgICAgICB1cGxvYWRGYWlsTnVtOiBzdGF0cy5udW1PZlVwbG9hZEZhaWxlZCwKICAgICAgICAgIHF1ZXVlTnVtOiBzdGF0cy5udW1PZlF1ZXVlLAogICAgICAgICAgaW50ZXJydXB0TnVtOiBzdGF0cy5udW1vZkludGVycnVwdAogICAgICAgIH0gOiB7fTsKICAgICAgfSwKICAgICAgLy8g6ZyA6KaB6YeN5YaZ5q2k5pa55rOV5p2l5p2l5pSv5oyBb3B0cy5vbkV2ZW505ZKMaW5zdGFuY2Uub25FdmVudOeahOWkhOeQhuWZqAogICAgICB0cmlnZ2VyOiBmdW5jdGlvbiB0cmlnZ2VyKHR5cGUKICAgICAgLyosIGFyZ3MuLi4qLwogICAgICApIHsKICAgICAgICB2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwKICAgICAgICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgbmFtZSA9ICdvbicgKyB0eXBlLnN1YnN0cmluZygwLCAxKS50b1VwcGVyQ2FzZSgpICsgdHlwZS5zdWJzdHJpbmcoMSk7CgogICAgICAgIGlmICggLy8g6LCD55So6YCa6L+Hb27mlrnms5Xms6jlhoznmoRoYW5kbGVyLgogICAgICAgIE1lZGlhdG9yLnRyaWdnZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA9PT0gZmFsc2UgfHwgLy8g6LCD55Sob3B0cy5vbkV2ZW50CiAgICAgICAgJC5pc0Z1bmN0aW9uKG9wdHNbbmFtZV0pICYmIG9wdHNbbmFtZV0uYXBwbHkodGhpcywgYXJncykgPT09IGZhbHNlIHx8IC8vIOiwg+eUqHRoaXMub25FdmVudAogICAgICAgICQuaXNGdW5jdGlvbih0aGlzW25hbWVdKSAmJiB0aGlzW25hbWVdLmFwcGx5KHRoaXMsIGFyZ3MpID09PSBmYWxzZSB8fCAvLyDlub/mkq3miYDmnIl1cGxvYWRlcueahOS6i+S7tuOAggogICAgICAgIE1lZGlhdG9yLnRyaWdnZXIuYXBwbHkoTWVkaWF0b3IsIFt0aGlzLCB0eXBlXS5jb25jYXQoYXJncykpID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICog6ZSA5q+BIHdlYnVwbG9hZGVyIOWunuS+iwogICAgICAgKiBAbWV0aG9kIGRlc3Ryb3kKICAgICAgICogQGdyYW1tYXIgZGVzdHJveSgpID0+IHVuZGVmaW5lZAogICAgICAgKi8KICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLnJlcXVlc3QoJ2Rlc3Ryb3knLCBhcmd1bWVudHMpOwogICAgICAgIHRoaXMub2ZmKCk7CiAgICAgIH0sCiAgICAgIC8vIHdpZGdldHMvd2lkZ2V0Lmpz5bCG6KGl5YWF5q2k5pa55rOV55qE6K+m57uG5paH5qGj44CCCiAgICAgIHJlcXVlc3Q6IEJhc2Uubm9vcAogICAgfSk7CiAgICAvKioKICAgICAqIOWIm+W7ulVwbG9hZGVy5a6e5L6L77yM562J5ZCM5LqObmV3IFVwbG9hZGVyKCBvcHRzICk7CiAgICAgKiBAbWV0aG9kIGNyZWF0ZQogICAgICogQGNsYXNzIEJhc2UKICAgICAqIEBzdGF0aWMKICAgICAqIEBncmFtbWFyIEJhc2UuY3JlYXRlKCBvcHRzICkgPT4gVXBsb2FkZXIKICAgICAqLwoKICAgIEJhc2UuY3JlYXRlID0gVXBsb2FkZXIuY3JlYXRlID0gZnVuY3Rpb24gKG9wdHMpIHsKICAgICAgcmV0dXJuIG5ldyBVcGxvYWRlcihvcHRzKTsKICAgIH07IC8vIOaatOmcslVwbG9hZGVy77yM5Y+v5Lul6YCa6L+H5a6D5p2l5omp5bGV5Lia5Yqh6YC76L6R44CCCgoKICAgIEJhc2UuVXBsb2FkZXIgPSBVcGxvYWRlcjsKICAgIHJldHVybiBVcGxvYWRlcjsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IFJ1bnRpbWXnrqHnkIblmajvvIzotJ/otKNSdW50aW1l55qE6YCJ5oupLCDov57mjqUKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL3J1bnRpbWUnLCBbJ2Jhc2UnLCAnbWVkaWF0b3InXSwgZnVuY3Rpb24gKEJhc2UsIE1lZGlhdG9yKSB7CiAgICB2YXIgJCA9IEJhc2UuJCwKICAgICAgICBmYWN0b3JpZXMgPSB7fSwKICAgICAgICAvLyDojrflj5blr7nosaHnmoTnrKzkuIDkuKprZXkKICAgIGdldEZpcnN0S2V5ID0gZnVuY3Rpb24gZ2V0Rmlyc3RLZXkob2JqKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH07IC8vIOaOpeWPo+exu+OAggoKCiAgICBmdW5jdGlvbiBSdW50aW1lKG9wdGlvbnMpIHsKICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoewogICAgICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuYm9keQogICAgICB9LCBvcHRpb25zKTsKICAgICAgdGhpcy51aWQgPSBCYXNlLmd1aWQoJ3J0XycpOwogICAgfQoKICAgICQuZXh0ZW5kKFJ1bnRpbWUucHJvdG90eXBlLCB7CiAgICAgIGdldENvbnRhaW5lcjogZnVuY3Rpb24gZ2V0Q29udGFpbmVyKCkgewogICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBwYXJlbnQsCiAgICAgICAgICAgIGNvbnRhaW5lcjsKCiAgICAgICAgaWYgKHRoaXMuX2NvbnRhaW5lcikgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjsKICAgICAgICB9CgogICAgICAgIHBhcmVudCA9ICQob3B0cy5jb250YWluZXIgfHwgZG9jdW1lbnQuYm9keSk7CiAgICAgICAgY29udGFpbmVyID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7CiAgICAgICAgY29udGFpbmVyLmF0dHIoJ2lkJywgJ3J0XycgKyB0aGlzLnVpZCk7CiAgICAgICAgY29udGFpbmVyLmNzcyh7CiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgIHRvcDogJzBweCcsCiAgICAgICAgICBsZWZ0OiAnMHB4JywKICAgICAgICAgIHdpZHRoOiAnMXB4JywKICAgICAgICAgIGhlaWdodDogJzFweCcsCiAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicKICAgICAgICB9KTsKICAgICAgICBwYXJlbnQuYXBwZW5kKGNvbnRhaW5lcik7CiAgICAgICAgcGFyZW50LmFkZENsYXNzKCd3ZWJ1cGxvYWRlci1jb250YWluZXInKTsKICAgICAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7CiAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50OwogICAgICAgIHJldHVybiBjb250YWluZXI7CiAgICAgIH0sCiAgICAgIGluaXQ6IEJhc2Uubm9vcCwKICAgICAgZXhlYzogQmFzZS5ub29wLAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHRoaXMuX2NvbnRhaW5lciAmJiB0aGlzLl9jb250YWluZXIucmVtb3ZlKCk7CiAgICAgICAgdGhpcy5fcGFyZW50ICYmIHRoaXMuX3BhcmVudC5yZW1vdmVDbGFzcygnd2VidXBsb2FkZXItY29udGFpbmVyJyk7CiAgICAgICAgdGhpcy5vZmYoKTsKICAgICAgfQogICAgfSk7CiAgICBSdW50aW1lLm9yZGVycyA9ICdodG1sNSxmbGFzaCc7CiAgICAvKioKICAgICAqIOa3u+WKoFJ1bnRpbWXlrp7njrDjgIIKICAgICAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlICAgIOexu+WeiwogICAgICogQHBhcmFtIHtSdW50aW1lfSBmYWN0b3J5IOWFt+S9k1J1bnRpbWXlrp7njrDjgIIKICAgICAqLwoKICAgIFJ1bnRpbWUuYWRkUnVudGltZSA9IGZ1bmN0aW9uICh0eXBlLCBmYWN0b3J5KSB7CiAgICAgIGZhY3Rvcmllc1t0eXBlXSA9IGZhY3Rvcnk7CiAgICB9OwoKICAgIFJ1bnRpbWUuaGFzUnVudGltZSA9IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgIHJldHVybiAhISh0eXBlID8gZmFjdG9yaWVzW3R5cGVdIDogZ2V0Rmlyc3RLZXkoZmFjdG9yaWVzKSk7CiAgICB9OwoKICAgIFJ1bnRpbWUuY3JlYXRlID0gZnVuY3Rpb24gKG9wdHMsIG9yZGVycykgewogICAgICB2YXIgdHlwZSwgcnVudGltZTsKICAgICAgb3JkZXJzID0gb3JkZXJzIHx8IFJ1bnRpbWUub3JkZXJzOwogICAgICAkLmVhY2gob3JkZXJzLnNwbGl0KC9ccyosXHMqL2cpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKGZhY3Rvcmllc1t0aGlzXSkgewogICAgICAgICAgdHlwZSA9IHRoaXM7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdHlwZSA9IHR5cGUgfHwgZ2V0Rmlyc3RLZXkoZmFjdG9yaWVzKTsKCiAgICAgIGlmICghdHlwZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUnVudGltZSBFcnJvcicpOwogICAgICB9CgogICAgICBydW50aW1lID0gbmV3IGZhY3Rvcmllc1t0eXBlXShvcHRzKTsKICAgICAgcmV0dXJuIHJ1bnRpbWU7CiAgICB9OwoKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhSdW50aW1lLnByb3RvdHlwZSk7CiAgICByZXR1cm4gUnVudGltZTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IFJ1bnRpbWXnrqHnkIblmajvvIzotJ/otKNSdW50aW1l55qE6YCJ5oupLCDov57mjqUKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2NsaWVudCcsIFsnYmFzZScsICdtZWRpYXRvcicsICdydW50aW1lL3J1bnRpbWUnXSwgZnVuY3Rpb24gKEJhc2UsIE1lZGlhdG9yLCBSdW50aW1lKSB7CiAgICB2YXIgY2FjaGU7CgogICAgY2FjaGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBvYmogPSB7fTsKICAgICAgcmV0dXJuIHsKICAgICAgICBhZGQ6IGZ1bmN0aW9uIGFkZChydW50aW1lKSB7CiAgICAgICAgICBvYmpbcnVudGltZS51aWRdID0gcnVudGltZTsKICAgICAgICB9LAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KHJ1aWQsIHN0YW5kYWxvbmUpIHsKICAgICAgICAgIHZhciBpOwoKICAgICAgICAgIGlmIChydWlkKSB7CiAgICAgICAgICAgIHJldHVybiBvYmpbcnVpZF07CiAgICAgICAgICB9CgogICAgICAgICAgZm9yIChpIGluIG9iaikgewogICAgICAgICAgICAvLyDmnInkupvnsbvlnovkuI3og73ph43nlKjvvIzmr5TlpoJmaWxlcGlja2VyLgogICAgICAgICAgICBpZiAoc3RhbmRhbG9uZSAmJiBvYmpbaV0uX19zdGFuZGFsb25lKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBvYmpbaV07CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSwKICAgICAgICByZW1vdmU6IGZ1bmN0aW9uIHJlbW92ZShydW50aW1lKSB7CiAgICAgICAgICBkZWxldGUgb2JqW3J1bnRpbWUudWlkXTsKICAgICAgICB9CiAgICAgIH07CiAgICB9KCk7CgogICAgZnVuY3Rpb24gUnVudGltZUNsaWVudChjb21wb25lbnQsIHN0YW5kYWxvbmUpIHsKICAgICAgdmFyIGRlZmVycmVkID0gQmFzZS5EZWZlcnJlZCgpLAogICAgICAgICAgcnVudGltZTsKICAgICAgdGhpcy51aWQgPSBCYXNlLmd1aWQoJ2NsaWVudF8nKTsgLy8g5YWB6K64cnVudGltZeayoeacieWIneWni+WMluS5i+WJje+8jOazqOWGjOS4gOS6m+aWueazleWcqOWIneWni+WMluWQjuaJp+ihjOOAggoKICAgICAgdGhpcy5ydW50aW1lUmVhZHkgPSBmdW5jdGlvbiAoY2IpIHsKICAgICAgICByZXR1cm4gZGVmZXJyZWQuZG9uZShjYik7CiAgICAgIH07CgogICAgICB0aGlzLmNvbm5lY3RSdW50aW1lID0gZnVuY3Rpb24gKG9wdHMsIGNiKSB7CiAgICAgICAgLy8gYWxyZWFkeSBjb25uZWN0ZWQuCiAgICAgICAgaWYgKHJ1bnRpbWUpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcignYWxyZWFkeSBjb25uZWN0ZWQhJyk7CiAgICAgICAgfQoKICAgICAgICBkZWZlcnJlZC5kb25lKGNiKTsKCiAgICAgICAgaWYgKHR5cGVvZiBvcHRzID09PSAnc3RyaW5nJyAmJiBjYWNoZS5nZXQob3B0cykpIHsKICAgICAgICAgIHJ1bnRpbWUgPSBjYWNoZS5nZXQob3B0cyk7CiAgICAgICAgfSAvLyDlg49maWxlUGlja2Vy5Y+q6IO954us56uL5a2Y5Zyo77yM5LiN6IO95YWs55So44CCCgoKICAgICAgICBydW50aW1lID0gcnVudGltZSB8fCBjYWNoZS5nZXQobnVsbCwgc3RhbmRhbG9uZSk7IC8vIOmcgOimgeWIm+W7ugoKICAgICAgICBpZiAoIXJ1bnRpbWUpIHsKICAgICAgICAgIHJ1bnRpbWUgPSBSdW50aW1lLmNyZWF0ZShvcHRzLCBvcHRzLnJ1bnRpbWVPcmRlcik7CiAgICAgICAgICBydW50aW1lLl9fcHJvbWlzZSA9IGRlZmVycmVkLnByb21pc2UoKTsKICAgICAgICAgIHJ1bnRpbWUub25jZSgncmVhZHknLCBkZWZlcnJlZC5yZXNvbHZlKTsKICAgICAgICAgIHJ1bnRpbWUuaW5pdCgpOwogICAgICAgICAgY2FjaGUuYWRkKHJ1bnRpbWUpOwogICAgICAgICAgcnVudGltZS5fX2NsaWVudCA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOadpeiHqmNhY2hlCiAgICAgICAgICBCYXNlLiQuZXh0ZW5kKHJ1bnRpbWUub3B0aW9ucywgb3B0cyk7CgogICAgICAgICAgcnVudGltZS5fX3Byb21pc2UudGhlbihkZWZlcnJlZC5yZXNvbHZlKTsKCiAgICAgICAgICBydW50aW1lLl9fY2xpZW50Kys7CiAgICAgICAgfQoKICAgICAgICBzdGFuZGFsb25lICYmIChydW50aW1lLl9fc3RhbmRhbG9uZSA9IHN0YW5kYWxvbmUpOwogICAgICAgIHJldHVybiBydW50aW1lOwogICAgICB9OwoKICAgICAgdGhpcy5nZXRSdW50aW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBydW50aW1lOwogICAgICB9OwoKICAgICAgdGhpcy5kaXNjb25uZWN0UnVudGltZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXJ1bnRpbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJ1bnRpbWUuX19jbGllbnQtLTsKCiAgICAgICAgaWYgKHJ1bnRpbWUuX19jbGllbnQgPD0gMCkgewogICAgICAgICAgY2FjaGUucmVtb3ZlKHJ1bnRpbWUpOwogICAgICAgICAgZGVsZXRlIHJ1bnRpbWUuX19wcm9taXNlOwogICAgICAgICAgcnVudGltZS5kZXN0cm95KCk7CiAgICAgICAgfQoKICAgICAgICBydW50aW1lID0gbnVsbDsKICAgICAgfTsKCiAgICAgIHRoaXMuZXhlYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXJ1bnRpbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBhcmdzID0gQmFzZS5zbGljZShhcmd1bWVudHMpOwogICAgICAgIGNvbXBvbmVudCAmJiBhcmdzLnVuc2hpZnQoY29tcG9uZW50KTsKICAgICAgICByZXR1cm4gcnVudGltZS5leGVjLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICB9OwoKICAgICAgdGhpcy5nZXRSdWlkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBydW50aW1lICYmIHJ1bnRpbWUudWlkOwogICAgICB9OwoKICAgICAgdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKGRlc3Ryb3kpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgZGVzdHJveSAmJiBkZXN0cm95LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2Rlc3Ryb3knKTsKICAgICAgICAgIHRoaXMub2ZmKCk7CiAgICAgICAgICB0aGlzLmV4ZWMoJ2Rlc3Ryb3knKTsKICAgICAgICAgIHRoaXMuZGlzY29ubmVjdFJ1bnRpbWUoKTsKICAgICAgICB9OwogICAgICB9KHRoaXMuZGVzdHJveSk7CiAgICB9CgogICAgTWVkaWF0b3IuaW5zdGFsbFRvKFJ1bnRpbWVDbGllbnQucHJvdG90eXBlKTsKICAgIHJldHVybiBSdW50aW1lQ2xpZW50OwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg6ZSZ6K+v5L+h5oGvCiAgICovCgogIGRlZmluZSgnbGliL2RuZCcsIFsnYmFzZScsICdtZWRpYXRvcicsICdydW50aW1lL2NsaWVudCddLCBmdW5jdGlvbiAoQmFzZSwgTWVkaWF0b3IsIFJ1bnRpbWVDbGVudCkgewogICAgdmFyICQgPSBCYXNlLiQ7CgogICAgZnVuY3Rpb24gRHJhZ0FuZERyb3Aob3B0cykgewogICAgICBvcHRzID0gdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIERyYWdBbmREcm9wLm9wdGlvbnMsIG9wdHMpOwogICAgICBvcHRzLmNvbnRhaW5lciA9ICQob3B0cy5jb250YWluZXIpOwoKICAgICAgaWYgKCFvcHRzLmNvbnRhaW5lci5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIFJ1bnRpbWVDbGVudC5jYWxsKHRoaXMsICdEcmFnQW5kRHJvcCcpOwogICAgfQoKICAgIERyYWdBbmREcm9wLm9wdGlvbnMgPSB7CiAgICAgIGFjY2VwdDogbnVsbCwKICAgICAgZGlzYWJsZUdsb2JhbERuZDogZmFsc2UKICAgIH07CiAgICBCYXNlLmluaGVyaXRzKFJ1bnRpbWVDbGVudCwgewogICAgICBjb25zdHJ1Y3RvcjogRHJhZ0FuZERyb3AsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICBtZS5jb25uZWN0UnVudGltZShtZS5vcHRpb25zLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5leGVjKCdpbml0Jyk7CiAgICAgICAgICBtZS50cmlnZ2VyKCdyZWFkeScpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhEcmFnQW5kRHJvcC5wcm90b3R5cGUpOwogICAgcmV0dXJuIERyYWdBbmREcm9wOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg57uE5Lu25Z+657G744CCCiAgICovCgogIGRlZmluZSgnd2lkZ2V0cy93aWRnZXQnLCBbJ2Jhc2UnLCAndXBsb2FkZXInXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyKSB7CiAgICB2YXIgJCA9IEJhc2UuJCwKICAgICAgICBfaW5pdDIgPSBVcGxvYWRlci5wcm90b3R5cGUuX2luaXQsCiAgICAgICAgX2Rlc3Ryb3kgPSBVcGxvYWRlci5wcm90b3R5cGUuZGVzdHJveSwKICAgICAgICBJR05PUkUgPSB7fSwKICAgICAgICB3aWRnZXRDbGFzcyA9IFtdOwoKICAgIGZ1bmN0aW9uIGlzQXJyYXlMaWtlKG9iaikgewogICAgICBpZiAoIW9iaikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGxlbmd0aCA9IG9iai5sZW5ndGgsCiAgICAgICAgICB0eXBlID0gJC50eXBlKG9iaik7CgogICAgICBpZiAob2JqLm5vZGVUeXBlID09PSAxICYmIGxlbmd0aCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gdHlwZSA9PT0gJ2FycmF5JyB8fCB0eXBlICE9PSAnZnVuY3Rpb24nICYmIHR5cGUgIT09ICdzdHJpbmcnICYmIChsZW5ndGggPT09IDAgfHwgdHlwZW9mIGxlbmd0aCA9PT0gJ251bWJlcicgJiYgbGVuZ3RoID4gMCAmJiBsZW5ndGggLSAxIGluIG9iaik7CiAgICB9CgogICAgZnVuY3Rpb24gV2lkZ2V0KHVwbG9hZGVyKSB7CiAgICAgIHRoaXMub3duZXIgPSB1cGxvYWRlcjsKICAgICAgdGhpcy5vcHRpb25zID0gdXBsb2FkZXIub3B0aW9uczsKICAgIH0KCiAgICAkLmV4dGVuZChXaWRnZXQucHJvdG90eXBlLCB7CiAgICAgIGluaXQ6IEJhc2Uubm9vcCwKICAgICAgLy8g57G7QmFja2JvbmXnmoTkuovku7bnm5HlkKzlo7DmmI7vvIznm5HlkKx1cGxvYWRlcuWunuS+i+S4iueahOS6i+S7tgogICAgICAvLyB3aWRnZXTnm7TmjqXml6Dms5Xnm5HlkKzkuovku7bvvIzkuovku7blj6rog73pgJrov4d1cGxvYWRlcuadpeS8oOmAkgogICAgICBpbnZva2U6IGZ1bmN0aW9uIGludm9rZShhcGlOYW1lLCBhcmdzKSB7CiAgICAgICAgLyoKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ21ha2UtdGh1bWInOiAnbWFrZVRodW1iJwogICAgICAgICAgICB9CiAgICAgICAgICovCiAgICAgICAgdmFyIG1hcCA9IHRoaXMucmVzcG9uc2VNYXA7IC8vIOWmguaenOaXoEFQSeWTjeW6lOWjsOaYjuWImeW/veeVpQoKICAgICAgICBpZiAoIW1hcCB8fCAhKGFwaU5hbWUgaW4gbWFwKSB8fCAhKG1hcFthcGlOYW1lXSBpbiB0aGlzKSB8fCAhJC5pc0Z1bmN0aW9uKHRoaXNbbWFwW2FwaU5hbWVdXSkpIHsKICAgICAgICAgIHJldHVybiBJR05PUkU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpc1ttYXBbYXBpTmFtZV1dLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOWPkemAgeWRveS7pOOAguW9k+S8oOWFpWBjYWxsYmFja2DmiJbogIVgaGFuZGxlcmDkuK3ov5Tlm55gcHJvbWlzZWDml7bjgILov5Tlm57kuIDkuKrlvZPmiYDmnIlgaGFuZGxlcmDkuK3nmoRwcm9taXNl6YO95a6M5oiQ5ZCO5a6M5oiQ55qE5pawYHByb21pc2Vg44CCCiAgICAgICAqIEBtZXRob2QgcmVxdWVzdAogICAgICAgKiBAZ3JhbW1hciByZXF1ZXN0KCBjb21tYW5kLCBhcmdzICkgPT4gKiB8IFByb21pc2UKICAgICAgICogQGdyYW1tYXIgcmVxdWVzdCggY29tbWFuZCwgYXJncywgY2FsbGJhY2sgKSA9PiBQcm9taXNlCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICByZXF1ZXN0OiBmdW5jdGlvbiByZXF1ZXN0KCkgewogICAgICAgIHJldHVybiB0aGlzLm93bmVyLnJlcXVlc3QuYXBwbHkodGhpcy5vd25lciwgYXJndW1lbnRzKTsKICAgICAgfQogICAgfSk7IC8vIOaJqeWxlVVwbG9hZGVyLgoKICAgICQuZXh0ZW5kKFVwbG9hZGVyLnByb3RvdHlwZSwgewogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtTdHJpbmcgfCBBcnJheX0gW2Rpc2FibGVXaWRnZXRzPXVuZGVmaW5lZF0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOm7mOiupOaJgOaciSBVcGxvYWRlci5yZWdpc3RlciDkuobnmoQgd2lkZ2V0IOmDveS8muiiq+WKoOi9ve+8jOWmguaenOemgeeUqOafkOS4gOmDqOWIhu+8jOivt+mAmui/h+atpCBvcHRpb24g5oyH5a6a6buR5ZCN5Y2V44CCCiAgICAgICAqLwogICAgICAvLyDopoblhplfaW5pdOeUqOadpeWIneWni+WMlndpZGdldHMKICAgICAgX2luaXQ6IGZ1bmN0aW9uIF9pbml0KCkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIHdpZGdldHMgPSBtZS5fd2lkZ2V0cyA9IFtdLAogICAgICAgICAgICBkZWFjdGl2ZXMgPSBtZS5vcHRpb25zLmRpc2FibGVXaWRnZXRzIHx8ICcnOwogICAgICAgICQuZWFjaCh3aWRnZXRDbGFzcywgZnVuY3Rpb24gKF8sIGtsYXNzKSB7CiAgICAgICAgICAoIWRlYWN0aXZlcyB8fCAhfmRlYWN0aXZlcy5pbmRleE9mKGtsYXNzLl9uYW1lKSkgJiYgd2lkZ2V0cy5wdXNoKG5ldyBrbGFzcyhtZSkpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfaW5pdDIuYXBwbHkobWUsIGFyZ3VtZW50cyk7CiAgICAgIH0sCiAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIHJlcXVlc3QoYXBpTmFtZSwgYXJncywgY2FsbGJhY2spIHsKICAgICAgICB2YXIgaSA9IDAsCiAgICAgICAgICAgIHdpZGdldHMgPSB0aGlzLl93aWRnZXRzLAogICAgICAgICAgICBsZW4gPSB3aWRnZXRzICYmIHdpZGdldHMubGVuZ3RoLAogICAgICAgICAgICBybHRzID0gW10sCiAgICAgICAgICAgIGRmZHMgPSBbXSwKICAgICAgICAgICAgd2lkZ2V0LAogICAgICAgICAgICBybHQsCiAgICAgICAgICAgIHByb21pc2UsCiAgICAgICAgICAgIGtleTsKICAgICAgICBhcmdzID0gaXNBcnJheUxpa2UoYXJncykgPyBhcmdzIDogW2FyZ3NdOwoKICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICB3aWRnZXQgPSB3aWRnZXRzW2ldOwogICAgICAgICAgcmx0ID0gd2lkZ2V0Lmludm9rZShhcGlOYW1lLCBhcmdzKTsKCiAgICAgICAgICBpZiAocmx0ICE9PSBJR05PUkUpIHsKICAgICAgICAgICAgLy8gRGVmZXJyZWTlr7nosaEKICAgICAgICAgICAgaWYgKEJhc2UuaXNQcm9taXNlKHJsdCkpIHsKICAgICAgICAgICAgICBkZmRzLnB1c2gocmx0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBybHRzLnB1c2gocmx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gLy8g5aaC5p6c5pyJY2FsbGJhY2vvvIzliJnnlKjlvILmraXmlrnlvI/jgIIKCgogICAgICAgIGlmIChjYWxsYmFjayB8fCBkZmRzLmxlbmd0aCkgewogICAgICAgICAgcHJvbWlzZSA9IEJhc2Uud2hlbi5hcHBseShCYXNlLCBkZmRzKTsKICAgICAgICAgIGtleSA9IHByb21pc2UucGlwZSA/ICdwaXBlJyA6ICd0aGVuJzsgLy8g5b6I6YeN6KaB5LiN6IO95Yig6Zmk44CC5Yig6Zmk5LqG5Lya5q275b6q546v44CCCiAgICAgICAgICAvLyDkv53or4HmiafooYzpobrluo/jgILorqljYWxsYmFja+aAu+aYr+WcqOS4i+S4gOS4qiB0aWNrIOS4reaJp+ihjOOAggoKICAgICAgICAgIHJldHVybiBwcm9taXNlW2tleV0oZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCksCiAgICAgICAgICAgICAgICBhcmdzID0gYXJndW1lbnRzOwoKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICAgICAgYXJncyA9IGFyZ3NbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoYXJncyk7CiAgICAgICAgICAgIH0sIDEpOwogICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpOwogICAgICAgICAgfSlbY2FsbGJhY2sgPyBrZXkgOiAnZG9uZSddKGNhbGxiYWNrIHx8IEJhc2Uubm9vcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBybHRzWzBdOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICBfZGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoKICAgICAgICB0aGlzLl93aWRnZXRzID0gbnVsbDsKICAgICAgfQogICAgfSk7CiAgICAvKioKICAgICAqIOa3u+WKoOe7hOS7tgogICAgICogQGdyYW1tYXIgVXBsb2FkZXIucmVnaXN0ZXIocHJvdG8pOwogICAgICogQGdyYW1tYXIgVXBsb2FkZXIucmVnaXN0ZXIobWFwLCBwcm90byk7CiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHJlc3BvbnNlTWFwIEFQSSDlkI3np7DkuI7lh73mlbDlrp7njrDnmoTmmKDlsIQKICAgICAqIEBwYXJhbSAge29iamVjdH0gcHJvdG8g57uE5Lu25Y6f5Z6L77yM5p6E6YCg5Ye95pWw6YCa6L+HIGNvbnN0cnVjdG9yIOWxnuaAp+WumuS5iQogICAgICogQG1ldGhvZCBVcGxvYWRlci5yZWdpc3RlcgogICAgICogQGZvciBVcGxvYWRlcgogICAgICogQGV4YW1wbGUKICAgICAqIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAqICAgICAnbWFrZS10aHVtYic6ICdtYWtlVGh1bWInCiAgICAgKiB9LCB7CiAgICAgKiAgICAgaW5pdDogZnVuY3Rpb24oIG9wdGlvbnMgKSB7fSwKICAgICAqICAgICBtYWtlVGh1bWI6IGZ1bmN0aW9uKCkge30KICAgICAqIH0pOwogICAgICoKICAgICAqIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAqICAgICAnbWFrZS10aHVtYic6IGZ1bmN0aW9uKCkgewogICAgICoKICAgICAqICAgICB9CiAgICAgKiB9KTsKICAgICAqLwoKICAgIFVwbG9hZGVyLnJlZ2lzdGVyID0gV2lkZ2V0LnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlc3BvbnNlTWFwLCB3aWRnZXRQcm90bykgewogICAgICB2YXIgbWFwID0gewogICAgICAgIGluaXQ6ICdpbml0JywKICAgICAgICBkZXN0cm95OiAnZGVzdHJveScsCiAgICAgICAgbmFtZTogJ2Fub255bW91cycKICAgICAgfSwKICAgICAgICAgIGtsYXNzOwoKICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgICB3aWRnZXRQcm90byA9IHJlc3BvbnNlTWFwOyAvLyDoh6rliqjnlJ/miJAgbWFwIOihqOOAggoKICAgICAgICAkLmVhY2god2lkZ2V0UHJvdG8sIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIGlmIChrZXlbMF0gPT09ICdfJyB8fCBrZXkgPT09ICduYW1lJykgewogICAgICAgICAgICBrZXkgPT09ICduYW1lJyAmJiAobWFwLm5hbWUgPSB3aWRnZXRQcm90by5uYW1lKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIG1hcFtrZXkucmVwbGFjZSgvW0EtWl0vZywgJy0kJicpLnRvTG93ZXJDYXNlKCldID0ga2V5OwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG1hcCA9ICQuZXh0ZW5kKG1hcCwgcmVzcG9uc2VNYXApOwogICAgICB9CgogICAgICB3aWRnZXRQcm90by5yZXNwb25zZU1hcCA9IG1hcDsKICAgICAga2xhc3MgPSBCYXNlLmluaGVyaXRzKFdpZGdldCwgd2lkZ2V0UHJvdG8pOwogICAgICBrbGFzcy5fbmFtZSA9IG1hcC5uYW1lOwogICAgICB3aWRnZXRDbGFzcy5wdXNoKGtsYXNzKTsKICAgICAgcmV0dXJuIGtsYXNzOwogICAgfTsKICAgIC8qKgogICAgICog5Yig6Zmk5o+S5Lu277yM5Y+q5pyJ5Zyo5rOo5YaM5pe25oyH5a6a5LqG5ZCN5a2X55qE5omN6IO96KKr5Yig6Zmk44CCCiAgICAgKiBAZ3JhbW1hciBVcGxvYWRlci51blJlZ2lzdGVyKG5hbWUpOwogICAgICogQHBhcmFtICB7c3RyaW5nfSBuYW1lIOe7hOS7tuWQjeWtlwogICAgICogQG1ldGhvZCBVcGxvYWRlci51blJlZ2lzdGVyCiAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgKiBAZXhhbXBsZQogICAgICoKICAgICAqIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAqICAgICBuYW1lOiAnY3VzdG9tJywKICAgICAqCiAgICAgKiAgICAgJ21ha2UtdGh1bWInOiBmdW5jdGlvbigpIHsKICAgICAqCiAgICAgKiAgICAgfQogICAgICogfSk7CiAgICAgKgogICAgICogVXBsb2FkZXIudW5SZWdpc3RlcignY3VzdG9tJyk7CiAgICAgKi8KCgogICAgVXBsb2FkZXIudW5SZWdpc3RlciA9IFdpZGdldC51blJlZ2lzdGVyID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgaWYgKCFuYW1lIHx8IG5hbWUgPT09ICdhbm9ueW1vdXMnKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIOWIoOmZpOaMh+WumueahOaPkuS7tuOAggoKCiAgICAgIGZvciAodmFyIGkgPSB3aWRnZXRDbGFzcy5sZW5ndGg7IGktLTspIHsKICAgICAgICBpZiAod2lkZ2V0Q2xhc3NbaV0uX25hbWUgPT09IG5hbWUpIHsKICAgICAgICAgIHdpZGdldENsYXNzLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIFdpZGdldDsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IERyYWdBbmREcm9wIFdpZGdldOOAggogICAqLwoKICBkZWZpbmUoJ3dpZGdldHMvZmlsZWRuZCcsIFsnYmFzZScsICd1cGxvYWRlcicsICdsaWIvZG5kJywgJ3dpZGdldHMvd2lkZ2V0J10sIGZ1bmN0aW9uIChCYXNlLCBVcGxvYWRlciwgRG5kKSB7CiAgICB2YXIgJCA9IEJhc2UuJDsKICAgIFVwbG9hZGVyLm9wdGlvbnMuZG5kID0gJyc7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7U2VsZWN0b3J9IFtkbmQ9dW5kZWZpbmVkXSAg5oyH5a6aRHJhZyBBbmQgRHJvcOaLluaLveeahOWuueWZqO+8jOWmguaenOS4jeaMh+Wumu+8jOWImeS4jeWQr+WKqOOAggogICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7U2VsZWN0b3J9IFtkaXNhYmxlR2xvYmFsRG5kPWZhbHNlXSAg5piv5ZCm56aB5o6J5pW05Liq6aG16Z2i55qE5ouW5ou95Yqf6IO977yM5aaC5p6c5LiN56aB55So77yM5Zu+54mH5ouW6L+b5p2l55qE5pe25YCZ5Lya6buY6K6k6KKr5rWP6KeI5Zmo5omT5byA44CCCiAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQGV2ZW50IGRuZEFjY2VwdAogICAgICogQHBhcmFtIHtEYXRhVHJhbnNmZXJJdGVtTGlzdH0gaXRlbXMgRGF0YVRyYW5zZmVySXRlbQogICAgICogQGRlc2NyaXB0aW9uIOmYu+atouatpOS6i+S7tuWPr+S7peaLkue7neafkOS6m+exu+Wei+eahOaWh+S7tuaLluWFpei/m+adpeOAguebruWJjeWPquaciSBjaHJvbWUg5o+Q5L6b6L+Z5qC355qEIEFQSe+8jOS4lOWPquiDvemAmui/hyBtaW1lLXR5cGUg6aqM6K+B44CCCiAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICovCgogICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAgbmFtZTogJ2RuZCcsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQob3B0cykgewogICAgICAgIGlmICghb3B0cy5kbmQgfHwgdGhpcy5yZXF1ZXN0KCdwcmVkaWN0LXJ1bnRpbWUtdHlwZScpICE9PSAnaHRtbDUnKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKSwKICAgICAgICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB7CiAgICAgICAgICBkaXNhYmxlR2xvYmFsRG5kOiBvcHRzLmRpc2FibGVHbG9iYWxEbmQsCiAgICAgICAgICBjb250YWluZXI6IG9wdHMuZG5kLAogICAgICAgICAgYWNjZXB0OiBvcHRzLmFjY2VwdAogICAgICAgIH0pLAogICAgICAgICAgICBkbmQ7CiAgICAgICAgdGhpcy5kbmQgPSBkbmQgPSBuZXcgRG5kKG9wdGlvbnMpOwogICAgICAgIGRuZC5vbmNlKCdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUpOwogICAgICAgIGRuZC5vbignZHJvcCcsIGZ1bmN0aW9uIChmaWxlcykgewogICAgICAgICAgbWUucmVxdWVzdCgnYWRkLWZpbGUnLCBbZmlsZXNdKTsKICAgICAgICB9KTsgLy8g5qOA5rWL5paH5Lu25piv5ZCm5YWo6YOo5YWB6K645re75Yqg44CCCgogICAgICAgIGRuZC5vbignYWNjZXB0JywgZnVuY3Rpb24gKGl0ZW1zKSB7CiAgICAgICAgICByZXR1cm4gbWUub3duZXIudHJpZ2dlcignZG5kQWNjZXB0JywgaXRlbXMpOwogICAgICAgIH0pOwogICAgICAgIGRuZC5pbml0KCk7CiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLmRuZCAmJiB0aGlzLmRuZC5kZXN0cm95KCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg6ZSZ6K+v5L+h5oGvCiAgICovCgogIGRlZmluZSgnbGliL2ZpbGVwYXN0ZScsIFsnYmFzZScsICdtZWRpYXRvcicsICdydW50aW1lL2NsaWVudCddLCBmdW5jdGlvbiAoQmFzZSwgTWVkaWF0b3IsIFJ1bnRpbWVDbGVudCkgewogICAgdmFyICQgPSBCYXNlLiQ7CgogICAgZnVuY3Rpb24gRmlsZVBhc3RlKG9wdHMpIHsKICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBvcHRzKTsKICAgICAgb3B0cy5jb250YWluZXIgPSAkKG9wdHMuY29udGFpbmVyIHx8IGRvY3VtZW50LmJvZHkpOwogICAgICBSdW50aW1lQ2xlbnQuY2FsbCh0aGlzLCAnRmlsZVBhc3RlJyk7CiAgICB9CgogICAgQmFzZS5pbmhlcml0cyhSdW50aW1lQ2xlbnQsIHsKICAgICAgY29uc3RydWN0b3I6IEZpbGVQYXN0ZSwKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIG1lLmNvbm5lY3RSdW50aW1lKG1lLm9wdGlvbnMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG1lLmV4ZWMoJ2luaXQnKTsKICAgICAgICAgIG1lLnRyaWdnZXIoJ3JlYWR5Jyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgTWVkaWF0b3IuaW5zdGFsbFRvKEZpbGVQYXN0ZS5wcm90b3R5cGUpOwogICAgcmV0dXJuIEZpbGVQYXN0ZTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IOe7hOS7tuWfuuexu+OAggogICAqLwoKICBkZWZpbmUoJ3dpZGdldHMvZmlsZXBhc3RlJywgWydiYXNlJywgJ3VwbG9hZGVyJywgJ2xpYi9maWxlcGFzdGUnLCAnd2lkZ2V0cy93aWRnZXQnXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyLCBGaWxlUGFzdGUpIHsKICAgIHZhciAkID0gQmFzZS4kOwogICAgLyoqCiAgICAgKiBAcHJvcGVydHkge1NlbGVjdG9yfSBbcGFzdGU9dW5kZWZpbmVkXSAg5oyH5a6a55uR5ZCscGFzdGXkuovku7bnmoTlrrnlmajvvIzlpoLmnpzkuI3mjIflrprvvIzkuI3lkK/nlKjmraTlip/og73jgILmraTlip/og73kuLrpgJrov4fnspjotLTmnaXmt7vliqDmiKrlsY/nmoTlm77niYfjgILlu7rorq7orr7nva7kuLpgZG9jdW1lbnQuYm9keWAuCiAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAqLwoKICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICdwYXN0ZScsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQob3B0cykgewogICAgICAgIGlmICghb3B0cy5wYXN0ZSB8fCB0aGlzLnJlcXVlc3QoJ3ByZWRpY3QtcnVudGltZS10eXBlJykgIT09ICdodG1sNScpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIGRlZmVycmVkID0gQmFzZS5EZWZlcnJlZCgpLAogICAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIHsKICAgICAgICAgIGNvbnRhaW5lcjogb3B0cy5wYXN0ZSwKICAgICAgICAgIGFjY2VwdDogb3B0cy5hY2NlcHQKICAgICAgICB9KSwKICAgICAgICAgICAgcGFzdGU7CiAgICAgICAgdGhpcy5wYXN0ZSA9IHBhc3RlID0gbmV3IEZpbGVQYXN0ZShvcHRpb25zKTsKICAgICAgICBwYXN0ZS5vbmNlKCdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUpOwogICAgICAgIHBhc3RlLm9uKCdwYXN0ZScsIGZ1bmN0aW9uIChmaWxlcykgewogICAgICAgICAgbWUub3duZXIucmVxdWVzdCgnYWRkLWZpbGUnLCBbZmlsZXNdKTsKICAgICAgICB9KTsKICAgICAgICBwYXN0ZS5pbml0KCk7CiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLnBhc3RlICYmIHRoaXMucGFzdGUuZGVzdHJveSgpOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEJsb2IKICAgKi8KCiAgZGVmaW5lKCdsaWIvYmxvYicsIFsnYmFzZScsICdydW50aW1lL2NsaWVudCddLCBmdW5jdGlvbiAoQmFzZSwgUnVudGltZUNsaWVudCkgewogICAgZnVuY3Rpb24gQmxvYihydWlkLCBzb3VyY2UpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuc291cmNlID0gc291cmNlOwogICAgICBtZS5ydWlkID0gcnVpZDsKICAgICAgdGhpcy5zaXplID0gc291cmNlLnNpemUgfHwgMDsgLy8g5aaC5p6c5rKh5pyJ5oyH5a6aIG1pbWV0eXBlLCDkvYbmmK/nn6XpgZPmlofku7blkI7nvIDjgIIKCiAgICAgIGlmICghc291cmNlLnR5cGUgJiYgdGhpcy5leHQgJiYgfidqcGcsanBlZyxwbmcsZ2lmLGJtcCcuaW5kZXhPZih0aGlzLmV4dCkpIHsKICAgICAgICB0aGlzLnR5cGUgPSAnaW1hZ2UvJyArICh0aGlzLmV4dCA9PT0gJ2pwZycgPyAnanBlZycgOiB0aGlzLmV4dCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50eXBlID0gc291cmNlLnR5cGUgfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICAgIH0KCiAgICAgIFJ1bnRpbWVDbGllbnQuY2FsbChtZSwgJ0Jsb2InKTsKICAgICAgdGhpcy51aWQgPSBzb3VyY2UudWlkIHx8IHRoaXMudWlkOwoKICAgICAgaWYgKHJ1aWQpIHsKICAgICAgICBtZS5jb25uZWN0UnVudGltZShydWlkKTsKICAgICAgfQogICAgfQoKICAgIEJhc2UuaW5oZXJpdHMoUnVudGltZUNsaWVudCwgewogICAgICBjb25zdHJ1Y3RvcjogQmxvYiwKICAgICAgc2xpY2U6IGZ1bmN0aW9uIHNsaWNlKHN0YXJ0LCBlbmQpIHsKICAgICAgICByZXR1cm4gdGhpcy5leGVjKCdzbGljZScsIHN0YXJ0LCBlbmQpOwogICAgICB9LAogICAgICBnZXRTb3VyY2U6IGZ1bmN0aW9uIGdldFNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2U7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEJsb2I7CiAgfSk7CiAgLyoqCiAgICog5Li65LqG57uf5LiA5YyWRmxhc2jnmoRGaWxl5ZKMSFRNTDXnmoRGaWxl6ICM5a2Y5Zyo44CCCiAgICog5Lul6Iez5LqO6KaB6LCD55SoRmxhc2jph4zpnaLnmoRGaWxl77yM5Lmf5Y+v5Lul5YOP6LCD55SoSFRNTDXniYjmnKznmoRGaWxl5LiA5LiL44CCCiAgICogQGZpbGVPdmVydmlldyBGaWxlCiAgICovCgogIGRlZmluZSgnbGliL2ZpbGUnLCBbJ2Jhc2UnLCAnbGliL2Jsb2InXSwgZnVuY3Rpb24gKEJhc2UsIEJsb2IpIHsKICAgIHZhciB1aWQgPSAxLAogICAgICAgIHJFeHQgPSAvXC4oW14uXSspJC87CgogICAgZnVuY3Rpb24gRmlsZShydWlkLCBmaWxlKSB7CiAgICAgIHZhciBleHQ7CiAgICAgIHRoaXMubmFtZSA9IGZpbGUubmFtZSB8fCAndW50aXRsZWQnICsgdWlkKys7CiAgICAgIGV4dCA9IHJFeHQuZXhlYyhmaWxlLm5hbWUpID8gUmVnRXhwLiQxLnRvTG93ZXJDYXNlKCkgOiAnJzsgLy8gdG9kbyDmlK/mjIHlhbbku5bnsbvlnovmlofku7bnmoTovazmjaLjgIIKICAgICAgLy8g5aaC5p6c5pyJIG1pbWV0eXBlLCDkvYbmmK/mlofku7blkI3ph4zpnaLmsqHmnInmib7lh7rlkI7nvIDop4TlvosKCiAgICAgIGlmICghZXh0ICYmIGZpbGUudHlwZSkgewogICAgICAgIGV4dCA9IC9cLyhqcGd8anBlZ3xwbmd8Z2lmfGJtcCkkL2kuZXhlYyhmaWxlLnR5cGUpID8gUmVnRXhwLiQxLnRvTG93ZXJDYXNlKCkgOiAnJzsKICAgICAgICB0aGlzLm5hbWUgKz0gJy4nICsgZXh0OwogICAgICB9CgogICAgICB0aGlzLmV4dCA9IGV4dDsKICAgICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gZmlsZS5sYXN0TW9kaWZpZWREYXRlIHx8IG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKTsKICAgICAgQmxvYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIHJldHVybiBCYXNlLmluaGVyaXRzKEJsb2IsIEZpbGUpOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg6ZSZ6K+v5L+h5oGvCiAgICovCgogIGRlZmluZSgnbGliL2ZpbGVwaWNrZXInLCBbJ2Jhc2UnLCAncnVudGltZS9jbGllbnQnLCAnbGliL2ZpbGUnXSwgZnVuY3Rpb24gKEJhc2UsIFJ1bnRpbWVDbGllbnQsIEZpbGUpIHsKICAgIHZhciAkID0gQmFzZS4kOwoKICAgIGZ1bmN0aW9uIEZpbGVQaWNrZXIob3B0cykgewogICAgICBvcHRzID0gdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIEZpbGVQaWNrZXIub3B0aW9ucywgb3B0cyk7CiAgICAgIG9wdHMuY29udGFpbmVyID0gJChvcHRzLmlkKTsKCiAgICAgIGlmICghb3B0cy5jb250YWluZXIubGVuZ3RoKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmjInpkq7mjIflrprplJnor68nKTsKICAgICAgfQoKICAgICAgb3B0cy5pbm5lckhUTUwgPSBvcHRzLmlubmVySFRNTCB8fCBvcHRzLmxhYmVsIHx8IG9wdHMuY29udGFpbmVyLmh0bWwoKSB8fCAnJzsKICAgICAgb3B0cy5idXR0b24gPSAkKG9wdHMuYnV0dG9uIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTsKICAgICAgb3B0cy5idXR0b24uaHRtbChvcHRzLmlubmVySFRNTCk7CiAgICAgIG9wdHMuY29udGFpbmVyLmh0bWwob3B0cy5idXR0b24pOwogICAgICBSdW50aW1lQ2xpZW50LmNhbGwodGhpcywgJ0ZpbGVQaWNrZXInLCB0cnVlKTsKICAgIH0KCiAgICBGaWxlUGlja2VyLm9wdGlvbnMgPSB7CiAgICAgIGJ1dHRvbjogbnVsbCwKICAgICAgY29udGFpbmVyOiBudWxsLAogICAgICBsYWJlbDogbnVsbCwKICAgICAgaW5uZXJIVE1MOiBudWxsLAogICAgICBtdWx0aXBsZTogdHJ1ZSwKICAgICAgYWNjZXB0OiBudWxsLAogICAgICBuYW1lOiAnZmlsZScsCiAgICAgIHN0eWxlOiAnd2VidXBsb2FkZXItcGljaycgLy9waWNrIGVsZW1lbnQgY2xhc3MgYXR0cmlidXRlLCBkZWZhdWx0IGlzICJ3ZWJ1cGxvYWRlci1waWNrIgoKICAgIH07CiAgICBCYXNlLmluaGVyaXRzKFJ1bnRpbWVDbGllbnQsIHsKICAgICAgY29uc3RydWN0b3I6IEZpbGVQaWNrZXIsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgb3B0cyA9IG1lLm9wdGlvbnMsCiAgICAgICAgICAgIGJ1dHRvbiA9IG9wdHMuYnV0dG9uLAogICAgICAgICAgICBzdHlsZSA9IG9wdHMuc3R5bGU7CiAgICAgICAgaWYgKHN0eWxlKSBidXR0b24uYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2snKTsKICAgICAgICBtZS5vbignYWxsJywgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgIHZhciBmaWxlczsKCiAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbW91c2VlbnRlcic6CiAgICAgICAgICAgICAgaWYgKHN0eWxlKSBidXR0b24uYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2staG92ZXInKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ21vdXNlbGVhdmUnOgogICAgICAgICAgICAgIGlmIChzdHlsZSkgYnV0dG9uLnJlbW92ZUNsYXNzKCd3ZWJ1cGxvYWRlci1waWNrLWhvdmVyJyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICdjaGFuZ2UnOgogICAgICAgICAgICAgIGZpbGVzID0gbWUuZXhlYygnZ2V0RmlsZXMnKTsKICAgICAgICAgICAgICBtZS50cmlnZ2VyKCdzZWxlY3QnLCAkLm1hcChmaWxlcywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgICAgICAgIGZpbGUgPSBuZXcgRmlsZShtZS5nZXRSdWlkKCksIGZpbGUpOyAvLyDorrDlvZXmnaXmupDjgIIKCiAgICAgICAgICAgICAgICBmaWxlLl9yZWZlciA9IG9wdHMuY29udGFpbmVyOwogICAgICAgICAgICAgICAgcmV0dXJuIGZpbGU7CiAgICAgICAgICAgICAgfSksIG9wdHMuY29udGFpbmVyKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBtZS5jb25uZWN0UnVudGltZShvcHRzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5yZWZyZXNoKCk7CiAgICAgICAgICBtZS5leGVjKCdpbml0Jywgb3B0cyk7CiAgICAgICAgICBtZS50cmlnZ2VyKCdyZWFkeScpOwogICAgICAgIH0pOwogICAgICAgIHRoaXMuX3Jlc2l6ZUhhbmRsZXIgPSBCYXNlLmJpbmRGbih0aGlzLnJlZnJlc2gsIHRoaXMpOwogICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgdGhpcy5fcmVzaXplSGFuZGxlcik7CiAgICAgIH0sCiAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uIHJlZnJlc2goKSB7CiAgICAgICAgdmFyIHNoaW1Db250YWluZXIgPSB0aGlzLmdldFJ1bnRpbWUoKS5nZXRDb250YWluZXIoKSwKICAgICAgICAgICAgYnV0dG9uID0gdGhpcy5vcHRpb25zLmJ1dHRvbiwKICAgICAgICAgICAgd2lkdGggPSBidXR0b24ub3V0ZXJXaWR0aCA/IGJ1dHRvbi5vdXRlcldpZHRoKCkgOiBidXR0b24ud2lkdGgoKSwKICAgICAgICAgICAgaGVpZ2h0ID0gYnV0dG9uLm91dGVySGVpZ2h0ID8gYnV0dG9uLm91dGVySGVpZ2h0KCkgOiBidXR0b24uaGVpZ2h0KCksCiAgICAgICAgICAgIHBvcyA9IGJ1dHRvbi5vZmZzZXQoKTsKICAgICAgICB3aWR0aCAmJiBoZWlnaHQgJiYgc2hpbUNvbnRhaW5lci5jc3MoewogICAgICAgICAgYm90dG9tOiAnYXV0bycsCiAgICAgICAgICByaWdodDogJ2F1dG8nLAogICAgICAgICAgd2lkdGg6IHdpZHRoICsgJ3B4JywKICAgICAgICAgIGhlaWdodDogaGVpZ2h0ICsgJ3B4JwogICAgICAgIH0pLm9mZnNldChwb3MpOwogICAgICB9LAogICAgICBlbmFibGU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKICAgICAgICB2YXIgYnRuID0gdGhpcy5vcHRpb25zLmJ1dHRvbjsKICAgICAgICBidG4ucmVtb3ZlQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2stZGlzYWJsZScpOwogICAgICAgIHRoaXMucmVmcmVzaCgpOwogICAgICB9LAogICAgICBkaXNhYmxlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICAgIHZhciBidG4gPSB0aGlzLm9wdGlvbnMuYnV0dG9uOwogICAgICAgIHRoaXMuZ2V0UnVudGltZSgpLmdldENvbnRhaW5lcigpLmNzcyh7CiAgICAgICAgICB0b3A6ICctOTk5OTlweCcKICAgICAgICB9KTsKICAgICAgICBidG4uYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLXBpY2stZGlzYWJsZScpOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHZhciBidG4gPSB0aGlzLm9wdGlvbnMuYnV0dG9uOwogICAgICAgICQod2luZG93KS5vZmYoJ3Jlc2l6ZScsIHRoaXMuX3Jlc2l6ZUhhbmRsZXIpOwogICAgICAgIGJ0bi5yZW1vdmVDbGFzcygnd2VidXBsb2FkZXItcGljay1kaXNhYmxlIHdlYnVwbG9hZGVyLXBpY2staG92ZXIgJyArICd3ZWJ1cGxvYWRlci1waWNrJyk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIEZpbGVQaWNrZXI7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDmlofku7bpgInmi6nnm7jlhbMKICAgKi8KCiAgZGVmaW5lKCd3aWRnZXRzL2ZpbGVwaWNrZXInLCBbJ2Jhc2UnLCAndXBsb2FkZXInLCAnbGliL2ZpbGVwaWNrZXInLCAnd2lkZ2V0cy93aWRnZXQnXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyLCBGaWxlUGlja2VyKSB7CiAgICB2YXIgJCA9IEJhc2UuJDsKICAgICQuZXh0ZW5kKFVwbG9hZGVyLm9wdGlvbnMsIHsKICAgICAgLyoqCiAgICAgICAqIEBwcm9wZXJ0eSB7U2VsZWN0b3IgfCBPYmplY3R9IFtwaWNrPXVuZGVmaW5lZF0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOaMh+WumumAieaLqeaWh+S7tueahOaMiemSruWuueWZqO+8jOS4jeaMh+WumuWImeS4jeWIm+W7uuaMiemSruOAggogICAgICAgKgogICAgICAgKiAqIGBpZGAge1NlbGV0b3J8ZG9tfSDmjIflrprpgInmi6nmlofku7bnmoTmjInpkq7lrrnlmajvvIzkuI3mjIflrprliJnkuI3liJvlu7rmjInpkq7jgIIqKuazqOaEjyoqIOi/memHjOiZveeEtuWGmeeahOaYryBpZCwg5L2G5piv5LiN5piv5Y+q5pSv5oyBIGlkLCDov5jmlK/mjIEgY2xhc3MsIOaIluiAhSBkb20g6IqC54K544CCCiAgICAgICAqICogYGxhYmVsYCB7U3RyaW5nfSDor7fph4fnlKggYGlubmVySFRNTGAg5Luj5pu/CiAgICAgICAqICogYGlubmVySFRNTGAge1N0cmluZ30g5oyH5a6a5oyJ6ZKu5paH5a2X44CC5LiN5oyH5a6a5pe25LyY5YWI5LuO5oyH5a6a55qE5a655Zmo5Lit55yL5piv5ZCm6Ieq5bim5paH5a2X44CCCiAgICAgICAqICogYG11bHRpcGxlYCB7Qm9vbGVhbn0g5piv5ZCm5byA6LW35ZCM5pe26YCJ5oup5aSa5Liq5paH5Lu26IO95Yqb44CCCiAgICAgICAqLwogICAgICBwaWNrOiBudWxsLAoKICAgICAgLyoqCiAgICAgICAqIEBwcm9wZXJ0eSB7QXJyb3l9IFthY2NlcHQ9bnVsbF0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOaMh+WumuaOpeWPl+WTquS6m+exu+Wei+eahOaWh+S7tuOAgiDnlLHkuo7nm67liY3ov5jmnIlleHTovaxtaW1lVHlwZeihqO+8jOaJgOS7pei/memHjOmcgOimgeWIhuW8gOaMh+WumuOAggogICAgICAgKgogICAgICAgKiAqIGB0aXRsZWAge1N0cmluZ30g5paH5a2X5o+P6L+wCiAgICAgICAqICogYGV4dGVuc2lvbnNgIHtTdHJpbmd9IOWFgeiuuOeahOaWh+S7tuWQjue8gO+8jOS4jeW4pueCue+8jOWkmuS4queUqOmAl+WPt+WIhuWJsuOAggogICAgICAgKiAqIGBtaW1lVHlwZXNgIHtTdHJpbmd9IOWkmuS4queUqOmAl+WPt+WIhuWJsuOAggogICAgICAgKgogICAgICAgKiDlpoLvvJoKICAgICAgICoKICAgICAgICogYGBgCiAgICAgICAqIHsKICAgICAgICogICAgIHRpdGxlOiAnSW1hZ2VzJywKICAgICAgICogICAgIGV4dGVuc2lvbnM6ICdnaWYsanBnLGpwZWcsYm1wLHBuZycsCiAgICAgICAqICAgICBtaW1lVHlwZXM6ICdpbWFnZS8qJwogICAgICAgKiB9CiAgICAgICAqIGBgYAogICAgICAgKi8KICAgICAgYWNjZXB0OiBudWxsCiAgICAgIC8qewogICAgICB0aXRsZTogJ0ltYWdlcycsCiAgICAgIGV4dGVuc2lvbnM6ICdnaWYsanBnLGpwZWcsYm1wLHBuZycsCiAgICAgIG1pbWVUeXBlczogJ2ltYWdlLyonCiAgICAgIH0qLwoKICAgIH0pOwogICAgcmV0dXJuIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAgbmFtZTogJ3BpY2tlcicsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQob3B0cykgewogICAgICAgIHRoaXMucGlja2VycyA9IFtdOwogICAgICAgIHJldHVybiBvcHRzLnBpY2sgJiYgdGhpcy5hZGRCdG4ob3B0cy5waWNrKTsKICAgICAgfSwKICAgICAgcmVmcmVzaDogZnVuY3Rpb24gcmVmcmVzaCgpIHsKICAgICAgICAkLmVhY2godGhpcy5waWNrZXJzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGlzLnJlZnJlc2goKTsKICAgICAgICB9KTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAbWV0aG9kIGFkZEJ0bgogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBncmFtbWFyIGFkZEJ0biggcGljayApID0+IFByb21pc2UKICAgICAgICogQGRlc2NyaXB0aW9uCiAgICAgICAqIOa3u+WKoOaWh+S7tumAieaLqeaMiemSru+8jOWmguaenOS4gOS4quaMiemSruS4jeWkn++8jOmcgOimgeiwg+eUqOatpOaWueazleadpea3u+WKoOOAguWPguaVsOi3n1tvcHRpb25zLnBpY2tdKCNXZWJVcGxvYWRlcjpVcGxvYWRlcjpvcHRpb25zKeS4gOiHtOOAggogICAgICAgKiBAZXhhbXBsZQogICAgICAgKiB1cGxvYWRlci5hZGRCdG4oewogICAgICAgKiAgICAgaWQ6ICcjYnRuQ29udGFpbmVyJywKICAgICAgICogICAgIGlubmVySFRNTDogJ+mAieaLqeaWh+S7ticKICAgICAgICogfSk7CiAgICAgICAqLwogICAgICBhZGRCdG46IGZ1bmN0aW9uIGFkZEJ0bihwaWNrKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgb3B0cyA9IG1lLm9wdGlvbnMsCiAgICAgICAgICAgIGFjY2VwdCA9IG9wdHMuYWNjZXB0LAogICAgICAgICAgICBwcm9taXNlcyA9IFtdOwoKICAgICAgICBpZiAoIXBpY2spIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICQuaXNQbGFpbk9iamVjdChwaWNrKSB8fCAocGljayA9IHsKICAgICAgICAgIGlkOiBwaWNrCiAgICAgICAgfSk7CiAgICAgICAgJChwaWNrLmlkKS5lYWNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBvcHRpb25zLCBwaWNrZXIsIGRlZmVycmVkOwogICAgICAgICAgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCk7CiAgICAgICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sIHBpY2ssIHsKICAgICAgICAgICAgYWNjZXB0OiAkLmlzUGxhaW5PYmplY3QoYWNjZXB0KSA/IFthY2NlcHRdIDogYWNjZXB0LAogICAgICAgICAgICBzd2Y6IG9wdHMuc3dmLAogICAgICAgICAgICBydW50aW1lT3JkZXI6IG9wdHMucnVudGltZU9yZGVyLAogICAgICAgICAgICBpZDogdGhpcwogICAgICAgICAgfSk7CiAgICAgICAgICBwaWNrZXIgPSBuZXcgRmlsZVBpY2tlcihvcHRpb25zKTsKICAgICAgICAgIHBpY2tlci5vbmNlKCdyZWFkeScsIGRlZmVycmVkLnJlc29sdmUpOwogICAgICAgICAgcGlja2VyLm9uKCdzZWxlY3QnLCBmdW5jdGlvbiAoZmlsZXMpIHsKICAgICAgICAgICAgbWUub3duZXIucmVxdWVzdCgnYWRkLWZpbGUnLCBbZmlsZXNdKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcGlja2VyLm9uKCdkaWFsb2dvcGVuJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCdkaWFsb2dPcGVuJywgcGlja2VyLmJ1dHRvbik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHBpY2tlci5pbml0KCk7CiAgICAgICAgICBtZS5waWNrZXJzLnB1c2gocGlja2VyKTsKICAgICAgICAgIHByb21pc2VzLnB1c2goZGVmZXJyZWQucHJvbWlzZSgpKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gQmFzZS53aGVuLmFwcGx5KEJhc2UsIHByb21pc2VzKTsKICAgICAgfSwKICAgICAgZGlzYWJsZTogZnVuY3Rpb24gZGlzYWJsZSgpIHsKICAgICAgICAkLmVhY2godGhpcy5waWNrZXJzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZW5hYmxlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgICAgJC5lYWNoKHRoaXMucGlja2VycywgZnVuY3Rpb24gKCkgewogICAgICAgICAgdGhpcy5lbmFibGUoKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICAkLmVhY2godGhpcy5waWNrZXJzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0aGlzLmRlc3Ryb3koKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLnBpY2tlcnMgPSBudWxsOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEltYWdlCiAgICovCgogIGRlZmluZSgnbGliL2ltYWdlJywgWydiYXNlJywgJ3J1bnRpbWUvY2xpZW50JywgJ2xpYi9ibG9iJ10sIGZ1bmN0aW9uIChCYXNlLCBSdW50aW1lQ2xpZW50LCBCbG9iKSB7CiAgICB2YXIgJCA9IEJhc2UuJDsgLy8g5p6E6YCg5Zmo44CCCgogICAgZnVuY3Rpb24gSW1hZ2Uob3B0cykgewogICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgSW1hZ2Uub3B0aW9ucywgb3B0cyk7CiAgICAgIFJ1bnRpbWVDbGllbnQuY2FsbCh0aGlzLCAnSW1hZ2UnKTsKICAgICAgdGhpcy5vbignbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLl9pbmZvID0gdGhpcy5leGVjKCdpbmZvJyk7CiAgICAgICAgdGhpcy5fbWV0YSA9IHRoaXMuZXhlYygnbWV0YScpOwogICAgICB9KTsKICAgIH0gLy8g6buY6K6k6YCJ6aG544CCCgoKICAgIEltYWdlLm9wdGlvbnMgPSB7CiAgICAgIC8vIOm7mOiupOeahOWbvueJh+WkhOeQhui0qOmHjwogICAgICBxdWFsaXR5OiA5MCwKICAgICAgLy8g5piv5ZCm6KOB5YmqCiAgICAgIGNyb3A6IGZhbHNlLAogICAgICAvLyDmmK/lkKbkv53nlZnlpLTpg6jkv6Hmga8KICAgICAgcHJlc2VydmVIZWFkZXJzOiBmYWxzZSwKICAgICAgLy8g5piv5ZCm5YWB6K645pS+5aSn44CCCiAgICAgIGFsbG93TWFnbmlmeTogZmFsc2UKICAgIH07IC8vIOe7p+aJv1J1bnRpbWVDbGllbnQuCgogICAgQmFzZS5pbmhlcml0cyhSdW50aW1lQ2xpZW50LCB7CiAgICAgIGNvbnN0cnVjdG9yOiBJbWFnZSwKICAgICAgaW5mbzogZnVuY3Rpb24gaW5mbyh2YWwpIHsKICAgICAgICAvLyBzZXR0ZXIKICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICB0aGlzLl9pbmZvID0gdmFsOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSAvLyBnZXR0ZXIKCgogICAgICAgIHJldHVybiB0aGlzLl9pbmZvOwogICAgICB9LAogICAgICBtZXRhOiBmdW5jdGlvbiBtZXRhKHZhbCkgewogICAgICAgIC8vIHNldHRlcgogICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgIHRoaXMuX21ldGEgPSB2YWw7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IC8vIGdldHRlcgoKCiAgICAgICAgcmV0dXJuIHRoaXMuX21ldGE7CiAgICAgIH0sCiAgICAgIGxvYWRGcm9tQmxvYjogZnVuY3Rpb24gbG9hZEZyb21CbG9iKGJsb2IpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBydWlkID0gYmxvYi5nZXRSdWlkKCk7CiAgICAgICAgdGhpcy5jb25uZWN0UnVudGltZShydWlkLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5leGVjKCdpbml0JywgbWUub3B0aW9ucyk7CiAgICAgICAgICBtZS5leGVjKCdsb2FkRnJvbUJsb2InLCBibG9iKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcmVzaXplOiBmdW5jdGlvbiByZXNpemUoKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBCYXNlLnNsaWNlKGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYy5hcHBseSh0aGlzLCBbJ3Jlc2l6ZSddLmNvbmNhdChhcmdzKSk7CiAgICAgIH0sCiAgICAgIGNyb3A6IGZ1bmN0aW9uIGNyb3AoKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBCYXNlLnNsaWNlKGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYy5hcHBseSh0aGlzLCBbJ2Nyb3AnXS5jb25jYXQoYXJncykpOwogICAgICB9LAogICAgICBnZXRBc0RhdGFVcmw6IGZ1bmN0aW9uIGdldEFzRGF0YVVybCh0eXBlKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0QXNEYXRhVXJsJywgdHlwZSk7CiAgICAgIH0sCiAgICAgIGdldEFzQmxvYjogZnVuY3Rpb24gZ2V0QXNCbG9iKHR5cGUpIHsKICAgICAgICB2YXIgYmxvYiA9IHRoaXMuZXhlYygnZ2V0QXNCbG9iJywgdHlwZSk7CiAgICAgICAgcmV0dXJuIG5ldyBCbG9iKHRoaXMuZ2V0UnVpZCgpLCBibG9iKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gSW1hZ2U7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDlm77niYfmk43kvZwsIOi0n+i0o+mihOiniOWbvueJh+WSjOS4iuS8oOWJjeWOi+e8qeWbvueJhwogICAqLwoKICBkZWZpbmUoJ3dpZGdldHMvaW1hZ2UnLCBbJ2Jhc2UnLCAndXBsb2FkZXInLCAnbGliL2ltYWdlJywgJ3dpZGdldHMvd2lkZ2V0J10sIGZ1bmN0aW9uIChCYXNlLCBVcGxvYWRlciwgSW1hZ2UpIHsKICAgIHZhciAkID0gQmFzZS4kLAogICAgICAgIHRocm90dGxlOyAvLyDmoLnmja7opoHlpITnkIbnmoTmlofku7blpKflsI/mnaXoioLmtYHvvIzkuIDmrKHkuI3og73lpITnkIblpKrlpJrvvIzkvJrljaHjgIIKCiAgICB0aHJvdHRsZSA9IGZ1bmN0aW9uIChtYXgpIHsKICAgICAgdmFyIG9jY3VwaWVkID0gMCwKICAgICAgICAgIHdhaXRpbmcgPSBbXSwKICAgICAgICAgIHRpY2sgPSBmdW5jdGlvbiB0aWNrKCkgewogICAgICAgIHZhciBpdGVtOwoKICAgICAgICB3aGlsZSAod2FpdGluZy5sZW5ndGggJiYgb2NjdXBpZWQgPCBtYXgpIHsKICAgICAgICAgIGl0ZW0gPSB3YWl0aW5nLnNoaWZ0KCk7CiAgICAgICAgICBvY2N1cGllZCArPSBpdGVtWzBdOwogICAgICAgICAgaXRlbVsxXSgpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoZW1pdGVyLCBzaXplLCBjYikgewogICAgICAgIHdhaXRpbmcucHVzaChbc2l6ZSwgY2JdKTsKICAgICAgICBlbWl0ZXIub25jZSgnZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG9jY3VwaWVkIC09IHNpemU7CiAgICAgICAgICBzZXRUaW1lb3V0KHRpY2ssIDEpOwogICAgICAgIH0pOwogICAgICAgIHNldFRpbWVvdXQodGljaywgMSk7CiAgICAgIH07CiAgICB9KDUgKiAxMDI0ICogMTAyNCk7CgogICAgJC5leHRlbmQoVXBsb2FkZXIub3B0aW9ucywgewogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFt0aHVtYl0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOmFjee9rueUn+aIkOe8qeeVpeWbvueahOmAiemhueOAggogICAgICAgKgogICAgICAgKiDpu5jorqTkuLrvvJoKICAgICAgICoKICAgICAgICogYGBgamF2YXNjcmlwdAogICAgICAgKiB7CiAgICAgICAqICAgICB3aWR0aDogMTEwLAogICAgICAgKiAgICAgaGVpZ2h0OiAxMTAsCiAgICAgICAqCiAgICAgICAqICAgICAvLyDlm77niYfotKjph4/vvIzlj6rmnIl0eXBl5Li6YGltYWdlL2pwZWdg55qE5pe25YCZ5omN5pyJ5pWI44CCCiAgICAgICAqICAgICBxdWFsaXR5OiA3MCwKICAgICAgICoKICAgICAgICogICAgIC8vIOaYr+WQpuWFgeiuuOaUvuWkp++8jOWmguaenOaDs+imgeeUn+aIkOWwj+WbvueahOaXtuWAmeS4jeWkseecn++8jOatpOmAiemhueW6lOivpeiuvue9ruS4umZhbHNlLgogICAgICAgKiAgICAgYWxsb3dNYWduaWZ5OiB0cnVlLAogICAgICAgKgogICAgICAgKiAgICAgLy8g5piv5ZCm5YWB6K646KOB5Ymq44CCCiAgICAgICAqICAgICBjcm9wOiB0cnVlLAogICAgICAgKgogICAgICAgKiAgICAgLy8g5Li656m655qE6K+d5YiZ5L+d55WZ5Y6f5pyJ5Zu+54mH5qC85byP44CCCiAgICAgICAqICAgICAvLyDlkKbliJnlvLrliLbovazmjaLmiJDmjIflrprnmoTnsbvlnovjgIIKICAgICAgICogICAgIHR5cGU6ICdpbWFnZS9qcGVnJwogICAgICAgKiB9CiAgICAgICAqIGBgYAogICAgICAgKi8KICAgICAgdGh1bWI6IHsKICAgICAgICB3aWR0aDogMTEwLAogICAgICAgIGhlaWdodDogMTEwLAogICAgICAgIHF1YWxpdHk6IDcwLAogICAgICAgIGFsbG93TWFnbmlmeTogdHJ1ZSwKICAgICAgICBjcm9wOiB0cnVlLAogICAgICAgIHByZXNlcnZlSGVhZGVyczogZmFsc2UsCiAgICAgICAgLy8g5Li656m655qE6K+d5YiZ5L+d55WZ5Y6f5pyJ5Zu+54mH5qC85byP44CCCiAgICAgICAgLy8g5ZCm5YiZ5by65Yi26L2s5o2i5oiQ5oyH5a6a55qE57G75Z6L44CCCiAgICAgICAgLy8gSUUgOOS4i+mdoiBiYXNlNjQg5aSn5bCP5LiN6IO96LaF6L+HIDMySyDlkKbliJnpooTop4jlpLHotKXvvIzogIzpnZ4ganBlZyDnvJbnoIHnmoTlm77niYflvojlj68KICAgICAgICAvLyDog73kvJrotoXov4cgMzJrLCDmiYDku6Xov5nph4zorr7nva7miJDpooTop4jnmoTml7blgJnpg73mmK8gaW1hZ2UvanBlZwogICAgICAgIHR5cGU6ICdpbWFnZS9qcGVnJwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbY29tcHJlc3NdCiAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBkZXNjcmlwdGlvbiDphY3nva7ljovnvKnnmoTlm77niYfnmoTpgInpobnjgILlpoLmnpzmraTpgInpobnkuLpgZmFsc2VgLCDliJnlm77niYflnKjkuIrkvKDliY3kuI3ov5vooYzljovnvKnjgIIKICAgICAgICoKICAgICAgICog6buY6K6k5Li677yaCiAgICAgICAqCiAgICAgICAqIGBgYGphdmFzY3JpcHQKICAgICAgICogewogICAgICAgKiAgICAgd2lkdGg6IDE2MDAsCiAgICAgICAqICAgICBoZWlnaHQ6IDE2MDAsCiAgICAgICAqCiAgICAgICAqICAgICAvLyDlm77niYfotKjph4/vvIzlj6rmnIl0eXBl5Li6YGltYWdlL2pwZWdg55qE5pe25YCZ5omN5pyJ5pWI44CCCiAgICAgICAqICAgICBxdWFsaXR5OiA5MCwKICAgICAgICoKICAgICAgICogICAgIC8vIOaYr+WQpuWFgeiuuOaUvuWkp++8jOWmguaenOaDs+imgeeUn+aIkOWwj+WbvueahOaXtuWAmeS4jeWkseecn++8jOatpOmAiemhueW6lOivpeiuvue9ruS4umZhbHNlLgogICAgICAgKiAgICAgYWxsb3dNYWduaWZ5OiBmYWxzZSwKICAgICAgICoKICAgICAgICogICAgIC8vIOaYr+WQpuWFgeiuuOijgeWJquOAggogICAgICAgKiAgICAgY3JvcDogZmFsc2UsCiAgICAgICAqCiAgICAgICAqICAgICAvLyDmmK/lkKbkv53nlZnlpLTpg6htZXRh5L+h5oGv44CCCiAgICAgICAqICAgICBwcmVzZXJ2ZUhlYWRlcnM6IHRydWUsCiAgICAgICAqCiAgICAgICAqICAgICAvLyDlpoLmnpzlj5HnjrDljovnvKnlkI7mlofku7blpKflsI/mr5Tljp/mnaXov5jlpKfvvIzliJnkvb/nlKjljp/mnaXlm77niYcKICAgICAgICogICAgIC8vIOatpOWxnuaAp+WPr+iDveS8muW9seWTjeWbvueJh+iHquWKqOe6oOato+WKn+iDvQogICAgICAgKiAgICAgbm9Db21wcmVzc0lmTGFyZ2VyOiBmYWxzZSwKICAgICAgICoKICAgICAgICogICAgIC8vIOWNleS9jeWtl+iKgu+8jOWmguaenOWbvueJh+Wkp+Wwj+Wwj+S6juatpOWAvO+8jOS4jeS8mumHh+eUqOWOi+e8qeOAggogICAgICAgKiAgICAgY29tcHJlc3NTaXplOiAwCiAgICAgICAqIH0KICAgICAgICogYGBgCiAgICAgICAqLwogICAgICBjb21wcmVzczogewogICAgICAgIHdpZHRoOiAxNjAwLAogICAgICAgIGhlaWdodDogMTYwMCwKICAgICAgICBxdWFsaXR5OiA5MCwKICAgICAgICBhbGxvd01hZ25pZnk6IGZhbHNlLAogICAgICAgIGNyb3A6IGZhbHNlLAogICAgICAgIHByZXNlcnZlSGVhZGVyczogdHJ1ZQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICdpbWFnZScsCgogICAgICAvKioKICAgICAgICog55Sf5oiQ57yp55Wl5Zu+77yM5q2k6L+H56iL5Li65byC5q2l77yM5omA5Lul6ZyA6KaB5Lyg5YWlYGNhbGxiYWNrYOOAggogICAgICAgKiDpgJrluLjmg4XlhrXlnKjlm77niYfliqDlhaXpmJ/ph4zlkI7osIPnlKjmraTmlrnms5XmnaXnlJ/miJDpooTop4jlm77ku6Xlop7lvLrkuqTkupLmlYjmnpzjgIIKICAgICAgICoKICAgICAgICog5b2TIHdpZHRoIOaIluiAhSBoZWlnaHQg55qE5YC85LuL5LqOIDAgLSAxIOaXtu+8jOiiq+W9k+aIkOeZvuWIhuavlOS9v+eUqOOAggogICAgICAgKgogICAgICAgKiBgY2FsbGJhY2tg5Lit5Y+v5Lul5o6l5pS25Yiw5Lik5Liq5Y+C5pWw44CCCiAgICAgICAqICog56ys5LiA5Liq5Li6ZXJyb3LvvIzlpoLmnpznlJ/miJDnvKnnlaXlm77mnInplJnor6/vvIzmraRlcnJvcuWwhuS4uuecn+OAggogICAgICAgKiAqIOesrOS6jOS4quS4unJldCwg57yp55Wl5Zu+55qERGF0YSBVUkzlgLzjgIIKICAgICAgICoKICAgICAgICogKirms6jmhI8qKgogICAgICAgKiBEYXRlIFVSTOWcqElFNi835Lit5LiN5pSv5oyB77yM5omA5Lul5LiN55So6LCD55So5q2k5pa55rOV5LqG77yM55u05o6l5pi+56S65LiA5byg5pqC5LiN5pSv5oyB6aKE6KeI5Zu+54mH5aW95LqG44CCCiAgICAgICAqIOS5n+WPr+S7peWAn+WKqeacjeWKoeerr++8jOWwhiBiYXNlNjQg5pWw5o2u5Lyg57uZ5pyN5Yqh56uv77yM55Sf5oiQ5LiA5Liq5Li05pe25paH5Lu25L6b6aKE6KeI44CCCiAgICAgICAqCiAgICAgICAqIEBtZXRob2QgbWFrZVRodW1iCiAgICAgICAqIEBncmFtbWFyIG1ha2VUaHVtYiggZmlsZSwgY2FsbGJhY2sgKSA9PiB1bmRlZmluZWQKICAgICAgICogQGdyYW1tYXIgbWFrZVRodW1iKCBmaWxlLCBjYWxsYmFjaywgd2lkdGgsIGhlaWdodCApID0+IHVuZGVmaW5lZAogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqCiAgICAgICAqIHVwbG9hZGVyLm9uKCAnZmlsZVF1ZXVlZCcsIGZ1bmN0aW9uKCBmaWxlICkgewogICAgICAgKiAgICAgdmFyICRsaSA9IC4uLjsKICAgICAgICoKICAgICAgICogICAgIHVwbG9hZGVyLm1ha2VUaHVtYiggZmlsZSwgZnVuY3Rpb24oIGVycm9yLCByZXQgKSB7CiAgICAgICAqICAgICAgICAgaWYgKCBlcnJvciApIHsKICAgICAgICogICAgICAgICAgICAgJGxpLnRleHQoJ+mihOiniOmUmeivrycpOwogICAgICAgKiAgICAgICAgIH0gZWxzZSB7CiAgICAgICAqICAgICAgICAgICAgICRsaS5hcHBlbmQoJzxpbWcgYWx0PSIiIHNyYz0iJyArIHJldCArICciIC8+Jyk7CiAgICAgICAqICAgICAgICAgfQogICAgICAgKiAgICAgfSk7CiAgICAgICAqCiAgICAgICAqIH0pOwogICAgICAgKi8KICAgICAgbWFrZVRodW1iOiBmdW5jdGlvbiBtYWtlVGh1bWIoZmlsZSwgY2IsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB2YXIgb3B0cywgaW1hZ2U7CiAgICAgICAgZmlsZSA9IHRoaXMucmVxdWVzdCgnZ2V0LWZpbGUnLCBmaWxlKTsgLy8g5Y+q6aKE6KeI5Zu+54mH5qC85byP44CCCgogICAgICAgIGlmICghZmlsZS50eXBlLm1hdGNoKC9eaW1hZ2UvKSkgewogICAgICAgICAgY2IodHJ1ZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBvcHRzID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy50aHVtYik7IC8vIOWmguaenOS8oOWFpeeahOaYr29iamVjdC4KCiAgICAgICAgaWYgKCQuaXNQbGFpbk9iamVjdCh3aWR0aCkpIHsKICAgICAgICAgIG9wdHMgPSAkLmV4dGVuZChvcHRzLCB3aWR0aCk7CiAgICAgICAgICB3aWR0aCA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICB3aWR0aCA9IHdpZHRoIHx8IG9wdHMud2lkdGg7CiAgICAgICAgaGVpZ2h0ID0gaGVpZ2h0IHx8IG9wdHMuaGVpZ2h0OwogICAgICAgIGltYWdlID0gbmV3IEltYWdlKG9wdHMpOwogICAgICAgIGltYWdlLm9uY2UoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmaWxlLl9pbmZvID0gZmlsZS5faW5mbyB8fCBpbWFnZS5pbmZvKCk7CiAgICAgICAgICBmaWxlLl9tZXRhID0gZmlsZS5fbWV0YSB8fCBpbWFnZS5tZXRhKCk7IC8vIOWmguaenCB3aWR0aCDnmoTlgLzku4vkuo4gMCAtIDEKICAgICAgICAgIC8vIOivtOaYjuiuvue9rueahOaYr+eZvuWIhuavlOOAggoKICAgICAgICAgIGlmICh3aWR0aCA8PSAxICYmIHdpZHRoID4gMCkgewogICAgICAgICAgICB3aWR0aCA9IGZpbGUuX2luZm8ud2lkdGggKiB3aWR0aDsKICAgICAgICAgIH0gLy8g5ZCM5qC355qE6KeE5YiZ5bqU55So5LqOIGhlaWdodAoKCiAgICAgICAgICBpZiAoaGVpZ2h0IDw9IDEgJiYgaGVpZ2h0ID4gMCkgewogICAgICAgICAgICBoZWlnaHQgPSBmaWxlLl9pbmZvLmhlaWdodCAqIGhlaWdodDsKICAgICAgICAgIH0KCiAgICAgICAgICBpbWFnZS5yZXNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgfSk7IC8vIOW9kyByZXNpemUg5a6M5ZCOCgogICAgICAgIGltYWdlLm9uY2UoJ2NvbXBsZXRlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgY2IoZmFsc2UsIGltYWdlLmdldEFzRGF0YVVybChvcHRzLnR5cGUpKTsKICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTsKICAgICAgICB9KTsKICAgICAgICBpbWFnZS5vbmNlKCdlcnJvcicsIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNiKHJlYXNvbiB8fCB0cnVlKTsKICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTsKICAgICAgICB9KTsKICAgICAgICB0aHJvdHRsZShpbWFnZSwgZmlsZS5zb3VyY2Uuc2l6ZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgZmlsZS5faW5mbyAmJiBpbWFnZS5pbmZvKGZpbGUuX2luZm8pOwogICAgICAgICAgZmlsZS5fbWV0YSAmJiBpbWFnZS5tZXRhKGZpbGUuX21ldGEpOwogICAgICAgICAgaW1hZ2UubG9hZEZyb21CbG9iKGZpbGUuc291cmNlKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgYmVmb3JlU2VuZEZpbGU6IGZ1bmN0aW9uIGJlZm9yZVNlbmRGaWxlKGZpbGUpIHsKICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucy5jb21wcmVzcyB8fCB0aGlzLm9wdGlvbnMucmVzaXplLAogICAgICAgICAgICBjb21wcmVzc1NpemUgPSBvcHRzICYmIG9wdHMuY29tcHJlc3NTaXplIHx8IDAsCiAgICAgICAgICAgIG5vQ29tcHJlc3NJZkxhcmdlciA9IG9wdHMgJiYgb3B0cy5ub0NvbXByZXNzSWZMYXJnZXIgfHwgZmFsc2UsCiAgICAgICAgICAgIGltYWdlLAogICAgICAgICAgICBkZWZlcnJlZDsKICAgICAgICBmaWxlID0gdGhpcy5yZXF1ZXN0KCdnZXQtZmlsZScsIGZpbGUpOyAvLyDlj6rljovnvKkganBlZyDlm77niYfmoLzlvI/jgIIKICAgICAgICAvLyBnaWYg5Y+v6IO95Lya5Lii5aSx6ZKICiAgICAgICAgLy8gYm1wIHBuZyDln7rmnKzkuIrlsLrlr7jpg73kuI3lpKfvvIzkuJTljovnvKnmr5Tmr5TovoPlsI/jgIIKCiAgICAgICAgaWYgKCFvcHRzIHx8ICF+J2ltYWdlL2pwZWcsaW1hZ2UvanBnJy5pbmRleE9mKGZpbGUudHlwZSkgfHwgZmlsZS5zaXplIDwgY29tcHJlc3NTaXplIHx8IGZpbGUuX2NvbXByZXNzZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG9wdHMgPSAkLmV4dGVuZCh7fSwgb3B0cyk7CiAgICAgICAgZGVmZXJyZWQgPSBCYXNlLkRlZmVycmVkKCk7CiAgICAgICAgaW1hZ2UgPSBuZXcgSW1hZ2Uob3B0cyk7CiAgICAgICAgZGVmZXJyZWQuYWx3YXlzKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGltYWdlLmRlc3Ryb3koKTsKICAgICAgICAgIGltYWdlID0gbnVsbDsKICAgICAgICB9KTsKICAgICAgICBpbWFnZS5vbmNlKCdlcnJvcicsIGRlZmVycmVkLnJlamVjdCk7CiAgICAgICAgaW1hZ2Uub25jZSgnbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB3aWR0aCA9IG9wdHMud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0ID0gb3B0cy5oZWlnaHQ7CiAgICAgICAgICBmaWxlLl9pbmZvID0gZmlsZS5faW5mbyB8fCBpbWFnZS5pbmZvKCk7CiAgICAgICAgICBmaWxlLl9tZXRhID0gZmlsZS5fbWV0YSB8fCBpbWFnZS5tZXRhKCk7IC8vIOWmguaenCB3aWR0aCDnmoTlgLzku4vkuo4gMCAtIDEKICAgICAgICAgIC8vIOivtOaYjuiuvue9rueahOaYr+eZvuWIhuavlOOAggoKICAgICAgICAgIGlmICh3aWR0aCA8PSAxICYmIHdpZHRoID4gMCkgewogICAgICAgICAgICB3aWR0aCA9IGZpbGUuX2luZm8ud2lkdGggKiB3aWR0aDsKICAgICAgICAgIH0gLy8g5ZCM5qC355qE6KeE5YiZ5bqU55So5LqOIGhlaWdodAoKCiAgICAgICAgICBpZiAoaGVpZ2h0IDw9IDEgJiYgaGVpZ2h0ID4gMCkgewogICAgICAgICAgICBoZWlnaHQgPSBmaWxlLl9pbmZvLmhlaWdodCAqIGhlaWdodDsKICAgICAgICAgIH0KCiAgICAgICAgICBpbWFnZS5yZXNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgICAgfSk7CiAgICAgICAgaW1hZ2Uub25jZSgnY29tcGxldGUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYmxvYiwgc2l6ZTsgLy8g56e75Yqo56uvIFVDIC8gcXEg5rWP6KeI5Zmo55qE5peg5Zu+5qih5byP5LiLCiAgICAgICAgICAvLyBjdHguZ2V0SW1hZ2VEYXRhIOWkhOeQhuWkp+WbvueahOaXtuWAmeS8muaKpSBFeGNlcHRpb24KICAgICAgICAgIC8vIElOREVYX1NJWkVfRVJSOiBET00gRXhjZXB0aW9uIDEKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBibG9iID0gaW1hZ2UuZ2V0QXNCbG9iKG9wdHMudHlwZSk7CiAgICAgICAgICAgIHNpemUgPSBmaWxlLnNpemU7IC8vIOWmguaenOWOi+e8qeWQju+8jOavlOWOn+adpei/mOWkp+WImeS4jeeUqOWOi+e8qeWQjueahOOAggoKICAgICAgICAgICAgaWYgKCFub0NvbXByZXNzSWZMYXJnZXIgfHwgYmxvYi5zaXplIDwgc2l6ZSkgewogICAgICAgICAgICAgIC8vIGZpbGUuc291cmNlLmRlc3Ryb3kgJiYgZmlsZS5zb3VyY2UuZGVzdHJveSgpOwogICAgICAgICAgICAgIGZpbGUuc291cmNlID0gYmxvYjsKICAgICAgICAgICAgICBmaWxlLnNpemUgPSBibG9iLnNpemU7CiAgICAgICAgICAgICAgZmlsZS50cmlnZ2VyKCdyZXNpemUnLCBibG9iLnNpemUsIHNpemUpOwogICAgICAgICAgICB9IC8vIOagh+iusO+8jOmBv+WFjemHjeWkjeWOi+e8qeOAggoKCiAgICAgICAgICAgIGZpbGUuX2NvbXByZXNzZWQgPSB0cnVlOwogICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIC8vIOWHuumUmeS6huebtOaOpee7p+e7re+8jOiuqeWFtuS4iuS8oOWOn+Wni+WbvueJhwogICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgZmlsZS5faW5mbyAmJiBpbWFnZS5pbmZvKGZpbGUuX2luZm8pOwogICAgICAgIGZpbGUuX21ldGEgJiYgaW1hZ2UubWV0YShmaWxlLl9tZXRhKTsKICAgICAgICBpbWFnZS5sb2FkRnJvbUJsb2IoZmlsZS5zb3VyY2UpOwogICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg5paH5Lu25bGe5oCn5bCB6KOFCiAgICovCgogIGRlZmluZSgnZmlsZScsIFsnYmFzZScsICdtZWRpYXRvciddLCBmdW5jdGlvbiAoQmFzZSwgTWVkaWF0b3IpIHsKICAgIHZhciAkID0gQmFzZS4kLAogICAgICAgIGlkUHJlZml4ID0gJ1dVX0ZJTEVfJywKICAgICAgICBpZFN1ZmZpeCA9IDAsCiAgICAgICAgckV4dCA9IC9cLihbXi5dKykkLywKICAgICAgICBzdGF0dXNNYXAgPSB7fTsKCiAgICBmdW5jdGlvbiBnaWQoKSB7CiAgICAgIHJldHVybiBpZFByZWZpeCArIGlkU3VmZml4Kys7CiAgICB9CiAgICAvKioKICAgICAqIOaWh+S7tuexuwogICAgICogQGNsYXNzIEZpbGUKICAgICAqIEBjb25zdHJ1Y3RvciDmnoTpgKDlh73mlbAKICAgICAqIEBncmFtbWFyIG5ldyBGaWxlKCBzb3VyY2UgKSA9PiBGaWxlCiAgICAgKiBAcGFyYW0ge0xpYi5GaWxlfSBzb3VyY2UgW2xpYi5GaWxlXSgjTGliLkZpbGUp5a6e5L6LLCDmraRzb3VyY2Xlr7nosaHmmK/luKbmnIlSdW50aW1l5L+h5oGv55qE44CCCiAgICAgKi8KCgogICAgZnVuY3Rpb24gV1VGaWxlKHNvdXJjZSkgewogICAgICAvKioKICAgICAgICog5paH5Lu25ZCN77yM5YyF5ous5omp5bGV5ZCN77yI5ZCO57yA77yJCiAgICAgICAqIEBwcm9wZXJ0eSBuYW1lCiAgICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgICAqLwogICAgICB0aGlzLm5hbWUgPSBzb3VyY2UubmFtZSB8fCAnVW50aXRsZWQnOwogICAgICAvKioKICAgICAgICog5paH5Lu25L2T56ev77yI5a2X6IqC77yJCiAgICAgICAqIEBwcm9wZXJ0eSBzaXplCiAgICAgICAqIEB0eXBlIHt1aW50fQogICAgICAgKiBAZGVmYXVsdCAwCiAgICAgICAqLwoKICAgICAgdGhpcy5zaXplID0gc291cmNlLnNpemUgfHwgMDsKICAgICAgLyoqCiAgICAgICAqIOaWh+S7tk1JTUVUWVBF57G75Z6L77yM5LiO5paH5Lu257G75Z6L55qE5a+55bqU5YWz57O76K+35Y+C6ICDW2h0dHA6Ly90LmNuL3o4Wm5GbnldKGh0dHA6Ly90LmNuL3o4Wm5GbnkpCiAgICAgICAqIEBwcm9wZXJ0eSB0eXBlCiAgICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgICAqIEBkZWZhdWx0ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nCiAgICAgICAqLwoKICAgICAgdGhpcy50eXBlID0gc291cmNlLnR5cGUgfHwgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSc7CiAgICAgIC8qKgogICAgICAgKiDmlofku7bmnIDlkI7kv67mlLnml6XmnJ8KICAgICAgICogQHByb3BlcnR5IGxhc3RNb2RpZmllZERhdGUKICAgICAgICogQHR5cGUge2ludH0KICAgICAgICogQGRlZmF1bHQg5b2T5YmN5pe26Ze05oizCiAgICAgICAqLwoKICAgICAgdGhpcy5sYXN0TW9kaWZpZWREYXRlID0gc291cmNlLmxhc3RNb2RpZmllZERhdGUgfHwgbmV3IERhdGUoKSAqIDE7CiAgICAgIC8qKgogICAgICAgKiDmlofku7ZJRO+8jOavj+S4quWvueixoeWFt+acieWUr+S4gElE77yM5LiO5paH5Lu25ZCN5peg5YWzCiAgICAgICAqIEBwcm9wZXJ0eSBpZAogICAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICAgKi8KCiAgICAgIHRoaXMuaWQgPSBnaWQoKTsKICAgICAgLyoqCiAgICAgICAqIOaWh+S7tuaJqeWxleWQje+8jOmAmui/h+aWh+S7tuWQjeiOt+WPlu+8jOS+i+WmgnRlc3QucG5n55qE5omp5bGV5ZCN5Li6cG5nCiAgICAgICAqIEBwcm9wZXJ0eSBleHQKICAgICAgICogQHR5cGUge3N0cmluZ30KICAgICAgICovCgogICAgICB0aGlzLmV4dCA9IHJFeHQuZXhlYyh0aGlzLm5hbWUpID8gUmVnRXhwLiQxIDogJyc7CiAgICAgIC8qKgogICAgICAgKiDnirbmgIHmloflrZfor7TmmI7jgILlnKjkuI3lkIznmoRzdGF0dXPor63looPkuIvmnInkuI3lkIznmoTnlKjpgJTjgIIKICAgICAgICogQHByb3BlcnR5IHN0YXR1c1RleHQKICAgICAgICogQHR5cGUge3N0cmluZ30KICAgICAgICovCgogICAgICB0aGlzLnN0YXR1c1RleHQgPSAnJzsgLy8g5a2Y5YKo5paH5Lu254q25oCB77yM6Ziy5q2i6YCa6L+H5bGe5oCn55u05o6l5L+u5pS5CgogICAgICBzdGF0dXNNYXBbdGhpcy5pZF0gPSBXVUZpbGUuU3RhdHVzLklOSVRFRDsKICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICAgIHRoaXMubG9hZGVkID0gMDsKICAgICAgdGhpcy5vbignZXJyb3InLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgdGhpcy5zZXRTdGF0dXMoV1VGaWxlLlN0YXR1cy5FUlJPUiwgbXNnKTsKICAgICAgfSk7CiAgICB9CgogICAgJC5leHRlbmQoV1VGaWxlLnByb3RvdHlwZSwgewogICAgICAvKioKICAgICAgICog6K6+572u54q25oCB77yM54q25oCB5Y+Y5YyW5pe25Lya6Kem5Y+RYGNoYW5nZWDkuovku7bjgIIKICAgICAgICogQG1ldGhvZCBzZXRTdGF0dXMKICAgICAgICogQGdyYW1tYXIgc2V0U3RhdHVzKCBzdGF0dXNbLCBzdGF0dXNUZXh0XSApOwogICAgICAgKiBAcGFyYW0ge0ZpbGUuU3RhdHVzfFN0cmluZ30gc3RhdHVzIFvmlofku7bnirbmgIHlgLxdKCNXZWJVcGxvYWRlcjpGaWxlOkZpbGUuU3RhdHVzKQogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0YXR1c1RleHQ9JyddIOeKtuaAgeivtOaYju+8jOW4uOWcqGVycm9y5pe25L2/55So77yM55SoaHR0cCwgYWJvcnQsc2VydmVy562J5p2l5qCH6K6w5piv55Sx5LqO5LuA5LmI5Y6f5Zug5a+86Ie05paH5Lu26ZSZ6K+v44CCCiAgICAgICAqLwogICAgICBzZXRTdGF0dXM6IGZ1bmN0aW9uIHNldFN0YXR1cyhzdGF0dXMsIHRleHQpIHsKICAgICAgICB2YXIgcHJldlN0YXR1cyA9IHN0YXR1c01hcFt0aGlzLmlkXTsKICAgICAgICB0eXBlb2YgdGV4dCAhPT0gJ3VuZGVmaW5lZCcgJiYgKHRoaXMuc3RhdHVzVGV4dCA9IHRleHQpOwoKICAgICAgICBpZiAoc3RhdHVzICE9PSBwcmV2U3RhdHVzKSB7CiAgICAgICAgICBzdGF0dXNNYXBbdGhpcy5pZF0gPSBzdGF0dXM7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIOaWh+S7tueKtuaAgeWPmOWMlgogICAgICAgICAgICogQGV2ZW50IHN0YXR1c2NoYW5nZQogICAgICAgICAgICovCgogICAgICAgICAgdGhpcy50cmlnZ2VyKCdzdGF0dXNjaGFuZ2UnLCBzdGF0dXMsIHByZXZTdGF0dXMpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDojrflj5bmlofku7bnirbmgIEKICAgICAgICogQHJldHVybiB7RmlsZS5TdGF0dXN9CiAgICAgICAqIEBleGFtcGxlCiAgICAgICAgICAgICAgIOaWh+S7tueKtuaAgeWFt+S9k+WMheaLrOS7peS4i+WHoOenjeexu+Wei++8mgogICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAvLyDliJ3lp4vljJYKICAgICAgICAgICAgICAgICAgSU5JVEVEOiAgICAgMCwKICAgICAgICAgICAgICAgICAgLy8g5bey5YWl6Zif5YiXCiAgICAgICAgICAgICAgICAgIFFVRVVFRDogICAgIDEsCiAgICAgICAgICAgICAgICAgIC8vIOato+WcqOS4iuS8oAogICAgICAgICAgICAgICAgICBQUk9HUkVTUzogICAgIDIsCiAgICAgICAgICAgICAgICAgIC8vIOS4iuS8oOWHuumUmQogICAgICAgICAgICAgICAgICBFUlJPUjogICAgICAgICAzLAogICAgICAgICAgICAgICAgICAvLyDkuIrkvKDmiJDlip8KICAgICAgICAgICAgICAgICAgQ09NUExFVEU6ICAgICA0LAogICAgICAgICAgICAgICAgICAvLyDkuIrkvKDlj5bmtogKICAgICAgICAgICAgICAgICAgQ0FOQ0VMTEVEOiAgICAgNQogICAgICAgICAgICAgIH0KICAgICAgICovCiAgICAgIGdldFN0YXR1czogZnVuY3Rpb24gZ2V0U3RhdHVzKCkgewogICAgICAgIHJldHVybiBzdGF0dXNNYXBbdGhpcy5pZF07CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICog6I635Y+W5paH5Lu25Y6f5aeL5L+h5oGv44CCCiAgICAgICAqIEByZXR1cm4geyp9CiAgICAgICAqLwogICAgICBnZXRTb3VyY2U6IGZ1bmN0aW9uIGdldFNvdXJjZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5zb3VyY2U7CiAgICAgIH0sCiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5vZmYoKTsKICAgICAgICBkZWxldGUgc3RhdHVzTWFwW3RoaXMuaWRdOwogICAgICB9CiAgICB9KTsKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhXVUZpbGUucHJvdG90eXBlKTsKICAgIC8qKgogICAgICog5paH5Lu254q25oCB5YC877yM5YW35L2T5YyF5ous5Lul5LiL5Yeg56eN57G75Z6L77yaCiAgICAgKiAqIGBpbml0ZWRgIOWIneWni+eKtuaAgQogICAgICogKiBgcXVldWVkYCDlt7Lnu4/ov5vlhaXpmJ/liJcsIOetieW+heS4iuS8oAogICAgICogKiBgcHJvZ3Jlc3NgIOS4iuS8oOS4rQogICAgICogKiBgY29tcGxldGVgIOS4iuS8oOWujOaIkOOAggogICAgICogKiBgZXJyb3JgIOS4iuS8oOWHuumUme+8jOWPr+mHjeivlQogICAgICogKiBgaW50ZXJydXB0YCDkuIrkvKDkuK3mlq3vvIzlj6/nu63kvKDjgIIKICAgICAqICogYGludmFsaWRgIOaWh+S7tuS4jeWQiOagvO+8jOS4jeiDvemHjeivleS4iuS8oOOAguS8muiHquWKqOS7jumYn+WIl+S4reenu+mZpOOAggogICAgICogKiBgY2FuY2VsbGVkYCDmlofku7booqvnp7vpmaTjgIIKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBTdGF0dXMKICAgICAqIEBuYW1lc3BhY2UgRmlsZQogICAgICogQGNsYXNzIEZpbGUKICAgICAqIEBzdGF0aWMKICAgICAqLwoKICAgIFdVRmlsZS5TdGF0dXMgPSB7CiAgICAgIElOSVRFRDogJ2luaXRlZCcsCiAgICAgIC8vIOWIneWni+eKtuaAgQogICAgICBRVUVVRUQ6ICdxdWV1ZWQnLAogICAgICAvLyDlt7Lnu4/ov5vlhaXpmJ/liJcsIOetieW+heS4iuS8oAogICAgICBQUk9HUkVTUzogJ3Byb2dyZXNzJywKICAgICAgLy8g5LiK5Lyg5LitCiAgICAgIEVSUk9SOiAnZXJyb3InLAogICAgICAvLyDkuIrkvKDlh7rplJnvvIzlj6/ph43or5UKICAgICAgQ09NUExFVEU6ICdjb21wbGV0ZScsCiAgICAgIC8vIOS4iuS8oOWujOaIkOOAggogICAgICBDQU5DRUxMRUQ6ICdjYW5jZWxsZWQnLAogICAgICAvLyDkuIrkvKDlj5bmtojjgIIKICAgICAgSU5URVJSVVBUOiAnaW50ZXJydXB0JywKICAgICAgLy8g5LiK5Lyg5Lit5pat77yM5Y+v57ut5Lyg44CCCiAgICAgIElOVkFMSUQ6ICdpbnZhbGlkJyAvLyDmlofku7bkuI3lkIjmoLzvvIzkuI3og73ph43or5XkuIrkvKDjgIIKCiAgICB9OwogICAgcmV0dXJuIFdVRmlsZTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IOaWh+S7tumYn+WIlwogICAqLwoKICBkZWZpbmUoJ3F1ZXVlJywgWydiYXNlJywgJ21lZGlhdG9yJywgJ2ZpbGUnXSwgZnVuY3Rpb24gKEJhc2UsIE1lZGlhdG9yLCBXVUZpbGUpIHsKICAgIHZhciAkID0gQmFzZS4kLAogICAgICAgIFNUQVRVUyA9IFdVRmlsZS5TdGF0dXM7CiAgICAvKioKICAgICAqIOaWh+S7tumYn+WIlywg55So5p2l5a2Y5YKo5ZCE5Liq54q25oCB5Lit55qE5paH5Lu244CCCiAgICAgKiBAY2xhc3MgUXVldWUKICAgICAqIEBleHRlbmRzIE1lZGlhdG9yCiAgICAgKi8KCiAgICBmdW5jdGlvbiBRdWV1ZSgpIHsKICAgICAgLyoqCiAgICAgICAqIOe7n+iuoeaWh+S7tuaVsOOAggogICAgICAgKiAqIGBudW1PZlF1ZXVlYCDpmJ/liJfkuK3nmoTmlofku7bmlbDjgIIKICAgICAgICogKiBgbnVtT2ZTdWNjZXNzYCDkuIrkvKDmiJDlip/nmoTmlofku7bmlbAKICAgICAgICogKiBgbnVtT2ZDYW5jZWxgIOiiq+WPlua2iOeahOaWh+S7tuaVsAogICAgICAgKiAqIGBudW1PZlByb2dyZXNzYCDmraPlnKjkuIrkvKDkuK3nmoTmlofku7bmlbAKICAgICAgICogKiBgbnVtT2ZVcGxvYWRGYWlsZWRgIOS4iuS8oOmUmeivr+eahOaWh+S7tuaVsOOAggogICAgICAgKiAqIGBudW1PZkludmFsaWRgIOaXoOaViOeahOaWh+S7tuaVsOOAggogICAgICAgKiAqIGBudW1vZkRlbGV0ZWRgIOiiq+enu+mZpOeahOaWh+S7tuaVsOOAggogICAgICAgKiBAcHJvcGVydHkge09iamVjdH0gc3RhdHMKICAgICAgICovCiAgICAgIHRoaXMuc3RhdHMgPSB7CiAgICAgICAgbnVtT2ZRdWV1ZTogMCwKICAgICAgICBudW1PZlN1Y2Nlc3M6IDAsCiAgICAgICAgbnVtT2ZDYW5jZWw6IDAsCiAgICAgICAgbnVtT2ZQcm9ncmVzczogMCwKICAgICAgICBudW1PZlVwbG9hZEZhaWxlZDogMCwKICAgICAgICBudW1PZkludmFsaWQ6IDAsCiAgICAgICAgbnVtb2ZEZWxldGVkOiAwLAogICAgICAgIG51bW9mSW50ZXJydXB0OiAwCiAgICAgIH07IC8vIOS4iuS8oOmYn+WIl++8jOS7heWMheaLrOetieW+heS4iuS8oOeahOaWh+S7tgoKICAgICAgdGhpcy5fcXVldWUgPSBbXTsgLy8g5a2Y5YKo5omA5pyJ5paH5Lu2CgogICAgICB0aGlzLl9tYXAgPSB7fTsKICAgIH0KCiAgICAkLmV4dGVuZChRdWV1ZS5wcm90b3R5cGUsIHsKICAgICAgLyoqCiAgICAgICAqIOWwhuaWsOaWh+S7tuWKoOWFpeWvuemYn+WIl+WwvumDqAogICAgICAgKgogICAgICAgKiBAbWV0aG9kIGFwcGVuZAogICAgICAgKiBAcGFyYW0gIHtGaWxlfSBmaWxlICAg5paH5Lu25a+56LGhCiAgICAgICAqLwogICAgICBhcHBlbmQ6IGZ1bmN0aW9uIGFwcGVuZChmaWxlKSB7CiAgICAgICAgdGhpcy5fcXVldWUucHVzaChmaWxlKTsKCiAgICAgICAgdGhpcy5fZmlsZUFkZGVkKGZpbGUpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDlsIbmlrDmlofku7bliqDlhaXlr7npmJ/liJflpLTpg6gKICAgICAgICoKICAgICAgICogQG1ldGhvZCBwcmVwZW5kCiAgICAgICAqIEBwYXJhbSAge0ZpbGV9IGZpbGUgICDmlofku7blr7nosaEKICAgICAgICovCiAgICAgIHByZXBlbmQ6IGZ1bmN0aW9uIHByZXBlbmQoZmlsZSkgewogICAgICAgIHRoaXMuX3F1ZXVlLnVuc2hpZnQoZmlsZSk7CgogICAgICAgIHRoaXMuX2ZpbGVBZGRlZChmaWxlKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICog6I635Y+W5paH5Lu25a+56LGhCiAgICAgICAqCiAgICAgICAqIEBtZXRob2QgZ2V0RmlsZQogICAgICAgKiBAcGFyYW0gIHtTdHJpbmd9IGZpbGVJZCAgIOaWh+S7tklECiAgICAgICAqIEByZXR1cm4ge0ZpbGV9CiAgICAgICAqLwogICAgICBnZXRGaWxlOiBmdW5jdGlvbiBnZXRGaWxlKGZpbGVJZCkgewogICAgICAgIGlmICh0eXBlb2YgZmlsZUlkICE9PSAnc3RyaW5nJykgewogICAgICAgICAgcmV0dXJuIGZpbGVJZDsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzLl9tYXBbZmlsZUlkXTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDku47pmJ/liJfkuK3lj5blh7rkuIDkuKrmjIflrprnirbmgIHnmoTmlofku7bjgIIKICAgICAgICogQGdyYW1tYXIgZmV0Y2goIHN0YXR1cyApID0+IEZpbGUKICAgICAgICogQG1ldGhvZCBmZXRjaAogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RhdHVzIFvmlofku7bnirbmgIHlgLxdKCNXZWJVcGxvYWRlcjpGaWxlOkZpbGUuU3RhdHVzKQogICAgICAgKiBAcmV0dXJuIHtGaWxlfSBbRmlsZV0oI1dlYlVwbG9hZGVyOkZpbGUpCiAgICAgICAqLwogICAgICBmZXRjaDogZnVuY3Rpb24gZmV0Y2goc3RhdHVzKSB7CiAgICAgICAgdmFyIGxlbiA9IHRoaXMuX3F1ZXVlLmxlbmd0aCwKICAgICAgICAgICAgaSwKICAgICAgICAgICAgZmlsZTsKICAgICAgICBzdGF0dXMgPSBzdGF0dXMgfHwgU1RBVFVTLlFVRVVFRDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBmaWxlID0gdGhpcy5fcXVldWVbaV07CgogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZmlsZS5nZXRTdGF0dXMoKSkgewogICAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOWvuemYn+WIl+i/m+ihjOaOkuW6j++8jOiDveWkn+aOp+WItuaWh+S7tuS4iuS8oOmhuuW6j+OAggogICAgICAgKiBAZ3JhbW1hciBzb3J0KCBmbiApID0+IHVuZGVmaW5lZAogICAgICAgKiBAbWV0aG9kIHNvcnQKICAgICAgICogQHBhcmFtIHtGdW5jdGlvbn0gZm4g5o6S5bqP5pa55rOVCiAgICAgICAqLwogICAgICBzb3J0OiBmdW5jdGlvbiBzb3J0KGZuKSB7CiAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgdGhpcy5fcXVldWUuc29ydChmbik7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOiOt+WPluaMh+Wumuexu+Wei+eahOaWh+S7tuWIl+ihqCwg5YiX6KGo5Lit5q+P5LiA5Liq5oiQ5ZGY5Li6W0ZpbGVdKCNXZWJVcGxvYWRlcjpGaWxlKeWvueixoeOAggogICAgICAgKiBAZ3JhbW1hciBnZXRGaWxlcyggW3N0YXR1czFbLCBzdGF0dXMyIC4uLl1dICkgPT4gQXJyYXkKICAgICAgICogQG1ldGhvZCBnZXRGaWxlcwogICAgICAgKiBAcGFyYW0ge1N0cmluZ30gW3N0YXR1c10gW+aWh+S7tueKtuaAgeWAvF0oI1dlYlVwbG9hZGVyOkZpbGU6RmlsZS5TdGF0dXMpCiAgICAgICAqLwogICAgICBnZXRGaWxlczogZnVuY3Rpb24gZ2V0RmlsZXMoKSB7CiAgICAgICAgdmFyIHN0cyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKSwKICAgICAgICAgICAgcmV0ID0gW10sCiAgICAgICAgICAgIGkgPSAwLAogICAgICAgICAgICBsZW4gPSB0aGlzLl9xdWV1ZS5sZW5ndGgsCiAgICAgICAgICAgIGZpbGU7CgogICAgICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGZpbGUgPSB0aGlzLl9xdWV1ZVtpXTsKCiAgICAgICAgICBpZiAoc3RzLmxlbmd0aCAmJiAhfiQuaW5BcnJheShmaWxlLmdldFN0YXR1cygpLCBzdHMpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHJldC5wdXNoKGZpbGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJldDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDlnKjpmJ/liJfkuK3liKDpmaTmlofku7bjgIIKICAgICAgICogQGdyYW1tYXIgcmVtb3ZlRmlsZSggZmlsZSApID0+IEFycmF5CiAgICAgICAqIEBtZXRob2QgcmVtb3ZlRmlsZQogICAgICAgKiBAcGFyYW0ge0ZpbGV9IOaWh+S7tuWvueixoeOAggogICAgICAgKi8KICAgICAgcmVtb3ZlRmlsZTogZnVuY3Rpb24gcmVtb3ZlRmlsZShmaWxlKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgZXhpc3RpbmcgPSB0aGlzLl9tYXBbZmlsZS5pZF07CgogICAgICAgIGlmIChleGlzdGluZykgewogICAgICAgICAgZGVsZXRlIHRoaXMuX21hcFtmaWxlLmlkXTsKCiAgICAgICAgICB0aGlzLl9kZWxGaWxlKGZpbGUpOwoKICAgICAgICAgIGZpbGUuZGVzdHJveSgpOwogICAgICAgICAgdGhpcy5zdGF0cy5udW1vZkRlbGV0ZWQrKzsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF9maWxlQWRkZWQ6IGZ1bmN0aW9uIF9maWxlQWRkZWQoZmlsZSkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIGV4aXN0aW5nID0gdGhpcy5fbWFwW2ZpbGUuaWRdOwoKICAgICAgICBpZiAoIWV4aXN0aW5nKSB7CiAgICAgICAgICB0aGlzLl9tYXBbZmlsZS5pZF0gPSBmaWxlOwogICAgICAgICAgZmlsZS5vbignc3RhdHVzY2hhbmdlJywgZnVuY3Rpb24gKGN1ciwgcHJlKSB7CiAgICAgICAgICAgIG1lLl9vbkZpbGVTdGF0dXNDaGFuZ2UoY3VyLCBwcmUpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBfZGVsRmlsZTogZnVuY3Rpb24gX2RlbEZpbGUoZmlsZSkgewogICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9xdWV1ZS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgaWYgKHRoaXMuX3F1ZXVlW2ldID09IGZpbGUpIHsKICAgICAgICAgICAgdGhpcy5fcXVldWUuc3BsaWNlKGksIDEpOwoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBfb25GaWxlU3RhdHVzQ2hhbmdlOiBmdW5jdGlvbiBfb25GaWxlU3RhdHVzQ2hhbmdlKGN1clN0YXR1cywgcHJlU3RhdHVzKSB7CiAgICAgICAgdmFyIHN0YXRzID0gdGhpcy5zdGF0czsKCiAgICAgICAgc3dpdGNoIChwcmVTdGF0dXMpIHsKICAgICAgICAgIGNhc2UgU1RBVFVTLlBST0dSRVNTOgogICAgICAgICAgICBzdGF0cy5udW1PZlByb2dyZXNzLS07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLlFVRVVFRDoKICAgICAgICAgICAgc3RhdHMubnVtT2ZRdWV1ZS0tOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIFNUQVRVUy5FUlJPUjoKICAgICAgICAgICAgc3RhdHMubnVtT2ZVcGxvYWRGYWlsZWQtLTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBTVEFUVVMuSU5WQUxJRDoKICAgICAgICAgICAgc3RhdHMubnVtT2ZJbnZhbGlkLS07CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLklOVEVSUlVQVDoKICAgICAgICAgICAgc3RhdHMubnVtb2ZJbnRlcnJ1cHQtLTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKGN1clN0YXR1cykgewogICAgICAgICAgY2FzZSBTVEFUVVMuUVVFVUVEOgogICAgICAgICAgICBzdGF0cy5udW1PZlF1ZXVlKys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLlBST0dSRVNTOgogICAgICAgICAgICBzdGF0cy5udW1PZlByb2dyZXNzKys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLkVSUk9SOgogICAgICAgICAgICBzdGF0cy5udW1PZlVwbG9hZEZhaWxlZCsrOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIFNUQVRVUy5DT01QTEVURToKICAgICAgICAgICAgc3RhdHMubnVtT2ZTdWNjZXNzKys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLkNBTkNFTExFRDoKICAgICAgICAgICAgc3RhdHMubnVtT2ZDYW5jZWwrKzsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBTVEFUVVMuSU5WQUxJRDoKICAgICAgICAgICAgc3RhdHMubnVtT2ZJbnZhbGlkKys7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgU1RBVFVTLklOVEVSUlVQVDoKICAgICAgICAgICAgc3RhdHMubnVtb2ZJbnRlcnJ1cHQrKzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhRdWV1ZS5wcm90b3R5cGUpOwogICAgcmV0dXJuIFF1ZXVlOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg6Zif5YiXCiAgICovCgogIGRlZmluZSgnd2lkZ2V0cy9xdWV1ZScsIFsnYmFzZScsICd1cGxvYWRlcicsICdxdWV1ZScsICdmaWxlJywgJ2xpYi9maWxlJywgJ3J1bnRpbWUvY2xpZW50JywgJ3dpZGdldHMvd2lkZ2V0J10sIGZ1bmN0aW9uIChCYXNlLCBVcGxvYWRlciwgUXVldWUsIFdVRmlsZSwgRmlsZSwgUnVudGltZUNsaWVudCkgewogICAgdmFyICQgPSBCYXNlLiQsCiAgICAgICAgckV4dCA9IC9cLlx3KyQvLAogICAgICAgIFN0YXR1cyA9IFdVRmlsZS5TdGF0dXM7CiAgICByZXR1cm4gVXBsb2FkZXIucmVnaXN0ZXIoewogICAgICBuYW1lOiAncXVldWUnLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KG9wdHMpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBkZWZlcnJlZCwKICAgICAgICAgICAgbGVuLAogICAgICAgICAgICBpLAogICAgICAgICAgICBpdGVtLAogICAgICAgICAgICBhcnIsCiAgICAgICAgICAgIGFjY2VwdCwKICAgICAgICAgICAgcnVudGltZTsKCiAgICAgICAgaWYgKCQuaXNQbGFpbk9iamVjdChvcHRzLmFjY2VwdCkpIHsKICAgICAgICAgIG9wdHMuYWNjZXB0ID0gW29wdHMuYWNjZXB0XTsKICAgICAgICB9IC8vIGFjY2VwdOS4reeahOS4reeUn+aIkOWMuemFjeato+WImeOAggoKCiAgICAgICAgaWYgKG9wdHMuYWNjZXB0KSB7CiAgICAgICAgICBhcnIgPSBbXTsKCiAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBvcHRzLmFjY2VwdC5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgICBpdGVtID0gb3B0cy5hY2NlcHRbaV0uZXh0ZW5zaW9uczsKICAgICAgICAgICAgaXRlbSAmJiBhcnIucHVzaChpdGVtKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYXJyLmxlbmd0aCkgewogICAgICAgICAgICBhY2NlcHQgPSAnXFwuJyArIGFyci5qb2luKCcsJykucmVwbGFjZSgvLC9nLCAnJHxcXC4nKS5yZXBsYWNlKC9cKi9nLCAnLionKSArICckJzsKICAgICAgICAgIH0KCiAgICAgICAgICBtZS5hY2NlcHQgPSBuZXcgUmVnRXhwKGFjY2VwdCwgJ2knKTsKICAgICAgICB9CgogICAgICAgIG1lLnF1ZXVlID0gbmV3IFF1ZXVlKCk7CiAgICAgICAgbWUuc3RhdHMgPSBtZS5xdWV1ZS5zdGF0czsgLy8g5aaC5p6c5b2T5YmN5LiN5pivaHRtbDXov5DooYzml7bvvIzpgqPlsLHnrpfkuobjgIIKICAgICAgICAvLyDkuI3miafooYzlkI7nu63mk43kvZwKCiAgICAgICAgaWYgKHRoaXMucmVxdWVzdCgncHJlZGljdC1ydW50aW1lLXR5cGUnKSAhPT0gJ2h0bWw1JykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8g5Yib5bu65LiA5LiqIGh0bWw1IOi/kOihjOaXtueahCBwbGFjZWhvbGRlcgogICAgICAgIC8vIOS7peiHs+S6juWklumDqOa3u+WKoOWOn+eUnyBGaWxlIOWvueixoeeahOaXtuWAmeiDveato+ehruWMheijueS4gOS4i+S+myB3ZWJ1cGxvYWRlciDkvb/nlKjjgIIKCgogICAgICAgIGRlZmVycmVkID0gQmFzZS5EZWZlcnJlZCgpOwogICAgICAgIHRoaXMucGxhY2Vob2xkZXIgPSBydW50aW1lID0gbmV3IFJ1bnRpbWVDbGllbnQoJ1BsYWNlaG9sZGVyJyk7CiAgICAgICAgcnVudGltZS5jb25uZWN0UnVudGltZSh7CiAgICAgICAgICBydW50aW1lT3JkZXI6ICdodG1sNScKICAgICAgICB9LCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5fcnVpZCA9IHJ1bnRpbWUuZ2V0UnVpZCgpOwogICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7CiAgICAgIH0sCiAgICAgIC8vIOS4uuS6huaUr+aMgeWklumDqOebtOaOpea3u+WKoOS4gOS4quWOn+eUn0ZpbGXlr7nosaHjgIIKICAgICAgX3dyYXBGaWxlOiBmdW5jdGlvbiBfd3JhcEZpbGUoZmlsZSkgewogICAgICAgIGlmICghKGZpbGUgaW5zdGFuY2VvZiBXVUZpbGUpKSB7CiAgICAgICAgICBpZiAoIShmaWxlIGluc3RhbmNlb2YgRmlsZSkpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLl9ydWlkKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5cJ3QgYWRkIGV4dGVybmFsIGZpbGVzLicpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaWxlID0gbmV3IEZpbGUodGhpcy5fcnVpZCwgZmlsZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZmlsZSA9IG5ldyBXVUZpbGUoZmlsZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgfSwKICAgICAgLy8g5Yik5pat5paH5Lu25piv5ZCm5Y+v5Lul6KKr5Yqg5YWl6Zif5YiXCiAgICAgIGFjY2VwdEZpbGU6IGZ1bmN0aW9uIGFjY2VwdEZpbGUoZmlsZSkgewogICAgICAgIHZhciBpbnZhbGlkID0gIWZpbGUgfHwgIWZpbGUuc2l6ZSB8fCB0aGlzLmFjY2VwdCAmJiAvLyDlpoLmnpzlkI3lrZfkuK3mnInlkI7nvIDvvIzmiY3lgZrlkI7nvIDnmb3lkI3ljZXlpITnkIbjgIIKICAgICAgICByRXh0LmV4ZWMoZmlsZS5uYW1lKSAmJiAhdGhpcy5hY2NlcHQudGVzdChmaWxlLm5hbWUpOwogICAgICAgIHJldHVybiAhaW52YWxpZDsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgYmVmb3JlRmlsZVF1ZXVlZAogICAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZeWvueixoQogICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5paH5Lu26KKr5Yqg5YWl6Zif5YiX5LmL5YmN6Kem5Y+R77yM5q2k5LqL5Lu255qEaGFuZGxlcui/lOWbnuWAvOS4umBmYWxzZWDvvIzliJnmraTmlofku7bkuI3kvJrooqvmt7vliqDov5vlhaXpmJ/liJfjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQGV2ZW50IGZpbGVRdWV1ZWQKICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGXlr7nosaEKICAgICAgICogQGRlc2NyaXB0aW9uIOW9k+aWh+S7tuiiq+WKoOWFpemYn+WIl+S7peWQjuinpuWPkeOAggogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKi8KICAgICAgX2FkZEZpbGU6IGZ1bmN0aW9uIF9hZGRGaWxlKGZpbGUpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIGZpbGUgPSBtZS5fd3JhcEZpbGUoZmlsZSk7IC8vIOS4jei/h+exu+Wei+WIpOaWreWFgeiuuOS4jeWFgeiuuO+8jOWFiOa0vumAgSBgYmVmb3JlRmlsZVF1ZXVlZGAKCiAgICAgICAgaWYgKCFtZS5vd25lci50cmlnZ2VyKCdiZWZvcmVGaWxlUXVldWVkJywgZmlsZSkpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIOexu+Wei+S4jeWMuemFje+8jOWImea0vumAgemUmeivr+S6i+S7tu+8jOW5tui/lOWbnuOAggoKCiAgICAgICAgaWYgKCFtZS5hY2NlcHRGaWxlKGZpbGUpKSB7CiAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCdlcnJvcicsICdRX1RZUEVfREVOSUVEJywgZmlsZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtZS5xdWV1ZS5hcHBlbmQoZmlsZSk7CiAgICAgICAgbWUub3duZXIudHJpZ2dlcignZmlsZVF1ZXVlZCcsIGZpbGUpOwogICAgICAgIHJldHVybiBmaWxlOwogICAgICB9LAogICAgICBnZXRGaWxlOiBmdW5jdGlvbiBnZXRGaWxlKGZpbGVJZCkgewogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlLmdldEZpbGUoZmlsZUlkKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgZmlsZXNRdWV1ZWQKICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlcyDmlbDnu4TvvIzlhoXlrrnkuLrljp/lp4tGaWxlKGxpYi9GaWxl77yJ5a+56LGh44CCCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPkuIDmibnmlofku7bmt7vliqDov5vpmJ/liJfku6XlkI7op6blj5HjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbYXV0bz1mYWxzZV0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOiuvue9ruS4uiB0cnVlIOWQju+8jOS4jemcgOimgeaJi+WKqOiwg+eUqOS4iuS8oO+8jOacieaWh+S7tumAieaLqeWNs+W8gOWni+S4iuS8oOOAggogICAgICAgKgogICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgKiBAbWV0aG9kIGFkZEZpbGVzCiAgICAgICAqIEBncmFtbWFyIGFkZEZpbGVzKCBmaWxlICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBncmFtbWFyIGFkZEZpbGVzKCBbZmlsZTEsIGZpbGUyIC4uLl0gKSA9PiB1bmRlZmluZWQKICAgICAgICogQHBhcmFtIHtBcnJheSBvZiBGaWxlIG9yIEZpbGV9IFtmaWxlc10gRmlsZXMg5a+56LGhIOaVsOe7hAogICAgICAgKiBAZGVzY3JpcHRpb24g5re75Yqg5paH5Lu25Yiw6Zif5YiXCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICBhZGRGaWxlOiBmdW5jdGlvbiBhZGRGaWxlKGZpbGVzKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgICAgaWYgKCFmaWxlcy5sZW5ndGgpIHsKICAgICAgICAgIGZpbGVzID0gW2ZpbGVzXTsKICAgICAgICB9CgogICAgICAgIGZpbGVzID0gJC5tYXAoZmlsZXMsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICByZXR1cm4gbWUuX2FkZEZpbGUoZmlsZSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChmaWxlcy5sZW5ndGgpIHsKICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ2ZpbGVzUXVldWVkJywgZmlsZXMpOwoKICAgICAgICAgIGlmIChtZS5vcHRpb25zLmF1dG8pIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgbWUucmVxdWVzdCgnc3RhcnQtdXBsb2FkJyk7CiAgICAgICAgICAgIH0sIDIwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldFN0YXRzOiBmdW5jdGlvbiBnZXRTdGF0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5zdGF0czsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgZmlsZURlcXVldWVkCiAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmlofku7booqvnp7vpmaTpmJ/liJflkI7op6blj5HjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgKiBAbWV0aG9kIHJlbW92ZUZpbGUKICAgICAgKiBAZ3JhbW1hciByZW1vdmVGaWxlKCBmaWxlICkgPT4gdW5kZWZpbmVkCiAgICAgICogQGdyYW1tYXIgcmVtb3ZlRmlsZSggaWQgKSA9PiB1bmRlZmluZWQKICAgICAgKiBAZ3JhbW1hciByZW1vdmVGaWxlKCBmaWxlLCB0cnVlICkgPT4gdW5kZWZpbmVkCiAgICAgICogQGdyYW1tYXIgcmVtb3ZlRmlsZSggaWQsIHRydWUgKSA9PiB1bmRlZmluZWQKICAgICAgKiBAcGFyYW0ge0ZpbGV8aWR9IGZpbGUgRmlsZeWvueixoeaIlui/mUZpbGXlr7nosaHnmoRpZAogICAgICAqIEBkZXNjcmlwdGlvbiDnp7vpmaTmn5DkuIDmlofku7YsIOm7mOiupOWPquS8muagh+iusOaWh+S7tueKtuaAgeS4uuW3suWPlua2iO+8jOWmguaenOesrOS6jOS4quWPguaVsOS4uiBgdHJ1ZWAg5YiZ5Lya5LuOIHF1ZXVlIOS4reenu+mZpOOAggogICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICogQGV4YW1wbGUKICAgICAgKgogICAgICAqICRsaS5vbignY2xpY2snLCAnLnJlbW92ZS10aGlzJywgZnVuY3Rpb24oKSB7CiAgICAgICogICAgIHVwbG9hZGVyLnJlbW92ZUZpbGUoIGZpbGUgKTsKICAgICAgKiB9KQogICAgICAqLwogICAgICByZW1vdmVGaWxlOiBmdW5jdGlvbiByZW1vdmVGaWxlKGZpbGUsIHJlbW92ZSkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgZmlsZSA9IGZpbGUuaWQgPyBmaWxlIDogbWUucXVldWUuZ2V0RmlsZShmaWxlKTsKICAgICAgICB0aGlzLnJlcXVlc3QoJ2NhbmNlbC1maWxlJywgZmlsZSk7CgogICAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICAgIHRoaXMucXVldWUucmVtb3ZlRmlsZShmaWxlKTsKICAgICAgICB9CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogQG1ldGhvZCBnZXRGaWxlcwogICAgICAgKiBAZ3JhbW1hciBnZXRGaWxlcygpID0+IEFycmF5CiAgICAgICAqIEBncmFtbWFyIGdldEZpbGVzKCBzdGF0dXMxLCBzdGF0dXMyLCBzdGF0dXMuLi4gKSA9PiBBcnJheQogICAgICAgKiBAZGVzY3JpcHRpb24g6L+U5Zue5oyH5a6a54q25oCB55qE5paH5Lu26ZuG5ZCI77yM5LiN5Lyg5Y+C5pWw5bCG6L+U5Zue5omA5pyJ54q25oCB55qE5paH5Lu244CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqIEBleGFtcGxlCiAgICAgICAqIGNvbnNvbGUubG9nKCB1cGxvYWRlci5nZXRGaWxlcygpICk7ICAgIC8vID0+IGFsbCBmaWxlcwogICAgICAgKiBjb25zb2xlLmxvZyggdXBsb2FkZXIuZ2V0RmlsZXMoJ2Vycm9yJykgKSAgICAvLyA9PiBhbGwgZXJyb3IgZmlsZXMuCiAgICAgICAqLwogICAgICBnZXRGaWxlczogZnVuY3Rpb24gZ2V0RmlsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUuZ2V0RmlsZXMuYXBwbHkodGhpcy5xdWV1ZSwgYXJndW1lbnRzKTsKICAgICAgfSwKICAgICAgZmV0Y2hGaWxlOiBmdW5jdGlvbiBmZXRjaEZpbGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucXVldWUuZmV0Y2guYXBwbHkodGhpcy5xdWV1ZSwgYXJndW1lbnRzKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAbWV0aG9kIHJldHJ5CiAgICAgICAqIEBncmFtbWFyIHJldHJ5KCkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBncmFtbWFyIHJldHJ5KCBmaWxlICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBkZXNjcmlwdGlvbiDph43or5XkuIrkvKDvvIzph43or5XmjIflrprmlofku7bvvIzmiJbogIXku47lh7rplJnnmoTmlofku7blvIDlp4vph43mlrDkuIrkvKDjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICogQGV4YW1wbGUKICAgICAgICogZnVuY3Rpb24gcmV0cnkoKSB7CiAgICAgICAqICAgICB1cGxvYWRlci5yZXRyeSgpOwogICAgICAgKiB9CiAgICAgICAqLwogICAgICByZXRyeTogZnVuY3Rpb24gcmV0cnkoZmlsZSwgbm9Gb3JjZVN0YXJ0KSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgZmlsZXMsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbjsKCiAgICAgICAgaWYgKGZpbGUpIHsKICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnF1ZXVlLmdldEZpbGUoZmlsZSk7CiAgICAgICAgICBmaWxlLnNldFN0YXR1cyhTdGF0dXMuUVVFVUVEKTsKICAgICAgICAgIG5vRm9yY2VTdGFydCB8fCBtZS5yZXF1ZXN0KCdzdGFydC11cGxvYWQnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZpbGVzID0gbWUucXVldWUuZ2V0RmlsZXMoU3RhdHVzLkVSUk9SKTsKICAgICAgICBpID0gMDsKICAgICAgICBsZW4gPSBmaWxlcy5sZW5ndGg7CgogICAgICAgIGZvciAoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgIGZpbGUgPSBmaWxlc1tpXTsKICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKFN0YXR1cy5RVUVVRUQpOwogICAgICAgIH0KCiAgICAgICAgbWUucmVxdWVzdCgnc3RhcnQtdXBsb2FkJyk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogQG1ldGhvZCBzb3J0CiAgICAgICAqIEBncmFtbWFyIHNvcnQoIGZuICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBkZXNjcmlwdGlvbiDmjpLluo/pmJ/liJfkuK3nmoTmlofku7bvvIzlnKjkuIrkvKDkuYvliY3osIPmlbTlj6/ku6XmjqfliLbkuIrkvKDpobrluo/jgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCiAgICAgIHNvcnRGaWxlczogZnVuY3Rpb24gc29ydEZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLnF1ZXVlLnNvcnQuYXBwbHkodGhpcy5xdWV1ZSwgYXJndW1lbnRzKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgcmVzZXQKICAgICAgICogQGRlc2NyaXB0aW9uIOW9kyB1cGxvYWRlciDooqvph43nva7nmoTml7blgJnop6blj5HjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQG1ldGhvZCByZXNldAogICAgICAgKiBAZ3JhbW1hciByZXNldCgpID0+IHVuZGVmaW5lZAogICAgICAgKiBAZGVzY3JpcHRpb24g6YeN572udXBsb2FkZXLjgILnm67liY3lj6rph43nva7kuobpmJ/liJfjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICogQGV4YW1wbGUKICAgICAgICogdXBsb2FkZXIucmVzZXQoKTsKICAgICAgICovCiAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoJ3Jlc2V0Jyk7CiAgICAgICAgdGhpcy5xdWV1ZSA9IG5ldyBRdWV1ZSgpOwogICAgICAgIHRoaXMuc3RhdHMgPSB0aGlzLnF1ZXVlLnN0YXRzOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgICB0aGlzLnBsYWNlaG9sZGVyICYmIHRoaXMucGxhY2Vob2xkZXIuZGVzdHJveSgpOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IOa3u+WKoOiOt+WPllJ1bnRpbWXnm7jlhbPkv6Hmga/nmoTmlrnms5XjgIIKICAgKi8KCiAgZGVmaW5lKCd3aWRnZXRzL3J1bnRpbWUnLCBbJ3VwbG9hZGVyJywgJ3J1bnRpbWUvcnVudGltZScsICd3aWRnZXRzL3dpZGdldCddLCBmdW5jdGlvbiAoVXBsb2FkZXIsIFJ1bnRpbWUpIHsKICAgIFVwbG9hZGVyLnN1cHBvcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBSdW50aW1lLmhhc1J1bnRpbWUuYXBwbHkoUnVudGltZSwgYXJndW1lbnRzKTsKICAgIH07CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbcnVudGltZU9yZGVyPWh0bWw1LGZsYXNoXQogICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgKiBAZGVzY3JpcHRpb24g5oyH5a6a6L+Q6KGM5pe25ZCv5Yqo6aG65bqP44CC6buY6K6k5Lya5oOz5bCd6K+VIGh0bWw1IOaYr+WQpuaUr+aMge+8jOWmguaenOaUr+aMgeWImeS9v+eUqCBodG1sNSwg5ZCm5YiZ5YiZ5L2/55SoIGZsYXNoLgogICAgICoKICAgICAqIOWPr+S7peWwhuatpOWAvOiuvue9ruaIkCBgZmxhc2hg77yM5p2l5by65Yi25L2/55SoIGZsYXNoIOi/kOihjOaXtuOAggogICAgICovCgoKICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICdydW50aW1lJywKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBpZiAoIXRoaXMucHJlZGljdFJ1bnRpbWVUeXBlKCkpIHsKICAgICAgICAgIHRocm93IEVycm9yKCdSdW50aW1lIEVycm9yJyk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIOmihOa1i1VwbG9hZGVy5bCG6YeH55So5ZOq5LiqYFJ1bnRpbWVgCiAgICAgICAqIEBncmFtbWFyIHByZWRpY3RSdW50aW1lVHlwZSgpID0+IFN0cmluZwogICAgICAgKiBAbWV0aG9kIHByZWRpY3RSdW50aW1lVHlwZQogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKi8KICAgICAgcHJlZGljdFJ1bnRpbWVUeXBlOiBmdW5jdGlvbiBwcmVkaWN0UnVudGltZVR5cGUoKSB7CiAgICAgICAgdmFyIG9yZGVycyA9IHRoaXMub3B0aW9ucy5ydW50aW1lT3JkZXIgfHwgUnVudGltZS5vcmRlcnMsCiAgICAgICAgICAgIHR5cGUgPSB0aGlzLnR5cGUsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbjsKCiAgICAgICAgaWYgKCF0eXBlKSB7CiAgICAgICAgICBvcmRlcnMgPSBvcmRlcnMuc3BsaXQoL1xzKixccyovZyk7CgogICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gb3JkZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGlmIChSdW50aW1lLmhhc1J1bnRpbWUob3JkZXJzW2ldKSkgewogICAgICAgICAgICAgIHRoaXMudHlwZSA9IHR5cGUgPSBvcmRlcnNbaV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB0eXBlOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IFRyYW5zcG9ydAogICAqLwoKICBkZWZpbmUoJ2xpYi90cmFuc3BvcnQnLCBbJ2Jhc2UnLCAncnVudGltZS9jbGllbnQnLCAnbWVkaWF0b3InXSwgZnVuY3Rpb24gKEJhc2UsIFJ1bnRpbWVDbGllbnQsIE1lZGlhdG9yKSB7CiAgICB2YXIgJCA9IEJhc2UuJDsKCiAgICBmdW5jdGlvbiBUcmFuc3BvcnQob3B0cykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBvcHRzID0gbWUub3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBUcmFuc3BvcnQub3B0aW9ucywgb3B0cyB8fCB7fSk7CiAgICAgIFJ1bnRpbWVDbGllbnQuY2FsbCh0aGlzLCAnVHJhbnNwb3J0Jyk7CiAgICAgIHRoaXMuX2Jsb2IgPSBudWxsOwogICAgICB0aGlzLl9mb3JtRGF0YSA9IG9wdHMuZm9ybURhdGEgfHwge307CiAgICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRzLmhlYWRlcnMgfHwge307CiAgICAgIHRoaXMub24oJ3Byb2dyZXNzJywgdGhpcy5fdGltZW91dCk7CiAgICAgIHRoaXMub24oJ2xvYWQgZXJyb3InLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgbWUudHJpZ2dlcigncHJvZ3Jlc3MnLCAxKTsKICAgICAgICBjbGVhclRpbWVvdXQobWUuX3RpbWVyKTsKICAgICAgfSk7CiAgICB9CgogICAgVHJhbnNwb3J0Lm9wdGlvbnMgPSB7CiAgICAgIHNlcnZlcjogJycsCiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAvLyDot6jln5/ml7bvvIzmmK/lkKblhYHorrjmkLrluKZjb29raWUsIOWPquaciWh0bWw1IHJ1bnRpbWXmiY3mnInmlYgKICAgICAgd2l0aENyZWRlbnRpYWxzOiBmYWxzZSwKICAgICAgZmlsZVZhbDogJ2ZpbGUnLAogICAgICB0aW1lb3V0OiAyICogNjAgKiAxMDAwLAogICAgICAvLyAy5YiG6ZKfCiAgICAgIGZvcm1EYXRhOiB7fSwKICAgICAgaGVhZGVyczoge30sCiAgICAgIHNlbmRBc0JpbmFyeTogZmFsc2UKICAgIH07CiAgICAkLmV4dGVuZChUcmFuc3BvcnQucHJvdG90eXBlLCB7CiAgICAgIC8vIOa3u+WKoEJsb2IsIOWPquiDvea3u+WKoOS4gOasoe+8jOacgOWQjuS4gOasoeacieaViOOAggogICAgICBhcHBlbmRCbG9iOiBmdW5jdGlvbiBhcHBlbmRCbG9iKGtleSwgYmxvYiwgZmlsZW5hbWUpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBvcHRzID0gbWUub3B0aW9uczsKCiAgICAgICAgaWYgKG1lLmdldFJ1aWQoKSkgewogICAgICAgICAgbWUuZGlzY29ubmVjdFJ1bnRpbWUoKTsKICAgICAgICB9IC8vIOi/nuaOpeWIsGJsb2LlvZLlsZ7nmoTlkIzkuIDkuKpydW50aW1lLgoKCiAgICAgICAgbWUuY29ubmVjdFJ1bnRpbWUoYmxvYi5ydWlkLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5leGVjKCdpbml0Jyk7CiAgICAgICAgfSk7CiAgICAgICAgbWUuX2Jsb2IgPSBibG9iOwogICAgICAgIG9wdHMuZmlsZVZhbCA9IGtleSB8fCBvcHRzLmZpbGVWYWw7CiAgICAgICAgb3B0cy5maWxlbmFtZSA9IGZpbGVuYW1lIHx8IG9wdHMuZmlsZW5hbWU7CiAgICAgIH0sCiAgICAgIC8vIOa3u+WKoOWFtuS7luWtl+autQogICAgICBhcHBlbmQ6IGZ1bmN0aW9uIGFwcGVuZChrZXksIHZhbHVlKSB7CiAgICAgICAgaWYgKF90eXBlb2Yoa2V5KSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICQuZXh0ZW5kKHRoaXMuX2Zvcm1EYXRhLCBrZXkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9mb3JtRGF0YVtrZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiBzZXRSZXF1ZXN0SGVhZGVyKGtleSwgdmFsdWUpIHsKICAgICAgICBpZiAoX3R5cGVvZihrZXkpID09PSAnb2JqZWN0JykgewogICAgICAgICAgJC5leHRlbmQodGhpcy5faGVhZGVycywga2V5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5faGVhZGVyc1trZXldID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9LAogICAgICBzZW5kOiBmdW5jdGlvbiBzZW5kKG1ldGhvZCkgewogICAgICAgIHRoaXMuZXhlYygnc2VuZCcsIG1ldGhvZCk7CgogICAgICAgIHRoaXMuX3RpbWVvdXQoKTsKICAgICAgfSwKICAgICAgYWJvcnQ6IGZ1bmN0aW9uIGFib3J0KCkgewogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lcik7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnYWJvcnQnKTsKICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLnRyaWdnZXIoJ2Rlc3Ryb3knKTsKICAgICAgICB0aGlzLm9mZigpOwogICAgICAgIHRoaXMuZXhlYygnZGVzdHJveScpOwogICAgICAgIHRoaXMuZGlzY29ubmVjdFJ1bnRpbWUoKTsKICAgICAgfSwKICAgICAgZ2V0UmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbiBnZXRSZXNwb25zZUhlYWRlcnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0UmVzcG9uc2VIZWFkZXJzJyk7CiAgICAgIH0sCiAgICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbiBnZXRSZXNwb25zZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5leGVjKCdnZXRSZXNwb25zZScpOwogICAgICB9LAogICAgICBnZXRSZXNwb25zZUFzSnNvbjogZnVuY3Rpb24gZ2V0UmVzcG9uc2VBc0pzb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0UmVzcG9uc2VBc0pzb24nKTsKICAgICAgfSwKICAgICAgZ2V0U3RhdHVzOiBmdW5jdGlvbiBnZXRTdGF0dXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0U3RhdHVzJyk7CiAgICAgIH0sCiAgICAgIF90aW1lb3V0OiBmdW5jdGlvbiBfdGltZW91dCgpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBkdXJhdGlvbiA9IG1lLm9wdGlvbnMudGltZW91dDsKCiAgICAgICAgaWYgKCFkdXJhdGlvbikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY2xlYXJUaW1lb3V0KG1lLl90aW1lcik7CiAgICAgICAgbWUuX3RpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5hYm9ydCgpOwogICAgICAgICAgbWUudHJpZ2dlcignZXJyb3InLCAndGltZW91dCcpOwogICAgICAgIH0sIGR1cmF0aW9uKTsKICAgICAgfQogICAgfSk7IC8vIOiuqVRyYW5zcG9ydOWFt+Wkh+S6i+S7tuWKn+iDveOAggoKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhUcmFuc3BvcnQucHJvdG90eXBlKTsKICAgIHJldHVybiBUcmFuc3BvcnQ7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDotJ/otKPmlofku7bkuIrkvKDnm7jlhbPjgIIKICAgKi8KCiAgZGVmaW5lKCd3aWRnZXRzL3VwbG9hZCcsIFsnYmFzZScsICd1cGxvYWRlcicsICdmaWxlJywgJ2xpYi90cmFuc3BvcnQnLCAnd2lkZ2V0cy93aWRnZXQnXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyLCBXVUZpbGUsIFRyYW5zcG9ydCkgewogICAgdmFyICQgPSBCYXNlLiQsCiAgICAgICAgaXNQcm9taXNlID0gQmFzZS5pc1Byb21pc2UsCiAgICAgICAgU3RhdHVzID0gV1VGaWxlLlN0YXR1czsgLy8g5re75Yqg6buY6K6k6YWN572u6aG5CgogICAgJC5leHRlbmQoVXBsb2FkZXIub3B0aW9ucywgewogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbcHJlcGFyZU5leHRGaWxlPWZhbHNlXQogICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAgICogQGZvciBVcGxvYWRlcgogICAgICAgKiBAZGVzY3JpcHRpb24g5piv5ZCm5YWB6K645Zyo5paH5Lu25Lyg6L6T5pe25o+Q5YmN5oqK5LiL5LiA5Liq5paH5Lu25YeG5aSH5aW944CCCiAgICAgICAqIOWvueS6juS4gOS4quaWh+S7tueahOWHhuWkh+W3peS9nOavlOi+g+iAl+aXtu+8jOavlOWmguWbvueJh+WOi+e8qe+8jG1kNeW6j+WIl+WMluOAggogICAgICAgKiDlpoLmnpzog73mj5DliY3lnKjlvZPliY3mlofku7bkvKDovpPmnJ/lpITnkIbvvIzlj6/ku6XoioLnnIHmgLvkvZPogJfml7bjgIIKICAgICAgICovCiAgICAgIHByZXBhcmVOZXh0RmlsZTogZmFsc2UsCgogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbY2h1bmtlZD1mYWxzZV0KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOaYr+WQpuimgeWIhueJh+WkhOeQhuWkp+aWh+S7tuS4iuS8oOOAggogICAgICAgKi8KICAgICAgY2h1bmtlZDogZmFsc2UsCgogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbY2h1bmtTaXplPTUyNDI4ODBdCiAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlpoLmnpzopoHliIbniYfvvIzliIblpJrlpKfkuIDniYfvvJ8g6buY6K6k5aSn5bCP5Li6NU0uCiAgICAgICAqLwogICAgICBjaHVua1NpemU6IDUgKiAxMDI0ICogMTAyNCwKCiAgICAgIC8qKgogICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IFtjaHVua1JldHJ5PTJdCiAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlpoLmnpzmn5DkuKrliIbniYfnlLHkuo7nvZHnu5zpl67popjlh7rplJnvvIzlhYHorrjoh6rliqjph43kvKDlpJrlsJHmrKHvvJ8KICAgICAgICovCiAgICAgIGNodW5rUmV0cnk6IDIsCgogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbdGhyZWFkcz0zXQogICAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAgICogQGZvciBVcGxvYWRlcgogICAgICAgKiBAZGVzY3JpcHRpb24g5LiK5Lyg5bm25Y+R5pWw44CC5YWB6K645ZCM5pe25pyA5aSn5LiK5Lyg6L+b56iL5pWw44CCCiAgICAgICAqLwogICAgICB0aHJlYWRzOiAzLAoKICAgICAgLyoqCiAgICAgICAqIEBwcm9wZXJ0eSB7T2JqZWN0fSBbZm9ybURhdGE9e31dCiAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBkZXNjcmlwdGlvbiDmlofku7bkuIrkvKDor7fmsYLnmoTlj4LmlbDooajvvIzmr4/mrKHlj5HpgIHpg73kvJrlj5HpgIHmraTlr7nosaHkuK3nmoTlj4LmlbDjgIIKICAgICAgICovCiAgICAgIGZvcm1EYXRhOiB7fQogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFtmaWxlVmFsPSdmaWxlJ10KICAgICAgICogQG5hbWVzcGFjZSBvcHRpb25zCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGRlc2NyaXB0aW9uIOiuvue9ruaWh+S7tuS4iuS8oOWfn+eahG5hbWXjgIIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IFtzZW5kQXNCaW5hcnk9ZmFsc2VdCiAgICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICAgKiBAZm9yIFVwbG9hZGVyCiAgICAgICAqIEBkZXNjcmlwdGlvbiDmmK/lkKblt7Lkuozov5vliLbnmoTmtYHnmoTmlrnlvI/lj5HpgIHmlofku7bvvIzov5nmoLfmlbTkuKrkuIrkvKDlhoXlrrlgcGhwOi8vaW5wdXRg6YO95Li65paH5Lu25YaF5a6577yMCiAgICAgICAqIOWFtuS7luWPguaVsOWcqCRfR0VU5pWw57uE5Lit44CCCiAgICAgICAqLwoKICAgIH0pOyAvLyDotJ/otKPlsIbmlofku7bliIfniYfjgIIKCiAgICBmdW5jdGlvbiBDdXRlRmlsZShmaWxlLCBjaHVua1NpemUpIHsKICAgICAgdmFyIHBlbmRpbmcgPSBbXSwKICAgICAgICAgIGJsb2IgPSBmaWxlLnNvdXJjZSwKICAgICAgICAgIHRvdGFsID0gYmxvYi5zaXplLAogICAgICAgICAgY2h1bmtzID0gY2h1bmtTaXplID8gTWF0aC5jZWlsKHRvdGFsIC8gY2h1bmtTaXplKSA6IDEsCiAgICAgICAgICBzdGFydCA9IDAsCiAgICAgICAgICBpbmRleCA9IDAsCiAgICAgICAgICBsZW4sCiAgICAgICAgICBhcGk7CiAgICAgIGFwaSA9IHsKICAgICAgICBmaWxlOiBmaWxlLAogICAgICAgIGhhczogZnVuY3Rpb24gaGFzKCkgewogICAgICAgICAgcmV0dXJuICEhcGVuZGluZy5sZW5ndGg7CiAgICAgICAgfSwKICAgICAgICBzaGlmdDogZnVuY3Rpb24gc2hpZnQoKSB7CiAgICAgICAgICByZXR1cm4gcGVuZGluZy5zaGlmdCgpOwogICAgICAgIH0sCiAgICAgICAgdW5zaGlmdDogZnVuY3Rpb24gdW5zaGlmdChibG9jaykgewogICAgICAgICAgcGVuZGluZy51bnNoaWZ0KGJsb2NrKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICB3aGlsZSAoaW5kZXggPCBjaHVua3MpIHsKICAgICAgICBsZW4gPSBNYXRoLm1pbihjaHVua1NpemUsIHRvdGFsIC0gc3RhcnQpOwogICAgICAgIHBlbmRpbmcucHVzaCh7CiAgICAgICAgICBmaWxlOiBmaWxlLAogICAgICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICAgICAgZW5kOiBjaHVua1NpemUgPyBzdGFydCArIGxlbiA6IHRvdGFsLAogICAgICAgICAgdG90YWw6IHRvdGFsLAogICAgICAgICAgY2h1bmtzOiBjaHVua3MsCiAgICAgICAgICBjaHVuazogaW5kZXgrKywKICAgICAgICAgIGN1dGVkOiBhcGkKICAgICAgICB9KTsKICAgICAgICBzdGFydCArPSBsZW47CiAgICAgIH0KCiAgICAgIGZpbGUuYmxvY2tzID0gcGVuZGluZy5jb25jYXQoKTsKICAgICAgZmlsZS5yZW1hbmluZyA9IHBlbmRpbmcubGVuZ3RoOwogICAgICByZXR1cm4gYXBpOwogICAgfQoKICAgIFVwbG9hZGVyLnJlZ2lzdGVyKHsKICAgICAgbmFtZTogJ3VwbG9hZCcsCiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lciwKICAgICAgICAgICAgbWUgPSB0aGlzOwogICAgICAgIHRoaXMucnVuaW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5wcm9ncmVzcyA9IGZhbHNlOwogICAgICAgIG93bmVyLm9uKCdzdGFydFVwbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG1lLnByb2dyZXNzID0gdHJ1ZTsKICAgICAgICB9KS5vbigndXBsb2FkRmluaXNoZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5wcm9ncmVzcyA9IGZhbHNlOwogICAgICAgIH0pOyAvLyDorrDlvZXlvZPliY3mraPlnKjkvKDnmoTmlbDmja7vvIzot590aHJlYWRz55u45YWzCgogICAgICAgIHRoaXMucG9vbCA9IFtdOyAvLyDnvJPlrZjliIblpb3niYfnmoTmlofku7bjgIIKCiAgICAgICAgdGhpcy5zdGFjayA9IFtdOyAvLyDnvJPlrZjljbPlsIbkuIrkvKDnmoTmlofku7bjgIIKCiAgICAgICAgdGhpcy5wZW5kaW5nID0gW107IC8vIOi3n+i4qui/mOacieWkmuWwkeWIhueJh+WcqOS4iuS8oOS4reS9huaYr+ayoeacieWujOaIkOS4iuS8oOOAggoKICAgICAgICB0aGlzLnJlbWFuaW5nID0gMDsKICAgICAgICB0aGlzLl9fdGljayA9IEJhc2UuYmluZEZuKHRoaXMuX3RpY2ssIHRoaXMpOyAvLyDplIDmr4HkuIrkvKDnm7jlhbPnmoTlsZ7mgKfjgIIKCiAgICAgICAgb3duZXIub24oJ3VwbG9hZENvbXBsZXRlJywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICAgIC8vIOaKiuWFtuS7luWdl+WPlua2iOS6huOAggogICAgICAgICAgZmlsZS5ibG9ja3MgJiYgJC5lYWNoKGZpbGUuYmxvY2tzLCBmdW5jdGlvbiAoXywgdikgewogICAgICAgICAgICB2LnRyYW5zcG9ydCAmJiAodi50cmFuc3BvcnQuYWJvcnQoKSwgdi50cmFuc3BvcnQuZGVzdHJveSgpKTsKICAgICAgICAgICAgZGVsZXRlIHYudHJhbnNwb3J0OwogICAgICAgICAgfSk7CiAgICAgICAgICBkZWxldGUgZmlsZS5ibG9ja3M7CiAgICAgICAgICBkZWxldGUgZmlsZS5yZW1hbmluZzsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICAgIHRoaXMucmVxdWVzdCgnc3RvcC11cGxvYWQnLCB0cnVlKTsKICAgICAgICB0aGlzLnJ1bmluZyA9IGZhbHNlOwogICAgICAgIHRoaXMucG9vbCA9IFtdOwogICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICB0aGlzLnBlbmRpbmcgPSBbXTsKICAgICAgICB0aGlzLnJlbWFuaW5nID0gMDsKICAgICAgICB0aGlzLl90cmlnZ2VkID0gZmFsc2U7CiAgICAgICAgdGhpcy5fcHJvbWlzZSA9IG51bGw7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogQGV2ZW50IHN0YXJ0VXBsb2FkCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPlvIDlp4vkuIrkvKDmtYHnqIvml7bop6blj5HjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICog5byA5aeL5LiK5Lyg44CC5q2k5pa55rOV5Y+v5Lul5LuO5Yid5aeL54q25oCB6LCD55So5byA5aeL5LiK5Lyg5rWB56iL77yM5Lmf5Y+v5Lul5LuO5pqC5YGc54q25oCB6LCD55So77yM57un57ut5LiK5Lyg5rWB56iL44CCCiAgICAgICAqCiAgICAgICAqIOWPr+S7peaMh+WumuW8gOWni+afkOS4gOS4quaWh+S7tuOAggogICAgICAgKiBAZ3JhbW1hciB1cGxvYWQoKSA9PiB1bmRlZmluZWQKICAgICAgICogQGdyYW1tYXIgdXBsb2FkKCBmaWxlIHwgZmlsZUlkKSA9PiB1bmRlZmluZWQKICAgICAgICogQG1ldGhvZCB1cGxvYWQKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCiAgICAgIHN0YXJ0VXBsb2FkOiBmdW5jdGlvbiBzdGFydFVwbG9hZChmaWxlKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsgLy8g56e75Ye6aW52YWxpZOeahOaWh+S7tgoKICAgICAgICAkLmVhY2gobWUucmVxdWVzdCgnZ2V0LWZpbGVzJywgU3RhdHVzLklOVkFMSUQpLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS5yZXF1ZXN0KCdyZW1vdmUtZmlsZScsIHRoaXMpOwogICAgICAgIH0pOyAvLyDlpoLmnpzmjIflrprkuoblvIDlp4vmn5DkuKrmlofku7bvvIzliJnlj6rlvIDlp4vmjIflrprnmoTmlofku7bjgIIKCiAgICAgICAgaWYgKGZpbGUpIHsKICAgICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IG1lLnJlcXVlc3QoJ2dldC1maWxlJywgZmlsZSk7CgogICAgICAgICAgaWYgKGZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoU3RhdHVzLlFVRVVFRCk7CiAgICAgICAgICAgICQuZWFjaChtZS5wb29sLCBmdW5jdGlvbiAoXywgdikgewogICAgICAgICAgICAgIC8vIOS5i+WJjeaaguWBnOi/h+OAggogICAgICAgICAgICAgIGlmICh2LmZpbGUgIT09IGZpbGUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYudHJhbnNwb3J0ICYmIHYudHJhbnNwb3J0LnNlbmQoKTsKICAgICAgICAgICAgICBmaWxlLnNldFN0YXR1cyhTdGF0dXMuUFJPR1JFU1MpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoZmlsZS5nZXRTdGF0dXMoKSAhPT0gU3RhdHVzLlBST0dSRVNTKSB7CiAgICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKFN0YXR1cy5RVUVVRUQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkLmVhY2gobWUucmVxdWVzdCgnZ2V0LWZpbGVzJywgW1N0YXR1cy5JTklURURdKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnNldFN0YXR1cyhTdGF0dXMuUVVFVUVEKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1lLnJ1bmluZykgewogICAgICAgICAgbWUub3duZXIudHJpZ2dlcignc3RhcnRVcGxvYWQnLCBmaWxlKTsgLy8g5byA5aeL5LiK5Lyg5oiW5pqC5YGc5oGi5aSN55qE77yMdHJpZ2dlciBldmVudAoKICAgICAgICAgIHJldHVybiBCYXNlLm5leHRUaWNrKG1lLl9fdGljayk7CiAgICAgICAgfQoKICAgICAgICBtZS5ydW5pbmcgPSB0cnVlOwogICAgICAgIHZhciBmaWxlcyA9IFtdOyAvLyDlpoLmnpzmnInmmoLlgZznmoTvvIzliJnnu63kvKAKCiAgICAgICAgZmlsZSB8fCAkLmVhY2gobWUucG9vbCwgZnVuY3Rpb24gKF8sIHYpIHsKICAgICAgICAgIHZhciBmaWxlID0gdi5maWxlOwoKICAgICAgICAgIGlmIChmaWxlLmdldFN0YXR1cygpID09PSBTdGF0dXMuSU5URVJSVVBUKSB7CiAgICAgICAgICAgIG1lLl90cmlnZ2VkID0gZmFsc2U7CiAgICAgICAgICAgIGZpbGVzLnB1c2goZmlsZSk7CiAgICAgICAgICAgIHYudHJhbnNwb3J0ICYmIHYudHJhbnNwb3J0LnNlbmQoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAkLmVhY2goZmlsZXMsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKFN0YXR1cy5QUk9HUkVTUyk7CiAgICAgICAgfSk7CiAgICAgICAgZmlsZSB8fCAkLmVhY2gobWUucmVxdWVzdCgnZ2V0LWZpbGVzJywgU3RhdHVzLklOVEVSUlVQVCksIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRoaXMuc2V0U3RhdHVzKFN0YXR1cy5QUk9HUkVTUyk7CiAgICAgICAgfSk7CiAgICAgICAgbWUuX3RyaWdnZWQgPSBmYWxzZTsKICAgICAgICBCYXNlLm5leHRUaWNrKG1lLl9fdGljayk7CiAgICAgICAgbWUub3duZXIudHJpZ2dlcignc3RhcnRVcGxvYWQnKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgc3RvcFVwbG9hZAogICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5byA5aeL5LiK5Lyg5rWB56iL5pqC5YGc5pe26Kem5Y+R44CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwoKICAgICAgLyoqCiAgICAgICAqIOaaguWBnOS4iuS8oOOAguesrOS4gOS4quWPguaVsOS4uuaYr+WQpuS4reaWreS4iuS8oOW9k+WJjeato+WcqOS4iuS8oOeahOaWh+S7tuOAggogICAgICAgKgogICAgICAgKiDlpoLmnpznrKzkuIDkuKrlj4LmlbDmmK/mlofku7bvvIzliJnlj6rmmoLlgZzmjIflrprmlofku7bjgIIKICAgICAgICogQGdyYW1tYXIgc3RvcCgpID0+IHVuZGVmaW5lZAogICAgICAgKiBAZ3JhbW1hciBzdG9wKCB0cnVlICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBncmFtbWFyIHN0b3AoIGZpbGUgKSA9PiB1bmRlZmluZWQKICAgICAgICogQG1ldGhvZCBzdG9wCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICBzdG9wVXBsb2FkOiBmdW5jdGlvbiBzdG9wVXBsb2FkKGZpbGUsIGludGVycnVwdCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICAgIGlmIChmaWxlID09PSB0cnVlKSB7CiAgICAgICAgICBpbnRlcnJ1cHQgPSBmaWxlOwogICAgICAgICAgZmlsZSA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAobWUucnVuaW5nID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8g5aaC5p6c5Y+q5piv5pqC5YGc5p+Q5Liq5paH5Lu244CCCgoKICAgICAgICBpZiAoZmlsZSkgewogICAgICAgICAgZmlsZSA9IGZpbGUuaWQgPyBmaWxlIDogbWUucmVxdWVzdCgnZ2V0LWZpbGUnLCBmaWxlKTsKCiAgICAgICAgICBpZiAoZmlsZS5nZXRTdGF0dXMoKSAhPT0gU3RhdHVzLlBST0dSRVNTICYmIGZpbGUuZ2V0U3RhdHVzKCkgIT09IFN0YXR1cy5RVUVVRUQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKFN0YXR1cy5JTlRFUlJVUFQpOwogICAgICAgICAgJC5lYWNoKG1lLnBvb2wsIGZ1bmN0aW9uIChfLCB2KSB7CiAgICAgICAgICAgIC8vIOWPqiBhYm9ydCDmjIflrprnmoTmlofku7bvvIzmr4/kuIDkuKrliIbniYfjgIIKICAgICAgICAgICAgaWYgKHYuZmlsZSA9PT0gZmlsZSkgewogICAgICAgICAgICAgIHYudHJhbnNwb3J0ICYmIHYudHJhbnNwb3J0LmFib3J0KCk7CgogICAgICAgICAgICAgIGlmIChpbnRlcnJ1cHQpIHsKICAgICAgICAgICAgICAgIG1lLl9wdXRiYWNrKHYpOwoKICAgICAgICAgICAgICAgIG1lLl9wb3BCbG9jayh2KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgbWUub3duZXIudHJpZ2dlcignc3RvcFVwbG9hZCcsIGZpbGUpOyAvLyDmmoLlgZzvvIx0cmlnZ2VyIGV2ZW50CgogICAgICAgICAgcmV0dXJuIEJhc2UubmV4dFRpY2sobWUuX190aWNrKTsKICAgICAgICB9CgogICAgICAgIG1lLnJ1bmluZyA9IGZhbHNlOyAvLyDmraPlnKjlh4blpIfkuK3nmoTmlofku7bjgIIKCiAgICAgICAgaWYgKHRoaXMuX3Byb21pc2UgJiYgdGhpcy5fcHJvbWlzZS5maWxlKSB7CiAgICAgICAgICB0aGlzLl9wcm9taXNlLmZpbGUuc2V0U3RhdHVzKFN0YXR1cy5JTlRFUlJVUFQpOwogICAgICAgIH0KCiAgICAgICAgaW50ZXJydXB0ICYmICQuZWFjaChtZS5wb29sLCBmdW5jdGlvbiAoXywgdikgewogICAgICAgICAgdi50cmFuc3BvcnQgJiYgdi50cmFuc3BvcnQuYWJvcnQoKTsKICAgICAgICAgIHYuZmlsZS5zZXRTdGF0dXMoU3RhdHVzLklOVEVSUlVQVCk7CiAgICAgICAgfSk7CiAgICAgICAgbWUub3duZXIudHJpZ2dlcignc3RvcFVwbG9hZCcpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIEBtZXRob2QgY2FuY2VsRmlsZQogICAgICAgKiBAZ3JhbW1hciBjYW5jZWxGaWxlKCBmaWxlICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBncmFtbWFyIGNhbmNlbEZpbGUoIGlkICkgPT4gdW5kZWZpbmVkCiAgICAgICAqIEBwYXJhbSB7RmlsZXxpZH0gZmlsZSBGaWxl5a+56LGh5oiW6L+ZRmlsZeWvueixoeeahGlkCiAgICAgICAqIEBkZXNjcmlwdGlvbiDmoIforrDmlofku7bnirbmgIHkuLrlt7Llj5bmtogsIOWQjOaXtuWwhuS4reaWreaWh+S7tuS8oOi+k+OAggogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKiBAZXhhbXBsZQogICAgICAgKgogICAgICAgKiAkbGkub24oJ2NsaWNrJywgJy5yZW1vdmUtdGhpcycsIGZ1bmN0aW9uKCkgewogICAgICAgKiAgICAgdXBsb2FkZXIuY2FuY2VsRmlsZSggZmlsZSApOwogICAgICAgKiB9KQogICAgICAgKi8KICAgICAgY2FuY2VsRmlsZTogZnVuY3Rpb24gY2FuY2VsRmlsZShmaWxlKSB7CiAgICAgICAgZmlsZSA9IGZpbGUuaWQgPyBmaWxlIDogdGhpcy5yZXF1ZXN0KCdnZXQtZmlsZScsIGZpbGUpOyAvLyDlpoLmnpzmraPlnKjkuIrkvKDjgIIKCiAgICAgICAgZmlsZS5ibG9ja3MgJiYgJC5lYWNoKGZpbGUuYmxvY2tzLCBmdW5jdGlvbiAoXywgdikgewogICAgICAgICAgdmFyIF90ciA9IHYudHJhbnNwb3J0OwoKICAgICAgICAgIGlmIChfdHIpIHsKICAgICAgICAgICAgX3RyLmFib3J0KCk7CgogICAgICAgICAgICBfdHIuZGVzdHJveSgpOwoKICAgICAgICAgICAgZGVsZXRlIHYudHJhbnNwb3J0OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGZpbGUuc2V0U3RhdHVzKFN0YXR1cy5DQU5DRUxMRUQpOwogICAgICAgIHRoaXMub3duZXIudHJpZ2dlcignZmlsZURlcXVldWVkJywgZmlsZSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICog5Yik5patYFVwbGFvZGVgcuaYr+WQpuato+WcqOS4iuS8oOS4reOAggogICAgICAgKiBAZ3JhbW1hciBpc0luUHJvZ3Jlc3MoKSA9PiBCb29sZWFuCiAgICAgICAqIEBtZXRob2QgaXNJblByb2dyZXNzCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICBpc0luUHJvZ3Jlc3M6IGZ1bmN0aW9uIGlzSW5Qcm9ncmVzcygpIHsKICAgICAgICByZXR1cm4gISF0aGlzLnByb2dyZXNzOwogICAgICB9LAogICAgICBfZ2V0U3RhdHM6IGZ1bmN0aW9uIF9nZXRTdGF0cygpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KCdnZXQtc3RhdHMnKTsKICAgICAgfSwKCiAgICAgIC8qKgogICAgICAgKiDmjonov4fkuIDkuKrmlofku7bkuIrkvKDvvIznm7TmjqXmoIforrDmjIflrprmlofku7bkuLrlt7LkuIrkvKDnirbmgIHjgIIKICAgICAgICogQGdyYW1tYXIgc2tpcEZpbGUoIGZpbGUgKSA9PiB1bmRlZmluZWQKICAgICAgICogQG1ldGhvZCBza2lwRmlsZQogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKi8KICAgICAgc2tpcEZpbGU6IGZ1bmN0aW9uIHNraXBGaWxlKGZpbGUsIHN0YXR1cykgewogICAgICAgIGZpbGUgPSBmaWxlLmlkID8gZmlsZSA6IHRoaXMucmVxdWVzdCgnZ2V0LWZpbGUnLCBmaWxlKTsKICAgICAgICBmaWxlLnNldFN0YXR1cyhzdGF0dXMgfHwgU3RhdHVzLkNPTVBMRVRFKTsKICAgICAgICBmaWxlLnNraXBwZWQgPSB0cnVlOyAvLyDlpoLmnpzmraPlnKjkuIrkvKDjgIIKCiAgICAgICAgZmlsZS5ibG9ja3MgJiYgJC5lYWNoKGZpbGUuYmxvY2tzLCBmdW5jdGlvbiAoXywgdikgewogICAgICAgICAgdmFyIF90ciA9IHYudHJhbnNwb3J0OwoKICAgICAgICAgIGlmIChfdHIpIHsKICAgICAgICAgICAgX3RyLmFib3J0KCk7CgogICAgICAgICAgICBfdHIuZGVzdHJveSgpOwoKICAgICAgICAgICAgZGVsZXRlIHYudHJhbnNwb3J0OwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMub3duZXIudHJpZ2dlcigndXBsb2FkU2tpcCcsIGZpbGUpOwogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIEBldmVudCB1cGxvYWRGaW5pc2hlZAogICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5omA5pyJ5paH5Lu25LiK5Lyg57uT5p2f5pe26Kem5Y+R44CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICBfdGljazogZnVuY3Rpb24gX3RpY2soKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgb3B0cyA9IG1lLm9wdGlvbnMsCiAgICAgICAgICAgIGZuLAogICAgICAgICAgICB2YWw7IC8vIOS4iuS4gOS4qnByb21pc2Xov5jmsqHmnInnu5PmnZ/vvIzliJnnrYnlvoXlrozmiJDlkI7lho3miafooYzjgIIKCiAgICAgICAgaWYgKG1lLl9wcm9taXNlKSB7CiAgICAgICAgICByZXR1cm4gbWUuX3Byb21pc2UuYWx3YXlzKG1lLl9fdGljayk7CiAgICAgICAgfSAvLyDov5jmnInkvY3nva7vvIzkuJTov5jmnInmlofku7bopoHlpITnkIbnmoTor53jgIIKCgogICAgICAgIGlmIChtZS5wb29sLmxlbmd0aCA8IG9wdHMudGhyZWFkcyAmJiAodmFsID0gbWUuX25leHRCbG9jaygpKSkgewogICAgICAgICAgbWUuX3RyaWdnZWQgPSBmYWxzZTsKCiAgICAgICAgICBmbiA9IGZ1bmN0aW9uIGZuKHZhbCkgewogICAgICAgICAgICBtZS5fcHJvbWlzZSA9IG51bGw7IC8vIOacieWPr+iDveaYr3JlamVjdOi/h+adpeeahO+8jOaJgOS7peimgeajgOa1i3ZhbOeahOexu+Wei+OAggoKICAgICAgICAgICAgdmFsICYmIHZhbC5maWxlICYmIG1lLl9zdGFydFNlbmQodmFsKTsKICAgICAgICAgICAgQmFzZS5uZXh0VGljayhtZS5fX3RpY2spOwogICAgICAgICAgfTsKCiAgICAgICAgICBtZS5fcHJvbWlzZSA9IGlzUHJvbWlzZSh2YWwpID8gdmFsLmFsd2F5cyhmbikgOiBmbih2YWwpOyAvLyDmsqHmnInopoHkuIrkvKDnmoTkuobvvIzkuJTmsqHmnInmraPlnKjkvKDovpPnmoTkuobjgIIKICAgICAgICB9IGVsc2UgaWYgKCFtZS5yZW1hbmluZyAmJiAhbWUuX2dldFN0YXRzKCkubnVtT2ZRdWV1ZSAmJiAhbWUuX2dldFN0YXRzKCkubnVtb2ZJbnRlcnJ1cHQpIHsKICAgICAgICAgIG1lLnJ1bmluZyA9IGZhbHNlOwogICAgICAgICAgbWUuX3RyaWdnZWQgfHwgQmFzZS5uZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ3VwbG9hZEZpbmlzaGVkJyk7CiAgICAgICAgICB9KTsKICAgICAgICAgIG1lLl90cmlnZ2VkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF9wdXRiYWNrOiBmdW5jdGlvbiBfcHV0YmFjayhibG9jaykgewogICAgICAgIHZhciBpZHg7CiAgICAgICAgYmxvY2suY3V0ZWQudW5zaGlmdChibG9jayk7CiAgICAgICAgaWR4ID0gdGhpcy5zdGFjay5pbmRleE9mKGJsb2NrLmN1dGVkKTsKCiAgICAgICAgaWYgKCF+aWR4KSB7CiAgICAgICAgICB0aGlzLnN0YWNrLnVuc2hpZnQoYmxvY2suY3V0ZWQpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgX2dldFN0YWNrOiBmdW5jdGlvbiBfZ2V0U3RhY2soKSB7CiAgICAgICAgdmFyIGkgPSAwLAogICAgICAgICAgICBhY3Q7CgogICAgICAgIHdoaWxlIChhY3QgPSB0aGlzLnN0YWNrW2krK10pIHsKICAgICAgICAgIGlmIChhY3QuaGFzKCkgJiYgYWN0LmZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5QUk9HUkVTUykgewogICAgICAgICAgICByZXR1cm4gYWN0OwogICAgICAgICAgfSBlbHNlIGlmICghYWN0LmhhcygpIHx8IGFjdC5maWxlLmdldFN0YXR1cygpICE9PSBTdGF0dXMuUFJPR1JFU1MgJiYgYWN0LmZpbGUuZ2V0U3RhdHVzKCkgIT09IFN0YXR1cy5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgLy8g5oqK5bey57uP5aSE55CG5a6M5LqG55qE77yM5oiW6ICF77yM54q25oCB5Li66Z2eIHByb2dyZXNz77yI5LiK5Lyg5Lit77yJ44CBCiAgICAgICAgICAgIC8vIGludGVydXB077yI5pqC5YGc5Lit77yJIOeahOenu+mZpOOAggogICAgICAgICAgICB0aGlzLnN0YWNrLnNwbGljZSgtLWksIDEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0sCiAgICAgIF9uZXh0QmxvY2s6IGZ1bmN0aW9uIF9uZXh0QmxvY2soKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgb3B0cyA9IG1lLm9wdGlvbnMsCiAgICAgICAgICAgIGFjdCwKICAgICAgICAgICAgbmV4dCwKICAgICAgICAgICAgZG9uZSwKICAgICAgICAgICAgcHJlcGFyaW5nOyAvLyDlpoLmnpzlvZPliY3mlofku7bov5jmnInmsqHmnInpnIDopoHkvKDovpPnmoTvvIzliJnnm7TmjqXov5Tlm57liankuIvnmoTjgIIKCiAgICAgICAgaWYgKGFjdCA9IHRoaXMuX2dldFN0YWNrKCkpIHsKICAgICAgICAgIC8vIOaYr+WQpuaPkOWJjeWHhuWkh+S4i+S4gOS4quaWh+S7tgogICAgICAgICAgaWYgKG9wdHMucHJlcGFyZU5leHRGaWxlICYmICFtZS5wZW5kaW5nLmxlbmd0aCkgewogICAgICAgICAgICBtZS5fcHJlcGFyZU5leHRGaWxlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGFjdC5zaGlmdCgpOyAvLyDlkKbliJnvvIzlpoLmnpzmraPlnKjov5DooYzvvIzliJnlh4blpIfkuIvkuIDkuKrmlofku7bvvIzlubbnrYnlvoXlrozmiJDlkI7ov5Tlm57kuIvkuKrliIbniYfjgIIKICAgICAgICB9IGVsc2UgaWYgKG1lLnJ1bmluZykgewogICAgICAgICAgLy8g5aaC5p6c57yT5a2Y5Lit5pyJ77yM5YiZ55u05o6l5Zyo57yT5a2Y5Lit5Y+W77yM5rKh5pyJ5YiZ5Y67cXVldWXkuK3lj5bjgIIKICAgICAgICAgIGlmICghbWUucGVuZGluZy5sZW5ndGggJiYgbWUuX2dldFN0YXRzKCkubnVtT2ZRdWV1ZSkgewogICAgICAgICAgICBtZS5fcHJlcGFyZU5leHRGaWxlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgbmV4dCA9IG1lLnBlbmRpbmcuc2hpZnQoKTsKCiAgICAgICAgICBkb25lID0gZnVuY3Rpb24gZG9uZShmaWxlKSB7CiAgICAgICAgICAgIGlmICghZmlsZSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhY3QgPSBDdXRlRmlsZShmaWxlLCBvcHRzLmNodW5rZWQgPyBvcHRzLmNodW5rU2l6ZSA6IDApOwogICAgICAgICAgICBtZS5zdGFjay5wdXNoKGFjdCk7CiAgICAgICAgICAgIHJldHVybiBhY3Quc2hpZnQoKTsKICAgICAgICAgIH07IC8vIOaWh+S7tuWPr+iDvei/mOWcqHByZXBhcmXkuK3vvIzkuZ/mnInlj6/og73lt7Lnu4/lrozlhajlh4blpIflpb3kuobjgIIKCgogICAgICAgICAgaWYgKGlzUHJvbWlzZShuZXh0KSkgewogICAgICAgICAgICBwcmVwYXJpbmcgPSBuZXh0LmZpbGU7CiAgICAgICAgICAgIG5leHQgPSBuZXh0W25leHQucGlwZSA/ICdwaXBlJyA6ICd0aGVuJ10oZG9uZSk7CiAgICAgICAgICAgIG5leHQuZmlsZSA9IHByZXBhcmluZzsKICAgICAgICAgICAgcmV0dXJuIG5leHQ7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGRvbmUobmV4dCk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgLyoqCiAgICAgICAqIEBldmVudCB1cGxvYWRTdGFydAogICAgICAgKiBAcGFyYW0ge0ZpbGV9IGZpbGUgRmlsZeWvueixoQogICAgICAgKiBAZGVzY3JpcHRpb24g5p+Q5Liq5paH5Lu25byA5aeL5LiK5Lyg5YmN6Kem5Y+R77yM5LiA5Liq5paH5Lu25Y+q5Lya6Kem5Y+R5LiA5qyh44CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICBfcHJlcGFyZU5leHRGaWxlOiBmdW5jdGlvbiBfcHJlcGFyZU5leHRGaWxlKCkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIGZpbGUgPSBtZS5yZXF1ZXN0KCdmZXRjaC1maWxlJyksCiAgICAgICAgICAgIHBlbmRpbmcgPSBtZS5wZW5kaW5nLAogICAgICAgICAgICBwcm9taXNlOwoKICAgICAgICBpZiAoZmlsZSkgewogICAgICAgICAgcHJvbWlzZSA9IG1lLnJlcXVlc3QoJ2JlZm9yZS1zZW5kLWZpbGUnLCBmaWxlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIC8vIOacieWPr+iDveaWh+S7tuiiq3NraXDmjonkuobjgILmlofku7booqtza2lw5o6J5ZCO77yM54q25oCB5Z2R5a6a5LiN5pivUXVldWVkLgogICAgICAgICAgICBpZiAoZmlsZS5nZXRTdGF0dXMoKSA9PT0gU3RhdHVzLlBST0dSRVNTIHx8IGZpbGUuZ2V0U3RhdHVzKCkgPT09IFN0YXR1cy5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1lLl9maW5pc2hGaWxlKGZpbGUpOwogICAgICAgICAgfSk7CiAgICAgICAgICBtZS5vd25lci50cmlnZ2VyKCd1cGxvYWRTdGFydCcsIGZpbGUpOwogICAgICAgICAgZmlsZS5zZXRTdGF0dXMoU3RhdHVzLlBST0dSRVNTKTsKICAgICAgICAgIHByb21pc2UuZmlsZSA9IGZpbGU7IC8vIOWmguaenOi/mOWcqHBlbmRpbmfkuK3vvIzliJnmm7/mjaLmiJDmlofku7bmnKzouqvjgIIKCiAgICAgICAgICBwcm9taXNlLmRvbmUoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgaWR4ID0gJC5pbkFycmF5KHByb21pc2UsIHBlbmRpbmcpOwogICAgICAgICAgICB+aWR4ICYmIHBlbmRpbmcuc3BsaWNlKGlkeCwgMSwgZmlsZSk7CiAgICAgICAgICB9KTsgLy8gYmVmZW9yZS1zZW5kLWZpbGXnmoTpkqnlrZDlsLHmnInplJnor6/lj5HnlJ/jgIIKCiAgICAgICAgICBwcm9taXNlLmZhaWwoZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICBmaWxlLnNldFN0YXR1cyhTdGF0dXMuRVJST1IsIHJlYXNvbik7CiAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ3VwbG9hZEVycm9yJywgZmlsZSwgcmVhc29uKTsKICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlcigndXBsb2FkQ29tcGxldGUnLCBmaWxlKTsKICAgICAgICAgIH0pOwogICAgICAgICAgcGVuZGluZy5wdXNoKHByb21pc2UpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8g6K6p5Ye65L2N572u5LqG77yM5Y+v5Lul6K6p5YW25LuW5YiG54mH5byA5aeL5LiK5LygCiAgICAgIF9wb3BCbG9jazogZnVuY3Rpb24gX3BvcEJsb2NrKGJsb2NrKSB7CiAgICAgICAgdmFyIGlkeCA9ICQuaW5BcnJheShibG9jaywgdGhpcy5wb29sKTsKICAgICAgICB0aGlzLnBvb2wuc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgYmxvY2suZmlsZS5yZW1hbmluZy0tOwogICAgICAgIHRoaXMucmVtYW5pbmctLTsKICAgICAgfSwKICAgICAgLy8g5byA5aeL5LiK5Lyg77yM5Y+v5Lul6KKr5o6J6L+H44CC5aaC5p6ccHJvbWlzZeiiq3JlamVjdOS6hu+8jOWImeihqOekuui3s+i/h+atpOWIhueJh+OAggogICAgICBfc3RhcnRTZW5kOiBmdW5jdGlvbiBfc3RhcnRTZW5kKGJsb2NrKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgZmlsZSA9IGJsb2NrLmZpbGUsCiAgICAgICAgICAgIHByb21pc2U7IC8vIOacieWPr+iDveWcqCBiZWZvcmUtc2VuZC1maWxlIOeahCBwcm9taXNlIOacn+mXtOaUueWPmOS6huaWh+S7tueKtuaAgeOAggogICAgICAgIC8vIOWmgu+8muaaguWBnO+8jOWPlua2iAogICAgICAgIC8vIOaIkeS7rOS4jeiDveS4reaWrSBwcm9taXNlLCDkvYbmmK/lj6/ku6XlnKggcHJvbWlzZSDlrozlkI7vvIzkuI3lgZrkuIrkvKDmk43kvZzjgIIKCiAgICAgICAgaWYgKGZpbGUuZ2V0U3RhdHVzKCkgIT09IFN0YXR1cy5QUk9HUkVTUykgewogICAgICAgICAgLy8g5aaC5p6c5piv5Lit5pat77yM5YiZ6L+Y6ZyA6KaB5pS+5Zue5Y6744CCCiAgICAgICAgICBpZiAoZmlsZS5nZXRTdGF0dXMoKSA9PT0gU3RhdHVzLklOVEVSUlVQVCkgewogICAgICAgICAgICBtZS5fcHV0YmFjayhibG9jayk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWUucG9vbC5wdXNoKGJsb2NrKTsKICAgICAgICBtZS5yZW1hbmluZysrOyAvLyDlpoLmnpzmsqHmnInliIbniYfvvIzliJnnm7TmjqXkvb/nlKjljp/lp4vnmoTjgIIKICAgICAgICAvLyDkuI3kvJrkuKLlpLFjb250ZW50LXR5cGXkv6Hmga/jgIIKCiAgICAgICAgYmxvY2suYmxvYiA9IGJsb2NrLmNodW5rcyA9PT0gMSA/IGZpbGUuc291cmNlIDogZmlsZS5zb3VyY2Uuc2xpY2UoYmxvY2suc3RhcnQsIGJsb2NrLmVuZCk7IC8vIGhvb2ssIOavj+S4quWIhueJh+WPkemAgeS5i+WJjeWPr+iDveimgeWBmuS6m+W8guatpeeahOS6i+aDheOAggoKICAgICAgICBwcm9taXNlID0gbWUucmVxdWVzdCgnYmVmb3JlLXNlbmQnLCBibG9jaywgZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8g5pyJ5Y+v6IO95paH5Lu25bey57uP5LiK5Lyg5Ye66ZSZ5LqG77yM5omA5Lul5LiN6ZyA6KaB5YaN5Lyg6L6T5LqG44CCCiAgICAgICAgICBpZiAoZmlsZS5nZXRTdGF0dXMoKSA9PT0gU3RhdHVzLlBST0dSRVNTKSB7CiAgICAgICAgICAgIG1lLl9kb1NlbmQoYmxvY2spOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWUuX3BvcEJsb2NrKGJsb2NrKTsKCiAgICAgICAgICAgIEJhc2UubmV4dFRpY2sobWUuX190aWNrKTsKICAgICAgICAgIH0KICAgICAgICB9KTsgLy8g5aaC5p6c5Li6ZmFpbOS6hu+8jOWImei3s+i/h+atpOWIhueJh+OAggoKICAgICAgICBwcm9taXNlLmZhaWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGZpbGUucmVtYW5pbmcgPT09IDEpIHsKICAgICAgICAgICAgbWUuX2ZpbmlzaEZpbGUoZmlsZSkuYWx3YXlzKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBibG9jay5wZXJjZW50YWdlID0gMTsKCiAgICAgICAgICAgICAgbWUuX3BvcEJsb2NrKGJsb2NrKTsKCiAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlcigndXBsb2FkQ29tcGxldGUnLCBmaWxlKTsKICAgICAgICAgICAgICBCYXNlLm5leHRUaWNrKG1lLl9fdGljayk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmxvY2sucGVyY2VudGFnZSA9IDE7CiAgICAgICAgICAgIG1lLnVwZGF0ZUZpbGVQcm9ncmVzcyhmaWxlKTsKCiAgICAgICAgICAgIG1lLl9wb3BCbG9jayhibG9jayk7CgogICAgICAgICAgICBCYXNlLm5leHRUaWNrKG1lLl9fdGljayk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sCgogICAgICAvKioKICAgICAgICogQGV2ZW50IHVwbG9hZEJlZm9yZVNlbmQKICAgICAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSDpu5jorqTnmoTkuIrkvKDlj4LmlbDvvIzlj6/ku6XmianlsZXmraTlr7nosaHmnaXmjqfliLbkuIrkvKDlj4LmlbDjgIIKICAgICAgICogQHBhcmFtIHtPYmplY3R9IGhlYWRlcnMg5Y+v5Lul5omp5bGV5q2k5a+56LGh5p2l5o6n5Yi25LiK5Lyg5aS06YOo44CCCiAgICAgICAqIEBkZXNjcmlwdGlvbiDlvZPmn5DkuKrmlofku7bnmoTliIblnZflnKjlj5HpgIHliY3op6blj5HvvIzkuLvopoHnlKjmnaXor6Lpl67mmK/lkKbopoHmt7vliqDpmYTluKblj4LmlbDvvIzlpKfmlofku7blnKjlvIDotbfliIbniYfkuIrkvKDnmoTliY3mj5DkuIvmraTkuovku7blj6/og73kvJrop6blj5HlpJrmrKHjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQGV2ZW50IHVwbG9hZEFjY2VwdAogICAgICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0CiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXQg5pyN5Yqh56uv55qE6L+U5Zue5pWw5o2u77yManNvbuagvOW8j++8jOWmguaenOacjeWKoeerr+S4jeaYr2pzb27moLzlvI/vvIzku45yZXQuX3Jhd+S4reWPluaVsOaNru+8jOiHquihjOino+aekOOAggogICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5p+Q5Liq5paH5Lu25LiK5Lyg5Yiw5pyN5Yqh56uv5ZON5bqU5ZCO77yM5Lya5rS+6YCB5q2k5LqL5Lu25p2l6K+i6Zeu5pyN5Yqh56uv5ZON5bqU5piv5ZCm5pyJ5pWI44CC5aaC5p6c5q2k5LqL5Lu2aGFuZGxlcui/lOWbnuWAvOS4umBmYWxzZWAsIOWImeatpOaWh+S7tuWwhua0vumAgWBzZXJ2ZXJg57G75Z6L55qEYHVwbG9hZEVycm9yYOS6i+S7tuOAggogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgdXBsb2FkUHJvZ3Jlc3MKICAgICAgICogQHBhcmFtIHtGaWxlfSBmaWxlIEZpbGXlr7nosaEKICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IHBlcmNlbnRhZ2Ug5LiK5Lyg6L+b5bqmCiAgICAgICAqIEBkZXNjcmlwdGlvbiDkuIrkvKDov4fnqIvkuK3op6blj5HvvIzmkLrluKbkuIrkvKDov5vluqbjgIIKICAgICAgICogQGZvciAgVXBsb2FkZXIKICAgICAgICovCgogICAgICAvKioKICAgICAgICogQGV2ZW50IHVwbG9hZEVycm9yCiAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhCiAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSByZWFzb24g5Ye66ZSZ55qEY29kZQogICAgICAgKiBAZGVzY3JpcHRpb24g5b2T5paH5Lu25LiK5Lyg5Ye66ZSZ5pe26Kem5Y+R44CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwoKICAgICAgLyoqCiAgICAgICAqIEBldmVudCB1cGxvYWRTdWNjZXNzCiAgICAgICAqIEBwYXJhbSB7RmlsZX0gZmlsZSBGaWxl5a+56LGhCiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXNwb25zZSDmnI3liqHnq6/ov5Tlm57nmoTmlbDmja4KICAgICAgICogQGRlc2NyaXB0aW9uIOW9k+aWh+S7tuS4iuS8oOaIkOWKn+aXtuinpuWPkeOAggogICAgICAgKiBAZm9yICBVcGxvYWRlcgogICAgICAgKi8KCiAgICAgIC8qKgogICAgICAgKiBAZXZlbnQgdXBsb2FkQ29tcGxldGUKICAgICAgICogQHBhcmFtIHtGaWxlfSBbZmlsZV0gRmlsZeWvueixoQogICAgICAgKiBAZGVzY3JpcHRpb24g5LiN566h5oiQ5Yqf5oiW6ICF5aSx6LSl77yM5paH5Lu25LiK5Lyg5a6M5oiQ5pe26Kem5Y+R44CCCiAgICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgICAqLwogICAgICAvLyDlgZrkuIrkvKDmk43kvZzjgIIKICAgICAgX2RvU2VuZDogZnVuY3Rpb24gX2RvU2VuZChibG9jaykgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIG93bmVyID0gbWUub3duZXIsCiAgICAgICAgICAgIG9wdHMgPSAkLmV4dGVuZCh7fSwgbWUub3B0aW9ucywgYmxvY2sub3B0aW9ucyksCiAgICAgICAgICAgIGZpbGUgPSBibG9jay5maWxlLAogICAgICAgICAgICB0ciA9IG5ldyBUcmFuc3BvcnQob3B0cyksCiAgICAgICAgICAgIGRhdGEgPSAkLmV4dGVuZCh7fSwgb3B0cy5mb3JtRGF0YSksCiAgICAgICAgICAgIGhlYWRlcnMgPSAkLmV4dGVuZCh7fSwgb3B0cy5oZWFkZXJzKSwKICAgICAgICAgICAgcmVxdWVzdEFjY2VwdCwKICAgICAgICAgICAgcmV0OwogICAgICAgIGJsb2NrLnRyYW5zcG9ydCA9IHRyOwogICAgICAgIHRyLm9uKCdkZXN0cm95JywgZnVuY3Rpb24gKCkgewogICAgICAgICAgZGVsZXRlIGJsb2NrLnRyYW5zcG9ydDsKCiAgICAgICAgICBtZS5fcG9wQmxvY2soYmxvY2spOwoKICAgICAgICAgIEJhc2UubmV4dFRpY2sobWUuX190aWNrKTsKICAgICAgICB9KTsgLy8g5bm/5pKt5LiK5Lyg6L+b5bqm44CC5Lul5paH5Lu25Li65Y2V5L2N44CCCgogICAgICAgIHRyLm9uKCdwcm9ncmVzcycsIGZ1bmN0aW9uIChwZXJjZW50YWdlKSB7CiAgICAgICAgICBibG9jay5wZXJjZW50YWdlID0gcGVyY2VudGFnZTsKICAgICAgICAgIG1lLnVwZGF0ZUZpbGVQcm9ncmVzcyhmaWxlKTsKICAgICAgICB9KTsgLy8g55So5p2l6K+i6Zeu77yM5piv5ZCm6L+U5Zue55qE57uT5p6c5piv5pyJ6ZSZ6K+v55qE44CCCgogICAgICAgIHJlcXVlc3RBY2NlcHQgPSBmdW5jdGlvbiByZXF1ZXN0QWNjZXB0KHJlamVjdCkgewogICAgICAgICAgdmFyIGZuOwogICAgICAgICAgcmV0ID0gdHIuZ2V0UmVzcG9uc2VBc0pzb24oKSB8fCB7fTsKICAgICAgICAgIHJldC5fcmF3ID0gdHIuZ2V0UmVzcG9uc2UoKTsKICAgICAgICAgIHJldC5faGVhZGVycyA9IHRyLmdldFJlc3BvbnNlSGVhZGVycygpOwogICAgICAgICAgYmxvY2sucmVzcG9uc2UgPSByZXQ7CgogICAgICAgICAgZm4gPSBmdW5jdGlvbiBmbih2YWx1ZSkgewogICAgICAgICAgICByZWplY3QgPSB2YWx1ZTsKICAgICAgICAgIH07IC8vIOacjeWKoeerr+WTjeW6lOS6hu+8jOS4jeS7o+ihqOaIkOWKn+S6hu+8jOivoumXruaYr+WQpuWTjeW6lOato+ehruOAggoKCiAgICAgICAgICBpZiAoIW93bmVyLnRyaWdnZXIoJ3VwbG9hZEFjY2VwdCcsIGJsb2NrLCByZXQsIGZuKSkgewogICAgICAgICAgICByZWplY3QgPSByZWplY3QgfHwgJ3NlcnZlcic7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIHJlamVjdDsKICAgICAgICB9OyAvLyDlsJ3or5Xph43or5XvvIznhLblkI7lub/mkq3mlofku7bkuIrkvKDlh7rplJnjgIIKCgogICAgICAgIHRyLm9uKCdlcnJvcicsIGZ1bmN0aW9uICh0eXBlLCBmbGFnKSB7CiAgICAgICAgICBibG9jay5yZXRyaWVkID0gYmxvY2sucmV0cmllZCB8fCAwOyAvLyDoh6rliqjph43or5UKCiAgICAgICAgICBpZiAoYmxvY2suY2h1bmtzID4gMSAmJiB+J2h0dHAsYWJvcnQnLmluZGV4T2YodHlwZSkgJiYgYmxvY2sucmV0cmllZCA8IG9wdHMuY2h1bmtSZXRyeSkgewogICAgICAgICAgICBibG9jay5yZXRyaWVkKys7CiAgICAgICAgICAgIHRyLnNlbmQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGh0dHAgc3RhdHVzIDUwMCB+IDYwMAogICAgICAgICAgICBpZiAoIWZsYWcgJiYgdHlwZSA9PT0gJ3NlcnZlcicpIHsKICAgICAgICAgICAgICB0eXBlID0gcmVxdWVzdEFjY2VwdCh0eXBlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoU3RhdHVzLkVSUk9SLCB0eXBlKTsKICAgICAgICAgICAgb3duZXIudHJpZ2dlcigndXBsb2FkRXJyb3InLCBmaWxlLCB0eXBlKTsKICAgICAgICAgICAgb3duZXIudHJpZ2dlcigndXBsb2FkQ29tcGxldGUnLCBmaWxlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsgLy8g5LiK5Lyg5oiQ5YqfCgogICAgICAgIHRyLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHJlYXNvbjsgLy8g5aaC5p6c6Z2e6aKE5pyf77yM6L2s5ZCR5LiK5Lyg5Ye66ZSZ44CCCgogICAgICAgICAgaWYgKHJlYXNvbiA9IHJlcXVlc3RBY2NlcHQoKSkgewogICAgICAgICAgICB0ci50cmlnZ2VyKCdlcnJvcicsIHJlYXNvbiwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8g5YWo6YOo5LiK5Lyg5a6M5oiQ44CCCgoKICAgICAgICAgIGlmIChmaWxlLnJlbWFuaW5nID09PSAxKSB7CiAgICAgICAgICAgIG1lLl9maW5pc2hGaWxlKGZpbGUsIHJldCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ci5kZXN0cm95KCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7IC8vIOmFjee9rum7mOiupOeahOS4iuS8oOWtl+auteOAggoKICAgICAgICBkYXRhID0gJC5leHRlbmQoZGF0YSwgewogICAgICAgICAgaWQ6IGZpbGUuaWQsCiAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsCiAgICAgICAgICBsYXN0TW9kaWZpZWREYXRlOiBmaWxlLmxhc3RNb2RpZmllZERhdGUsCiAgICAgICAgICBzaXplOiBmaWxlLnNpemUKICAgICAgICB9KTsKICAgICAgICBibG9jay5jaHVua3MgPiAxICYmICQuZXh0ZW5kKGRhdGEsIHsKICAgICAgICAgIGNodW5rczogYmxvY2suY2h1bmtzLAogICAgICAgICAgY2h1bms6IGJsb2NrLmNodW5rCiAgICAgICAgfSk7IC8vIOWcqOWPkemAgeS5i+mXtOWPr+S7pea3u+WKoOWtl+auteS7gOS5iOeahOOAguOAguOAggogICAgICAgIC8vIOWmguaenOm7mOiupOeahOWtl+auteS4jeWkn+S9v+eUqO+8jOWPr+S7pemAmui/h+ebkeWQrOatpOS6i+S7tuadpeaJqeWxlQoKICAgICAgICBvd25lci50cmlnZ2VyKCd1cGxvYWRCZWZvcmVTZW5kJywgYmxvY2ssIGRhdGEsIGhlYWRlcnMpOyAvLyDlvIDlp4vlj5HpgIHjgIIKCiAgICAgICAgdHIuYXBwZW5kQmxvYihvcHRzLmZpbGVWYWwsIGJsb2NrLmJsb2IsIGZpbGUubmFtZSk7CiAgICAgICAgdHIuYXBwZW5kKGRhdGEpOwogICAgICAgIHRyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVycyk7CiAgICAgICAgdHIuc2VuZCgpOwogICAgICB9LAogICAgICAvLyDlrozmiJDkuIrkvKDjgIIKICAgICAgX2ZpbmlzaEZpbGU6IGZ1bmN0aW9uIF9maW5pc2hGaWxlKGZpbGUsIHJldCwgaGRzKSB7CiAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lcjsKICAgICAgICByZXR1cm4gb3duZXIucmVxdWVzdCgnYWZ0ZXItc2VuZC1maWxlJywgYXJndW1lbnRzLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBmaWxlLnNldFN0YXR1cyhTdGF0dXMuQ09NUExFVEUpOwogICAgICAgICAgb3duZXIudHJpZ2dlcigndXBsb2FkU3VjY2VzcycsIGZpbGUsIHJldCwgaGRzKTsKICAgICAgICB9KS5mYWlsKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIC8vIOWmguaenOWklumDqOW3sue7j+agh+iusOS4umludmFsaWTku4DkuYjnmoTvvIzkuI3lho3mlLnnirbmgIHjgIIKICAgICAgICAgIGlmIChmaWxlLmdldFN0YXR1cygpID09PSBTdGF0dXMuUFJPR1JFU1MpIHsKICAgICAgICAgICAgZmlsZS5zZXRTdGF0dXMoU3RhdHVzLkVSUk9SLCByZWFzb24pOwogICAgICAgICAgfQoKICAgICAgICAgIG93bmVyLnRyaWdnZXIoJ3VwbG9hZEVycm9yJywgZmlsZSwgcmVhc29uKTsKICAgICAgICB9KS5hbHdheXMoZnVuY3Rpb24gKCkgewogICAgICAgICAgb3duZXIudHJpZ2dlcigndXBsb2FkQ29tcGxldGUnLCBmaWxlKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgdXBkYXRlRmlsZVByb2dyZXNzOiBmdW5jdGlvbiB1cGRhdGVGaWxlUHJvZ3Jlc3MoZmlsZSkgewogICAgICAgIHZhciB0b3RhbFBlcmNlbnQgPSAwLAogICAgICAgICAgICB1cGxvYWRlZCA9IDA7CgogICAgICAgIGlmICghZmlsZS5ibG9ja3MpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgICQuZWFjaChmaWxlLmJsb2NrcywgZnVuY3Rpb24gKF8sIHYpIHsKICAgICAgICAgIHVwbG9hZGVkICs9ICh2LnBlcmNlbnRhZ2UgfHwgMCkgKiAodi5lbmQgLSB2LnN0YXJ0KTsKICAgICAgICB9KTsKICAgICAgICB0b3RhbFBlcmNlbnQgPSB1cGxvYWRlZCAvIGZpbGUuc2l6ZTsKICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoJ3VwbG9hZFByb2dyZXNzJywgZmlsZSwgdG90YWxQZXJjZW50IHx8IDApOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IOWQhOenjemqjOivge+8jOWMheaLrOaWh+S7tuaAu+Wkp+Wwj+aYr+WQpui2heWHuuOAgeWNleaWh+S7tuaYr+WQpui2heWHuuWSjOaWh+S7tuaYr+WQpumHjeWkjeOAggogICAqLwoKICBkZWZpbmUoJ3dpZGdldHMvdmFsaWRhdG9yJywgWydiYXNlJywgJ3VwbG9hZGVyJywgJ2ZpbGUnLCAnd2lkZ2V0cy93aWRnZXQnXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyLCBXVUZpbGUpIHsKICAgIHZhciAkID0gQmFzZS4kLAogICAgICAgIHZhbGlkYXRvcnMgPSB7fSwKICAgICAgICBhcGk7CiAgICAvKioKICAgICAqIEBldmVudCBlcnJvcgogICAgICogQHBhcmFtIHtTdHJpbmd9IHR5cGUg6ZSZ6K+v57G75Z6L44CCCiAgICAgKiBAZGVzY3JpcHRpb24g5b2TdmFsaWRhdGXkuI3pgJrov4fml7bvvIzkvJrku6XmtL7pgIHplJnor6/kuovku7bnmoTlvaLlvI/pgJrnn6XosIPnlKjogIXjgILpgJrov4dgdXBsb2FkLm9uKCdlcnJvcicsIGhhbmRsZXIpYOWPr+S7peaNleiOt+WIsOatpOexu+mUmeivr++8jOebruWJjeacieS7peS4i+mUmeivr+S8muWcqOeJueWumueahOaDheWGteS4i+a0vumAgemUmeadpeOAggogICAgICoKICAgICAqICogYFFfRVhDRUVEX05VTV9MSU1JVGAg5Zyo6K6+572u5LqGYGZpbGVOdW1MaW1pdGDkuJTlsJ3or5Xnu5lgdXBsb2FkZXJg5re75Yqg55qE5paH5Lu25pWw6YeP6LaF5Ye66L+Z5Liq5YC85pe25rS+6YCB44CCCiAgICAgKiAqIGBRX0VYQ0VFRF9TSVpFX0xJTUlUYCDlnKjorr7nva7kuoZgUV9FWENFRURfU0laRV9MSU1JVGDkuJTlsJ3or5Xnu5lgdXBsb2FkZXJg5re75Yqg55qE5paH5Lu25oC75aSn5bCP6LaF5Ye66L+Z5Liq5YC85pe25rS+6YCB44CCCiAgICAgKiAqIGBRX1RZUEVfREVOSUVEYCDlvZPmlofku7bnsbvlnovkuI3mu6HotrPml7bop6blj5HjgILjgIIKICAgICAqIEBmb3IgIFVwbG9hZGVyCiAgICAgKi8KICAgIC8vIOaatOmcsue7meWklumdoueahGFwaQoKICAgIGFwaSA9IHsKICAgICAgLy8g5re75Yqg6aqM6K+B5ZmoCiAgICAgIGFkZFZhbGlkYXRvcjogZnVuY3Rpb24gYWRkVmFsaWRhdG9yKHR5cGUsIGNiKSB7CiAgICAgICAgdmFsaWRhdG9yc1t0eXBlXSA9IGNiOwogICAgICB9LAogICAgICAvLyDnp7vpmaTpqozor4HlmagKICAgICAgcmVtb3ZlVmFsaWRhdG9yOiBmdW5jdGlvbiByZW1vdmVWYWxpZGF0b3IodHlwZSkgewogICAgICAgIGRlbGV0ZSB2YWxpZGF0b3JzW3R5cGVdOwogICAgICB9CiAgICB9OyAvLyDlnKhVcGxvYWRlcuWIneWni+WMlueahOaXtuWAmeWQr+WKqFZhbGlkYXRvcnPnmoTliJ3lp4vljJYKCiAgICBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICd2YWxpZGF0b3InLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgQmFzZS5uZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkLmVhY2godmFsaWRhdG9ycywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmNhbGwobWUub3duZXIpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgLyoqCiAgICAgKiBAcHJvcGVydHkge2ludH0gW2ZpbGVOdW1MaW1pdD11bmRlZmluZWRdCiAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAqIEBkZXNjcmlwdGlvbiDpqozor4Hmlofku7bmgLvmlbDph48sIOi2heWHuuWImeS4jeWFgeiuuOWKoOWFpemYn+WIl+OAggogICAgICovCgogICAgYXBpLmFkZFZhbGlkYXRvcignZmlsZU51bUxpbWl0JywgZnVuY3Rpb24gKCkgewogICAgICB2YXIgdXBsb2FkZXIgPSB0aGlzLAogICAgICAgICAgb3B0cyA9IHVwbG9hZGVyLm9wdGlvbnMsCiAgICAgICAgICBjb3VudCA9IDAsCiAgICAgICAgICBtYXggPSBwYXJzZUludChvcHRzLmZpbGVOdW1MaW1pdCwgMTApLAogICAgICAgICAgZmxhZyA9IHRydWU7CgogICAgICBpZiAoIW1heCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdXBsb2FkZXIub24oJ2JlZm9yZUZpbGVRdWV1ZWQnLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgIC8vIOWinuWKoGJlZm9yZUZpbGVRdWV1ZWRDaGVja2ZpbGVOdW1MaW1pdOmqjOivgSzkuLvopoHkuLrkuoblho3mrKHliqDovb3ml7Yo5bey5a2Y5Zyo5Y6G5Y+y5paH5Lu2KemqjOivgeaVsOmHj+aYr+WQpui2hei/h+iuvue9rumhuQogICAgICAgIGlmICghdGhpcy50cmlnZ2VyKCdiZWZvcmVGaWxlUXVldWVkQ2hlY2tmaWxlTnVtTGltaXQnLCBmaWxlLCBjb3VudCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChjb3VudCA+PSBtYXggJiYgZmxhZykgewogICAgICAgICAgZmxhZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy50cmlnZ2VyKCdlcnJvcicsICdRX0VYQ0VFRF9OVU1fTElNSVQnLCBtYXgsIGZpbGUpOwogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZsYWcgPSB0cnVlOwogICAgICAgICAgfSwgMSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY291bnQgPj0gbWF4ID8gZmFsc2UgOiB0cnVlOwogICAgICB9KTsKICAgICAgdXBsb2FkZXIub24oJ2ZpbGVRdWV1ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgY291bnQrKzsKICAgICAgfSk7CiAgICAgIHVwbG9hZGVyLm9uKCdmaWxlRGVxdWV1ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgY291bnQtLTsKICAgICAgfSk7CiAgICAgIHVwbG9hZGVyLm9uKCdyZXNldCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBjb3VudCA9IDA7CiAgICAgIH0pOwogICAgfSk7CiAgICAvKioKICAgICAqIEBwcm9wZXJ0eSB7aW50fSBbZmlsZVNpemVMaW1pdD11bmRlZmluZWRdCiAgICAgKiBAbmFtZXNwYWNlIG9wdGlvbnMKICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAqIEBkZXNjcmlwdGlvbiDpqozor4Hmlofku7bmgLvlpKflsI/mmK/lkKbotoXlh7rpmZDliLYsIOi2heWHuuWImeS4jeWFgeiuuOWKoOWFpemYn+WIl+OAggogICAgICovCgogICAgYXBpLmFkZFZhbGlkYXRvcignZmlsZVNpemVMaW1pdCcsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcywKICAgICAgICAgIG9wdHMgPSB1cGxvYWRlci5vcHRpb25zLAogICAgICAgICAgY291bnQgPSAwLAogICAgICAgICAgbWF4ID0gcGFyc2VJbnQob3B0cy5maWxlU2l6ZUxpbWl0LCAxMCksCiAgICAgICAgICBmbGFnID0gdHJ1ZTsKCiAgICAgIGlmICghbWF4KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB1cGxvYWRlci5vbignYmVmb3JlRmlsZVF1ZXVlZCcsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgdmFyIGludmFsaWQgPSBjb3VudCArIGZpbGUuc2l6ZSA+IG1heDsKCiAgICAgICAgaWYgKGludmFsaWQgJiYgZmxhZykgewogICAgICAgICAgZmxhZyA9IGZhbHNlOwogICAgICAgICAgdGhpcy50cmlnZ2VyKCdlcnJvcicsICdRX0VYQ0VFRF9TSVpFX0xJTUlUJywgbWF4LCBmaWxlKTsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgICAgIH0sIDEpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGludmFsaWQgPyBmYWxzZSA6IHRydWU7CiAgICAgIH0pOwogICAgICB1cGxvYWRlci5vbignZmlsZVF1ZXVlZCcsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgY291bnQgKz0gZmlsZS5zaXplOwogICAgICB9KTsKICAgICAgdXBsb2FkZXIub24oJ2ZpbGVEZXF1ZXVlZCcsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgY291bnQgLT0gZmlsZS5zaXplOwogICAgICB9KTsKICAgICAgdXBsb2FkZXIub24oJ3Jlc2V0JywgZnVuY3Rpb24gKCkgewogICAgICAgIGNvdW50ID0gMDsKICAgICAgfSk7CiAgICB9KTsKICAgIC8qKgogICAgICogQHByb3BlcnR5IHtpbnR9IFtmaWxlU2luZ2xlU2l6ZUxpbWl0PXVuZGVmaW5lZF0KICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICogQGZvciBVcGxvYWRlcgogICAgICogQGRlc2NyaXB0aW9uIOmqjOivgeWNleS4quaWh+S7tuWkp+Wwj+aYr+WQpui2heWHuumZkOWItiwg6LaF5Ye65YiZ5LiN5YWB6K645Yqg5YWl6Zif5YiX44CCCiAgICAgKi8KCiAgICBhcGkuYWRkVmFsaWRhdG9yKCdmaWxlU2luZ2xlU2l6ZUxpbWl0JywgZnVuY3Rpb24gKCkgewogICAgICB2YXIgdXBsb2FkZXIgPSB0aGlzLAogICAgICAgICAgb3B0cyA9IHVwbG9hZGVyLm9wdGlvbnMsCiAgICAgICAgICBtYXggPSBvcHRzLmZpbGVTaW5nbGVTaXplTGltaXQ7CgogICAgICBpZiAoIW1heCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdXBsb2FkZXIub24oJ2JlZm9yZUZpbGVRdWV1ZWQnLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgIGlmIChmaWxlLnNpemUgPiBtYXgpIHsKICAgICAgICAgIGZpbGUuc2V0U3RhdHVzKFdVRmlsZS5TdGF0dXMuSU5WQUxJRCwgJ2V4Y2VlZF9zaXplJyk7CiAgICAgICAgICB0aGlzLnRyaWdnZXIoJ2Vycm9yJywgJ0ZfRVhDRUVEX1NJWkUnLCBtYXgsIGZpbGUpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIC8qKgogICAgICogQHByb3BlcnR5IHtCb29sZWFufSBbZHVwbGljYXRlPXVuZGVmaW5lZF0KICAgICAqIEBuYW1lc3BhY2Ugb3B0aW9ucwogICAgICogQGZvciBVcGxvYWRlcgogICAgICogQGRlc2NyaXB0aW9uIOWOu+mHje+8jCDmoLnmja7mlofku7blkI3lrZfjgIHmlofku7blpKflsI/lkozmnIDlkI7kv67mlLnml7bpl7TmnaXnlJ/miJBoYXNoIEtleS4KICAgICAqLwoKICAgIGFwaS5hZGRWYWxpZGF0b3IoJ2R1cGxpY2F0ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHVwbG9hZGVyID0gdGhpcywKICAgICAgICAgIG9wdHMgPSB1cGxvYWRlci5vcHRpb25zLAogICAgICAgICAgbWFwcGluZyA9IHt9OwoKICAgICAgaWYgKG9wdHMuZHVwbGljYXRlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmdW5jdGlvbiBoYXNoU3RyaW5nKHN0cikgewogICAgICAgIHZhciBoYXNoID0gMCwKICAgICAgICAgICAgaSA9IDAsCiAgICAgICAgICAgIGxlbiA9IHN0ci5sZW5ndGgsCiAgICAgICAgICAgIF9jaGFyOwoKICAgICAgICBmb3IgKDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBfY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgICAgaGFzaCA9IF9jaGFyICsgKGhhc2ggPDwgNikgKyAoaGFzaCA8PCAxNikgLSBoYXNoOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGhhc2g7CiAgICAgIH0KCiAgICAgIHVwbG9hZGVyLm9uKCdiZWZvcmVGaWxlUXVldWVkJywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICB2YXIgaGFzaCA9IGZpbGUuX19oYXNoIHx8IChmaWxlLl9faGFzaCA9IGhhc2hTdHJpbmcoZmlsZS5uYW1lICsgZmlsZS5zaXplICsgZmlsZS5sYXN0TW9kaWZpZWREYXRlKSk7IC8vIOW3sue7j+mHjeWkjeS6hgoKICAgICAgICBpZiAobWFwcGluZ1toYXNoXSkgewogICAgICAgICAgdGhpcy50cmlnZ2VyKCdlcnJvcicsICdGX0RVUExJQ0FURScsIGZpbGUpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHVwbG9hZGVyLm9uKCdmaWxlUXVldWVkJywgZnVuY3Rpb24gKGZpbGUpIHsKICAgICAgICB2YXIgaGFzaCA9IGZpbGUuX19oYXNoOwogICAgICAgIGhhc2ggJiYgKG1hcHBpbmdbaGFzaF0gPSB0cnVlKTsKICAgICAgfSk7CiAgICAgIHVwbG9hZGVyLm9uKCdmaWxlRGVxdWV1ZWQnLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgIHZhciBoYXNoID0gZmlsZS5fX2hhc2g7CiAgICAgICAgaGFzaCAmJiBkZWxldGUgbWFwcGluZ1toYXNoXTsKICAgICAgfSk7CiAgICAgIHVwbG9hZGVyLm9uKCdyZXNldCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBtYXBwaW5nID0ge307CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gYXBpOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgTWQ1CiAgICovCgogIGRlZmluZSgnbGliL21kNScsIFsncnVudGltZS9jbGllbnQnLCAnbWVkaWF0b3InXSwgZnVuY3Rpb24gKFJ1bnRpbWVDbGllbnQsIE1lZGlhdG9yKSB7CiAgICBmdW5jdGlvbiBNZDUoKSB7CiAgICAgIFJ1bnRpbWVDbGllbnQuY2FsbCh0aGlzLCAnTWQ1Jyk7CiAgICB9IC8vIOiuqSBNZDUg5YW35aSH5LqL5Lu25Yqf6IO944CCCgoKICAgIE1lZGlhdG9yLmluc3RhbGxUbyhNZDUucHJvdG90eXBlKTsKCiAgICBNZDUucHJvdG90eXBlLmxvYWRGcm9tQmxvYiA9IGZ1bmN0aW9uIChibG9iKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuZ2V0UnVpZCgpKSB7CiAgICAgICAgbWUuZGlzY29ubmVjdFJ1bnRpbWUoKTsKICAgICAgfSAvLyDov57mjqXliLBibG9i5b2S5bGe55qE5ZCM5LiA5LiqcnVudGltZS4KCgogICAgICBtZS5jb25uZWN0UnVudGltZShibG9iLnJ1aWQsIGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS5leGVjKCdpbml0Jyk7CiAgICAgICAgbWUuZXhlYygnbG9hZEZyb21CbG9iJywgYmxvYik7CiAgICAgIH0pOwogICAgfTsKCiAgICBNZDUucHJvdG90eXBlLmdldFJlc3VsdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZXhlYygnZ2V0UmVzdWx0Jyk7CiAgICB9OwoKICAgIHJldHVybiBNZDU7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDlm77niYfmk43kvZwsIOi0n+i0o+mihOiniOWbvueJh+WSjOS4iuS8oOWJjeWOi+e8qeWbvueJhwogICAqLwoKICBkZWZpbmUoJ3dpZGdldHMvbWQ1JywgWydiYXNlJywgJ3VwbG9hZGVyJywgJ2xpYi9tZDUnLCAnbGliL2Jsb2InLCAnd2lkZ2V0cy93aWRnZXQnXSwgZnVuY3Rpb24gKEJhc2UsIFVwbG9hZGVyLCBNZDUsIEJsb2IpIHsKICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICdtZDUnLAoKICAgICAgLyoqCiAgICAgICAqIOiuoeeul+aWh+S7tiBtZDUg5YC877yM6L+U5Zue5LiA5LiqIHByb21pc2Ug5a+56LGh77yM5Y+v5Lul55uR5ZCsIHByb2dyZXNzIOi/m+W6puOAggogICAgICAgKgogICAgICAgKgogICAgICAgKiBAbWV0aG9kIG1kNUZpbGUKICAgICAgICogQGdyYW1tYXIgbWQ1RmlsZSggZmlsZVssIHN0YXJ0WywgZW5kXV0gKSA9PiBwcm9taXNlCiAgICAgICAqIEBmb3IgVXBsb2FkZXIKICAgICAgICogQGV4YW1wbGUKICAgICAgICoKICAgICAgICogdXBsb2FkZXIub24oICdmaWxlUXVldWVkJywgZnVuY3Rpb24oIGZpbGUgKSB7CiAgICAgICAqICAgICB2YXIgJGxpID0gLi4uOwogICAgICAgKgogICAgICAgKiAgICAgdXBsb2FkZXIubWQ1RmlsZSggZmlsZSApCiAgICAgICAqCiAgICAgICAqICAgICAgICAgLy8g5Y+K5pe25pi+56S66L+b5bqmCiAgICAgICAqICAgICAgICAgLnByb2dyZXNzKGZ1bmN0aW9uKHBlcmNlbnRhZ2UpIHsKICAgICAgICogICAgICAgICAgICAgY29uc29sZS5sb2coJ1BlcmNlbnRhZ2U6JywgcGVyY2VudGFnZSk7CiAgICAgICAqICAgICAgICAgfSkKICAgICAgICoKICAgICAgICogICAgICAgICAvLyDlrozmiJAKICAgICAgICogICAgICAgICAudGhlbihmdW5jdGlvbih2YWwpIHsKICAgICAgICogICAgICAgICAgICAgY29uc29sZS5sb2coJ21kNSByZXN1bHQ6JywgdmFsKTsKICAgICAgICogICAgICAgICB9KTsKICAgICAgICoKICAgICAgICogfSk7CiAgICAgICAqLwogICAgICBtZDVGaWxlOiBmdW5jdGlvbiBtZDVGaWxlKGZpbGUsIHN0YXJ0LCBlbmQpIHsKICAgICAgICB2YXIgbWQ1ID0gbmV3IE1kNSgpLAogICAgICAgICAgICBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKSwKICAgICAgICAgICAgYmxvYiA9IGZpbGUgaW5zdGFuY2VvZiBCbG9iID8gZmlsZSA6IHRoaXMucmVxdWVzdCgnZ2V0LWZpbGUnLCBmaWxlKS5zb3VyY2U7CiAgICAgICAgbWQ1Lm9uKCdwcm9ncmVzcyBsb2FkJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGUgPSBlIHx8IHt9OwogICAgICAgICAgZGVmZXJyZWQubm90aWZ5KGUudG90YWwgPyBlLmxvYWRlZCAvIGUudG90YWwgOiAxKTsKICAgICAgICB9KTsKICAgICAgICBtZDUub24oJ2NvbXBsZXRlJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShtZDUuZ2V0UmVzdWx0KCkpOwogICAgICAgIH0pOwogICAgICAgIG1kNS5vbignZXJyb3InLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBzdGFydCA9IHN0YXJ0IHx8IDA7CiAgICAgICAgICBlbmQgPSBlbmQgfHwgMDsKICAgICAgICAgIHN0YXJ0IDwgMCAmJiAoc3RhcnQgPSBibG9iLnNpemUgKyBzdGFydCk7CiAgICAgICAgICBlbmQgPCAwICYmIChlbmQgPSBibG9iLnNpemUgKyBlbmQpOwogICAgICAgICAgZW5kID0gTWF0aC5taW4oZW5kLCBibG9iLnNpemUpOwogICAgICAgICAgYmxvYiA9IGJsb2Iuc2xpY2Uoc3RhcnQsIGVuZCk7CiAgICAgICAgfQoKICAgICAgICBtZDUubG9hZEZyb21CbG9iKGJsb2IpOwogICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgUnVudGltZeeuoeeQhuWZqO+8jOi0n+i0o1J1bnRpbWXnmoTpgInmi6ksIOi/nuaOpQogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvY29tcGJhc2UnLCBbXSwgZnVuY3Rpb24gKCkgewogICAgZnVuY3Rpb24gQ29tcEJhc2Uob3duZXIsIHJ1bnRpbWUpIHsKICAgICAgdGhpcy5vd25lciA9IG93bmVyOwogICAgICB0aGlzLm9wdGlvbnMgPSBvd25lci5vcHRpb25zOwoKICAgICAgdGhpcy5nZXRSdW50aW1lID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBydW50aW1lOwogICAgICB9OwoKICAgICAgdGhpcy5nZXRSdWlkID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBydW50aW1lLnVpZDsKICAgICAgfTsKCiAgICAgIHRoaXMudHJpZ2dlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gb3duZXIudHJpZ2dlci5hcHBseShvd25lciwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gQ29tcEJhc2U7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyBIdG1sNVJ1bnRpbWUKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2h0bWw1L3J1bnRpbWUnLCBbJ2Jhc2UnLCAncnVudGltZS9ydW50aW1lJywgJ3J1bnRpbWUvY29tcGJhc2UnXSwgZnVuY3Rpb24gKEJhc2UsIFJ1bnRpbWUsIENvbXBCYXNlKSB7CiAgICB2YXIgdHlwZSA9ICdodG1sNScsCiAgICAgICAgY29tcG9uZW50cyA9IHt9OwoKICAgIGZ1bmN0aW9uIEh0bWw1UnVudGltZSgpIHsKICAgICAgdmFyIHBvb2wgPSB7fSwKICAgICAgICAgIG1lID0gdGhpcywKICAgICAgICAgIGRlc3Ryb3kgPSB0aGlzLmRlc3Ryb3k7CiAgICAgIFJ1bnRpbWUuYXBwbHkobWUsIGFyZ3VtZW50cyk7CiAgICAgIG1lLnR5cGUgPSB0eXBlOyAvLyDov5nkuKrmlrnms5XnmoTosIPnlKjogIXvvIzlrp7pmYXkuIrmmK9SdW50aW1lQ2xpZW50CgogICAgICBtZS5leGVjID0gZnVuY3Rpb24gKGNvbXAsIGZuCiAgICAgIC8qLCBhcmdzLi4uKi8KICAgICAgKSB7CiAgICAgICAgdmFyIGNsaWVudCA9IHRoaXMsCiAgICAgICAgICAgIHVpZCA9IGNsaWVudC51aWQsCiAgICAgICAgICAgIGFyZ3MgPSBCYXNlLnNsaWNlKGFyZ3VtZW50cywgMiksCiAgICAgICAgICAgIGluc3RhbmNlOwoKICAgICAgICBpZiAoY29tcG9uZW50c1tjb21wXSkgewogICAgICAgICAgaW5zdGFuY2UgPSBwb29sW3VpZF0gPSBwb29sW3VpZF0gfHwgbmV3IGNvbXBvbmVudHNbY29tcF0oY2xpZW50LCBtZSk7CgogICAgICAgICAgaWYgKGluc3RhbmNlW2ZuXSkgewogICAgICAgICAgICByZXR1cm4gaW5zdGFuY2VbZm5dLmFwcGx5KGluc3RhbmNlLCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBtZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewogICAgICAgIC8vIEB0b2RvIOWIoOmZpOaxoOWtkOS4reeahOaJgOacieWunuS+iwogICAgICAgIHJldHVybiBkZXN0cm95ICYmIGRlc3Ryb3kuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0KCiAgICBCYXNlLmluaGVyaXRzKFJ1bnRpbWUsIHsKICAgICAgY29uc3RydWN0b3I6IEh0bWw1UnVudGltZSwKICAgICAgLy8g5LiN6ZyA6KaB6L+e5o6l5YW25LuW56iL5bqP77yM55u05o6l5omn6KGMY2FsbGJhY2sKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUudHJpZ2dlcigncmVhZHknKTsKICAgICAgICB9LCAxKTsKICAgICAgfQogICAgfSk7IC8vIOazqOWGjENvbXBvbmVudHMKCiAgICBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIgPSBmdW5jdGlvbiAobmFtZSwgY29tcG9uZW50KSB7CiAgICAgIHZhciBrbGFzcyA9IGNvbXBvbmVudHNbbmFtZV0gPSBCYXNlLmluaGVyaXRzKENvbXBCYXNlLCBjb21wb25lbnQpOwogICAgICByZXR1cm4ga2xhc3M7CiAgICB9OyAvLyDms6jlhoxodG1sNei/kOihjOaXtuOAggogICAgLy8g5Y+q5pyJ5Zyo5pSv5oyB55qE5YmN5o+Q5LiL5rOo5YaM44CCCgoKICAgIGlmICh3aW5kb3cuQmxvYiAmJiB3aW5kb3cuRmlsZVJlYWRlciAmJiB3aW5kb3cuRGF0YVZpZXcpIHsKICAgICAgUnVudGltZS5hZGRSdW50aW1lKHR5cGUsIEh0bWw1UnVudGltZSk7CiAgICB9CgogICAgcmV0dXJuIEh0bWw1UnVudGltZTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEJsb2IgSHRtbOWunueOsAogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvYmxvYicsIFsncnVudGltZS9odG1sNS9ydW50aW1lJywgJ2xpYi9ibG9iJ10sIGZ1bmN0aW9uIChIdG1sNVJ1bnRpbWUsIEJsb2IpIHsKICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoJ0Jsb2InLCB7CiAgICAgIHNsaWNlOiBmdW5jdGlvbiBzbGljZShzdGFydCwgZW5kKSB7CiAgICAgICAgdmFyIGJsb2IgPSB0aGlzLm93bmVyLnNvdXJjZSwKICAgICAgICAgICAgc2xpY2UgPSBibG9iLnNsaWNlIHx8IGJsb2Iud2Via2l0U2xpY2UgfHwgYmxvYi5tb3pTbGljZTsKICAgICAgICBibG9iID0gc2xpY2UuY2FsbChibG9iLCBzdGFydCwgZW5kKTsKICAgICAgICByZXR1cm4gbmV3IEJsb2IodGhpcy5nZXRSdWlkKCksIGJsb2IpOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEZpbGVQYXN0ZQogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvZG5kJywgWydiYXNlJywgJ3J1bnRpbWUvaHRtbDUvcnVudGltZScsICdsaWIvZmlsZSddLCBmdW5jdGlvbiAoQmFzZSwgSHRtbDVSdW50aW1lLCBGaWxlKSB7CiAgICB2YXIgJCA9IEJhc2UuJCwKICAgICAgICBwcmVmaXggPSAnd2VidXBsb2FkZXItZG5kLSc7CiAgICByZXR1cm4gSHRtbDVSdW50aW1lLnJlZ2lzdGVyKCdEcmFnQW5kRHJvcCcsIHsKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgZWxlbSA9IHRoaXMuZWxlbSA9IHRoaXMub3B0aW9ucy5jb250YWluZXI7CiAgICAgICAgdGhpcy5kcmFnRW50ZXJIYW5kbGVyID0gQmFzZS5iaW5kRm4odGhpcy5fZHJhZ0VudGVySGFuZGxlciwgdGhpcyk7CiAgICAgICAgdGhpcy5kcmFnT3ZlckhhbmRsZXIgPSBCYXNlLmJpbmRGbih0aGlzLl9kcmFnT3ZlckhhbmRsZXIsIHRoaXMpOwogICAgICAgIHRoaXMuZHJhZ0xlYXZlSGFuZGxlciA9IEJhc2UuYmluZEZuKHRoaXMuX2RyYWdMZWF2ZUhhbmRsZXIsIHRoaXMpOwogICAgICAgIHRoaXMuZHJvcEhhbmRsZXIgPSBCYXNlLmJpbmRGbih0aGlzLl9kcm9wSGFuZGxlciwgdGhpcyk7CiAgICAgICAgdGhpcy5kbmRPdmVyID0gZmFsc2U7CiAgICAgICAgZWxlbS5vbignZHJhZ2VudGVyJywgdGhpcy5kcmFnRW50ZXJIYW5kbGVyKTsKICAgICAgICBlbGVtLm9uKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTsKICAgICAgICBlbGVtLm9uKCdkcmFnbGVhdmUnLCB0aGlzLmRyYWdMZWF2ZUhhbmRsZXIpOwogICAgICAgIGVsZW0ub24oJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5kaXNhYmxlR2xvYmFsRG5kKSB7CiAgICAgICAgICAkKGRvY3VtZW50KS5vbignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7CiAgICAgICAgICAkKGRvY3VtZW50KS5vbignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgX2RyYWdFbnRlckhhbmRsZXI6IGZ1bmN0aW9uIF9kcmFnRW50ZXJIYW5kbGVyKGUpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBkZW5pZWQgPSBtZS5fZGVuaWVkIHx8IGZhbHNlLAogICAgICAgICAgICBpdGVtczsKICAgICAgICBlID0gZS5vcmlnaW5hbEV2ZW50IHx8IGU7CgogICAgICAgIGlmICghbWUuZG5kT3ZlcikgewogICAgICAgICAgbWUuZG5kT3ZlciA9IHRydWU7IC8vIOazqOaEj+WPquaciSBjaHJvbWUg5pSv5oyB44CCCgogICAgICAgICAgaXRlbXMgPSBlLmRhdGFUcmFuc2Zlci5pdGVtczsKCiAgICAgICAgICBpZiAoaXRlbXMgJiYgaXRlbXMubGVuZ3RoKSB7CiAgICAgICAgICAgIG1lLl9kZW5pZWQgPSBkZW5pZWQgPSAhbWUudHJpZ2dlcignYWNjZXB0JywgaXRlbXMpOwogICAgICAgICAgfQoKICAgICAgICAgIG1lLmVsZW0uYWRkQ2xhc3MocHJlZml4ICsgJ292ZXInKTsKICAgICAgICAgIG1lLmVsZW1bZGVuaWVkID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKHByZWZpeCArICdkZW5pZWQnKTsKICAgICAgICB9CgogICAgICAgIGUuZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSBkZW5pZWQgPyAnbm9uZScgOiAnY29weSc7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9LAogICAgICBfZHJhZ092ZXJIYW5kbGVyOiBmdW5jdGlvbiBfZHJhZ092ZXJIYW5kbGVyKGUpIHsKICAgICAgICAvLyDlj6rlpITnkIbmoYblhoXnmoTjgIIKICAgICAgICB2YXIgcGFyZW50RWxlbSA9IHRoaXMuZWxlbS5wYXJlbnQoKS5nZXQoMCk7CgogICAgICAgIGlmIChwYXJlbnRFbGVtICYmICEkLmNvbnRhaW5zKHBhcmVudEVsZW0sIGUuY3VycmVudFRhcmdldCkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9sZWF2ZVRpbWVyKTsKCiAgICAgICAgdGhpcy5fZHJhZ0VudGVySGFuZGxlci5jYWxsKHRoaXMsIGUpOwoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0sCiAgICAgIF9kcmFnTGVhdmVIYW5kbGVyOiBmdW5jdGlvbiBfZHJhZ0xlYXZlSGFuZGxlcigpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgICBoYW5kbGVyOwoKICAgICAgICBoYW5kbGVyID0gZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICAgIG1lLmRuZE92ZXIgPSBmYWxzZTsKICAgICAgICAgIG1lLmVsZW0ucmVtb3ZlQ2xhc3MocHJlZml4ICsgJ292ZXIgJyArIHByZWZpeCArICdkZW5pZWQnKTsKICAgICAgICB9OwoKICAgICAgICBjbGVhclRpbWVvdXQobWUuX2xlYXZlVGltZXIpOwogICAgICAgIG1lLl9sZWF2ZVRpbWVyID0gc2V0VGltZW91dChoYW5kbGVyLCAxMDApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgX2Ryb3BIYW5kbGVyOiBmdW5jdGlvbiBfZHJvcEhhbmRsZXIoZSkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIHJ1aWQgPSBtZS5nZXRSdWlkKCksCiAgICAgICAgICAgIHBhcmVudEVsZW0gPSBtZS5lbGVtLnBhcmVudCgpLmdldCgwKSwKICAgICAgICAgICAgZGF0YVRyYW5zZmVyLAogICAgICAgICAgICBkYXRhOyAvLyDlj6rlpITnkIbmoYblhoXnmoTjgIIKCiAgICAgICAgaWYgKHBhcmVudEVsZW0gJiYgISQuY29udGFpbnMocGFyZW50RWxlbSwgZS5jdXJyZW50VGFyZ2V0KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgZSA9IGUub3JpZ2luYWxFdmVudCB8fCBlOwogICAgICAgIGRhdGFUcmFuc2ZlciA9IGUuZGF0YVRyYW5zZmVyOyAvLyDlpoLmnpzmmK/pobXpnaLlhoXmi5bmi73vvIzov5jkuI3og73lpITnkIbvvIzkuI3pmLvmraLkuovku7bjgIIKICAgICAgICAvLyDmraTlpIQgaWUxMSDkuIvkvJrmiqXlj4LmlbDplJnor6/vvIwKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGRhdGEgPSBkYXRhVHJhbnNmZXIuZ2V0RGF0YSgndGV4dC9odG1sJyk7CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7fQoKICAgICAgICBtZS5kbmRPdmVyID0gZmFsc2U7CiAgICAgICAgbWUuZWxlbS5yZW1vdmVDbGFzcyhwcmVmaXggKyAnb3ZlcicpOwoKICAgICAgICBpZiAoIWRhdGFUcmFuc2ZlciB8fCBkYXRhKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtZS5fZ2V0VGFuc2ZlckZpbGVzKGRhdGFUcmFuc2ZlciwgZnVuY3Rpb24gKHJlc3VsdHMpIHsKICAgICAgICAgIG1lLnRyaWdnZXIoJ2Ryb3AnLCAkLm1hcChyZXN1bHRzLCBmdW5jdGlvbiAoZmlsZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IEZpbGUocnVpZCwgZmlsZSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgICAgLy8g5aaC5p6c5Lyg5YWlIGNhbGxiYWNrIOWImeWOu+afpeeci+aWh+S7tuWkue+8jOWQpuWImeWPqueuoeW9k+WJjeaWh+S7tuWkueOAggogICAgICBfZ2V0VGFuc2ZlckZpbGVzOiBmdW5jdGlvbiBfZ2V0VGFuc2ZlckZpbGVzKGRhdGFUcmFuc2ZlciwgY2FsbGJhY2spIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IFtdLAogICAgICAgICAgICBwcm9taXNlcyA9IFtdLAogICAgICAgICAgICBpdGVtcywKICAgICAgICAgICAgZmlsZXMsCiAgICAgICAgICAgIGZpbGUsCiAgICAgICAgICAgIGl0ZW0sCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgY2FuQWNjZXNzRm9sZGVyOwogICAgICAgIGl0ZW1zID0gZGF0YVRyYW5zZmVyLml0ZW1zOwogICAgICAgIGZpbGVzID0gZGF0YVRyYW5zZmVyLmZpbGVzOwogICAgICAgIGNhbkFjY2Vzc0ZvbGRlciA9ICEhKGl0ZW1zICYmIGl0ZW1zWzBdLndlYmtpdEdldEFzRW50cnkpOwoKICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBmaWxlcy5sZW5ndGg7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgZmlsZSA9IGZpbGVzW2ldOwogICAgICAgICAgaXRlbSA9IGl0ZW1zICYmIGl0ZW1zW2ldOwoKICAgICAgICAgIGlmIChjYW5BY2Nlc3NGb2xkZXIgJiYgaXRlbS53ZWJraXRHZXRBc0VudHJ5KCkuaXNEaXJlY3RvcnkpIHsKICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh0aGlzLl90cmF2ZXJzZURpcmVjdG9yeVRyZWUoaXRlbS53ZWJraXRHZXRBc0VudHJ5KCksIHJlc3VsdHMpKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaChmaWxlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEJhc2Uud2hlbi5hcHBseShCYXNlLCBwcm9taXNlcykuZG9uZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIXJlc3VsdHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBjYWxsYmFjayhyZXN1bHRzKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgX3RyYXZlcnNlRGlyZWN0b3J5VHJlZTogZnVuY3Rpb24gX3RyYXZlcnNlRGlyZWN0b3J5VHJlZShlbnRyeSwgcmVzdWx0cykgewogICAgICAgIHZhciBkZWZlcnJlZCA9IEJhc2UuRGVmZXJyZWQoKSwKICAgICAgICAgICAgbWUgPSB0aGlzOwoKICAgICAgICBpZiAoZW50cnkuaXNGaWxlKSB7CiAgICAgICAgICBlbnRyeS5maWxlKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaChmaWxlKTsKICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0RpcmVjdG9yeSkgewogICAgICAgICAgZW50cnkuY3JlYXRlUmVhZGVyKCkucmVhZEVudHJpZXMoZnVuY3Rpb24gKGVudHJpZXMpIHsKICAgICAgICAgICAgdmFyIGxlbiA9IGVudHJpZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgcHJvbWlzZXMgPSBbXSwKICAgICAgICAgICAgICAgIGFyciA9IFtdLAogICAgICAgICAgICAgICAgLy8g5Li65LqG5L+d6K+B6aG65bqP44CCCiAgICAgICAgICAgIGk7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKG1lLl90cmF2ZXJzZURpcmVjdG9yeVRyZWUoZW50cmllc1tpXSwgYXJyKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEJhc2Uud2hlbi5hcHBseShCYXNlLCBwcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoLmFwcGx5KHJlc3VsdHMsIGFycik7CiAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpOwogICAgICAgICAgICB9LCBkZWZlcnJlZC5yZWplY3QpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHZhciBlbGVtID0gdGhpcy5lbGVtOyAvLyDov5jmsqEgaW5pdCDlsLHosIPnlKggZGVzdHJveQoKICAgICAgICBpZiAoIWVsZW0pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGVsZW0ub2ZmKCdkcmFnZW50ZXInLCB0aGlzLmRyYWdFbnRlckhhbmRsZXIpOwogICAgICAgIGVsZW0ub2ZmKCdkcmFnb3ZlcicsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTsKICAgICAgICBlbGVtLm9mZignZHJhZ2xlYXZlJywgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTsKICAgICAgICBlbGVtLm9mZignZHJvcCcsIHRoaXMuZHJvcEhhbmRsZXIpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRpc2FibGVHbG9iYWxEbmQpIHsKICAgICAgICAgICQoZG9jdW1lbnQpLm9mZignZHJhZ292ZXInLCB0aGlzLmRyYWdPdmVySGFuZGxlcik7CiAgICAgICAgICAkKGRvY3VtZW50KS5vZmYoJ2Ryb3AnLCB0aGlzLmRyb3BIYW5kbGVyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgRmlsZVBhc3RlCiAgICovCgogIGRlZmluZSgncnVudGltZS9odG1sNS9maWxlcGFzdGUnLCBbJ2Jhc2UnLCAncnVudGltZS9odG1sNS9ydW50aW1lJywgJ2xpYi9maWxlJ10sIGZ1bmN0aW9uIChCYXNlLCBIdG1sNVJ1bnRpbWUsIEZpbGUpIHsKICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoJ0ZpbGVQYXN0ZScsIHsKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgZWxlbSA9IHRoaXMuZWxlbSA9IG9wdHMuY29udGFpbmVyLAogICAgICAgICAgICBhY2NlcHQgPSAnLionLAogICAgICAgICAgICBhcnIsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgaXRlbTsgLy8gYWNjZXRw55qEbWltZVR5cGVz5Lit55Sf5oiQ5Yy56YWN5q2j5YiZ44CCCgogICAgICAgIGlmIChvcHRzLmFjY2VwdCkgewogICAgICAgICAgYXJyID0gW107CgogICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gb3B0cy5hY2NlcHQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgICAgICAgaXRlbSA9IG9wdHMuYWNjZXB0W2ldLm1pbWVUeXBlczsKICAgICAgICAgICAgaXRlbSAmJiBhcnIucHVzaChpdGVtKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYXJyLmxlbmd0aCkgewogICAgICAgICAgICBhY2NlcHQgPSBhcnIuam9pbignLCcpOwogICAgICAgICAgICBhY2NlcHQgPSBhY2NlcHQucmVwbGFjZSgvLC9nLCAnfCcpLnJlcGxhY2UoL1wqL2csICcuKicpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5hY2NlcHQgPSBhY2NlcHQgPSBuZXcgUmVnRXhwKGFjY2VwdCwgJ2knKTsKICAgICAgICB0aGlzLmhhbmRlciA9IEJhc2UuYmluZEZuKHRoaXMuX3Bhc3RlSGFuZGVyLCB0aGlzKTsKICAgICAgICBlbGVtLm9uKCdwYXN0ZScsIHRoaXMuaGFuZGVyKTsKICAgICAgfSwKICAgICAgX3Bhc3RlSGFuZGVyOiBmdW5jdGlvbiBfcGFzdGVIYW5kZXIoZSkgewogICAgICAgIHZhciBhbGxvd2VkID0gW10sCiAgICAgICAgICAgIHJ1aWQgPSB0aGlzLmdldFJ1aWQoKSwKICAgICAgICAgICAgaXRlbXMsCiAgICAgICAgICAgIGl0ZW0sCiAgICAgICAgICAgIGJsb2IsCiAgICAgICAgICAgIGksCiAgICAgICAgICAgIGxlbjsKICAgICAgICBlID0gZS5vcmlnaW5hbEV2ZW50IHx8IGU7CiAgICAgICAgaXRlbXMgPSBlLmNsaXBib2FyZERhdGEuaXRlbXM7CgogICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGl0ZW1zLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBpdGVtID0gaXRlbXNbaV07CgogICAgICAgICAgaWYgKGl0ZW0ua2luZCAhPT0gJ2ZpbGUnIHx8ICEoYmxvYiA9IGl0ZW0uZ2V0QXNGaWxlKCkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGFsbG93ZWQucHVzaChuZXcgRmlsZShydWlkLCBibG9iKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWxsb3dlZC5sZW5ndGgpIHsKICAgICAgICAgIC8vIOS4jemYu+atoumdnuaWh+S7tueymOi0tO+8iOaWh+Wtl+eymOi0tO+8ieeahOS6i+S7tuWGkuazoQogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIHRoaXMudHJpZ2dlcigncGFzdGUnLCBhbGxvd2VkKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7CiAgICAgICAgdGhpcy5lbGVtLm9mZigncGFzdGUnLCB0aGlzLmhhbmRlcik7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgRmlsZVBpY2tlcgogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvZmlsZXBpY2tlcicsIFsnYmFzZScsICdydW50aW1lL2h0bWw1L3J1bnRpbWUnXSwgZnVuY3Rpb24gKEJhc2UsIEh0bWw1UnVudGltZSkgewogICAgdmFyICQgPSBCYXNlLiQ7CiAgICByZXR1cm4gSHRtbDVSdW50aW1lLnJlZ2lzdGVyKCdGaWxlUGlja2VyJywgewogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmdldFJ1bnRpbWUoKS5nZXRDb250YWluZXIoKSwKICAgICAgICAgICAgbWUgPSB0aGlzLAogICAgICAgICAgICBvd25lciA9IG1lLm93bmVyLAogICAgICAgICAgICBvcHRzID0gbWUub3B0aW9ucywKICAgICAgICAgICAgbGFiZWwgPSB0aGlzLmxhYmVsID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpKSwKICAgICAgICAgICAgaW5wdXQgPSB0aGlzLmlucHV0ID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpKSwKICAgICAgICAgICAgYXJyLAogICAgICAgICAgICBpLAogICAgICAgICAgICBsZW4sCiAgICAgICAgICAgIG1vdXNlSGFuZGxlciwKICAgICAgICAgICAgX2NoYW5nZUhhbmRsZXI7CgogICAgICAgIGlucHV0LmF0dHIoJ3R5cGUnLCAnZmlsZScpOwogICAgICAgIGlucHV0LmF0dHIoJ2NhcHR1cmUnLCAnY2FtZXJhJyk7CiAgICAgICAgaW5wdXQuYXR0cignbmFtZScsIG9wdHMubmFtZSk7CiAgICAgICAgaW5wdXQuYWRkQ2xhc3MoJ3dlYnVwbG9hZGVyLWVsZW1lbnQtaW52aXNpYmxlJyk7CiAgICAgICAgbGFiZWwub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGlucHV0LnRyaWdnZXIoJ2NsaWNrJyk7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgb3duZXIudHJpZ2dlcignZGlhbG9nb3BlbicpOwogICAgICAgIH0pOwogICAgICAgIGxhYmVsLmNzcyh7CiAgICAgICAgICBvcGFjaXR5OiAwLAogICAgICAgICAgd2lkdGg6ICcxMDAlJywKICAgICAgICAgIGhlaWdodDogJzEwMCUnLAogICAgICAgICAgZGlzcGxheTogJ2Jsb2NrJywKICAgICAgICAgIGN1cnNvcjogJ3BvaW50ZXInLAogICAgICAgICAgYmFja2dyb3VuZDogJyNmZmZmZmYnCiAgICAgICAgfSk7CgogICAgICAgIGlmIChvcHRzLm11bHRpcGxlKSB7CiAgICAgICAgICBpbnB1dC5hdHRyKCdtdWx0aXBsZScsICdtdWx0aXBsZScpOwogICAgICAgIH0gLy8gQHRvZG8gRmlyZWZveOS4jeaUr+aMgeWNleeLrOaMh+WumuWQjue8gAoKCiAgICAgICAgaWYgKG9wdHMuYWNjZXB0ICYmIG9wdHMuYWNjZXB0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIGFyciA9IFtdOwoKICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IG9wdHMuYWNjZXB0Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICAgIGFyci5wdXNoKG9wdHMuYWNjZXB0W2ldLm1pbWVUeXBlcyk7CiAgICAgICAgICB9CgogICAgICAgICAgaW5wdXQuYXR0cignYWNjZXB0JywgYXJyLmpvaW4oJywnKSk7CiAgICAgICAgfQoKICAgICAgICBjb250YWluZXIuYXBwZW5kKGlucHV0KTsKICAgICAgICBjb250YWluZXIuYXBwZW5kKGxhYmVsKTsKCiAgICAgICAgbW91c2VIYW5kbGVyID0gZnVuY3Rpb24gbW91c2VIYW5kbGVyKGUpIHsKICAgICAgICAgIG93bmVyLnRyaWdnZXIoZS50eXBlKTsKICAgICAgICB9OwoKICAgICAgICBfY2hhbmdlSGFuZGxlciA9IGZ1bmN0aW9uIGNoYW5nZUhhbmRsZXIoZSkgewogICAgICAgICAgdmFyIGNsb25lOyAvLyDop6PlhrNjaHJvbWUgNTYg56ys5LqM5qyh5omT5byA5paH5Lu26YCJ5oup5Zmo77yM54S25ZCO54K55Ye75Y+W5raI77yM5L6d54S25Lya6Kem5Y+RY2hhbmdl5LqL5Lu255qE6Zeu6aKYCgogICAgICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9IC8vIOesrOS4gOasoeS4iuS8oOWbvueJh+WQju+8jOesrOS6jOasoeWGjeeCueWHu+W8ueWHuuaWh+S7tumAieaLqeWZqOeql++8jOetieW+hQoKCiAgICAgICAgICBtZS5maWxlcyA9IGUudGFyZ2V0LmZpbGVzOyAvLyByZXNldCBpbnB1dAoKICAgICAgICAgIGNsb25lID0gdGhpcy5jbG9uZU5vZGUodHJ1ZSk7CiAgICAgICAgICBjbG9uZS52YWx1ZSA9IG51bGw7CiAgICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGNsb25lLCB0aGlzKTsKICAgICAgICAgIGlucHV0Lm9mZigpOwogICAgICAgICAgaW5wdXQgPSAkKGNsb25lKS5vbignY2hhbmdlJywgX2NoYW5nZUhhbmRsZXIpLm9uKCdtb3VzZWVudGVyIG1vdXNlbGVhdmUnLCBtb3VzZUhhbmRsZXIpOwogICAgICAgICAgb3duZXIudHJpZ2dlcignY2hhbmdlJyk7CiAgICAgICAgfTsKCiAgICAgICAgaW5wdXQub24oJ2NoYW5nZScsIF9jaGFuZ2VIYW5kbGVyKTsKICAgICAgICBsYWJlbC5vbignbW91c2VlbnRlciBtb3VzZWxlYXZlJywgbW91c2VIYW5kbGVyKTsKICAgICAgfSwKICAgICAgZ2V0RmlsZXM6IGZ1bmN0aW9uIGdldEZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLmZpbGVzOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHRoaXMuaW5wdXQub2ZmKCk7CiAgICAgICAgdGhpcy5sYWJlbC5vZmYoKTsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgLyoqCiAgICogVGVybXM6CiAgICoKICAgKiBVaW50OEFycmF5LCBGaWxlUmVhZGVyLCBCbG9iQnVpbGRlciwgYXRvYiwgQXJyYXlCdWZmZXIKICAgKiBAZmlsZU92ZXJ2aWV3IEltYWdl5o6n5Lu2CiAgICovCgogIGRlZmluZSgncnVudGltZS9odG1sNS91dGlsJywgWydiYXNlJ10sIGZ1bmN0aW9uIChCYXNlKSB7CiAgICB2YXIgdXJsQVBJID0gd2luZG93LmNyZWF0ZU9iamVjdFVSTCAmJiB3aW5kb3cgfHwgd2luZG93LlVSTCAmJiBVUkwucmV2b2tlT2JqZWN0VVJMICYmIFVSTCB8fCB3aW5kb3cud2Via2l0VVJMLAogICAgICAgIGNyZWF0ZU9iamVjdFVSTCA9IEJhc2Uubm9vcCwKICAgICAgICByZXZva2VPYmplY3RVUkwgPSBjcmVhdGVPYmplY3RVUkw7CgogICAgaWYgKHVybEFQSSkgewogICAgICAvLyDmm7TlronlhajnmoTmlrnlvI/osIPnlKjvvIzmr5TlpoJhbmRyb2lk6YeM6Z2i5bCx6IO95oqKY29udGV4dOaUueaIkOWFtuS7lueahOWvueixoeOAggogICAgICBjcmVhdGVPYmplY3RVUkwgPSBmdW5jdGlvbiBjcmVhdGVPYmplY3RVUkwoKSB7CiAgICAgICAgcmV0dXJuIHVybEFQSS5jcmVhdGVPYmplY3RVUkwuYXBwbHkodXJsQVBJLCBhcmd1bWVudHMpOwogICAgICB9OwoKICAgICAgcmV2b2tlT2JqZWN0VVJMID0gZnVuY3Rpb24gcmV2b2tlT2JqZWN0VVJMKCkgewogICAgICAgIHJldHVybiB1cmxBUEkucmV2b2tlT2JqZWN0VVJMLmFwcGx5KHVybEFQSSwgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICBjcmVhdGVPYmplY3RVUkw6IGNyZWF0ZU9iamVjdFVSTCwKICAgICAgcmV2b2tlT2JqZWN0VVJMOiByZXZva2VPYmplY3RVUkwsCiAgICAgIGRhdGFVUkwyQmxvYjogZnVuY3Rpb24gZGF0YVVSTDJCbG9iKGRhdGFVUkkpIHsKICAgICAgICB2YXIgYnl0ZVN0ciwgaW50QXJyYXksIGFiLCBpLCBtaW1ldHlwZSwgcGFydHM7CiAgICAgICAgcGFydHMgPSBkYXRhVVJJLnNwbGl0KCcsJyk7CgogICAgICAgIGlmICh+cGFydHNbMF0uaW5kZXhPZignYmFzZTY0JykpIHsKICAgICAgICAgIGJ5dGVTdHIgPSBhdG9iKHBhcnRzWzFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnl0ZVN0ciA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7CiAgICAgICAgfQoKICAgICAgICBhYiA9IG5ldyBBcnJheUJ1ZmZlcihieXRlU3RyLmxlbmd0aCk7CiAgICAgICAgaW50QXJyYXkgPSBuZXcgVWludDhBcnJheShhYik7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBieXRlU3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpbnRBcnJheVtpXSA9IGJ5dGVTdHIuY2hhckNvZGVBdChpKTsKICAgICAgICB9CgogICAgICAgIG1pbWV0eXBlID0gcGFydHNbMF0uc3BsaXQoJzonKVsxXS5zcGxpdCgnOycpWzBdOwogICAgICAgIHJldHVybiB0aGlzLmFycmF5QnVmZmVyVG9CbG9iKGFiLCBtaW1ldHlwZSk7CiAgICAgIH0sCiAgICAgIGRhdGFVUkwyQXJyYXlCdWZmZXI6IGZ1bmN0aW9uIGRhdGFVUkwyQXJyYXlCdWZmZXIoZGF0YVVSSSkgewogICAgICAgIHZhciBieXRlU3RyLCBpbnRBcnJheSwgaSwgcGFydHM7CiAgICAgICAgcGFydHMgPSBkYXRhVVJJLnNwbGl0KCcsJyk7CgogICAgICAgIGlmICh+cGFydHNbMF0uaW5kZXhPZignYmFzZTY0JykpIHsKICAgICAgICAgIGJ5dGVTdHIgPSBhdG9iKHBhcnRzWzFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnl0ZVN0ciA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJ0c1sxXSk7CiAgICAgICAgfQoKICAgICAgICBpbnRBcnJheSA9IG5ldyBVaW50OEFycmF5KGJ5dGVTdHIubGVuZ3RoKTsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGJ5dGVTdHIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGludEFycmF5W2ldID0gYnl0ZVN0ci5jaGFyQ29kZUF0KGkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGludEFycmF5LmJ1ZmZlcjsKICAgICAgfSwKICAgICAgYXJyYXlCdWZmZXJUb0Jsb2I6IGZ1bmN0aW9uIGFycmF5QnVmZmVyVG9CbG9iKGJ1ZmZlciwgdHlwZSkgewogICAgICAgIHZhciBidWlsZGVyID0gd2luZG93LkJsb2JCdWlsZGVyIHx8IHdpbmRvdy5XZWJLaXRCbG9iQnVpbGRlciwKICAgICAgICAgICAgYmI7IC8vIGFuZHJvaWTkuI3mlK/mjIHnm7TmjqVuZXcgQmxvYiwg5Y+q6IO95YCf5YqpYmxvYmJ1aWxkZXIuCgogICAgICAgIGlmIChidWlsZGVyKSB7CiAgICAgICAgICBiYiA9IG5ldyBidWlsZGVyKCk7CiAgICAgICAgICBiYi5hcHBlbmQoYnVmZmVyKTsKICAgICAgICAgIHJldHVybiBiYi5nZXRCbG9iKHR5cGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtidWZmZXJdLCB0eXBlID8gewogICAgICAgICAgdHlwZTogdHlwZQogICAgICAgIH0gOiB7fSk7CiAgICAgIH0sCiAgICAgIC8vIOaKveWHuuadpeS4u+imgeaYr+S4uuS6huino+WGs2FuZHJvaWTkuIvpnaJjYW52YXMudG9EYXRhVXJs5LiN5pSv5oyBanBlZy4KICAgICAgLy8g5L2g5b6X5Yiw55qE57uT5p6c5pivcG5nLgogICAgICBjYW52YXNUb0RhdGFVcmw6IGZ1bmN0aW9uIGNhbnZhc1RvRGF0YVVybChjYW52YXMsIHR5cGUsIHF1YWxpdHkpIHsKICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTCh0eXBlLCBxdWFsaXR5IC8gMTAwKTsKICAgICAgfSwKICAgICAgLy8gaW1hZ2VtZWF05Lya5aSN5YaZ6L+Z5Liq5pa55rOV77yM5aaC5p6c55So5oi36YCJ5oup5Yqg6L296YKj5Liq5paH5Lu25LqG55qE6K+d44CCCiAgICAgIHBhcnNlTWV0YTogZnVuY3Rpb24gcGFyc2VNZXRhKGJsb2IsIGNhbGxiYWNrKSB7CiAgICAgICAgY2FsbGJhY2soZmFsc2UsIHt9KTsKICAgICAgfSwKICAgICAgLy8gaW1hZ2VtZWF05Lya5aSN5YaZ6L+Z5Liq5pa55rOV77yM5aaC5p6c55So5oi36YCJ5oup5Yqg6L296YKj5Liq5paH5Lu25LqG55qE6K+d44CCCiAgICAgIHVwZGF0ZUltYWdlSGVhZDogZnVuY3Rpb24gdXBkYXRlSW1hZ2VIZWFkKGRhdGEpIHsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfQogICAgfTsKICB9KTsKICAvKioKICAgKiBUZXJtczoKICAgKgogICAqIFVpbnQ4QXJyYXksIEZpbGVSZWFkZXIsIEJsb2JCdWlsZGVyLCBhdG9iLCBBcnJheUJ1ZmZlcgogICAqIEBmaWxlT3ZlcnZpZXcgSW1hZ2Xmjqfku7YKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2ltYWdlbWV0YScsIFsncnVudGltZS9odG1sNS91dGlsJ10sIGZ1bmN0aW9uIChVdGlsKSB7CiAgICB2YXIgYXBpOwogICAgYXBpID0gewogICAgICBwYXJzZXJzOiB7CiAgICAgICAgMHhmZmUxOiBbXQogICAgICB9LAogICAgICBtYXhNZXRhRGF0YVNpemU6IDI2MjE0NCwKICAgICAgcGFyc2U6IGZ1bmN0aW9uIHBhcnNlKGJsb2IsIGNiKSB7CiAgICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgICAgZnIgPSBuZXcgRmlsZVJlYWRlcigpOwoKICAgICAgICBmci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjYihmYWxzZSwgbWUuX3BhcnNlKHRoaXMucmVzdWx0KSk7CiAgICAgICAgICBmciA9IGZyLm9ubG9hZCA9IGZyLm9uZXJyb3IgPSBudWxsOwogICAgICAgIH07CgogICAgICAgIGZyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgY2IoZS5tZXNzYWdlKTsKICAgICAgICAgIGZyID0gZnIub25sb2FkID0gZnIub25lcnJvciA9IG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgYmxvYiA9IGJsb2Iuc2xpY2UoMCwgbWUubWF4TWV0YURhdGFTaXplKTsKICAgICAgICBmci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iLmdldFNvdXJjZSgpKTsKICAgICAgfSwKICAgICAgX3BhcnNlOiBmdW5jdGlvbiBfcGFyc2UoYnVmZmVyLCBub1BhcnNlKSB7CiAgICAgICAgaWYgKGJ1ZmZlci5ieXRlTGVuZ3RoIDwgNikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRhdGF2aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlciksCiAgICAgICAgICAgIG9mZnNldCA9IDIsCiAgICAgICAgICAgIG1heE9mZnNldCA9IGRhdGF2aWV3LmJ5dGVMZW5ndGggLSA0LAogICAgICAgICAgICBoZWFkTGVuZ3RoID0gb2Zmc2V0LAogICAgICAgICAgICByZXQgPSB7fSwKICAgICAgICAgICAgbWFya2VyQnl0ZXMsCiAgICAgICAgICAgIG1hcmtlckxlbmd0aCwKICAgICAgICAgICAgcGFyc2VycywKICAgICAgICAgICAgaTsKCiAgICAgICAgaWYgKGRhdGF2aWV3LmdldFVpbnQxNigwKSA9PT0gMHhmZmQ4KSB7CiAgICAgICAgICB3aGlsZSAob2Zmc2V0IDwgbWF4T2Zmc2V0KSB7CiAgICAgICAgICAgIG1hcmtlckJ5dGVzID0gZGF0YXZpZXcuZ2V0VWludDE2KG9mZnNldCk7CgogICAgICAgICAgICBpZiAobWFya2VyQnl0ZXMgPj0gMHhmZmUwICYmIG1hcmtlckJ5dGVzIDw9IDB4ZmZlZiB8fCBtYXJrZXJCeXRlcyA9PT0gMHhmZmZlKSB7CiAgICAgICAgICAgICAgbWFya2VyTGVuZ3RoID0gZGF0YXZpZXcuZ2V0VWludDE2KG9mZnNldCArIDIpICsgMjsKCiAgICAgICAgICAgICAgaWYgKG9mZnNldCArIG1hcmtlckxlbmd0aCA+IGRhdGF2aWV3LmJ5dGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcGFyc2VycyA9IGFwaS5wYXJzZXJzW21hcmtlckJ5dGVzXTsKCiAgICAgICAgICAgICAgaWYgKCFub1BhcnNlICYmIHBhcnNlcnMpIHsKICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwYXJzZXJzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgICAgIHBhcnNlcnNbaV0uY2FsbChhcGksIGRhdGF2aWV3LCBvZmZzZXQsIG1hcmtlckxlbmd0aCwgcmV0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG9mZnNldCArPSBtYXJrZXJMZW5ndGg7CiAgICAgICAgICAgICAgaGVhZExlbmd0aCA9IG9mZnNldDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoZWFkTGVuZ3RoID4gNikgewogICAgICAgICAgICBpZiAoYnVmZmVyLnNsaWNlKSB7CiAgICAgICAgICAgICAgcmV0LmltYWdlSGVhZCA9IGJ1ZmZlci5zbGljZSgyLCBoZWFkTGVuZ3RoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBJRTEwLCB3aGljaCBkb2VzIG5vdCB5ZXQKICAgICAgICAgICAgICAvLyBzdXBwb3J0IEFycmF5QnVmZmVyLnNsaWNlOgogICAgICAgICAgICAgIHJldC5pbWFnZUhlYWQgPSBuZXcgVWludDhBcnJheShidWZmZXIpLnN1YmFycmF5KDIsIGhlYWRMZW5ndGgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmV0OwogICAgICB9LAogICAgICB1cGRhdGVJbWFnZUhlYWQ6IGZ1bmN0aW9uIHVwZGF0ZUltYWdlSGVhZChidWZmZXIsIGhlYWQpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX3BhcnNlKGJ1ZmZlciwgdHJ1ZSksCiAgICAgICAgICAgIGJ1ZjEsCiAgICAgICAgICAgIGJ1ZjIsCiAgICAgICAgICAgIGJvZHlvZmZzZXQ7CgogICAgICAgIGJvZHlvZmZzZXQgPSAyOwoKICAgICAgICBpZiAoZGF0YS5pbWFnZUhlYWQpIHsKICAgICAgICAgIGJvZHlvZmZzZXQgPSAyICsgZGF0YS5pbWFnZUhlYWQuYnl0ZUxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmIChidWZmZXIuc2xpY2UpIHsKICAgICAgICAgIGJ1ZjIgPSBidWZmZXIuc2xpY2UoYm9keW9mZnNldCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJ1ZjIgPSBuZXcgVWludDhBcnJheShidWZmZXIpLnN1YmFycmF5KGJvZHlvZmZzZXQpOwogICAgICAgIH0KCiAgICAgICAgYnVmMSA9IG5ldyBVaW50OEFycmF5KGhlYWQuYnl0ZUxlbmd0aCArIDIgKyBidWYyLmJ5dGVMZW5ndGgpOwogICAgICAgIGJ1ZjFbMF0gPSAweEZGOwogICAgICAgIGJ1ZjFbMV0gPSAweEQ4OwogICAgICAgIGJ1ZjEuc2V0KG5ldyBVaW50OEFycmF5KGhlYWQpLCAyKTsKICAgICAgICBidWYxLnNldChuZXcgVWludDhBcnJheShidWYyKSwgaGVhZC5ieXRlTGVuZ3RoICsgMik7CiAgICAgICAgcmV0dXJuIGJ1ZjEuYnVmZmVyOwogICAgICB9CiAgICB9OwoKICAgIFV0aWwucGFyc2VNZXRhID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gYXBpLnBhcnNlLmFwcGx5KGFwaSwgYXJndW1lbnRzKTsKICAgIH07CgogICAgVXRpbC51cGRhdGVJbWFnZUhlYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBhcGkudXBkYXRlSW1hZ2VIZWFkLmFwcGx5KGFwaSwgYXJndW1lbnRzKTsKICAgIH07CgogICAgcmV0dXJuIGFwaTsKICB9KTsKICAvKioKICAgKiDku6PnoIHmnaXoh6rkuo7vvJpodHRwczovL2dpdGh1Yi5jb20vYmx1ZWltcC9KYXZhU2NyaXB0LUxvYWQtSW1hZ2UKICAgKiDmmoLml7bpobnnm67kuK3lj6rnlKjkuoZvcmllbnRhdGlvbi4KICAgKgogICAqIOWOu+mZpOS6hiBFeGlmIFN1YiBJRkQgUG9pbnRlciwgR1BTIEluZm8gSUZEIFBvaW50ZXIsIEV4aWYgVGh1bWJuYWlsLgogICAqIEBmaWxlT3ZlcnZpZXcgRVhJRuino+aekAogICAqLwogIC8vIFNhbXBsZQogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vIE1ha2UgOiBBcHBsZQogIC8vIE1vZGVsIDogaVBob25lIDRTCiAgLy8gT3JpZW50YXRpb24gOiAxCiAgLy8gWFJlc29sdXRpb24gOiA3MiBbNzIvMV0KICAvLyBZUmVzb2x1dGlvbiA6IDcyIFs3Mi8xXQogIC8vIFJlc29sdXRpb25Vbml0IDogMgogIC8vIFNvZnR3YXJlIDogUXVpY2tUaW1lIDcuNy4xCiAgLy8gRGF0ZVRpbWUgOiAyMDEzOjA5OjAxIDIyOjUzOjU1CiAgLy8gRXhpZklGRFBvaW50ZXIgOiAxOTAKICAvLyBFeHBvc3VyZVRpbWUgOiAwLjA1ODgyMzUyOTQxMTc2NDcwNSBbMS8xN10KICAvLyBGTnVtYmVyIDogMi40IFsxMi81XQogIC8vIEV4cG9zdXJlUHJvZ3JhbSA6IE5vcm1hbCBwcm9ncmFtCiAgLy8gSVNPU3BlZWRSYXRpbmdzIDogODAwCiAgLy8gRXhpZlZlcnNpb24gOiAwMjIwCiAgLy8gRGF0ZVRpbWVPcmlnaW5hbCA6IDIwMTM6MDk6MDEgMjI6NTI6NTEKICAvLyBEYXRlVGltZURpZ2l0aXplZCA6IDIwMTM6MDk6MDEgMjI6NTI6NTEKICAvLyBDb21wb25lbnRzQ29uZmlndXJhdGlvbiA6IFlDYkNyCiAgLy8gU2h1dHRlclNwZWVkVmFsdWUgOiA0LjA1ODg5MzUxNTc2NDQyNgogIC8vIEFwZXJ0dXJlVmFsdWUgOiAyLjUyNjA2ODgyMTY4OTI1OTcgWzQ4NDUvMTkxOF0KICAvLyBCcmlnaHRuZXNzVmFsdWUgOiAtMC4zMTI2Njg2NjAxOTk4Mzk1CiAgLy8gTWV0ZXJpbmdNb2RlIDogUGF0dGVybgogIC8vIEZsYXNoIDogRmxhc2ggZGlkIG5vdCBmaXJlLCBjb21wdWxzb3J5IGZsYXNoIG1vZGUKICAvLyBGb2NhbExlbmd0aCA6IDQuMjggWzEwNy8yNV0KICAvLyBTdWJqZWN0QXJlYSA6IFs0IHZhbHVlc10KICAvLyBGbGFzaHBpeFZlcnNpb24gOiAwMTAwCiAgLy8gQ29sb3JTcGFjZSA6IDEKICAvLyBQaXhlbFhEaW1lbnNpb24gOiAyNDQ4CiAgLy8gUGl4ZWxZRGltZW5zaW9uIDogMzI2NAogIC8vIFNlbnNpbmdNZXRob2QgOiBPbmUtY2hpcCBjb2xvciBhcmVhIHNlbnNvcgogIC8vIEV4cG9zdXJlTW9kZSA6IDAKICAvLyBXaGl0ZUJhbGFuY2UgOiBBdXRvIHdoaXRlIGJhbGFuY2UKICAvLyBGb2NhbExlbmd0aEluMzVtbUZpbG0gOiAzNQogIC8vIFNjZW5lQ2FwdHVyZVR5cGUgOiBTdGFuZGFyZAoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvaW1hZ2VtZXRhL2V4aWYnLCBbJ2Jhc2UnLCAncnVudGltZS9odG1sNS9pbWFnZW1ldGEnXSwgZnVuY3Rpb24gKEJhc2UsIEltYWdlTWV0YSkgewogICAgdmFyIEVYSUYgPSB7fTsKCiAgICBFWElGLkV4aWZNYXAgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICBFWElGLkV4aWZNYXAucHJvdG90eXBlLm1hcCA9IHsKICAgICAgJ09yaWVudGF0aW9uJzogMHgwMTEyCiAgICB9OwoKICAgIEVYSUYuRXhpZk1hcC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGlkKSB7CiAgICAgIHJldHVybiB0aGlzW2lkXSB8fCB0aGlzW3RoaXMubWFwW2lkXV07CiAgICB9OwoKICAgIEVYSUYuZXhpZlRhZ1R5cGVzID0gewogICAgICAvLyBieXRlLCA4LWJpdCB1bnNpZ25lZCBpbnQ6CiAgICAgIDE6IHsKICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoZGF0YVZpZXcsIGRhdGFPZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRVaW50OChkYXRhT2Zmc2V0KTsKICAgICAgICB9LAogICAgICAgIHNpemU6IDEKICAgICAgfSwKICAgICAgLy8gYXNjaWksIDgtYml0IGJ5dGU6CiAgICAgIDI6IHsKICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoZGF0YVZpZXcsIGRhdGFPZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGRhdGFWaWV3LmdldFVpbnQ4KGRhdGFPZmZzZXQpKTsKICAgICAgICB9LAogICAgICAgIHNpemU6IDEsCiAgICAgICAgYXNjaWk6IHRydWUKICAgICAgfSwKICAgICAgLy8gc2hvcnQsIDE2IGJpdCBpbnQ6CiAgICAgIDM6IHsKICAgICAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoZGF0YVZpZXcsIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbikgewogICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldFVpbnQxNihkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4pOwogICAgICAgIH0sCiAgICAgICAgc2l6ZTogMgogICAgICB9LAogICAgICAvLyBsb25nLCAzMiBiaXQgaW50OgogICAgICA0OiB7CiAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHsKICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRVaW50MzIoZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuKTsKICAgICAgICB9LAogICAgICAgIHNpemU6IDQKICAgICAgfSwKICAgICAgLy8gcmF0aW9uYWwgPSB0d28gbG9uZyB2YWx1ZXMsCiAgICAgIC8vIGZpcnN0IGlzIG51bWVyYXRvciwgc2Vjb25kIGlzIGRlbm9taW5hdG9yOgogICAgICA1OiB7CiAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHsKICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRVaW50MzIoZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuKSAvIGRhdGFWaWV3LmdldFVpbnQzMihkYXRhT2Zmc2V0ICsgNCwgbGl0dGxlRW5kaWFuKTsKICAgICAgICB9LAogICAgICAgIHNpemU6IDgKICAgICAgfSwKICAgICAgLy8gc2xvbmcsIDMyIGJpdCBzaWduZWQgaW50OgogICAgICA5OiB7CiAgICAgICAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKGRhdGFWaWV3LCBkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHsKICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRJbnQzMihkYXRhT2Zmc2V0LCBsaXR0bGVFbmRpYW4pOwogICAgICAgIH0sCiAgICAgICAgc2l6ZTogNAogICAgICB9LAogICAgICAvLyBzcmF0aW9uYWwsIHR3byBzbG9uZ3MsIGZpcnN0IGlzIG51bWVyYXRvciwgc2Vjb25kIGlzIGRlbm9taW5hdG9yOgogICAgICAxMDogewogICAgICAgIGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZShkYXRhVmlldywgZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuKSB7CiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MzIoZGF0YU9mZnNldCwgbGl0dGxlRW5kaWFuKSAvIGRhdGFWaWV3LmdldEludDMyKGRhdGFPZmZzZXQgKyA0LCBsaXR0bGVFbmRpYW4pOwogICAgICAgIH0sCiAgICAgICAgc2l6ZTogOAogICAgICB9CiAgICB9OyAvLyB1bmRlZmluZWQsIDgtYml0IGJ5dGUsIHZhbHVlIGRlcGVuZGluZyBvbiBmaWVsZDoKCiAgICBFWElGLmV4aWZUYWdUeXBlc1s3XSA9IEVYSUYuZXhpZlRhZ1R5cGVzWzFdOwoKICAgIEVYSUYuZ2V0RXhpZlZhbHVlID0gZnVuY3Rpb24gKGRhdGFWaWV3LCB0aWZmT2Zmc2V0LCBvZmZzZXQsIHR5cGUsIGxlbmd0aCwgbGl0dGxlRW5kaWFuKSB7CiAgICAgIHZhciB0YWdUeXBlID0gRVhJRi5leGlmVGFnVHlwZXNbdHlwZV0sCiAgICAgICAgICB0YWdTaXplLAogICAgICAgICAgZGF0YU9mZnNldCwKICAgICAgICAgIHZhbHVlcywKICAgICAgICAgIGksCiAgICAgICAgICBzdHIsCiAgICAgICAgICBjOwoKICAgICAgaWYgKCF0YWdUeXBlKSB7CiAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIHRhZyB0eXBlLicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGFnU2l6ZSA9IHRhZ1R5cGUuc2l6ZSAqIGxlbmd0aDsgLy8gRGV0ZXJtaW5lIGlmIHRoZSB2YWx1ZSBpcyBjb250YWluZWQgaW4gdGhlIGRhdGFPZmZzZXQgYnl0ZXMsCiAgICAgIC8vIG9yIGlmIHRoZSB2YWx1ZSBhdCB0aGUgZGF0YU9mZnNldCBpcyBhIHBvaW50ZXIgdG8gdGhlIGFjdHVhbCBkYXRhOgoKICAgICAgZGF0YU9mZnNldCA9IHRhZ1NpemUgPiA0ID8gdGlmZk9mZnNldCArIGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQgKyA4LCBsaXR0bGVFbmRpYW4pIDogb2Zmc2V0ICsgODsKCiAgICAgIGlmIChkYXRhT2Zmc2V0ICsgdGFnU2l6ZSA+IGRhdGFWaWV3LmJ5dGVMZW5ndGgpIHsKICAgICAgICBCYXNlLmxvZygnSW52YWxpZCBFeGlmIGRhdGE6IEludmFsaWQgZGF0YSBvZmZzZXQuJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAobGVuZ3RoID09PSAxKSB7CiAgICAgICAgcmV0dXJuIHRhZ1R5cGUuZ2V0VmFsdWUoZGF0YVZpZXcsIGRhdGFPZmZzZXQsIGxpdHRsZUVuZGlhbik7CiAgICAgIH0KCiAgICAgIHZhbHVlcyA9IFtdOwoKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgdmFsdWVzW2ldID0gdGFnVHlwZS5nZXRWYWx1ZShkYXRhVmlldywgZGF0YU9mZnNldCArIGkgKiB0YWdUeXBlLnNpemUsIGxpdHRsZUVuZGlhbik7CiAgICAgIH0KCiAgICAgIGlmICh0YWdUeXBlLmFzY2lpKSB7CiAgICAgICAgc3RyID0gJyc7IC8vIENvbmNhdGVuYXRlIHRoZSBjaGFyczoKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgYyA9IHZhbHVlc1tpXTsgLy8gSWdub3JlIHRoZSB0ZXJtaW5hdGluZyBOVUxMIGJ5dGUocyk6CgogICAgICAgICAgaWYgKGMgPT09ICJcMCIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgc3RyICs9IGM7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gc3RyOwogICAgICB9CgogICAgICByZXR1cm4gdmFsdWVzOwogICAgfTsKCiAgICBFWElGLnBhcnNlRXhpZlRhZyA9IGZ1bmN0aW9uIChkYXRhVmlldywgdGlmZk9mZnNldCwgb2Zmc2V0LCBsaXR0bGVFbmRpYW4sIGRhdGEpIHsKICAgICAgdmFyIHRhZyA9IGRhdGFWaWV3LmdldFVpbnQxNihvZmZzZXQsIGxpdHRsZUVuZGlhbik7CiAgICAgIGRhdGEuZXhpZlt0YWddID0gRVhJRi5nZXRFeGlmVmFsdWUoZGF0YVZpZXcsIHRpZmZPZmZzZXQsIG9mZnNldCwgZGF0YVZpZXcuZ2V0VWludDE2KG9mZnNldCArIDIsIGxpdHRsZUVuZGlhbiksIC8vIHRhZyB0eXBlCiAgICAgIGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQgKyA0LCBsaXR0bGVFbmRpYW4pLCAvLyB0YWcgbGVuZ3RoCiAgICAgIGxpdHRsZUVuZGlhbik7CiAgICB9OwoKICAgIEVYSUYucGFyc2VFeGlmVGFncyA9IGZ1bmN0aW9uIChkYXRhVmlldywgdGlmZk9mZnNldCwgZGlyT2Zmc2V0LCBsaXR0bGVFbmRpYW4sIGRhdGEpIHsKICAgICAgdmFyIHRhZ3NOdW1iZXIsIGRpckVuZE9mZnNldCwgaTsKCiAgICAgIGlmIChkaXJPZmZzZXQgKyA2ID4gZGF0YVZpZXcuYnl0ZUxlbmd0aCkgewogICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogSW52YWxpZCBkaXJlY3Rvcnkgb2Zmc2V0LicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGFnc051bWJlciA9IGRhdGFWaWV3LmdldFVpbnQxNihkaXJPZmZzZXQsIGxpdHRsZUVuZGlhbik7CiAgICAgIGRpckVuZE9mZnNldCA9IGRpck9mZnNldCArIDIgKyAxMiAqIHRhZ3NOdW1iZXI7CgogICAgICBpZiAoZGlyRW5kT2Zmc2V0ICsgNCA+IGRhdGFWaWV3LmJ5dGVMZW5ndGgpIHsKICAgICAgICBCYXNlLmxvZygnSW52YWxpZCBFeGlmIGRhdGE6IEludmFsaWQgZGlyZWN0b3J5IHNpemUuJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgdGFnc051bWJlcjsgaSArPSAxKSB7CiAgICAgICAgdGhpcy5wYXJzZUV4aWZUYWcoZGF0YVZpZXcsIHRpZmZPZmZzZXQsIGRpck9mZnNldCArIDIgKyAxMiAqIGksIC8vIHRhZyBvZmZzZXQKICAgICAgICBsaXR0bGVFbmRpYW4sIGRhdGEpOwogICAgICB9IC8vIFJldHVybiB0aGUgb2Zmc2V0IHRvIHRoZSBuZXh0IGRpcmVjdG9yeToKCgogICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDMyKGRpckVuZE9mZnNldCwgbGl0dGxlRW5kaWFuKTsKICAgIH07IC8vIEVYSUYuZ2V0RXhpZlRodW1ibmFpbCA9IGZ1bmN0aW9uKGRhdGFWaWV3LCBvZmZzZXQsIGxlbmd0aCkgewogICAgLy8gICAgIHZhciBoZXhEYXRhLAogICAgLy8gICAgICAgICBpLAogICAgLy8gICAgICAgICBiOwogICAgLy8gICAgIGlmICghbGVuZ3RoIHx8IG9mZnNldCArIGxlbmd0aCA+IGRhdGFWaWV3LmJ5dGVMZW5ndGgpIHsKICAgIC8vICAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBJbnZhbGlkIHRodW1ibmFpbCBkYXRhLicpOwogICAgLy8gICAgICAgICByZXR1cm47CiAgICAvLyAgICAgfQogICAgLy8gICAgIGhleERhdGEgPSBbXTsKICAgIC8vICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgIC8vICAgICAgICAgYiA9IGRhdGFWaWV3LmdldFVpbnQ4KG9mZnNldCArIGkpOwogICAgLy8gICAgICAgICBoZXhEYXRhLnB1c2goKGIgPCAxNiA/ICcwJyA6ICcnKSArIGIudG9TdHJpbmcoMTYpKTsKICAgIC8vICAgICB9CiAgICAvLyAgICAgcmV0dXJuICdkYXRhOmltYWdlL2pwZWcsJScgKyBoZXhEYXRhLmpvaW4oJyUnKTsKICAgIC8vIH07CgoKICAgIEVYSUYucGFyc2VFeGlmRGF0YSA9IGZ1bmN0aW9uIChkYXRhVmlldywgb2Zmc2V0LCBsZW5ndGgsIGRhdGEpIHsKICAgICAgdmFyIHRpZmZPZmZzZXQgPSBvZmZzZXQgKyAxMCwKICAgICAgICAgIGxpdHRsZUVuZGlhbiwKICAgICAgICAgIGRpck9mZnNldDsgLy8gQ2hlY2sgZm9yIHRoZSBBU0NJSSBjb2RlIGZvciAiRXhpZiIgKDB4NDU3ODY5NjYpOgoKICAgICAgaWYgKGRhdGFWaWV3LmdldFVpbnQzMihvZmZzZXQgKyA0KSAhPT0gMHg0NTc4Njk2NikgewogICAgICAgIC8vIE5vIEV4aWYgZGF0YSwgbWlnaHQgYmUgWE1QIGRhdGEgaW5zdGVhZAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHRpZmZPZmZzZXQgKyA4ID4gZGF0YVZpZXcuYnl0ZUxlbmd0aCkgewogICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogSW52YWxpZCBzZWdtZW50IHNpemUuJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENoZWNrIGZvciB0aGUgdHdvIG51bGwgYnl0ZXM6CgoKICAgICAgaWYgKGRhdGFWaWV3LmdldFVpbnQxNihvZmZzZXQgKyA4KSAhPT0gMHgwMDAwKSB7CiAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBNaXNzaW5nIGJ5dGUgYWxpZ25tZW50IG9mZnNldC4nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2hlY2sgdGhlIGJ5dGUgYWxpZ25tZW50OgoKCiAgICAgIHN3aXRjaCAoZGF0YVZpZXcuZ2V0VWludDE2KHRpZmZPZmZzZXQpKSB7CiAgICAgICAgY2FzZSAweDQ5NDk6CiAgICAgICAgICBsaXR0bGVFbmRpYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMHg0RDREOgogICAgICAgICAgbGl0dGxlRW5kaWFuID0gZmFsc2U7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIEJhc2UubG9nKCdJbnZhbGlkIEV4aWYgZGF0YTogSW52YWxpZCBieXRlIGFsaWdubWVudCBtYXJrZXIuJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2hlY2sgZm9yIHRoZSBUSUZGIHRhZyBtYXJrZXIgKDB4MDAyQSk6CgoKICAgICAgaWYgKGRhdGFWaWV3LmdldFVpbnQxNih0aWZmT2Zmc2V0ICsgMiwgbGl0dGxlRW5kaWFuKSAhPT0gMHgwMDJBKSB7CiAgICAgICAgQmFzZS5sb2coJ0ludmFsaWQgRXhpZiBkYXRhOiBNaXNzaW5nIFRJRkYgbWFya2VyLicpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBSZXRyaWV2ZSB0aGUgZGlyZWN0b3J5IG9mZnNldCBieXRlcywgdXN1YWxseSAweDAwMDAwMDA4IG9yIDggZGVjaW1hbDoKCgogICAgICBkaXJPZmZzZXQgPSBkYXRhVmlldy5nZXRVaW50MzIodGlmZk9mZnNldCArIDQsIGxpdHRsZUVuZGlhbik7IC8vIENyZWF0ZSB0aGUgZXhpZiBvYmplY3QgdG8gc3RvcmUgdGhlIHRhZ3M6CgogICAgICBkYXRhLmV4aWYgPSBuZXcgRVhJRi5FeGlmTWFwKCk7IC8vIFBhcnNlIHRoZSB0YWdzIG9mIHRoZSBtYWluIGltYWdlIGRpcmVjdG9yeSBhbmQgcmV0cmlldmUgdGhlCiAgICAgIC8vIG9mZnNldCB0byB0aGUgbmV4dCBkaXJlY3RvcnksIHVzdWFsbHkgdGhlIHRodW1ibmFpbCBkaXJlY3Rvcnk6CgogICAgICBkaXJPZmZzZXQgPSBFWElGLnBhcnNlRXhpZlRhZ3MoZGF0YVZpZXcsIHRpZmZPZmZzZXQsIHRpZmZPZmZzZXQgKyBkaXJPZmZzZXQsIGxpdHRsZUVuZGlhbiwgZGF0YSk7IC8vIOWwneivleivu+WPlue8qeeVpeWbvgogICAgICAvLyBpZiAoIGRpck9mZnNldCApIHsKICAgICAgLy8gICAgIHRodW1ibmFpbERhdGEgPSB7ZXhpZjoge319OwogICAgICAvLyAgICAgZGlyT2Zmc2V0ID0gRVhJRi5wYXJzZUV4aWZUYWdzKAogICAgICAvLyAgICAgICAgIGRhdGFWaWV3LAogICAgICAvLyAgICAgICAgIHRpZmZPZmZzZXQsCiAgICAgIC8vICAgICAgICAgdGlmZk9mZnNldCArIGRpck9mZnNldCwKICAgICAgLy8gICAgICAgICBsaXR0bGVFbmRpYW4sCiAgICAgIC8vICAgICAgICAgdGh1bWJuYWlsRGF0YQogICAgICAvLyAgICAgKTsKICAgICAgLy8gICAgIC8vIENoZWNrIGZvciBKUEVHIFRodW1ibmFpbCBvZmZzZXQ6CiAgICAgIC8vICAgICBpZiAodGh1bWJuYWlsRGF0YS5leGlmWzB4MDIwMV0pIHsKICAgICAgLy8gICAgICAgICBkYXRhLmV4aWYuVGh1bWJuYWlsID0gRVhJRi5nZXRFeGlmVGh1bWJuYWlsKAogICAgICAvLyAgICAgICAgICAgICBkYXRhVmlldywKICAgICAgLy8gICAgICAgICAgICAgdGlmZk9mZnNldCArIHRodW1ibmFpbERhdGEuZXhpZlsweDAyMDFdLAogICAgICAvLyAgICAgICAgICAgICB0aHVtYm5haWxEYXRhLmV4aWZbMHgwMjAyXSAvLyBUaHVtYm5haWwgZGF0YSBsZW5ndGgKICAgICAgLy8gICAgICAgICApOwogICAgICAvLyAgICAgfQogICAgICAvLyB9CiAgICB9OwoKICAgIEltYWdlTWV0YS5wYXJzZXJzWzB4ZmZlMV0ucHVzaChFWElGLnBhcnNlRXhpZkRhdGEpOwogICAgcmV0dXJuIEVYSUY7CiAgfSk7CiAgLyoqCiAgICog6L+Z5Liq5pa55byP5oCn6IO95LiN6KGM77yM5L2G5piv5Y+v5Lul6Kej5YazYW5kcm9pZOmHjOmdoueahHRvRGF0YVVybOeahGJ1ZwogICAqIGFuZHJvaWTph4zpnaJ0b0RhdGFVcmwoJ2ltYWdlL2pwZWdlJynlvpfliLDnmoTnu5PmnpzljbTmmK9wbmcuCiAgICoKICAgKiDmiYDku6Xov5nph4zmsqHovpnvvIzlj6rog73lgJ/liqnov5nkuKrlt6XlhbcKICAgKiBAZmlsZU92ZXJ2aWV3IGpwZWcgZW5jb2RlcgogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvanBlZ2VuY29kZXInLCBbXSwgZnVuY3Rpb24gKHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSkgewogICAgLyoKICAgICAgQ29weXJpZ2h0IChjKSAyMDA4LCBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZAogICAgICBBbGwgcmlnaHRzIHJlc2VydmVkLgogICAgICAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgICAgIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUKICAgICAgbWV0OgogICAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAgICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAgICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQKICAgICAgICBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlCiAgICAgICAgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICAgICAgICogTmVpdGhlciB0aGUgbmFtZSBvZiBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZCBub3IgdGhlIG5hbWVzIG9mIGl0cwogICAgICAgIGNvbnRyaWJ1dG9ycyBtYXkgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tCiAgICAgICAgdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICAgICAgIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTCiAgICAgIElTIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywKICAgICAgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUgogICAgICBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SCiAgICAgIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLAogICAgICBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sCiAgICAgIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUgogICAgICBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GCiAgICAgIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HCiAgICAgIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUwogICAgICBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICAgICovCgogICAgLyoKICAgIEpQRUcgZW5jb2RlciBwb3J0ZWQgdG8gSmF2YVNjcmlwdCBhbmQgb3B0aW1pemVkIGJ5IEFuZHJlYXMgUml0dGVyLCB3d3cuYnl0ZXN0cm9tLmV1LCAxMS8yMDA5CiAgICAgQmFzaWMgR1VJIGJsb2NraW5nIGpwZWcgZW5jb2RlcgogICAgKi8KICAgIGZ1bmN0aW9uIEpQRUdFbmNvZGVyKHF1YWxpdHkpIHsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZnJvdW5kID0gTWF0aC5yb3VuZDsKICAgICAgdmFyIGZmbG9vciA9IE1hdGguZmxvb3I7CiAgICAgIHZhciBZVGFibGUgPSBuZXcgQXJyYXkoNjQpOwogICAgICB2YXIgVVZUYWJsZSA9IG5ldyBBcnJheSg2NCk7CiAgICAgIHZhciBmZHRibF9ZID0gbmV3IEFycmF5KDY0KTsKICAgICAgdmFyIGZkdGJsX1VWID0gbmV3IEFycmF5KDY0KTsKICAgICAgdmFyIFlEQ19IVDsKICAgICAgdmFyIFVWRENfSFQ7CiAgICAgIHZhciBZQUNfSFQ7CiAgICAgIHZhciBVVkFDX0hUOwogICAgICB2YXIgYml0Y29kZSA9IG5ldyBBcnJheSg2NTUzNSk7CiAgICAgIHZhciBjYXRlZ29yeSA9IG5ldyBBcnJheSg2NTUzNSk7CiAgICAgIHZhciBvdXRwdXRmRENUUXVhbnQgPSBuZXcgQXJyYXkoNjQpOwogICAgICB2YXIgRFUgPSBuZXcgQXJyYXkoNjQpOwogICAgICB2YXIgYnl0ZW91dCA9IFtdOwogICAgICB2YXIgYnl0ZW5ldyA9IDA7CiAgICAgIHZhciBieXRlcG9zID0gNzsKICAgICAgdmFyIFlEVSA9IG5ldyBBcnJheSg2NCk7CiAgICAgIHZhciBVRFUgPSBuZXcgQXJyYXkoNjQpOwogICAgICB2YXIgVkRVID0gbmV3IEFycmF5KDY0KTsKICAgICAgdmFyIGNsdCA9IG5ldyBBcnJheSgyNTYpOwogICAgICB2YXIgUkdCX1lVVl9UQUJMRSA9IG5ldyBBcnJheSgyMDQ4KTsKICAgICAgdmFyIGN1cnJlbnRRdWFsaXR5OwogICAgICB2YXIgWmlnWmFnID0gWzAsIDEsIDUsIDYsIDE0LCAxNSwgMjcsIDI4LCAyLCA0LCA3LCAxMywgMTYsIDI2LCAyOSwgNDIsIDMsIDgsIDEyLCAxNywgMjUsIDMwLCA0MSwgNDMsIDksIDExLCAxOCwgMjQsIDMxLCA0MCwgNDQsIDUzLCAxMCwgMTksIDIzLCAzMiwgMzksIDQ1LCA1MiwgNTQsIDIwLCAyMiwgMzMsIDM4LCA0NiwgNTEsIDU1LCA2MCwgMjEsIDM0LCAzNywgNDcsIDUwLCA1NiwgNTksIDYxLCAzNSwgMzYsIDQ4LCA0OSwgNTcsIDU4LCA2MiwgNjNdOwogICAgICB2YXIgc3RkX2RjX2x1bWluYW5jZV9ucmNvZGVzID0gWzAsIDAsIDEsIDUsIDEsIDEsIDEsIDEsIDEsIDEsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB2YXIgc3RkX2RjX2x1bWluYW5jZV92YWx1ZXMgPSBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExXTsKICAgICAgdmFyIHN0ZF9hY19sdW1pbmFuY2VfbnJjb2RlcyA9IFswLCAwLCAyLCAxLCAzLCAzLCAyLCA0LCAzLCA1LCA1LCA0LCA0LCAwLCAwLCAxLCAweDdkXTsKICAgICAgdmFyIHN0ZF9hY19sdW1pbmFuY2VfdmFsdWVzID0gWzB4MDEsIDB4MDIsIDB4MDMsIDB4MDAsIDB4MDQsIDB4MTEsIDB4MDUsIDB4MTIsIDB4MjEsIDB4MzEsIDB4NDEsIDB4MDYsIDB4MTMsIDB4NTEsIDB4NjEsIDB4MDcsIDB4MjIsIDB4NzEsIDB4MTQsIDB4MzIsIDB4ODEsIDB4OTEsIDB4YTEsIDB4MDgsIDB4MjMsIDB4NDIsIDB4YjEsIDB4YzEsIDB4MTUsIDB4NTIsIDB4ZDEsIDB4ZjAsIDB4MjQsIDB4MzMsIDB4NjIsIDB4NzIsIDB4ODIsIDB4MDksIDB4MGEsIDB4MTYsIDB4MTcsIDB4MTgsIDB4MTksIDB4MWEsIDB4MjUsIDB4MjYsIDB4MjcsIDB4MjgsIDB4MjksIDB4MmEsIDB4MzQsIDB4MzUsIDB4MzYsIDB4MzcsIDB4MzgsIDB4MzksIDB4M2EsIDB4NDMsIDB4NDQsIDB4NDUsIDB4NDYsIDB4NDcsIDB4NDgsIDB4NDksIDB4NGEsIDB4NTMsIDB4NTQsIDB4NTUsIDB4NTYsIDB4NTcsIDB4NTgsIDB4NTksIDB4NWEsIDB4NjMsIDB4NjQsIDB4NjUsIDB4NjYsIDB4NjcsIDB4NjgsIDB4NjksIDB4NmEsIDB4NzMsIDB4NzQsIDB4NzUsIDB4NzYsIDB4NzcsIDB4NzgsIDB4NzksIDB4N2EsIDB4ODMsIDB4ODQsIDB4ODUsIDB4ODYsIDB4ODcsIDB4ODgsIDB4ODksIDB4OGEsIDB4OTIsIDB4OTMsIDB4OTQsIDB4OTUsIDB4OTYsIDB4OTcsIDB4OTgsIDB4OTksIDB4OWEsIDB4YTIsIDB4YTMsIDB4YTQsIDB4YTUsIDB4YTYsIDB4YTcsIDB4YTgsIDB4YTksIDB4YWEsIDB4YjIsIDB4YjMsIDB4YjQsIDB4YjUsIDB4YjYsIDB4YjcsIDB4YjgsIDB4YjksIDB4YmEsIDB4YzIsIDB4YzMsIDB4YzQsIDB4YzUsIDB4YzYsIDB4YzcsIDB4YzgsIDB4YzksIDB4Y2EsIDB4ZDIsIDB4ZDMsIDB4ZDQsIDB4ZDUsIDB4ZDYsIDB4ZDcsIDB4ZDgsIDB4ZDksIDB4ZGEsIDB4ZTEsIDB4ZTIsIDB4ZTMsIDB4ZTQsIDB4ZTUsIDB4ZTYsIDB4ZTcsIDB4ZTgsIDB4ZTksIDB4ZWEsIDB4ZjEsIDB4ZjIsIDB4ZjMsIDB4ZjQsIDB4ZjUsIDB4ZjYsIDB4ZjcsIDB4ZjgsIDB4ZjksIDB4ZmFdOwogICAgICB2YXIgc3RkX2RjX2Nocm9taW5hbmNlX25yY29kZXMgPSBbMCwgMCwgMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMCwgMCwgMCwgMCwgMF07CiAgICAgIHZhciBzdGRfZGNfY2hyb21pbmFuY2VfdmFsdWVzID0gWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDksIDEwLCAxMV07CiAgICAgIHZhciBzdGRfYWNfY2hyb21pbmFuY2VfbnJjb2RlcyA9IFswLCAwLCAyLCAxLCAyLCA0LCA0LCAzLCA0LCA3LCA1LCA0LCA0LCAwLCAxLCAyLCAweDc3XTsKICAgICAgdmFyIHN0ZF9hY19jaHJvbWluYW5jZV92YWx1ZXMgPSBbMHgwMCwgMHgwMSwgMHgwMiwgMHgwMywgMHgxMSwgMHgwNCwgMHgwNSwgMHgyMSwgMHgzMSwgMHgwNiwgMHgxMiwgMHg0MSwgMHg1MSwgMHgwNywgMHg2MSwgMHg3MSwgMHgxMywgMHgyMiwgMHgzMiwgMHg4MSwgMHgwOCwgMHgxNCwgMHg0MiwgMHg5MSwgMHhhMSwgMHhiMSwgMHhjMSwgMHgwOSwgMHgyMywgMHgzMywgMHg1MiwgMHhmMCwgMHgxNSwgMHg2MiwgMHg3MiwgMHhkMSwgMHgwYSwgMHgxNiwgMHgyNCwgMHgzNCwgMHhlMSwgMHgyNSwgMHhmMSwgMHgxNywgMHgxOCwgMHgxOSwgMHgxYSwgMHgyNiwgMHgyNywgMHgyOCwgMHgyOSwgMHgyYSwgMHgzNSwgMHgzNiwgMHgzNywgMHgzOCwgMHgzOSwgMHgzYSwgMHg0MywgMHg0NCwgMHg0NSwgMHg0NiwgMHg0NywgMHg0OCwgMHg0OSwgMHg0YSwgMHg1MywgMHg1NCwgMHg1NSwgMHg1NiwgMHg1NywgMHg1OCwgMHg1OSwgMHg1YSwgMHg2MywgMHg2NCwgMHg2NSwgMHg2NiwgMHg2NywgMHg2OCwgMHg2OSwgMHg2YSwgMHg3MywgMHg3NCwgMHg3NSwgMHg3NiwgMHg3NywgMHg3OCwgMHg3OSwgMHg3YSwgMHg4MiwgMHg4MywgMHg4NCwgMHg4NSwgMHg4NiwgMHg4NywgMHg4OCwgMHg4OSwgMHg4YSwgMHg5MiwgMHg5MywgMHg5NCwgMHg5NSwgMHg5NiwgMHg5NywgMHg5OCwgMHg5OSwgMHg5YSwgMHhhMiwgMHhhMywgMHhhNCwgMHhhNSwgMHhhNiwgMHhhNywgMHhhOCwgMHhhOSwgMHhhYSwgMHhiMiwgMHhiMywgMHhiNCwgMHhiNSwgMHhiNiwgMHhiNywgMHhiOCwgMHhiOSwgMHhiYSwgMHhjMiwgMHhjMywgMHhjNCwgMHhjNSwgMHhjNiwgMHhjNywgMHhjOCwgMHhjOSwgMHhjYSwgMHhkMiwgMHhkMywgMHhkNCwgMHhkNSwgMHhkNiwgMHhkNywgMHhkOCwgMHhkOSwgMHhkYSwgMHhlMiwgMHhlMywgMHhlNCwgMHhlNSwgMHhlNiwgMHhlNywgMHhlOCwgMHhlOSwgMHhlYSwgMHhmMiwgMHhmMywgMHhmNCwgMHhmNSwgMHhmNiwgMHhmNywgMHhmOCwgMHhmOSwgMHhmYV07CgogICAgICBmdW5jdGlvbiBpbml0UXVhbnRUYWJsZXMoc2YpIHsKICAgICAgICB2YXIgWVFUID0gWzE2LCAxMSwgMTAsIDE2LCAyNCwgNDAsIDUxLCA2MSwgMTIsIDEyLCAxNCwgMTksIDI2LCA1OCwgNjAsIDU1LCAxNCwgMTMsIDE2LCAyNCwgNDAsIDU3LCA2OSwgNTYsIDE0LCAxNywgMjIsIDI5LCA1MSwgODcsIDgwLCA2MiwgMTgsIDIyLCAzNywgNTYsIDY4LCAxMDksIDEwMywgNzcsIDI0LCAzNSwgNTUsIDY0LCA4MSwgMTA0LCAxMTMsIDkyLCA0OSwgNjQsIDc4LCA4NywgMTAzLCAxMjEsIDEyMCwgMTAxLCA3MiwgOTIsIDk1LCA5OCwgMTEyLCAxMDAsIDEwMywgOTldOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDY0OyBpKyspIHsKICAgICAgICAgIHZhciB0ID0gZmZsb29yKChZUVRbaV0gKiBzZiArIDUwKSAvIDEwMCk7CgogICAgICAgICAgaWYgKHQgPCAxKSB7CiAgICAgICAgICAgIHQgPSAxOwogICAgICAgICAgfSBlbHNlIGlmICh0ID4gMjU1KSB7CiAgICAgICAgICAgIHQgPSAyNTU7CiAgICAgICAgICB9CgogICAgICAgICAgWVRhYmxlW1ppZ1phZ1tpXV0gPSB0OwogICAgICAgIH0KCiAgICAgICAgdmFyIFVWUVQgPSBbMTcsIDE4LCAyNCwgNDcsIDk5LCA5OSwgOTksIDk5LCAxOCwgMjEsIDI2LCA2NiwgOTksIDk5LCA5OSwgOTksIDI0LCAyNiwgNTYsIDk5LCA5OSwgOTksIDk5LCA5OSwgNDcsIDY2LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTksIDk5LCA5OSwgOTldOwoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgIHZhciB1ID0gZmZsb29yKChVVlFUW2pdICogc2YgKyA1MCkgLyAxMDApOwoKICAgICAgICAgIGlmICh1IDwgMSkgewogICAgICAgICAgICB1ID0gMTsKICAgICAgICAgIH0gZWxzZSBpZiAodSA+IDI1NSkgewogICAgICAgICAgICB1ID0gMjU1OwogICAgICAgICAgfQoKICAgICAgICAgIFVWVGFibGVbWmlnWmFnW2pdXSA9IHU7CiAgICAgICAgfQoKICAgICAgICB2YXIgYWFzZiA9IFsxLjAsIDEuMzg3MDM5ODQ1LCAxLjMwNjU2Mjk2NSwgMS4xNzU4NzU2MDIsIDEuMCwgMC43ODU2OTQ5NTgsIDAuNTQxMTk2MTAwLCAwLjI3NTg5OTM3OV07CiAgICAgICAgdmFyIGsgPSAwOwoKICAgICAgICBmb3IgKHZhciByb3cgPSAwOyByb3cgPCA4OyByb3crKykgewogICAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgODsgY29sKyspIHsKICAgICAgICAgICAgZmR0YmxfWVtrXSA9IDEuMCAvIChZVGFibGVbWmlnWmFnW2tdXSAqIGFhc2Zbcm93XSAqIGFhc2ZbY29sXSAqIDguMCk7CiAgICAgICAgICAgIGZkdGJsX1VWW2tdID0gMS4wIC8gKFVWVGFibGVbWmlnWmFnW2tdXSAqIGFhc2Zbcm93XSAqIGFhc2ZbY29sXSAqIDguMCk7CiAgICAgICAgICAgIGsrKzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGNvbXB1dGVIdWZmbWFuVGJsKG5yY29kZXMsIHN0ZF90YWJsZSkgewogICAgICAgIHZhciBjb2RldmFsdWUgPSAwOwogICAgICAgIHZhciBwb3NfaW5fdGFibGUgPSAwOwogICAgICAgIHZhciBIVCA9IG5ldyBBcnJheSgpOwoKICAgICAgICBmb3IgKHZhciBrID0gMTsgayA8PSAxNjsgaysrKSB7CiAgICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8PSBucmNvZGVzW2tdOyBqKyspIHsKICAgICAgICAgICAgSFRbc3RkX3RhYmxlW3Bvc19pbl90YWJsZV1dID0gW107CiAgICAgICAgICAgIEhUW3N0ZF90YWJsZVtwb3NfaW5fdGFibGVdXVswXSA9IGNvZGV2YWx1ZTsKICAgICAgICAgICAgSFRbc3RkX3RhYmxlW3Bvc19pbl90YWJsZV1dWzFdID0gazsKICAgICAgICAgICAgcG9zX2luX3RhYmxlKys7CiAgICAgICAgICAgIGNvZGV2YWx1ZSsrOwogICAgICAgICAgfQoKICAgICAgICAgIGNvZGV2YWx1ZSAqPSAyOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIEhUOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpbml0SHVmZm1hblRibCgpIHsKICAgICAgICBZRENfSFQgPSBjb21wdXRlSHVmZm1hblRibChzdGRfZGNfbHVtaW5hbmNlX25yY29kZXMsIHN0ZF9kY19sdW1pbmFuY2VfdmFsdWVzKTsKICAgICAgICBVVkRDX0hUID0gY29tcHV0ZUh1ZmZtYW5UYmwoc3RkX2RjX2Nocm9taW5hbmNlX25yY29kZXMsIHN0ZF9kY19jaHJvbWluYW5jZV92YWx1ZXMpOwogICAgICAgIFlBQ19IVCA9IGNvbXB1dGVIdWZmbWFuVGJsKHN0ZF9hY19sdW1pbmFuY2VfbnJjb2Rlcywgc3RkX2FjX2x1bWluYW5jZV92YWx1ZXMpOwogICAgICAgIFVWQUNfSFQgPSBjb21wdXRlSHVmZm1hblRibChzdGRfYWNfY2hyb21pbmFuY2VfbnJjb2Rlcywgc3RkX2FjX2Nocm9taW5hbmNlX3ZhbHVlcyk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGluaXRDYXRlZ29yeU51bWJlcigpIHsKICAgICAgICB2YXIgbnJsb3dlciA9IDE7CiAgICAgICAgdmFyIG5ydXBwZXIgPSAyOwoKICAgICAgICBmb3IgKHZhciBjYXQgPSAxOyBjYXQgPD0gMTU7IGNhdCsrKSB7CiAgICAgICAgICAvL1Bvc2l0aXZlIG51bWJlcnMKICAgICAgICAgIGZvciAodmFyIG5yID0gbnJsb3dlcjsgbnIgPCBucnVwcGVyOyBucisrKSB7CiAgICAgICAgICAgIGNhdGVnb3J5WzMyNzY3ICsgbnJdID0gY2F0OwogICAgICAgICAgICBiaXRjb2RlWzMyNzY3ICsgbnJdID0gW107CiAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcgKyBucl1bMV0gPSBjYXQ7CiAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcgKyBucl1bMF0gPSBucjsKICAgICAgICAgIH0gLy9OZWdhdGl2ZSBudW1iZXJzCgoKICAgICAgICAgIGZvciAodmFyIG5ybmVnID0gLShucnVwcGVyIC0gMSk7IG5ybmVnIDw9IC1ucmxvd2VyOyBucm5lZysrKSB7CiAgICAgICAgICAgIGNhdGVnb3J5WzMyNzY3ICsgbnJuZWddID0gY2F0OwogICAgICAgICAgICBiaXRjb2RlWzMyNzY3ICsgbnJuZWddID0gW107CiAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcgKyBucm5lZ11bMV0gPSBjYXQ7CiAgICAgICAgICAgIGJpdGNvZGVbMzI3NjcgKyBucm5lZ11bMF0gPSBucnVwcGVyIC0gMSArIG5ybmVnOwogICAgICAgICAgfQoKICAgICAgICAgIG5ybG93ZXIgPDw9IDE7CiAgICAgICAgICBucnVwcGVyIDw8PSAxOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gaW5pdFJHQllVVlRhYmxlKCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgIFJHQl9ZVVZfVEFCTEVbaV0gPSAxOTU5NSAqIGk7CiAgICAgICAgICBSR0JfWVVWX1RBQkxFW2kgKyAyNTYgPj4gMF0gPSAzODQ3MCAqIGk7CiAgICAgICAgICBSR0JfWVVWX1RBQkxFW2kgKyA1MTIgPj4gMF0gPSA3NDcxICogaSArIDB4ODAwMDsKICAgICAgICAgIFJHQl9ZVVZfVEFCTEVbaSArIDc2OCA+PiAwXSA9IC0xMTA1OSAqIGk7CiAgICAgICAgICBSR0JfWVVWX1RBQkxFW2kgKyAxMDI0ID4+IDBdID0gLTIxNzA5ICogaTsKICAgICAgICAgIFJHQl9ZVVZfVEFCTEVbaSArIDEyODAgPj4gMF0gPSAzMjc2OCAqIGkgKyAweDgwN0ZGRjsKICAgICAgICAgIFJHQl9ZVVZfVEFCTEVbaSArIDE1MzYgPj4gMF0gPSAtMjc0MzkgKiBpOwogICAgICAgICAgUkdCX1lVVl9UQUJMRVtpICsgMTc5MiA+PiAwXSA9IC01MzI5ICogaTsKICAgICAgICB9CiAgICAgIH0gLy8gSU8gZnVuY3Rpb25zCgoKICAgICAgZnVuY3Rpb24gd3JpdGVCaXRzKGJzKSB7CiAgICAgICAgdmFyIHZhbHVlID0gYnNbMF07CiAgICAgICAgdmFyIHBvc3ZhbCA9IGJzWzFdIC0gMTsKCiAgICAgICAgd2hpbGUgKHBvc3ZhbCA+PSAwKSB7CiAgICAgICAgICBpZiAodmFsdWUgJiAxIDw8IHBvc3ZhbCkgewogICAgICAgICAgICBieXRlbmV3IHw9IDEgPDwgYnl0ZXBvczsKICAgICAgICAgIH0KCiAgICAgICAgICBwb3N2YWwtLTsKICAgICAgICAgIGJ5dGVwb3MtLTsKCiAgICAgICAgICBpZiAoYnl0ZXBvcyA8IDApIHsKICAgICAgICAgICAgaWYgKGJ5dGVuZXcgPT0gMHhGRikgewogICAgICAgICAgICAgIHdyaXRlQnl0ZSgweEZGKTsKICAgICAgICAgICAgICB3cml0ZUJ5dGUoMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgd3JpdGVCeXRlKGJ5dGVuZXcpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBieXRlcG9zID0gNzsKICAgICAgICAgICAgYnl0ZW5ldyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB3cml0ZUJ5dGUodmFsdWUpIHsKICAgICAgICBieXRlb3V0LnB1c2goY2x0W3ZhbHVlXSk7IC8vIHdyaXRlIGNoYXIgZGlyZWN0bHkgaW5zdGVhZCBvZiBjb252ZXJ0aW5nIGxhdGVyCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdyaXRlV29yZCh2YWx1ZSkgewogICAgICAgIHdyaXRlQnl0ZSh2YWx1ZSA+PiA4ICYgMHhGRik7CiAgICAgICAgd3JpdGVCeXRlKHZhbHVlICYgMHhGRik7CiAgICAgIH0gLy8gRENUICYgcXVhbnRpemF0aW9uIGNvcmUKCgogICAgICBmdW5jdGlvbiBmRENUUXVhbnQoZGF0YSwgZmR0YmwpIHsKICAgICAgICB2YXIgZDAsIGQxLCBkMiwgZDMsIGQ0LCBkNSwgZDYsIGQ3OwogICAgICAgIC8qIFBhc3MgMTogcHJvY2VzcyByb3dzLiAqLwoKICAgICAgICB2YXIgZGF0YU9mZiA9IDA7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIEk4ID0gODsKICAgICAgICB2YXIgSTY0ID0gNjQ7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBJODsgKytpKSB7CiAgICAgICAgICBkMCA9IGRhdGFbZGF0YU9mZl07CiAgICAgICAgICBkMSA9IGRhdGFbZGF0YU9mZiArIDFdOwogICAgICAgICAgZDIgPSBkYXRhW2RhdGFPZmYgKyAyXTsKICAgICAgICAgIGQzID0gZGF0YVtkYXRhT2ZmICsgM107CiAgICAgICAgICBkNCA9IGRhdGFbZGF0YU9mZiArIDRdOwogICAgICAgICAgZDUgPSBkYXRhW2RhdGFPZmYgKyA1XTsKICAgICAgICAgIGQ2ID0gZGF0YVtkYXRhT2ZmICsgNl07CiAgICAgICAgICBkNyA9IGRhdGFbZGF0YU9mZiArIDddOwogICAgICAgICAgdmFyIHRtcDAgPSBkMCArIGQ3OwogICAgICAgICAgdmFyIHRtcDcgPSBkMCAtIGQ3OwogICAgICAgICAgdmFyIHRtcDEgPSBkMSArIGQ2OwogICAgICAgICAgdmFyIHRtcDYgPSBkMSAtIGQ2OwogICAgICAgICAgdmFyIHRtcDIgPSBkMiArIGQ1OwogICAgICAgICAgdmFyIHRtcDUgPSBkMiAtIGQ1OwogICAgICAgICAgdmFyIHRtcDMgPSBkMyArIGQ0OwogICAgICAgICAgdmFyIHRtcDQgPSBkMyAtIGQ0OwogICAgICAgICAgLyogRXZlbiBwYXJ0ICovCgogICAgICAgICAgdmFyIHRtcDEwID0gdG1wMCArIHRtcDM7CiAgICAgICAgICAvKiBwaGFzZSAyICovCgogICAgICAgICAgdmFyIHRtcDEzID0gdG1wMCAtIHRtcDM7CiAgICAgICAgICB2YXIgdG1wMTEgPSB0bXAxICsgdG1wMjsKICAgICAgICAgIHZhciB0bXAxMiA9IHRtcDEgLSB0bXAyOwogICAgICAgICAgZGF0YVtkYXRhT2ZmXSA9IHRtcDEwICsgdG1wMTE7CiAgICAgICAgICAvKiBwaGFzZSAzICovCgogICAgICAgICAgZGF0YVtkYXRhT2ZmICsgNF0gPSB0bXAxMCAtIHRtcDExOwogICAgICAgICAgdmFyIHoxID0gKHRtcDEyICsgdG1wMTMpICogMC43MDcxMDY3ODE7CiAgICAgICAgICAvKiBjNCAqLwoKICAgICAgICAgIGRhdGFbZGF0YU9mZiArIDJdID0gdG1wMTMgKyB6MTsKICAgICAgICAgIC8qIHBoYXNlIDUgKi8KCiAgICAgICAgICBkYXRhW2RhdGFPZmYgKyA2XSA9IHRtcDEzIC0gejE7CiAgICAgICAgICAvKiBPZGQgcGFydCAqLwoKICAgICAgICAgIHRtcDEwID0gdG1wNCArIHRtcDU7CiAgICAgICAgICAvKiBwaGFzZSAyICovCgogICAgICAgICAgdG1wMTEgPSB0bXA1ICsgdG1wNjsKICAgICAgICAgIHRtcDEyID0gdG1wNiArIHRtcDc7CiAgICAgICAgICAvKiBUaGUgcm90YXRvciBpcyBtb2RpZmllZCBmcm9tIGZpZyA0LTggdG8gYXZvaWQgZXh0cmEgbmVnYXRpb25zLiAqLwoKICAgICAgICAgIHZhciB6NSA9ICh0bXAxMCAtIHRtcDEyKSAqIDAuMzgyNjgzNDMzOwogICAgICAgICAgLyogYzYgKi8KCiAgICAgICAgICB2YXIgejIgPSAwLjU0MTE5NjEwMCAqIHRtcDEwICsgejU7CiAgICAgICAgICAvKiBjMi1jNiAqLwoKICAgICAgICAgIHZhciB6NCA9IDEuMzA2NTYyOTY1ICogdG1wMTIgKyB6NTsKICAgICAgICAgIC8qIGMyK2M2ICovCgogICAgICAgICAgdmFyIHozID0gdG1wMTEgKiAwLjcwNzEwNjc4MTsKICAgICAgICAgIC8qIGM0ICovCgogICAgICAgICAgdmFyIHoxMSA9IHRtcDcgKyB6MzsKICAgICAgICAgIC8qIHBoYXNlIDUgKi8KCiAgICAgICAgICB2YXIgejEzID0gdG1wNyAtIHozOwogICAgICAgICAgZGF0YVtkYXRhT2ZmICsgNV0gPSB6MTMgKyB6MjsKICAgICAgICAgIC8qIHBoYXNlIDYgKi8KCiAgICAgICAgICBkYXRhW2RhdGFPZmYgKyAzXSA9IHoxMyAtIHoyOwogICAgICAgICAgZGF0YVtkYXRhT2ZmICsgMV0gPSB6MTEgKyB6NDsKICAgICAgICAgIGRhdGFbZGF0YU9mZiArIDddID0gejExIC0gejQ7CiAgICAgICAgICBkYXRhT2ZmICs9IDg7CiAgICAgICAgICAvKiBhZHZhbmNlIHBvaW50ZXIgdG8gbmV4dCByb3cgKi8KICAgICAgICB9CiAgICAgICAgLyogUGFzcyAyOiBwcm9jZXNzIGNvbHVtbnMuICovCgoKICAgICAgICBkYXRhT2ZmID0gMDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IEk4OyArK2kpIHsKICAgICAgICAgIGQwID0gZGF0YVtkYXRhT2ZmXTsKICAgICAgICAgIGQxID0gZGF0YVtkYXRhT2ZmICsgOF07CiAgICAgICAgICBkMiA9IGRhdGFbZGF0YU9mZiArIDE2XTsKICAgICAgICAgIGQzID0gZGF0YVtkYXRhT2ZmICsgMjRdOwogICAgICAgICAgZDQgPSBkYXRhW2RhdGFPZmYgKyAzMl07CiAgICAgICAgICBkNSA9IGRhdGFbZGF0YU9mZiArIDQwXTsKICAgICAgICAgIGQ2ID0gZGF0YVtkYXRhT2ZmICsgNDhdOwogICAgICAgICAgZDcgPSBkYXRhW2RhdGFPZmYgKyA1Nl07CiAgICAgICAgICB2YXIgdG1wMHAyID0gZDAgKyBkNzsKICAgICAgICAgIHZhciB0bXA3cDIgPSBkMCAtIGQ3OwogICAgICAgICAgdmFyIHRtcDFwMiA9IGQxICsgZDY7CiAgICAgICAgICB2YXIgdG1wNnAyID0gZDEgLSBkNjsKICAgICAgICAgIHZhciB0bXAycDIgPSBkMiArIGQ1OwogICAgICAgICAgdmFyIHRtcDVwMiA9IGQyIC0gZDU7CiAgICAgICAgICB2YXIgdG1wM3AyID0gZDMgKyBkNDsKICAgICAgICAgIHZhciB0bXA0cDIgPSBkMyAtIGQ0OwogICAgICAgICAgLyogRXZlbiBwYXJ0ICovCgogICAgICAgICAgdmFyIHRtcDEwcDIgPSB0bXAwcDIgKyB0bXAzcDI7CiAgICAgICAgICAvKiBwaGFzZSAyICovCgogICAgICAgICAgdmFyIHRtcDEzcDIgPSB0bXAwcDIgLSB0bXAzcDI7CiAgICAgICAgICB2YXIgdG1wMTFwMiA9IHRtcDFwMiArIHRtcDJwMjsKICAgICAgICAgIHZhciB0bXAxMnAyID0gdG1wMXAyIC0gdG1wMnAyOwogICAgICAgICAgZGF0YVtkYXRhT2ZmXSA9IHRtcDEwcDIgKyB0bXAxMXAyOwogICAgICAgICAgLyogcGhhc2UgMyAqLwoKICAgICAgICAgIGRhdGFbZGF0YU9mZiArIDMyXSA9IHRtcDEwcDIgLSB0bXAxMXAyOwogICAgICAgICAgdmFyIHoxcDIgPSAodG1wMTJwMiArIHRtcDEzcDIpICogMC43MDcxMDY3ODE7CiAgICAgICAgICAvKiBjNCAqLwoKICAgICAgICAgIGRhdGFbZGF0YU9mZiArIDE2XSA9IHRtcDEzcDIgKyB6MXAyOwogICAgICAgICAgLyogcGhhc2UgNSAqLwoKICAgICAgICAgIGRhdGFbZGF0YU9mZiArIDQ4XSA9IHRtcDEzcDIgLSB6MXAyOwogICAgICAgICAgLyogT2RkIHBhcnQgKi8KCiAgICAgICAgICB0bXAxMHAyID0gdG1wNHAyICsgdG1wNXAyOwogICAgICAgICAgLyogcGhhc2UgMiAqLwoKICAgICAgICAgIHRtcDExcDIgPSB0bXA1cDIgKyB0bXA2cDI7CiAgICAgICAgICB0bXAxMnAyID0gdG1wNnAyICsgdG1wN3AyOwogICAgICAgICAgLyogVGhlIHJvdGF0b3IgaXMgbW9kaWZpZWQgZnJvbSBmaWcgNC04IHRvIGF2b2lkIGV4dHJhIG5lZ2F0aW9ucy4gKi8KCiAgICAgICAgICB2YXIgejVwMiA9ICh0bXAxMHAyIC0gdG1wMTJwMikgKiAwLjM4MjY4MzQzMzsKICAgICAgICAgIC8qIGM2ICovCgogICAgICAgICAgdmFyIHoycDIgPSAwLjU0MTE5NjEwMCAqIHRtcDEwcDIgKyB6NXAyOwogICAgICAgICAgLyogYzItYzYgKi8KCiAgICAgICAgICB2YXIgejRwMiA9IDEuMzA2NTYyOTY1ICogdG1wMTJwMiArIHo1cDI7CiAgICAgICAgICAvKiBjMitjNiAqLwoKICAgICAgICAgIHZhciB6M3AyID0gdG1wMTFwMiAqIDAuNzA3MTA2NzgxOwogICAgICAgICAgLyogYzQgKi8KCiAgICAgICAgICB2YXIgejExcDIgPSB0bXA3cDIgKyB6M3AyOwogICAgICAgICAgLyogcGhhc2UgNSAqLwoKICAgICAgICAgIHZhciB6MTNwMiA9IHRtcDdwMiAtIHozcDI7CiAgICAgICAgICBkYXRhW2RhdGFPZmYgKyA0MF0gPSB6MTNwMiArIHoycDI7CiAgICAgICAgICAvKiBwaGFzZSA2ICovCgogICAgICAgICAgZGF0YVtkYXRhT2ZmICsgMjRdID0gejEzcDIgLSB6MnAyOwogICAgICAgICAgZGF0YVtkYXRhT2ZmICsgOF0gPSB6MTFwMiArIHo0cDI7CiAgICAgICAgICBkYXRhW2RhdGFPZmYgKyA1Nl0gPSB6MTFwMiAtIHo0cDI7CiAgICAgICAgICBkYXRhT2ZmKys7CiAgICAgICAgICAvKiBhZHZhbmNlIHBvaW50ZXIgdG8gbmV4dCBjb2x1bW4gKi8KICAgICAgICB9IC8vIFF1YW50aXplL2Rlc2NhbGUgdGhlIGNvZWZmaWNpZW50cwoKCiAgICAgICAgdmFyIGZEQ1RRdWFudDsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IEk2NDsgKytpKSB7CiAgICAgICAgICAvLyBBcHBseSB0aGUgcXVhbnRpemF0aW9uIGFuZCBzY2FsaW5nIGZhY3RvciAmIFJvdW5kIHRvIG5lYXJlc3QgaW50ZWdlcgogICAgICAgICAgZkRDVFF1YW50ID0gZGF0YVtpXSAqIGZkdGJsW2ldOwogICAgICAgICAgb3V0cHV0ZkRDVFF1YW50W2ldID0gZkRDVFF1YW50ID4gMC4wID8gZkRDVFF1YW50ICsgMC41IHwgMCA6IGZEQ1RRdWFudCAtIDAuNSB8IDA7IC8vb3V0cHV0ZkRDVFF1YW50W2ldID0gZnJvdW5kKGZEQ1RRdWFudCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gb3V0cHV0ZkRDVFF1YW50OwogICAgICB9CgogICAgICBmdW5jdGlvbiB3cml0ZUFQUDAoKSB7CiAgICAgICAgd3JpdGVXb3JkKDB4RkZFMCk7IC8vIG1hcmtlcgoKICAgICAgICB3cml0ZVdvcmQoMTYpOyAvLyBsZW5ndGgKCiAgICAgICAgd3JpdGVCeXRlKDB4NEEpOyAvLyBKCgogICAgICAgIHdyaXRlQnl0ZSgweDQ2KTsgLy8gRgoKICAgICAgICB3cml0ZUJ5dGUoMHg0OSk7IC8vIEkKCiAgICAgICAgd3JpdGVCeXRlKDB4NDYpOyAvLyBGCgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gPSAiSkZJRiIsJ1wwJwoKICAgICAgICB3cml0ZUJ5dGUoMSk7IC8vIHZlcnNpb25oaQoKICAgICAgICB3cml0ZUJ5dGUoMSk7IC8vIHZlcnNpb25sbwoKICAgICAgICB3cml0ZUJ5dGUoMCk7IC8vIHh5dW5pdHMKCiAgICAgICAgd3JpdGVXb3JkKDEpOyAvLyB4ZGVuc2l0eQoKICAgICAgICB3cml0ZVdvcmQoMSk7IC8vIHlkZW5zaXR5CgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gdGh1bWJud2lkdGgKCiAgICAgICAgd3JpdGVCeXRlKDApOyAvLyB0aHVtYm5oZWlnaHQKICAgICAgfQoKICAgICAgZnVuY3Rpb24gd3JpdGVTT0YwKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICB3cml0ZVdvcmQoMHhGRkMwKTsgLy8gbWFya2VyCgogICAgICAgIHdyaXRlV29yZCgxNyk7IC8vIGxlbmd0aCwgdHJ1ZWNvbG9yIFlVViBKUEcKCiAgICAgICAgd3JpdGVCeXRlKDgpOyAvLyBwcmVjaXNpb24KCiAgICAgICAgd3JpdGVXb3JkKGhlaWdodCk7CiAgICAgICAgd3JpdGVXb3JkKHdpZHRoKTsKICAgICAgICB3cml0ZUJ5dGUoMyk7IC8vIG5yb2Zjb21wb25lbnRzCgogICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gSWRZCgogICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZZCgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gUVRZCgogICAgICAgIHdyaXRlQnl0ZSgyKTsgLy8gSWRVCgogICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZVCgogICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gUVRVCgogICAgICAgIHdyaXRlQnl0ZSgzKTsgLy8gSWRWCgogICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFZWCgogICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gUVRWCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHdyaXRlRFFUKCkgewogICAgICAgIHdyaXRlV29yZCgweEZGREIpOyAvLyBtYXJrZXIKCiAgICAgICAgd3JpdGVXb3JkKDEzMik7IC8vIGxlbmd0aAoKICAgICAgICB3cml0ZUJ5dGUoMCk7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjQ7IGkrKykgewogICAgICAgICAgd3JpdGVCeXRlKFlUYWJsZVtpXSk7CiAgICAgICAgfQoKICAgICAgICB3cml0ZUJ5dGUoMSk7CgogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgd3JpdGVCeXRlKFVWVGFibGVbal0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gd3JpdGVESFQoKSB7CiAgICAgICAgd3JpdGVXb3JkKDB4RkZDNCk7IC8vIG1hcmtlcgoKICAgICAgICB3cml0ZVdvcmQoMHgwMUEyKTsgLy8gbGVuZ3RoCgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gSFRZRENpbmZvCgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgICAgd3JpdGVCeXRlKHN0ZF9kY19sdW1pbmFuY2VfbnJjb2Rlc1tpICsgMV0pOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPD0gMTE7IGorKykgewogICAgICAgICAgd3JpdGVCeXRlKHN0ZF9kY19sdW1pbmFuY2VfdmFsdWVzW2pdKTsKICAgICAgICB9CgogICAgICAgIHdyaXRlQnl0ZSgweDEwKTsgLy8gSFRZQUNpbmZvCgogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgMTY7IGsrKykgewogICAgICAgICAgd3JpdGVCeXRlKHN0ZF9hY19sdW1pbmFuY2VfbnJjb2Rlc1trICsgMV0pOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgbCA9IDA7IGwgPD0gMTYxOyBsKyspIHsKICAgICAgICAgIHdyaXRlQnl0ZShzdGRfYWNfbHVtaW5hbmNlX3ZhbHVlc1tsXSk7CiAgICAgICAgfQoKICAgICAgICB3cml0ZUJ5dGUoMSk7IC8vIEhUVURDaW5mbwoKICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IDE2OyBtKyspIHsKICAgICAgICAgIHdyaXRlQnl0ZShzdGRfZGNfY2hyb21pbmFuY2VfbnJjb2Rlc1ttICsgMV0pOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgbiA9IDA7IG4gPD0gMTE7IG4rKykgewogICAgICAgICAgd3JpdGVCeXRlKHN0ZF9kY19jaHJvbWluYW5jZV92YWx1ZXNbbl0pOwogICAgICAgIH0KCiAgICAgICAgd3JpdGVCeXRlKDB4MTEpOyAvLyBIVFVBQ2luZm8KCiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCAxNjsgbysrKSB7CiAgICAgICAgICB3cml0ZUJ5dGUoc3RkX2FjX2Nocm9taW5hbmNlX25yY29kZXNbbyArIDFdKTsKICAgICAgICB9CgogICAgICAgIGZvciAodmFyIHAgPSAwOyBwIDw9IDE2MTsgcCsrKSB7CiAgICAgICAgICB3cml0ZUJ5dGUoc3RkX2FjX2Nocm9taW5hbmNlX3ZhbHVlc1twXSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmdW5jdGlvbiB3cml0ZVNPUygpIHsKICAgICAgICB3cml0ZVdvcmQoMHhGRkRBKTsgLy8gbWFya2VyCgogICAgICAgIHdyaXRlV29yZCgxMik7IC8vIGxlbmd0aAoKICAgICAgICB3cml0ZUJ5dGUoMyk7IC8vIG5yb2Zjb21wb25lbnRzCgogICAgICAgIHdyaXRlQnl0ZSgxKTsgLy8gSWRZCgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gSFRZCgogICAgICAgIHdyaXRlQnl0ZSgyKTsgLy8gSWRVCgogICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFRVCgogICAgICAgIHdyaXRlQnl0ZSgzKTsgLy8gSWRWCgogICAgICAgIHdyaXRlQnl0ZSgweDExKTsgLy8gSFRWCgogICAgICAgIHdyaXRlQnl0ZSgwKTsgLy8gU3MKCiAgICAgICAgd3JpdGVCeXRlKDB4M2YpOyAvLyBTZQoKICAgICAgICB3cml0ZUJ5dGUoMCk7IC8vIEJmCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHByb2Nlc3NEVShDRFUsIGZkdGJsLCBEQywgSFREQywgSFRBQykgewogICAgICAgIHZhciBFT0IgPSBIVEFDWzB4MDBdOwogICAgICAgIHZhciBNMTZ6ZXJvZXMgPSBIVEFDWzB4RjBdOwogICAgICAgIHZhciBwb3M7CiAgICAgICAgdmFyIEkxNiA9IDE2OwogICAgICAgIHZhciBJNjMgPSA2MzsKICAgICAgICB2YXIgSTY0ID0gNjQ7CiAgICAgICAgdmFyIERVX0RDVCA9IGZEQ1RRdWFudChDRFUsIGZkdGJsKTsgLy9aaWdaYWcgcmVvcmRlcgoKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IEk2NDsgKytqKSB7CiAgICAgICAgICBEVVtaaWdaYWdbal1dID0gRFVfRENUW2pdOwogICAgICAgIH0KCiAgICAgICAgdmFyIERpZmYgPSBEVVswXSAtIERDOwogICAgICAgIERDID0gRFVbMF07IC8vRW5jb2RlIERDCgogICAgICAgIGlmIChEaWZmID09IDApIHsKICAgICAgICAgIHdyaXRlQml0cyhIVERDWzBdKTsgLy8gRGlmZiBtaWdodCBiZSAwCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBvcyA9IDMyNzY3ICsgRGlmZjsKICAgICAgICAgIHdyaXRlQml0cyhIVERDW2NhdGVnb3J5W3Bvc11dKTsKICAgICAgICAgIHdyaXRlQml0cyhiaXRjb2RlW3Bvc10pOwogICAgICAgIH0gLy9FbmNvZGUgQUNzCgoKICAgICAgICB2YXIgZW5kMHBvcyA9IDYzOyAvLyB3YXMgY29uc3QuLi4gd2hpY2ggaXMgY3JhenkKCiAgICAgICAgZm9yICg7IGVuZDBwb3MgPiAwICYmIERVW2VuZDBwb3NdID09IDA7IGVuZDBwb3MtLSkge30KCiAgICAgICAgOyAvL2VuZDBwb3MgPSBmaXJzdCBlbGVtZW50IGluIHJldmVyc2Ugb3JkZXIgIT0wCgogICAgICAgIGlmIChlbmQwcG9zID09IDApIHsKICAgICAgICAgIHdyaXRlQml0cyhFT0IpOwogICAgICAgICAgcmV0dXJuIERDOwogICAgICAgIH0KCiAgICAgICAgdmFyIGkgPSAxOwogICAgICAgIHZhciBsbmc7CgogICAgICAgIHdoaWxlIChpIDw9IGVuZDBwb3MpIHsKICAgICAgICAgIHZhciBzdGFydHBvcyA9IGk7CgogICAgICAgICAgZm9yICg7IERVW2ldID09IDAgJiYgaSA8PSBlbmQwcG9zOyArK2kpIHt9CgogICAgICAgICAgdmFyIG5yemVyb2VzID0gaSAtIHN0YXJ0cG9zOwoKICAgICAgICAgIGlmIChucnplcm9lcyA+PSBJMTYpIHsKICAgICAgICAgICAgbG5nID0gbnJ6ZXJvZXMgPj4gNDsKCiAgICAgICAgICAgIGZvciAodmFyIG5ybWFya2VyID0gMTsgbnJtYXJrZXIgPD0gbG5nOyArK25ybWFya2VyKSB7CiAgICAgICAgICAgICAgd3JpdGVCaXRzKE0xNnplcm9lcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5yemVyb2VzID0gbnJ6ZXJvZXMgJiAweEY7CiAgICAgICAgICB9CgogICAgICAgICAgcG9zID0gMzI3NjcgKyBEVVtpXTsKICAgICAgICAgIHdyaXRlQml0cyhIVEFDWyhucnplcm9lcyA8PCA0KSArIGNhdGVnb3J5W3Bvc11dKTsKICAgICAgICAgIHdyaXRlQml0cyhiaXRjb2RlW3Bvc10pOwogICAgICAgICAgaSsrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGVuZDBwb3MgIT0gSTYzKSB7CiAgICAgICAgICB3cml0ZUJpdHMoRU9CKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBEQzsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaW5pdENoYXJMb29rdXBUYWJsZSgpIHsKICAgICAgICB2YXIgc2ZjYyA9IFN0cmluZy5mcm9tQ2hhckNvZGU7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgIC8vLy8vIEFDSFRVTkcgLy8gMjU1CiAgICAgICAgICBjbHRbaV0gPSBzZmNjKGkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5lbmNvZGUgPSBmdW5jdGlvbiAoaW1hZ2UsIHF1YWxpdHkpIC8vIGltYWdlIGRhdGEgb2JqZWN0CiAgICAgIHsKICAgICAgICAvLyB2YXIgdGltZV9zdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGlmIChxdWFsaXR5KSBzZXRRdWFsaXR5KHF1YWxpdHkpOyAvLyBJbml0aWFsaXplIGJpdCB3cml0ZXIKCiAgICAgICAgYnl0ZW91dCA9IG5ldyBBcnJheSgpOwogICAgICAgIGJ5dGVuZXcgPSAwOwogICAgICAgIGJ5dGVwb3MgPSA3OyAvLyBBZGQgSlBFRyBoZWFkZXJzCgogICAgICAgIHdyaXRlV29yZCgweEZGRDgpOyAvLyBTT0kKCiAgICAgICAgd3JpdGVBUFAwKCk7CiAgICAgICAgd3JpdGVEUVQoKTsKICAgICAgICB3cml0ZVNPRjAoaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7CiAgICAgICAgd3JpdGVESFQoKTsKICAgICAgICB3cml0ZVNPUygpOyAvLyBFbmNvZGUgOHg4IG1hY3JvYmxvY2tzCgogICAgICAgIHZhciBEQ1kgPSAwOwogICAgICAgIHZhciBEQ1UgPSAwOwogICAgICAgIHZhciBEQ1YgPSAwOwogICAgICAgIGJ5dGVuZXcgPSAwOwogICAgICAgIGJ5dGVwb3MgPSA3OwogICAgICAgIHRoaXMuZW5jb2RlLmRpc3BsYXlOYW1lID0gIl9lbmNvZGVfIjsKICAgICAgICB2YXIgaW1hZ2VEYXRhID0gaW1hZ2UuZGF0YTsKICAgICAgICB2YXIgd2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICAgIHZhciBxdWFkV2lkdGggPSB3aWR0aCAqIDQ7CiAgICAgICAgdmFyIHRyaXBsZVdpZHRoID0gd2lkdGggKiAzOwogICAgICAgIHZhciB4LAogICAgICAgICAgICB5ID0gMDsKICAgICAgICB2YXIgciwgZywgYjsKICAgICAgICB2YXIgc3RhcnQsIHAsIGNvbCwgcm93LCBwb3M7CgogICAgICAgIHdoaWxlICh5IDwgaGVpZ2h0KSB7CiAgICAgICAgICB4ID0gMDsKCiAgICAgICAgICB3aGlsZSAoeCA8IHF1YWRXaWR0aCkgewogICAgICAgICAgICBzdGFydCA9IHF1YWRXaWR0aCAqIHkgKyB4OwogICAgICAgICAgICBwID0gc3RhcnQ7CiAgICAgICAgICAgIGNvbCA9IC0xOwogICAgICAgICAgICByb3cgPSAwOwoKICAgICAgICAgICAgZm9yIChwb3MgPSAwOyBwb3MgPCA2NDsgcG9zKyspIHsKICAgICAgICAgICAgICByb3cgPSBwb3MgPj4gMzsgLy8gLzgKCiAgICAgICAgICAgICAgY29sID0gKHBvcyAmIDcpICogNDsgLy8gJTgKCiAgICAgICAgICAgICAgcCA9IHN0YXJ0ICsgcm93ICogcXVhZFdpZHRoICsgY29sOwoKICAgICAgICAgICAgICBpZiAoeSArIHJvdyA+PSBoZWlnaHQpIHsKICAgICAgICAgICAgICAgIC8vIHBhZGRpbmcgYm90dG9tCiAgICAgICAgICAgICAgICBwIC09IHF1YWRXaWR0aCAqICh5ICsgMSArIHJvdyAtIGhlaWdodCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoeCArIGNvbCA+PSBxdWFkV2lkdGgpIHsKICAgICAgICAgICAgICAgIC8vIHBhZGRpbmcgcmlnaHQKICAgICAgICAgICAgICAgIHAgLT0geCArIGNvbCAtIHF1YWRXaWR0aCArIDQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByID0gaW1hZ2VEYXRhW3ArK107CiAgICAgICAgICAgICAgZyA9IGltYWdlRGF0YVtwKytdOwogICAgICAgICAgICAgIGIgPSBpbWFnZURhdGFbcCsrXTsKICAgICAgICAgICAgICAvKiAvLyBjYWxjdWxhdGUgWVVWIHZhbHVlcyBkeW5hbWljYWxseQogICAgICAgICAgICAgIFlEVVtwb3NdPSgoKCAwLjI5OTAwKSpyKyggMC41ODcwMCkqZysoIDAuMTE0MDApKmIpKS0xMjg7IC8vLTB4ODAKICAgICAgICAgICAgICBVRFVbcG9zXT0oKCgtMC4xNjg3NCkqcisoLTAuMzMxMjYpKmcrKCAwLjUwMDAwKSpiKSk7CiAgICAgICAgICAgICAgVkRVW3Bvc109KCgoIDAuNTAwMDApKnIrKC0wLjQxODY5KSpnKygtMC4wODEzMSkqYikpOwogICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgLy8gdXNlIGxvb2t1cCB0YWJsZSAoc2xpZ2h0bHkgZmFzdGVyKQoKICAgICAgICAgICAgICBZRFVbcG9zXSA9IChSR0JfWVVWX1RBQkxFW3JdICsgUkdCX1lVVl9UQUJMRVtnICsgMjU2ID4+IDBdICsgUkdCX1lVVl9UQUJMRVtiICsgNTEyID4+IDBdID4+IDE2KSAtIDEyODsKICAgICAgICAgICAgICBVRFVbcG9zXSA9IChSR0JfWVVWX1RBQkxFW3IgKyA3NjggPj4gMF0gKyBSR0JfWVVWX1RBQkxFW2cgKyAxMDI0ID4+IDBdICsgUkdCX1lVVl9UQUJMRVtiICsgMTI4MCA+PiAwXSA+PiAxNikgLSAxMjg7CiAgICAgICAgICAgICAgVkRVW3Bvc10gPSAoUkdCX1lVVl9UQUJMRVtyICsgMTI4MCA+PiAwXSArIFJHQl9ZVVZfVEFCTEVbZyArIDE1MzYgPj4gMF0gKyBSR0JfWVVWX1RBQkxFW2IgKyAxNzkyID4+IDBdID4+IDE2KSAtIDEyODsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgRENZID0gcHJvY2Vzc0RVKFlEVSwgZmR0YmxfWSwgRENZLCBZRENfSFQsIFlBQ19IVCk7CiAgICAgICAgICAgIERDVSA9IHByb2Nlc3NEVShVRFUsIGZkdGJsX1VWLCBEQ1UsIFVWRENfSFQsIFVWQUNfSFQpOwogICAgICAgICAgICBEQ1YgPSBwcm9jZXNzRFUoVkRVLCBmZHRibF9VViwgRENWLCBVVkRDX0hULCBVVkFDX0hUKTsKICAgICAgICAgICAgeCArPSAzMjsKICAgICAgICAgIH0KCiAgICAgICAgICB5ICs9IDg7CiAgICAgICAgfSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgLy8gRG8gdGhlIGJpdCBhbGlnbm1lbnQgb2YgdGhlIEVPSSBtYXJrZXIKCgogICAgICAgIGlmIChieXRlcG9zID49IDApIHsKICAgICAgICAgIHZhciBmaWxsYml0cyA9IFtdOwogICAgICAgICAgZmlsbGJpdHNbMV0gPSBieXRlcG9zICsgMTsKICAgICAgICAgIGZpbGxiaXRzWzBdID0gKDEgPDwgYnl0ZXBvcyArIDEpIC0gMTsKICAgICAgICAgIHdyaXRlQml0cyhmaWxsYml0cyk7CiAgICAgICAgfQoKICAgICAgICB3cml0ZVdvcmQoMHhGRkQ5KTsgLy9FT0kKCiAgICAgICAgdmFyIGpwZWdEYXRhVXJpID0gJ2RhdGE6aW1hZ2UvanBlZztiYXNlNjQsJyArIGJ0b2EoYnl0ZW91dC5qb2luKCcnKSk7CiAgICAgICAgYnl0ZW91dCA9IFtdOyAvLyBiZW5jaG1hcmtpbmcKICAgICAgICAvLyB2YXIgZHVyYXRpb24gPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRpbWVfc3RhcnQ7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ0VuY29kaW5nIHRpbWU6ICcrIGN1cnJlbnRRdWFsaXR5ICsgJ21zJyk7CiAgICAgICAgLy8KCiAgICAgICAgcmV0dXJuIGpwZWdEYXRhVXJpOwogICAgICB9OwoKICAgICAgZnVuY3Rpb24gc2V0UXVhbGl0eShxdWFsaXR5KSB7CiAgICAgICAgaWYgKHF1YWxpdHkgPD0gMCkgewogICAgICAgICAgcXVhbGl0eSA9IDE7CiAgICAgICAgfQoKICAgICAgICBpZiAocXVhbGl0eSA+IDEwMCkgewogICAgICAgICAgcXVhbGl0eSA9IDEwMDsKICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50UXVhbGl0eSA9PSBxdWFsaXR5KSByZXR1cm47IC8vIGRvbid0IHJlY2FsYyBpZiB1bmNoYW5nZWQKCiAgICAgICAgdmFyIHNmID0gMDsKCiAgICAgICAgaWYgKHF1YWxpdHkgPCA1MCkgewogICAgICAgICAgc2YgPSBNYXRoLmZsb29yKDUwMDAgLyBxdWFsaXR5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2YgPSBNYXRoLmZsb29yKDIwMCAtIHF1YWxpdHkgKiAyKTsKICAgICAgICB9CgogICAgICAgIGluaXRRdWFudFRhYmxlcyhzZik7CiAgICAgICAgY3VycmVudFF1YWxpdHkgPSBxdWFsaXR5OyAvLyBjb25zb2xlLmxvZygnUXVhbGl0eSBzZXQgdG86ICcrcXVhbGl0eSArJyUnKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAvLyB2YXIgdGltZV9zdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGlmICghcXVhbGl0eSkgcXVhbGl0eSA9IDUwOyAvLyBDcmVhdGUgdGFibGVzCgogICAgICAgIGluaXRDaGFyTG9va3VwVGFibGUoKTsKICAgICAgICBpbml0SHVmZm1hblRibCgpOwogICAgICAgIGluaXRDYXRlZ29yeU51bWJlcigpOwogICAgICAgIGluaXRSR0JZVVZUYWJsZSgpOwogICAgICAgIHNldFF1YWxpdHkocXVhbGl0eSk7IC8vIHZhciBkdXJhdGlvbiA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGltZV9zdGFydDsKICAgICAgICAvLyBjb25zb2xlLmxvZygnSW5pdGlhbGl6YXRpb24gJysgZHVyYXRpb24gKyAnbXMnKTsKICAgICAgfQoKICAgICAgaW5pdCgpOwogICAgfQoKICAgIDsKCiAgICBKUEVHRW5jb2Rlci5lbmNvZGUgPSBmdW5jdGlvbiAoZGF0YSwgcXVhbGl0eSkgewogICAgICB2YXIgZW5jb2RlciA9IG5ldyBKUEVHRW5jb2RlcihxdWFsaXR5KTsKICAgICAgcmV0dXJuIGVuY29kZXIuZW5jb2RlKGRhdGEpOwogICAgfTsKCiAgICByZXR1cm4gSlBFR0VuY29kZXI7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyBGaXggYW5kcm9pZCBjYW52YXMudG9EYXRhVXJsIGJ1Zy4KICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2h0bWw1L2FuZHJvaWRwYXRjaCcsIFsncnVudGltZS9odG1sNS91dGlsJywgJ3J1bnRpbWUvaHRtbDUvanBlZ2VuY29kZXInLCAnYmFzZSddLCBmdW5jdGlvbiAoVXRpbCwgZW5jb2RlciwgQmFzZSkgewogICAgdmFyIG9yaWdpbiA9IFV0aWwuY2FudmFzVG9EYXRhVXJsLAogICAgICAgIHN1cHBvcnRKcGVnOwoKICAgIFV0aWwuY2FudmFzVG9EYXRhVXJsID0gZnVuY3Rpb24gKGNhbnZhcywgdHlwZSwgcXVhbGl0eSkgewogICAgICB2YXIgY3R4LCB3LCBoLCBmcmFnZW1lbnQsIHBhcnRzOyAvLyDpnZ5hbmRyb2lk5omL5py655u05o6l6Lez6L+H44CCCgogICAgICBpZiAoIUJhc2Uub3MuYW5kcm9pZCkgewogICAgICAgIHJldHVybiBvcmlnaW4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgfSAvLyDmo4DmtYvmmK/lkKZjYW52YXPmlK/mjIFqcGVn5a+85Ye677yM5qC55o2u5pWw5o2u5qC85byP5p2l5Yik5pat44CCCiAgICAgIC8vIEpQRUcg5YmN5Lik5L2N5YiG5Yir5piv77yaMjU1LCAyMTYKCgogICAgICBpZiAodHlwZSA9PT0gJ2ltYWdlL2pwZWcnICYmIHR5cGVvZiBzdXBwb3J0SnBlZyA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBmcmFnZW1lbnQgPSBvcmlnaW4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgICAgICBwYXJ0cyA9IGZyYWdlbWVudC5zcGxpdCgnLCcpOwoKICAgICAgICBpZiAofnBhcnRzWzBdLmluZGV4T2YoJ2Jhc2U2NCcpKSB7CiAgICAgICAgICBmcmFnZW1lbnQgPSBhdG9iKHBhcnRzWzFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZnJhZ2VtZW50ID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcnRzWzFdKTsKICAgICAgICB9CgogICAgICAgIGZyYWdlbWVudCA9IGZyYWdlbWVudC5zdWJzdHJpbmcoMCwgMik7CiAgICAgICAgc3VwcG9ydEpwZWcgPSBmcmFnZW1lbnQuY2hhckNvZGVBdCgwKSA9PT0gMjU1ICYmIGZyYWdlbWVudC5jaGFyQ29kZUF0KDEpID09PSAyMTY7CiAgICAgIH0gLy8g5Y+q5pyJ5ZyoYW5kcm9pZOeOr+Wig+S4i+aJjeS/ruWkjQoKCiAgICAgIGlmICh0eXBlID09PSAnaW1hZ2UvanBlZycgJiYgIXN1cHBvcnRKcGVnKSB7CiAgICAgICAgdyA9IGNhbnZhcy53aWR0aDsKICAgICAgICBoID0gY2FudmFzLmhlaWdodDsKICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICByZXR1cm4gZW5jb2Rlci5lbmNvZGUoY3R4LmdldEltYWdlRGF0YSgwLCAwLCB3LCBoKSwgcXVhbGl0eSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvcmlnaW4uYXBwbHkobnVsbCwgYXJndW1lbnRzKTsKICAgIH07CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyBJbWFnZQogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvaHRtbDUvaW1hZ2UnLCBbJ2Jhc2UnLCAncnVudGltZS9odG1sNS9ydW50aW1lJywgJ3J1bnRpbWUvaHRtbDUvdXRpbCddLCBmdW5jdGlvbiAoQmFzZSwgSHRtbDVSdW50aW1lLCBVdGlsKSB7CiAgICB2YXIgQkxBTksgPSAnZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBRC9BQ3dBQUFBQUFRQUJBQUFDQURzJTNEJzsKICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoJ0ltYWdlJywgewogICAgICAvLyBmbGFnOiDmoIforrDmmK/lkKbooqvkv67mlLnov4fjgIIKICAgICAgbW9kaWZpZWQ6IGZhbHNlLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIGltZyA9IG5ldyBJbWFnZSgpOwoKICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgbWUuX2luZm8gPSB7CiAgICAgICAgICAgIHR5cGU6IG1lLnR5cGUsCiAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLAogICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0CiAgICAgICAgICB9OyAvL2RlYnVnZ2VyOwogICAgICAgICAgLy8g6K+75Y+WbWV0YeS/oeaBr+OAggoKICAgICAgICAgIGlmICghbWUuX21ldGFzICYmICdpbWFnZS9qcGVnJyA9PT0gbWUudHlwZSkgewogICAgICAgICAgICBVdGlsLnBhcnNlTWV0YShtZS5fYmxvYiwgZnVuY3Rpb24gKGVycm9yLCByZXQpIHsKICAgICAgICAgICAgICBtZS5fbWV0YXMgPSByZXQ7CiAgICAgICAgICAgICAgbWUub3duZXIudHJpZ2dlcignbG9hZCcpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ2xvYWQnKTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG1lLm93bmVyLnRyaWdnZXIoJ2Vycm9yJyk7CiAgICAgICAgfTsKCiAgICAgICAgbWUuX2ltZyA9IGltZzsKICAgICAgfSwKICAgICAgbG9hZEZyb21CbG9iOiBmdW5jdGlvbiBsb2FkRnJvbUJsb2IoYmxvYikgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIGltZyA9IG1lLl9pbWc7CiAgICAgICAgbWUuX2Jsb2IgPSBibG9iOwogICAgICAgIG1lLnR5cGUgPSBibG9iLnR5cGU7CiAgICAgICAgaW1nLnNyYyA9IFV0aWwuY3JlYXRlT2JqZWN0VVJMKGJsb2IuZ2V0U291cmNlKCkpOwogICAgICAgIG1lLm93bmVyLm9uY2UoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBVdGlsLnJldm9rZU9iamVjdFVSTChpbWcuc3JjKTsKICAgICAgICB9KTsKICAgICAgfSwKICAgICAgcmVzaXplOiBmdW5jdGlvbiByZXNpemUod2lkdGgsIGhlaWdodCkgewogICAgICAgIHZhciBjYW52YXMgPSB0aGlzLl9jYW52YXMgfHwgKHRoaXMuX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpKTsKCiAgICAgICAgdGhpcy5fcmVzaXplKHRoaXMuX2ltZywgY2FudmFzLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgdGhpcy5fYmxvYiA9IG51bGw7IC8vIOayoeeUqOS6hu+8jOWPr+S7peWIoOaOieS6huOAggoKICAgICAgICB0aGlzLm1vZGlmaWVkID0gdHJ1ZTsKICAgICAgICB0aGlzLm93bmVyLnRyaWdnZXIoJ2NvbXBsZXRlJywgJ3Jlc2l6ZScpOwogICAgICB9LAogICAgICBjcm9wOiBmdW5jdGlvbiBjcm9wKHgsIHksIHcsIGgsIHMpIHsKICAgICAgICB2YXIgY3ZzID0gdGhpcy5fY2FudmFzIHx8ICh0aGlzLl9jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSksCiAgICAgICAgICAgIG9wdHMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgIGltZyA9IHRoaXMuX2ltZywKICAgICAgICAgICAgaXcgPSBpbWcubmF0dXJhbFdpZHRoLAogICAgICAgICAgICBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0LAogICAgICAgICAgICBvcmllbnRhdGlvbiA9IHRoaXMuZ2V0T3JpZW50YXRpb24oKTsKICAgICAgICBzID0gcyB8fCAxOyAvLyB0b2RvIOino+WGsyBvcmllbnRhdGlvbiDnmoTpl67popjjgIIKICAgICAgICAvLyB2YWx1ZXMgdGhhdCByZXF1aXJlIDkwIGRlZ3JlZSByb3RhdGlvbgogICAgICAgIC8vIGlmICggflsgNSwgNiwgNywgOCBdLmluZGV4T2YoIG9yaWVudGF0aW9uICkgKSB7CiAgICAgICAgLy8gICAgIHN3aXRjaCAoIG9yaWVudGF0aW9uICkgewogICAgICAgIC8vICAgICAgICAgY2FzZSA2OgogICAgICAgIC8vICAgICAgICAgICAgIHRtcCA9IHg7CiAgICAgICAgLy8gICAgICAgICAgICAgeCA9IHk7CiAgICAgICAgLy8gICAgICAgICAgICAgeSA9IGl3ICogcyAtIHRtcCAtIHc7CiAgICAgICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coaWggKiBzLCB0bXAsIHcpCiAgICAgICAgLy8gICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gICAgIH0KICAgICAgICAvLyAgICAgKHcgXj0gaCwgaCBePSB3LCB3IF49IGgpOwogICAgICAgIC8vIH0KCiAgICAgICAgY3ZzLndpZHRoID0gdzsKICAgICAgICBjdnMuaGVpZ2h0ID0gaDsKICAgICAgICBvcHRzLnByZXNlcnZlSGVhZGVycyB8fCB0aGlzLl9yb3RhdGUyT3JpZW50YWlvbihjdnMsIG9yaWVudGF0aW9uKTsKCiAgICAgICAgdGhpcy5fcmVuZGVySW1hZ2VUb0NhbnZhcyhjdnMsIGltZywgLXgsIC15LCBpdyAqIHMsIGloICogcyk7CgogICAgICAgIHRoaXMuX2Jsb2IgPSBudWxsOyAvLyDmsqHnlKjkuobvvIzlj6/ku6XliKDmjonkuobjgIIKCiAgICAgICAgdGhpcy5tb2RpZmllZCA9IHRydWU7CiAgICAgICAgdGhpcy5vd25lci50cmlnZ2VyKCdjb21wbGV0ZScsICdjcm9wJyk7CiAgICAgIH0sCiAgICAgIGdldEFzQmxvYjogZnVuY3Rpb24gZ2V0QXNCbG9iKHR5cGUpIHsKICAgICAgICB2YXIgYmxvYiA9IHRoaXMuX2Jsb2IsCiAgICAgICAgICAgIG9wdHMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgIGNhbnZhczsKICAgICAgICB0eXBlID0gdHlwZSB8fCB0aGlzLnR5cGU7IC8vIGJsb2LpnIDopoHph43mlrDnlJ/miJDjgIIKCiAgICAgICAgaWYgKHRoaXMubW9kaWZpZWQgfHwgdGhpcy50eXBlICE9PSB0eXBlKSB7CiAgICAgICAgICBjYW52YXMgPSB0aGlzLl9jYW52YXM7CgogICAgICAgICAgaWYgKHR5cGUgPT09ICdpbWFnZS9qcGVnJykgewogICAgICAgICAgICBibG9iID0gVXRpbC5jYW52YXNUb0RhdGFVcmwoY2FudmFzLCB0eXBlLCBvcHRzLnF1YWxpdHkpOwoKICAgICAgICAgICAgaWYgKG9wdHMucHJlc2VydmVIZWFkZXJzICYmIHRoaXMuX21ldGFzICYmIHRoaXMuX21ldGFzLmltYWdlSGVhZCkgewogICAgICAgICAgICAgIGJsb2IgPSBVdGlsLmRhdGFVUkwyQXJyYXlCdWZmZXIoYmxvYik7CiAgICAgICAgICAgICAgYmxvYiA9IFV0aWwudXBkYXRlSW1hZ2VIZWFkKGJsb2IsIHRoaXMuX21ldGFzLmltYWdlSGVhZCk7CiAgICAgICAgICAgICAgYmxvYiA9IFV0aWwuYXJyYXlCdWZmZXJUb0Jsb2IoYmxvYiwgdHlwZSk7CiAgICAgICAgICAgICAgcmV0dXJuIGJsb2I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJsb2IgPSBVdGlsLmNhbnZhc1RvRGF0YVVybChjYW52YXMsIHR5cGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGJsb2IgPSBVdGlsLmRhdGFVUkwyQmxvYihibG9iKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBibG9iOwogICAgICB9LAogICAgICBnZXRBc0RhdGFVcmw6IGZ1bmN0aW9uIGdldEFzRGF0YVVybCh0eXBlKSB7CiAgICAgICAgdmFyIG9wdHMgPSB0aGlzLm9wdGlvbnM7CiAgICAgICAgdHlwZSA9IHR5cGUgfHwgdGhpcy50eXBlOwoKICAgICAgICBpZiAodHlwZSA9PT0gJ2ltYWdlL2pwZWcnKSB7CiAgICAgICAgICByZXR1cm4gVXRpbC5jYW52YXNUb0RhdGFVcmwodGhpcy5fY2FudmFzLCB0eXBlLCBvcHRzLnF1YWxpdHkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY2FudmFzLnRvRGF0YVVSTCh0eXBlKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldE9yaWVudGF0aW9uOiBmdW5jdGlvbiBnZXRPcmllbnRhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fbWV0YXMgJiYgdGhpcy5fbWV0YXMuZXhpZiAmJiB0aGlzLl9tZXRhcy5leGlmLmdldCgnT3JpZW50YXRpb24nKSB8fCAxOwogICAgICB9LAogICAgICBpbmZvOiBmdW5jdGlvbiBpbmZvKHZhbCkgewogICAgICAgIC8vIHNldHRlcgogICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgIHRoaXMuX2luZm8gPSB2YWw7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IC8vIGdldHRlcgoKCiAgICAgICAgcmV0dXJuIHRoaXMuX2luZm87CiAgICAgIH0sCiAgICAgIG1ldGE6IGZ1bmN0aW9uIG1ldGEodmFsKSB7CiAgICAgICAgLy8gc2V0dGVyCiAgICAgICAgaWYgKHZhbCkgewogICAgICAgICAgdGhpcy5fbWV0YXMgPSB2YWw7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9IC8vIGdldHRlcgoKCiAgICAgICAgcmV0dXJuIHRoaXMuX21ldGFzOwogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHZhciBjYW52YXMgPSB0aGlzLl9jYW52YXM7CiAgICAgICAgdGhpcy5faW1nLm9ubG9hZCA9IG51bGw7CgogICAgICAgIGlmIChjYW52YXMpIHsKICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgY2FudmFzLndpZHRoID0gY2FudmFzLmhlaWdodCA9IDA7CiAgICAgICAgICB0aGlzLl9jYW52YXMgPSBudWxsOwogICAgICAgIH0gLy8g6YeK5pS+5YaF5a2Y44CC6Z2e5bi46YeN6KaB77yM5ZCm5YiZ6YeK5pS+5LiN5LqGaW1hZ2XnmoTlhoXlrZjjgIIKCgogICAgICAgIHRoaXMuX2ltZy5zcmMgPSBCTEFOSzsKICAgICAgICB0aGlzLl9pbWcgPSB0aGlzLl9ibG9iID0gbnVsbDsKICAgICAgfSwKICAgICAgX3Jlc2l6ZTogZnVuY3Rpb24gX3Jlc2l6ZShpbWcsIGN2cywgd2lkdGgsIGhlaWdodCkgewogICAgICAgIHZhciBvcHRzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBuYXR1cmFsV2lkdGggPSBpbWcud2lkdGgsCiAgICAgICAgICAgIG5hdHVyYWxIZWlnaHQgPSBpbWcuaGVpZ2h0LAogICAgICAgICAgICBvcmllbnRhdGlvbiA9IHRoaXMuZ2V0T3JpZW50YXRpb24oKSwKICAgICAgICAgICAgc2NhbGUsCiAgICAgICAgICAgIHcsCiAgICAgICAgICAgIGgsCiAgICAgICAgICAgIHgsCiAgICAgICAgICAgIHk7IC8vIHZhbHVlcyB0aGF0IHJlcXVpcmUgOTAgZGVncmVlIHJvdGF0aW9uCgogICAgICAgIGlmICh+WzUsIDYsIDcsIDhdLmluZGV4T2Yob3JpZW50YXRpb24pKSB7CiAgICAgICAgICAvLyDkuqTmjaJ3aWR0aCwgaGVpZ2h055qE5YC844CCCiAgICAgICAgICB3aWR0aCBePSBoZWlnaHQ7CiAgICAgICAgICBoZWlnaHQgXj0gd2lkdGg7CiAgICAgICAgICB3aWR0aCBePSBoZWlnaHQ7CiAgICAgICAgfQoKICAgICAgICBzY2FsZSA9IE1hdGhbb3B0cy5jcm9wID8gJ21heCcgOiAnbWluJ10od2lkdGggLyBuYXR1cmFsV2lkdGgsIGhlaWdodCAvIG5hdHVyYWxIZWlnaHQpOyAvLyDkuI3lhYHorrjmlL7lpKfjgIIKCiAgICAgICAgb3B0cy5hbGxvd01hZ25pZnkgfHwgKHNjYWxlID0gTWF0aC5taW4oMSwgc2NhbGUpKTsKICAgICAgICB3ID0gbmF0dXJhbFdpZHRoICogc2NhbGU7CiAgICAgICAgaCA9IG5hdHVyYWxIZWlnaHQgKiBzY2FsZTsKCiAgICAgICAgaWYgKG9wdHMuY3JvcCkgewogICAgICAgICAgY3ZzLndpZHRoID0gd2lkdGg7CiAgICAgICAgICBjdnMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjdnMud2lkdGggPSB3OwogICAgICAgICAgY3ZzLmhlaWdodCA9IGg7CiAgICAgICAgfQoKICAgICAgICB4ID0gKGN2cy53aWR0aCAtIHcpIC8gMjsKICAgICAgICB5ID0gKGN2cy5oZWlnaHQgLSBoKSAvIDI7CiAgICAgICAgb3B0cy5wcmVzZXJ2ZUhlYWRlcnMgfHwgdGhpcy5fcm90YXRlMk9yaWVudGFpb24oY3ZzLCBvcmllbnRhdGlvbik7CgogICAgICAgIHRoaXMuX3JlbmRlckltYWdlVG9DYW52YXMoY3ZzLCBpbWcsIHgsIHksIHcsIGgpOwogICAgICB9LAogICAgICBfcm90YXRlMk9yaWVudGFpb246IGZ1bmN0aW9uIF9yb3RhdGUyT3JpZW50YWlvbihjYW52YXMsIG9yaWVudGF0aW9uKSB7CiAgICAgICAgdmFyIHdpZHRoID0gY2FudmFzLndpZHRoLAogICAgICAgICAgICBoZWlnaHQgPSBjYW52YXMuaGVpZ2h0LAogICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgc3dpdGNoIChvcmllbnRhdGlvbikgewogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBjYW52YXMud2lkdGggPSBoZWlnaHQ7CiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKG9yaWVudGF0aW9uKSB7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIC8vIGhvcml6b250YWwgZmxpcAogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLCAwKTsKICAgICAgICAgICAgY3R4LnNjYWxlKC0xLCAxKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAvLyAxODAgcm90YXRlIGxlZnQKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LnJvdGF0ZShNYXRoLlBJKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAvLyB2ZXJ0aWNhbCBmbGlwCiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LnNjYWxlKDEsIC0xKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAvLyB2ZXJ0aWNhbCBmbGlwICsgOTAgcm90YXRlIHJpZ2h0CiAgICAgICAgICAgIGN0eC5yb3RhdGUoMC41ICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC5zY2FsZSgxLCAtMSk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgLy8gOTAgcm90YXRlIHJpZ2h0CiAgICAgICAgICAgIGN0eC5yb3RhdGUoMC41ICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgLWhlaWdodCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgLy8gaG9yaXpvbnRhbCBmbGlwICsgOTAgcm90YXRlIHJpZ2h0CiAgICAgICAgICAgIGN0eC5yb3RhdGUoMC41ICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGgsIC1oZWlnaHQpOwogICAgICAgICAgICBjdHguc2NhbGUoLTEsIDEpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIC8vIDkwIHJvdGF0ZSBsZWZ0CiAgICAgICAgICAgIGN0eC5yb3RhdGUoLTAuNSAqIE1hdGguUEkpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKC13aWR0aCwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3N0b21pdGEvaW9zLWltYWdlZmlsZS1tZWdhcGl4ZWwvCiAgICAgIC8vIGJsb2IvbWFzdGVyL3NyYy9tZWdhcGl4LWltYWdlLmpzCiAgICAgIF9yZW5kZXJJbWFnZVRvQ2FudmFzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8g5aaC5p6c5LiN5pivaW9zLCDkuI3pnIDopoHov5nkuYjlpI3mnYLvvIEKICAgICAgICBpZiAoIUJhc2Uub3MuaW9zKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGNhbnZhcykgewogICAgICAgICAgICB2YXIgYXJncyA9IEJhc2Uuc2xpY2UoYXJndW1lbnRzLCAxKSwKICAgICAgICAgICAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlLmFwcGx5KGN0eCwgYXJncyk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEZXRlY3RpbmcgdmVydGljYWwgc3F1YXNoIGluIGxvYWRlZCBpbWFnZS4KICAgICAgICAgKiBGaXhlcyBhIGJ1ZyB3aGljaCBzcXVhc2ggaW1hZ2UgdmVydGljYWxseSB3aGlsZSBkcmF3aW5nIGludG8KICAgICAgICAgKiBjYW52YXMgZm9yIHNvbWUgaW1hZ2VzLgogICAgICAgICAqLwoKCiAgICAgICAgZnVuY3Rpb24gZGV0ZWN0VmVydGljYWxTcXVhc2goaW1nLCBpdywgaWgpIHsKICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKSwKICAgICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSwKICAgICAgICAgICAgICBzeSA9IDAsCiAgICAgICAgICAgICAgZXkgPSBpaCwKICAgICAgICAgICAgICBweSA9IGloLAogICAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgICAgYWxwaGEsCiAgICAgICAgICAgICAgcmF0aW87CiAgICAgICAgICBjYW52YXMud2lkdGggPSAxOwogICAgICAgICAgY2FudmFzLmhlaWdodCA9IGloOwogICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApOwogICAgICAgICAgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgaWgpLmRhdGE7IC8vIHNlYXJjaCBpbWFnZSBlZGdlIHBpeGVsIHBvc2l0aW9uIGluIGNhc2UKICAgICAgICAgIC8vIGl0IGlzIHNxdWFzaGVkIHZlcnRpY2FsbHkuCgogICAgICAgICAgd2hpbGUgKHB5ID4gc3kpIHsKICAgICAgICAgICAgYWxwaGEgPSBkYXRhWyhweSAtIDEpICogNCArIDNdOwoKICAgICAgICAgICAgaWYgKGFscGhhID09PSAwKSB7CiAgICAgICAgICAgICAgZXkgPSBweTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzeSA9IHB5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBweSA9IGV5ICsgc3kgPj4gMTsKICAgICAgICAgIH0KCiAgICAgICAgICByYXRpbyA9IHB5IC8gaWg7CiAgICAgICAgICByZXR1cm4gcmF0aW8gPT09IDAgPyAxIDogcmF0aW87CiAgICAgICAgfSAvLyBmaXggaWU3IGJ1ZwogICAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTE5MjkwOTkvCiAgICAgICAgLy8gaHRtbDUtY2FudmFzLWRyYXdpbWFnZS1yYXRpby1idWctaW9zCgoKICAgICAgICBpZiAoQmFzZS5vcy5pb3MgPj0gNykgewogICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChjYW52YXMsIGltZywgeCwgeSwgdywgaCkgewogICAgICAgICAgICB2YXIgaXcgPSBpbWcubmF0dXJhbFdpZHRoLAogICAgICAgICAgICAgICAgaWggPSBpbWcubmF0dXJhbEhlaWdodCwKICAgICAgICAgICAgICAgIHZlcnRTcXVhc2hSYXRpbyA9IGRldGVjdFZlcnRpY2FsU3F1YXNoKGltZywgaXcsIGloKTsKICAgICAgICAgICAgcmV0dXJuIGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDAsIGl3ICogdmVydFNxdWFzaFJhdGlvLCBpaCAqIHZlcnRTcXVhc2hSYXRpbywgeCwgeSwgdywgaCk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICAgKiBEZXRlY3Qgc3Vic2FtcGxpbmcgaW4gbG9hZGVkIGltYWdlLgogICAgICAgICAqIEluIGlPUywgbGFyZ2VyIGltYWdlcyB0aGFuIDJNIHBpeGVscyBtYXkgYmUKICAgICAgICAgKiBzdWJzYW1wbGVkIGluIHJlbmRlcmluZy4KICAgICAgICAgKi8KCgogICAgICAgIGZ1bmN0aW9uIGRldGVjdFN1YnNhbXBsaW5nKGltZykgewogICAgICAgICAgdmFyIGl3ID0gaW1nLm5hdHVyYWxXaWR0aCwKICAgICAgICAgICAgICBpaCA9IGltZy5uYXR1cmFsSGVpZ2h0LAogICAgICAgICAgICAgIGNhbnZhcywKICAgICAgICAgICAgICBjdHg7IC8vIHN1YnNhbXBsaW5nIG1heSBoYXBwZW4gb3Zlcm1lZ2FwaXhlbCBpbWFnZQoKICAgICAgICAgIGlmIChpdyAqIGloID4gMTAyNCAqIDEwMjQpIHsKICAgICAgICAgICAgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAxOwogICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIC1pdyArIDEsIDApOyAvLyBzdWJzYW1wbGVkIGltYWdlIGJlY29tZXMgaGFsZiBzbWFsbGVyIGluIHJlbmRlcmluZyBzaXplLgogICAgICAgICAgICAvLyBjaGVjayBhbHBoYSBjaGFubmVsIHZhbHVlIHRvIGNvbmZpcm0gaW1hZ2UgaXMgY292ZXJpbmcKICAgICAgICAgICAgLy8gZWRnZSBwaXhlbCBvciBub3QuIGlmIGFscGhhIHZhbHVlIGlzIDAKICAgICAgICAgICAgLy8gaW1hZ2UgaXMgbm90IGNvdmVyaW5nLCBoZW5jZSBzdWJzYW1wbGVkLgoKICAgICAgICAgICAgcmV0dXJuIGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YVszXSA9PT0gMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoY2FudmFzLCBpbWcsIHgsIHksIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIHZhciBpdyA9IGltZy5uYXR1cmFsV2lkdGgsCiAgICAgICAgICAgICAgaWggPSBpbWcubmF0dXJhbEhlaWdodCwKICAgICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSwKICAgICAgICAgICAgICBzdWJzYW1wbGVkID0gZGV0ZWN0U3Vic2FtcGxpbmcoaW1nKSwKICAgICAgICAgICAgICBkb1NxdWFzaCA9IHRoaXMudHlwZSA9PT0gJ2ltYWdlL2pwZWcnLAogICAgICAgICAgICAgIGQgPSAxMDI0LAogICAgICAgICAgICAgIHN5ID0gMCwKICAgICAgICAgICAgICBkeSA9IDAsCiAgICAgICAgICAgICAgdG1wQ2FudmFzLAogICAgICAgICAgICAgIHRtcEN0eCwKICAgICAgICAgICAgICB2ZXJ0U3F1YXNoUmF0aW8sCiAgICAgICAgICAgICAgZHcsCiAgICAgICAgICAgICAgZGgsCiAgICAgICAgICAgICAgc3gsCiAgICAgICAgICAgICAgZHg7CgogICAgICAgICAgaWYgKHN1YnNhbXBsZWQpIHsKICAgICAgICAgICAgaXcgLz0gMjsKICAgICAgICAgICAgaWggLz0gMjsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgdG1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICB0bXBDYW52YXMud2lkdGggPSB0bXBDYW52YXMuaGVpZ2h0ID0gZDsKICAgICAgICAgIHRtcEN0eCA9IHRtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgdmVydFNxdWFzaFJhdGlvID0gZG9TcXVhc2ggPyBkZXRlY3RWZXJ0aWNhbFNxdWFzaChpbWcsIGl3LCBpaCkgOiAxOwogICAgICAgICAgZHcgPSBNYXRoLmNlaWwoZCAqIHdpZHRoIC8gaXcpOwogICAgICAgICAgZGggPSBNYXRoLmNlaWwoZCAqIGhlaWdodCAvIGloIC8gdmVydFNxdWFzaFJhdGlvKTsKCiAgICAgICAgICB3aGlsZSAoc3kgPCBpaCkgewogICAgICAgICAgICBzeCA9IDA7CiAgICAgICAgICAgIGR4ID0gMDsKCiAgICAgICAgICAgIHdoaWxlIChzeCA8IGl3KSB7CiAgICAgICAgICAgICAgdG1wQ3R4LmNsZWFyUmVjdCgwLCAwLCBkLCBkKTsKICAgICAgICAgICAgICB0bXBDdHguZHJhd0ltYWdlKGltZywgLXN4LCAtc3kpOwogICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodG1wQ2FudmFzLCAwLCAwLCBkLCBkLCB4ICsgZHgsIHkgKyBkeSwgZHcsIGRoKTsKICAgICAgICAgICAgICBzeCArPSBkOwogICAgICAgICAgICAgIGR4ICs9IGR3OwogICAgICAgICAgICB9CgogICAgICAgICAgICBzeSArPSBkOwogICAgICAgICAgICBkeSArPSBkaDsKICAgICAgICAgIH0KCiAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgdG1wQ2FudmFzID0gdG1wQ3R4ID0gbnVsbDsKICAgICAgICB9OwogICAgICB9KCkKICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgVHJhbnNwb3J0CiAgICogQHRvZG8g5pSv5oyBY2h1bmtlZOS8oOi+k++8jOS8mOWKv++8mgogICAqIOWPr+S7peWwhuWkp+aWh+S7tuWIhuaIkOWwj+Wdl++8jOaMqOS4quS8oOi+k++8jOWPr+S7peaPkOmrmOWkp+aWh+S7tuaIkOWKn+eOh++8jOW9k+Wksei0peeahOaXtuWAme+8jOS5n+WPqumcgOimgemHjeS8oOmCo+Wwj+mDqOWIhu+8jAogICAqIOiAjOS4jemcgOimgemHjeWktOWGjeS8oOS4gOasoeOAguWPpuWkluaWreeCuee7reS8oOS5n+mcgOimgeeUqGNodW5rZWTmlrnlvI/jgIIKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2h0bWw1L3RyYW5zcG9ydCcsIFsnYmFzZScsICdydW50aW1lL2h0bWw1L3J1bnRpbWUnXSwgZnVuY3Rpb24gKEJhc2UsIEh0bWw1UnVudGltZSkgewogICAgdmFyIG5vb3AgPSBCYXNlLm5vb3AsCiAgICAgICAgJCA9IEJhc2UuJDsKICAgIHJldHVybiBIdG1sNVJ1bnRpbWUucmVnaXN0ZXIoJ1RyYW5zcG9ydCcsIHsKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB0aGlzLl9zdGF0dXMgPSAwOwogICAgICAgIHRoaXMuX3Jlc3BvbnNlID0gbnVsbDsKICAgICAgfSwKICAgICAgc2VuZDogZnVuY3Rpb24gc2VuZCgpIHsKICAgICAgICB2YXIgb3duZXIgPSB0aGlzLm93bmVyLAogICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICB4aHIgPSB0aGlzLl9pbml0QWpheCgpLAogICAgICAgICAgICBibG9iID0gb3duZXIuX2Jsb2IsCiAgICAgICAgICAgIHNlcnZlciA9IG9wdHMuc2VydmVyLAogICAgICAgICAgICBmb3JtRGF0YSwKICAgICAgICAgICAgYmluYXJ5LAogICAgICAgICAgICBmcjsKCiAgICAgICAgaWYgKG9wdHMuc2VuZEFzQmluYXJ5KSB7CiAgICAgICAgICBzZXJ2ZXIgKz0gb3B0cy5hdHRhY2hJbmZvVG9RdWVyeSAhPT0gZmFsc2UgPyAoL1w/Ly50ZXN0KHNlcnZlcikgPyAnJicgOiAnPycpICsgJC5wYXJhbShvd25lci5fZm9ybURhdGEpIDogJyc7CiAgICAgICAgICBiaW5hcnkgPSBibG9iLmdldFNvdXJjZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgJC5lYWNoKG93bmVyLl9mb3JtRGF0YSwgZnVuY3Rpb24gKGssIHYpIHsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKGssIHYpOwogICAgICAgICAgfSk7CiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQob3B0cy5maWxlVmFsLCBibG9iLmdldFNvdXJjZSgpLCBvcHRzLmZpbGVuYW1lIHx8IG93bmVyLl9mb3JtRGF0YS5uYW1lIHx8ICcnKTsKICAgICAgICB9CgogICAgICAgIGlmIChvcHRzLndpdGhDcmVkZW50aWFscyAmJiAnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpIHsKICAgICAgICAgIHhoci5vcGVuKG9wdHMubWV0aG9kLCBzZXJ2ZXIsIHRydWUpOwogICAgICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHhoci5vcGVuKG9wdHMubWV0aG9kLCBzZXJ2ZXIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fc2V0UmVxdWVzdEhlYWRlcih4aHIsIG9wdHMuaGVhZGVycyk7CgogICAgICAgIGlmIChiaW5hcnkpIHsKICAgICAgICAgIC8vIOW8uuWItuiuvue9ruaIkCBjb250ZW50LXR5cGUg5Li65paH5Lu25rWB44CCCiAgICAgICAgICB4aHIub3ZlcnJpZGVNaW1lVHlwZSAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSgnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJyk7IC8vIGFuZHJvaWTnm7TmjqXlj5HpgIFibG9i5Lya5a+86Ie05pyN5Yqh56uv5o6l5pS25Yiw55qE5piv56m65paH5Lu244CCCiAgICAgICAgICAvLyBidWfor6bmg4XjgIIKICAgICAgICAgIC8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvYW5kcm9pZC9pc3N1ZXMvZGV0YWlsP2lkPTM5ODgyCiAgICAgICAgICAvLyDmiYDku6XlhYjnlKhmaWxlUmVhZGVy6K+75Y+W5Ye65p2l5YaN6YCa6L+HYXJyYXlidWZmZXLnmoTmlrnlvI/lj5HpgIHjgIIKCiAgICAgICAgICBpZiAoQmFzZS5vcy5hbmRyb2lkKSB7CiAgICAgICAgICAgIGZyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgICAgICAgIGZyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB4aHIuc2VuZCh0aGlzLnJlc3VsdCk7CiAgICAgICAgICAgICAgZnIgPSBmci5vbmxvYWQgPSBudWxsOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgZnIucmVhZEFzQXJyYXlCdWZmZXIoYmluYXJ5KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHhoci5zZW5kKGJpbmFyeSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbiBnZXRSZXNwb25zZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2U7CiAgICAgIH0sCiAgICAgIGdldFJlc3BvbnNlQXNKc29uOiBmdW5jdGlvbiBnZXRSZXNwb25zZUFzSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcGFyc2VKc29uKHRoaXMuX3Jlc3BvbnNlKTsKICAgICAgfSwKICAgICAgZ2V0UmVzcG9uc2VIZWFkZXJzOiBmdW5jdGlvbiBnZXRSZXNwb25zZUhlYWRlcnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2hlYWRlcnM7CiAgICAgIH0sCiAgICAgIGdldFN0YXR1czogZnVuY3Rpb24gZ2V0U3RhdHVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICAgIH0sCiAgICAgIGFib3J0OiBmdW5jdGlvbiBhYm9ydCgpIHsKICAgICAgICB2YXIgeGhyID0gdGhpcy5feGhyOwoKICAgICAgICBpZiAoeGhyKSB7CiAgICAgICAgICB4aHIudXBsb2FkLm9ucHJvZ3Jlc3MgPSBub29wOwogICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IG5vb3A7CiAgICAgICAgICB4aHIuYWJvcnQoKTsKICAgICAgICAgIHRoaXMuX3hociA9IHhociA9IG51bGw7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAgIHRoaXMuYWJvcnQoKTsKICAgICAgfSwKICAgICAgX3BhcnNlSGVhZGVyOiBmdW5jdGlvbiBfcGFyc2VIZWFkZXIocmF3KSB7CiAgICAgICAgdmFyIHJldCA9IHt9OwogICAgICAgIHJhdyAmJiByYXcucmVwbGFjZSgvXihbXlw6XSspOiguKikkL21nLCBmdW5jdGlvbiAoXywga2V5LCB2YWx1ZSkgewogICAgICAgICAgcmV0W2tleS50cmltKCldID0gdmFsdWUudHJpbSgpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXQ7CiAgICAgIH0sCiAgICAgIF9pbml0QWpheDogZnVuY3Rpb24gX2luaXRBamF4KCkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLAogICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zOwoKICAgICAgICBpZiAob3B0cy53aXRoQ3JlZGVudGlhbHMgJiYgISgnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpICYmIHR5cGVvZiBYRG9tYWluUmVxdWVzdCAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICAgIHhociA9IG5ldyBYRG9tYWluUmVxdWVzdCgpOwogICAgICAgIH0KCiAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHZhciBwZXJjZW50YWdlID0gMDsKCiAgICAgICAgICBpZiAoZS5sZW5ndGhDb21wdXRhYmxlKSB7CiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSBlLmxvYWRlZCAvIGUudG90YWw7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1lLnRyaWdnZXIoJ3Byb2dyZXNzJywgcGVyY2VudGFnZSk7CiAgICAgICAgfTsKCiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSAhPT0gNCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgeGhyLnVwbG9hZC5vbnByb2dyZXNzID0gbm9vcDsKICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBub29wOwogICAgICAgICAgbWUuX3hociA9IG51bGw7CiAgICAgICAgICBtZS5fc3RhdHVzID0geGhyLnN0YXR1czsKCiAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCkgewogICAgICAgICAgICBtZS5fcmVzcG9uc2UgPSB4aHIucmVzcG9uc2VUZXh0OwogICAgICAgICAgICBtZS5faGVhZGVycyA9IG1lLl9wYXJzZUhlYWRlcih4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkpOwogICAgICAgICAgICByZXR1cm4gbWUudHJpZ2dlcignbG9hZCcpOwogICAgICAgICAgfSBlbHNlIGlmICh4aHIuc3RhdHVzID49IDUwMCAmJiB4aHIuc3RhdHVzIDwgNjAwKSB7CiAgICAgICAgICAgIG1lLl9yZXNwb25zZSA9IHhoci5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgIG1lLl9oZWFkZXJzID0gbWUuX3BhcnNlSGVhZGVyKHhoci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSk7CiAgICAgICAgICAgIHJldHVybiBtZS50cmlnZ2VyKCdlcnJvcicsICdzZXJ2ZXItJyArIHN0YXR1cyk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG1lLnRyaWdnZXIoJ2Vycm9yJywgbWUuX3N0YXR1cyA/ICdodHRwLScgKyBzdGF0dXMgOiAnYWJvcnQnKTsKICAgICAgICB9OwoKICAgICAgICBtZS5feGhyID0geGhyOwogICAgICAgIHJldHVybiB4aHI7CiAgICAgIH0sCiAgICAgIF9zZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiBfc2V0UmVxdWVzdEhlYWRlcih4aHIsIGhlYWRlcnMpIHsKICAgICAgICAkLmVhY2goaGVhZGVycywgZnVuY3Rpb24gKGtleSwgdmFsKSB7CiAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihrZXksIHZhbCk7CiAgICAgICAgfSk7CiAgICAgIH0sCiAgICAgIF9wYXJzZUpzb246IGZ1bmN0aW9uIF9wYXJzZUpzb24oc3RyKSB7CiAgICAgICAgdmFyIGpzb247CgogICAgICAgIHRyeSB7CiAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShzdHIpOwogICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICBqc29uID0ge307CiAgICAgICAgfQoKICAgICAgICByZXR1cm4ganNvbjsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyAgVHJhbnNwb3J0IGZsYXNo5a6e546wCiAgICovCgogIGRlZmluZSgncnVudGltZS9odG1sNS9tZDUnLCBbJ3J1bnRpbWUvaHRtbDUvcnVudGltZSddLCBmdW5jdGlvbiAoRmxhc2hSdW50aW1lKSB7CiAgICAvKgogICAgICogRmFzdGVzdCBtZDUgaW1wbGVtZW50YXRpb24gYXJvdW5kIChKS00gbWQ1KQogICAgICogQ3JlZGl0czogSm9zZXBoIE15ZXJzCiAgICAgKgogICAgICogQHNlZSBodHRwOi8vd3d3Lm15ZXJzZGFpbHkub3JnL2pvc2VwaC9qYXZhc2NyaXB0L21kNS10ZXh0Lmh0bWwKICAgICAqIEBzZWUgaHR0cDovL2pzcGVyZi5jb20vbWQ1LXNob290b3V0LzcKICAgICAqLwoKICAgIC8qIHRoaXMgZnVuY3Rpb24gaXMgbXVjaCBmYXN0ZXIsCiAgICAgIHNvIGlmIHBvc3NpYmxlIHdlIHVzZSBpdC4gU29tZSBJRXMKICAgICAgYXJlIHRoZSBvbmx5IG9uZXMgSSBrbm93IG9mIHRoYXQKICAgICAgbmVlZCB0aGUgaWRpb3RpYyBzZWNvbmQgZnVuY3Rpb24sCiAgICAgIGdlbmVyYXRlZCBieSBhbiBpZiBjbGF1c2UuICAqLwogICAgdmFyIGFkZDMyID0gZnVuY3Rpb24gYWRkMzIoYSwgYikgewogICAgICByZXR1cm4gYSArIGIgJiAweEZGRkZGRkZGOwogICAgfSwKICAgICAgICBjbW4gPSBmdW5jdGlvbiBjbW4ocSwgYSwgYiwgeCwgcywgdCkgewogICAgICBhID0gYWRkMzIoYWRkMzIoYSwgcSksIGFkZDMyKHgsIHQpKTsKICAgICAgcmV0dXJuIGFkZDMyKGEgPDwgcyB8IGEgPj4+IDMyIC0gcywgYik7CiAgICB9LAogICAgICAgIGZmID0gZnVuY3Rpb24gZmYoYSwgYiwgYywgZCwgeCwgcywgdCkgewogICAgICByZXR1cm4gY21uKGIgJiBjIHwgfmIgJiBkLCBhLCBiLCB4LCBzLCB0KTsKICAgIH0sCiAgICAgICAgZ2cgPSBmdW5jdGlvbiBnZyhhLCBiLCBjLCBkLCB4LCBzLCB0KSB7CiAgICAgIHJldHVybiBjbW4oYiAmIGQgfCBjICYgfmQsIGEsIGIsIHgsIHMsIHQpOwogICAgfSwKICAgICAgICBoaCA9IGZ1bmN0aW9uIGhoKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsKICAgICAgcmV0dXJuIGNtbihiIF4gYyBeIGQsIGEsIGIsIHgsIHMsIHQpOwogICAgfSwKICAgICAgICBpaSA9IGZ1bmN0aW9uIGlpKGEsIGIsIGMsIGQsIHgsIHMsIHQpIHsKICAgICAgcmV0dXJuIGNtbihjIF4gKGIgfCB+ZCksIGEsIGIsIHgsIHMsIHQpOwogICAgfSwKICAgICAgICBtZDVjeWNsZSA9IGZ1bmN0aW9uIG1kNWN5Y2xlKHgsIGspIHsKICAgICAgdmFyIGEgPSB4WzBdLAogICAgICAgICAgYiA9IHhbMV0sCiAgICAgICAgICBjID0geFsyXSwKICAgICAgICAgIGQgPSB4WzNdOwogICAgICBhID0gZmYoYSwgYiwgYywgZCwga1swXSwgNywgLTY4MDg3NjkzNik7CiAgICAgIGQgPSBmZihkLCBhLCBiLCBjLCBrWzFdLCAxMiwgLTM4OTU2NDU4Nik7CiAgICAgIGMgPSBmZihjLCBkLCBhLCBiLCBrWzJdLCAxNywgNjA2MTA1ODE5KTsKICAgICAgYiA9IGZmKGIsIGMsIGQsIGEsIGtbM10sIDIyLCAtMTA0NDUyNTMzMCk7CiAgICAgIGEgPSBmZihhLCBiLCBjLCBkLCBrWzRdLCA3LCAtMTc2NDE4ODk3KTsKICAgICAgZCA9IGZmKGQsIGEsIGIsIGMsIGtbNV0sIDEyLCAxMjAwMDgwNDI2KTsKICAgICAgYyA9IGZmKGMsIGQsIGEsIGIsIGtbNl0sIDE3LCAtMTQ3MzIzMTM0MSk7CiAgICAgIGIgPSBmZihiLCBjLCBkLCBhLCBrWzddLCAyMiwgLTQ1NzA1OTgzKTsKICAgICAgYSA9IGZmKGEsIGIsIGMsIGQsIGtbOF0sIDcsIDE3NzAwMzU0MTYpOwogICAgICBkID0gZmYoZCwgYSwgYiwgYywga1s5XSwgMTIsIC0xOTU4NDE0NDE3KTsKICAgICAgYyA9IGZmKGMsIGQsIGEsIGIsIGtbMTBdLCAxNywgLTQyMDYzKTsKICAgICAgYiA9IGZmKGIsIGMsIGQsIGEsIGtbMTFdLCAyMiwgLTE5OTA0MDQxNjIpOwogICAgICBhID0gZmYoYSwgYiwgYywgZCwga1sxMl0sIDcsIDE4MDQ2MDM2ODIpOwogICAgICBkID0gZmYoZCwgYSwgYiwgYywga1sxM10sIDEyLCAtNDAzNDExMDEpOwogICAgICBjID0gZmYoYywgZCwgYSwgYiwga1sxNF0sIDE3LCAtMTUwMjAwMjI5MCk7CiAgICAgIGIgPSBmZihiLCBjLCBkLCBhLCBrWzE1XSwgMjIsIDEyMzY1MzUzMjkpOwogICAgICBhID0gZ2coYSwgYiwgYywgZCwga1sxXSwgNSwgLTE2NTc5NjUxMCk7CiAgICAgIGQgPSBnZyhkLCBhLCBiLCBjLCBrWzZdLCA5LCAtMTA2OTUwMTYzMik7CiAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzExXSwgMTQsIDY0MzcxNzcxMyk7CiAgICAgIGIgPSBnZyhiLCBjLCBkLCBhLCBrWzBdLCAyMCwgLTM3Mzg5NzMwMik7CiAgICAgIGEgPSBnZyhhLCBiLCBjLCBkLCBrWzVdLCA1LCAtNzAxNTU4NjkxKTsKICAgICAgZCA9IGdnKGQsIGEsIGIsIGMsIGtbMTBdLCA5LCAzODAxNjA4Myk7CiAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzE1XSwgMTQsIC02NjA0NzgzMzUpOwogICAgICBiID0gZ2coYiwgYywgZCwgYSwga1s0XSwgMjAsIC00MDU1Mzc4NDgpOwogICAgICBhID0gZ2coYSwgYiwgYywgZCwga1s5XSwgNSwgNTY4NDQ2NDM4KTsKICAgICAgZCA9IGdnKGQsIGEsIGIsIGMsIGtbMTRdLCA5LCAtMTAxOTgwMzY5MCk7CiAgICAgIGMgPSBnZyhjLCBkLCBhLCBiLCBrWzNdLCAxNCwgLTE4NzM2Mzk2MSk7CiAgICAgIGIgPSBnZyhiLCBjLCBkLCBhLCBrWzhdLCAyMCwgMTE2MzUzMTUwMSk7CiAgICAgIGEgPSBnZyhhLCBiLCBjLCBkLCBrWzEzXSwgNSwgLTE0NDQ2ODE0NjcpOwogICAgICBkID0gZ2coZCwgYSwgYiwgYywga1syXSwgOSwgLTUxNDAzNzg0KTsKICAgICAgYyA9IGdnKGMsIGQsIGEsIGIsIGtbN10sIDE0LCAxNzM1MzI4NDczKTsKICAgICAgYiA9IGdnKGIsIGMsIGQsIGEsIGtbMTJdLCAyMCwgLTE5MjY2MDc3MzQpOwogICAgICBhID0gaGgoYSwgYiwgYywgZCwga1s1XSwgNCwgLTM3ODU1OCk7CiAgICAgIGQgPSBoaChkLCBhLCBiLCBjLCBrWzhdLCAxMSwgLTIwMjI1NzQ0NjMpOwogICAgICBjID0gaGgoYywgZCwgYSwgYiwga1sxMV0sIDE2LCAxODM5MDMwNTYyKTsKICAgICAgYiA9IGhoKGIsIGMsIGQsIGEsIGtbMTRdLCAyMywgLTM1MzA5NTU2KTsKICAgICAgYSA9IGhoKGEsIGIsIGMsIGQsIGtbMV0sIDQsIC0xNTMwOTkyMDYwKTsKICAgICAgZCA9IGhoKGQsIGEsIGIsIGMsIGtbNF0sIDExLCAxMjcyODkzMzUzKTsKICAgICAgYyA9IGhoKGMsIGQsIGEsIGIsIGtbN10sIDE2LCAtMTU1NDk3NjMyKTsKICAgICAgYiA9IGhoKGIsIGMsIGQsIGEsIGtbMTBdLCAyMywgLTEwOTQ3MzA2NDApOwogICAgICBhID0gaGgoYSwgYiwgYywgZCwga1sxM10sIDQsIDY4MTI3OTE3NCk7CiAgICAgIGQgPSBoaChkLCBhLCBiLCBjLCBrWzBdLCAxMSwgLTM1ODUzNzIyMik7CiAgICAgIGMgPSBoaChjLCBkLCBhLCBiLCBrWzNdLCAxNiwgLTcyMjUyMTk3OSk7CiAgICAgIGIgPSBoaChiLCBjLCBkLCBhLCBrWzZdLCAyMywgNzYwMjkxODkpOwogICAgICBhID0gaGgoYSwgYiwgYywgZCwga1s5XSwgNCwgLTY0MDM2NDQ4Nyk7CiAgICAgIGQgPSBoaChkLCBhLCBiLCBjLCBrWzEyXSwgMTEsIC00MjE4MTU4MzUpOwogICAgICBjID0gaGgoYywgZCwgYSwgYiwga1sxNV0sIDE2LCA1MzA3NDI1MjApOwogICAgICBiID0gaGgoYiwgYywgZCwgYSwga1syXSwgMjMsIC05OTUzMzg2NTEpOwogICAgICBhID0gaWkoYSwgYiwgYywgZCwga1swXSwgNiwgLTE5ODYzMDg0NCk7CiAgICAgIGQgPSBpaShkLCBhLCBiLCBjLCBrWzddLCAxMCwgMTEyNjg5MTQxNSk7CiAgICAgIGMgPSBpaShjLCBkLCBhLCBiLCBrWzE0XSwgMTUsIC0xNDE2MzU0OTA1KTsKICAgICAgYiA9IGlpKGIsIGMsIGQsIGEsIGtbNV0sIDIxLCAtNTc0MzQwNTUpOwogICAgICBhID0gaWkoYSwgYiwgYywgZCwga1sxMl0sIDYsIDE3MDA0ODU1NzEpOwogICAgICBkID0gaWkoZCwgYSwgYiwgYywga1szXSwgMTAsIC0xODk0OTg2NjA2KTsKICAgICAgYyA9IGlpKGMsIGQsIGEsIGIsIGtbMTBdLCAxNSwgLTEwNTE1MjMpOwogICAgICBiID0gaWkoYiwgYywgZCwgYSwga1sxXSwgMjEsIC0yMDU0OTIyNzk5KTsKICAgICAgYSA9IGlpKGEsIGIsIGMsIGQsIGtbOF0sIDYsIDE4NzMzMTMzNTkpOwogICAgICBkID0gaWkoZCwgYSwgYiwgYywga1sxNV0sIDEwLCAtMzA2MTE3NDQpOwogICAgICBjID0gaWkoYywgZCwgYSwgYiwga1s2XSwgMTUsIC0xNTYwMTk4MzgwKTsKICAgICAgYiA9IGlpKGIsIGMsIGQsIGEsIGtbMTNdLCAyMSwgMTMwOTE1MTY0OSk7CiAgICAgIGEgPSBpaShhLCBiLCBjLCBkLCBrWzRdLCA2LCAtMTQ1NTIzMDcwKTsKICAgICAgZCA9IGlpKGQsIGEsIGIsIGMsIGtbMTFdLCAxMCwgLTExMjAyMTAzNzkpOwogICAgICBjID0gaWkoYywgZCwgYSwgYiwga1syXSwgMTUsIDcxODc4NzI1OSk7CiAgICAgIGIgPSBpaShiLCBjLCBkLCBhLCBrWzldLCAyMSwgLTM0MzQ4NTU1MSk7CiAgICAgIHhbMF0gPSBhZGQzMihhLCB4WzBdKTsKICAgICAgeFsxXSA9IGFkZDMyKGIsIHhbMV0pOwogICAgICB4WzJdID0gYWRkMzIoYywgeFsyXSk7CiAgICAgIHhbM10gPSBhZGQzMihkLCB4WzNdKTsKICAgIH0sCgogICAgLyogdGhlcmUgbmVlZHMgdG8gYmUgc3VwcG9ydCBmb3IgVW5pY29kZSBoZXJlLAogICAgICAgKiB1bmxlc3Mgd2UgcHJldGVuZCB0aGF0IHdlIGNhbiByZWRlZmluZSB0aGUgTUQtNQogICAgICAgKiBhbGdvcml0aG0gZm9yIG11bHRpLWJ5dGUgY2hhcmFjdGVycyAocGVyaGFwcwogICAgICAgKiBieSBhZGRpbmcgZXZlcnkgZm91ciAxNi1iaXQgY2hhcmFjdGVycyBhbmQKICAgICAgICogc2hvcnRlbmluZyB0aGUgc3VtIHRvIDMyIGJpdHMpLiBPdGhlcndpc2UKICAgICAgICogSSBzdWdnZXN0IHBlcmZvcm1pbmcgTUQtNSBhcyBpZiBldmVyeSBjaGFyYWN0ZXIKICAgICAgICogd2FzIHR3byBieXRlcy0tZS5nLiwgMDA0MCAwMDI1ID0gQCUtLWJ1dCB0aGVuCiAgICAgICAqIGhvdyB3aWxsIGFuIG9yZGluYXJ5IE1ELTUgc3VtIGJlIG1hdGNoZWQ/CiAgICAgICAqIFRoZXJlIGlzIG5vIHdheSB0byBzdGFuZGFyZGl6ZSB0ZXh0IHRvIHNvbWV0aGluZwogICAgICAgKiBsaWtlIFVURi04IGJlZm9yZSB0cmFuc2Zvcm1hdGlvbjsgc3BlZWQgY29zdCBpcwogICAgICAgKiB1dHRlcmx5IHByb2hpYml0aXZlLiBUaGUgSmF2YVNjcmlwdCBzdGFuZGFyZAogICAgICAgKiBpdHNlbGYgbmVlZHMgdG8gbG9vayBhdCB0aGlzOiBpdCBzaG91bGQgc3RhcnQKICAgICAgICogcHJvdmlkaW5nIGFjY2VzcyB0byBzdHJpbmdzIGFzIHByZWZvcm1lZCBVVEYtOAogICAgICAgKiA4LWJpdCB1bnNpZ25lZCB2YWx1ZSBhcnJheXMuCiAgICAgICAqLwogICAgbWQ1YmxrID0gZnVuY3Rpb24gbWQ1YmxrKHMpIHsKICAgICAgdmFyIG1kNWJsa3MgPSBbXSwKICAgICAgICAgIGk7CiAgICAgIC8qIEFuZHkgS2luZyBzYWlkIGRvIGl0IHRoaXMgd2F5LiAqLwoKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyBpICs9IDQpIHsKICAgICAgICBtZDVibGtzW2kgPj4gMl0gPSBzLmNoYXJDb2RlQXQoaSkgKyAocy5jaGFyQ29kZUF0KGkgKyAxKSA8PCA4KSArIChzLmNoYXJDb2RlQXQoaSArIDIpIDw8IDE2KSArIChzLmNoYXJDb2RlQXQoaSArIDMpIDw8IDI0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1kNWJsa3M7CiAgICB9LAogICAgICAgIG1kNWJsa19hcnJheSA9IGZ1bmN0aW9uIG1kNWJsa19hcnJheShhKSB7CiAgICAgIHZhciBtZDVibGtzID0gW10sCiAgICAgICAgICBpOwogICAgICAvKiBBbmR5IEtpbmcgc2FpZCBkbyBpdCB0aGlzIHdheS4gKi8KCiAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSArPSA0KSB7CiAgICAgICAgbWQ1Ymxrc1tpID4+IDJdID0gYVtpXSArIChhW2kgKyAxXSA8PCA4KSArIChhW2kgKyAyXSA8PCAxNikgKyAoYVtpICsgM10gPDwgMjQpOwogICAgICB9CgogICAgICByZXR1cm4gbWQ1YmxrczsKICAgIH0sCiAgICAgICAgbWQ1MSA9IGZ1bmN0aW9uIG1kNTEocykgewogICAgICB2YXIgbiA9IHMubGVuZ3RoLAogICAgICAgICAgc3RhdGUgPSBbMTczMjU4NDE5MywgLTI3MTczMzg3OSwgLTE3MzI1ODQxOTQsIDI3MTczMzg3OF0sCiAgICAgICAgICBpLAogICAgICAgICAgbGVuZ3RoLAogICAgICAgICAgdGFpbCwKICAgICAgICAgIHRtcCwKICAgICAgICAgIGxvLAogICAgICAgICAgaGk7CgogICAgICBmb3IgKGkgPSA2NDsgaSA8PSBuOyBpICs9IDY0KSB7CiAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIG1kNWJsayhzLnN1YnN0cmluZyhpIC0gNjQsIGkpKSk7CiAgICAgIH0KCiAgICAgIHMgPSBzLnN1YnN0cmluZyhpIC0gNjQpOwogICAgICBsZW5ndGggPSBzLmxlbmd0aDsKICAgICAgdGFpbCA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewogICAgICAgIHRhaWxbaSA+PiAyXSB8PSBzLmNoYXJDb2RlQXQoaSkgPDwgKGkgJSA0IDw8IDMpOwogICAgICB9CgogICAgICB0YWlsW2kgPj4gMl0gfD0gMHg4MCA8PCAoaSAlIDQgPDwgMyk7CgogICAgICBpZiAoaSA+IDU1KSB7CiAgICAgICAgbWQ1Y3ljbGUoc3RhdGUsIHRhaWwpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkgKz0gMSkgewogICAgICAgICAgdGFpbFtpXSA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIEJld2FyZSB0aGF0IHRoZSBmaW5hbCBsZW5ndGggbWlnaHQgbm90IGZpdCBpbiAzMiBiaXRzIHNvIHdlIHRha2UgY2FyZSBvZiB0aGF0CgoKICAgICAgdG1wID0gbiAqIDg7CiAgICAgIHRtcCA9IHRtcC50b1N0cmluZygxNikubWF0Y2goLyguKj8pKC57MCw4fSkkLyk7CiAgICAgIGxvID0gcGFyc2VJbnQodG1wWzJdLCAxNik7CiAgICAgIGhpID0gcGFyc2VJbnQodG1wWzFdLCAxNikgfHwgMDsKICAgICAgdGFpbFsxNF0gPSBsbzsKICAgICAgdGFpbFsxNV0gPSBoaTsKICAgICAgbWQ1Y3ljbGUoc3RhdGUsIHRhaWwpOwogICAgICByZXR1cm4gc3RhdGU7CiAgICB9LAogICAgICAgIG1kNTFfYXJyYXkgPSBmdW5jdGlvbiBtZDUxX2FycmF5KGEpIHsKICAgICAgdmFyIG4gPSBhLmxlbmd0aCwKICAgICAgICAgIHN0YXRlID0gWzE3MzI1ODQxOTMsIC0yNzE3MzM4NzksIC0xNzMyNTg0MTk0LCAyNzE3MzM4NzhdLAogICAgICAgICAgaSwKICAgICAgICAgIGxlbmd0aCwKICAgICAgICAgIHRhaWwsCiAgICAgICAgICB0bXAsCiAgICAgICAgICBsbywKICAgICAgICAgIGhpOwoKICAgICAgZm9yIChpID0gNjQ7IGkgPD0gbjsgaSArPSA2NCkgewogICAgICAgIG1kNWN5Y2xlKHN0YXRlLCBtZDVibGtfYXJyYXkoYS5zdWJhcnJheShpIC0gNjQsIGkpKSk7CiAgICAgIH0gLy8gTm90IHN1cmUgaWYgaXQgaXMgYSBidWcsIGhvd2V2ZXIgSUUxMCB3aWxsIGFsd2F5cyBwcm9kdWNlIGEgc3ViIGFycmF5IG9mIGxlbmd0aCAxCiAgICAgIC8vIGNvbnRhaW5pbmcgdGhlIGxhc3QgZWxlbWVudCBvZiB0aGUgcGFyZW50IGFycmF5IGlmIHRoZSBzdWIgYXJyYXkgc3BlY2lmaWVkIHN0YXJ0cwogICAgICAvLyBiZXlvbmQgdGhlIGxlbmd0aCBvZiB0aGUgcGFyZW50IGFycmF5IC0gd2VpcmQuCiAgICAgIC8vIGh0dHBzOi8vY29ubmVjdC5taWNyb3NvZnQuY29tL0lFL2ZlZWRiYWNrL2RldGFpbHMvNzcxNDUyL3R5cGVkLWFycmF5LXN1YmFycmF5LWlzc3VlCgoKICAgICAgYSA9IGkgLSA2NCA8IG4gPyBhLnN1YmFycmF5KGkgLSA2NCkgOiBuZXcgVWludDhBcnJheSgwKTsKICAgICAgbGVuZ3RoID0gYS5sZW5ndGg7CiAgICAgIHRhaWwgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICB0YWlsW2kgPj4gMl0gfD0gYVtpXSA8PCAoaSAlIDQgPDwgMyk7CiAgICAgIH0KCiAgICAgIHRhaWxbaSA+PiAyXSB8PSAweDgwIDw8IChpICUgNCA8PCAzKTsKCiAgICAgIGlmIChpID4gNTUpIHsKICAgICAgICBtZDVjeWNsZShzdGF0ZSwgdGFpbCk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSArPSAxKSB7CiAgICAgICAgICB0YWlsW2ldID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gQmV3YXJlIHRoYXQgdGhlIGZpbmFsIGxlbmd0aCBtaWdodCBub3QgZml0IGluIDMyIGJpdHMgc28gd2UgdGFrZSBjYXJlIG9mIHRoYXQKCgogICAgICB0bXAgPSBuICogODsKICAgICAgdG1wID0gdG1wLnRvU3RyaW5nKDE2KS5tYXRjaCgvKC4qPykoLnswLDh9KSQvKTsKICAgICAgbG8gPSBwYXJzZUludCh0bXBbMl0sIDE2KTsKICAgICAgaGkgPSBwYXJzZUludCh0bXBbMV0sIDE2KSB8fCAwOwogICAgICB0YWlsWzE0XSA9IGxvOwogICAgICB0YWlsWzE1XSA9IGhpOwogICAgICBtZDVjeWNsZShzdGF0ZSwgdGFpbCk7CiAgICAgIHJldHVybiBzdGF0ZTsKICAgIH0sCiAgICAgICAgaGV4X2NociA9IFsnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc3JywgJzgnLCAnOScsICdhJywgJ2InLCAnYycsICdkJywgJ2UnLCAnZiddLAogICAgICAgIHJoZXggPSBmdW5jdGlvbiByaGV4KG4pIHsKICAgICAgdmFyIHMgPSAnJywKICAgICAgICAgIGo7CgogICAgICBmb3IgKGogPSAwOyBqIDwgNDsgaiArPSAxKSB7CiAgICAgICAgcyArPSBoZXhfY2hyW24gPj4gaiAqIDggKyA0ICYgMHgwRl0gKyBoZXhfY2hyW24gPj4gaiAqIDggJiAweDBGXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHM7CiAgICB9LAogICAgICAgIGhleCA9IGZ1bmN0aW9uIGhleCh4KSB7CiAgICAgIHZhciBpOwoKICAgICAgZm9yIChpID0gMDsgaSA8IHgubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICB4W2ldID0gcmhleCh4W2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHguam9pbignJyk7CiAgICB9LAogICAgICAgIG1kNSA9IGZ1bmN0aW9uIG1kNShzKSB7CiAgICAgIHJldHVybiBoZXgobWQ1MShzKSk7CiAgICB9LAogICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAvKioKICAgICAqIFNwYXJrTUQ1IE9PUCBpbXBsZW1lbnRhdGlvbi4KICAgICAqCiAgICAgKiBVc2UgdGhpcyBjbGFzcyB0byBwZXJmb3JtIGFuIGluY3JlbWVudGFsIG1kNSwgb3RoZXJ3aXNlIHVzZSB0aGUKICAgICAqIHN0YXRpYyBtZXRob2RzIGluc3RlYWQuCiAgICAgKi8KICAgIFNwYXJrTUQ1ID0gZnVuY3Rpb24gU3BhcmtNRDUoKSB7CiAgICAgIC8vIGNhbGwgcmVzZXQgdG8gaW5pdCB0aGUgaW5zdGFuY2UKICAgICAgdGhpcy5yZXNldCgpOwogICAgfTsgLy8gSW4gc29tZSBjYXNlcyB0aGUgZmFzdCBhZGQzMiBmdW5jdGlvbiBjYW5ub3QgYmUgdXNlZC4uCgoKICAgIGlmIChtZDUoJ2hlbGxvJykgIT09ICc1ZDQxNDAyYWJjNGIyYTc2Yjk3MTlkOTExMDE3YzU5MicpIHsKICAgICAgYWRkMzIgPSBmdW5jdGlvbiBhZGQzMih4LCB5KSB7CiAgICAgICAgdmFyIGxzdyA9ICh4ICYgMHhGRkZGKSArICh5ICYgMHhGRkZGKSwKICAgICAgICAgICAgbXN3ID0gKHggPj4gMTYpICsgKHkgPj4gMTYpICsgKGxzdyA+PiAxNik7CiAgICAgICAgcmV0dXJuIG1zdyA8PCAxNiB8IGxzdyAmIDB4RkZGRjsKICAgICAgfTsKICAgIH0KICAgIC8qKgogICAgICogQXBwZW5kcyBhIHN0cmluZy4KICAgICAqIEEgY29udmVyc2lvbiB3aWxsIGJlIGFwcGxpZWQgaWYgYW4gdXRmOCBzdHJpbmcgaXMgZGV0ZWN0ZWQuCiAgICAgKgogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0ciBUaGUgc3RyaW5nIHRvIGJlIGFwcGVuZGVkCiAgICAgKgogICAgICogQHJldHVybiB7U3BhcmtNRDV9IFRoZSBpbnN0YW5jZSBpdHNlbGYKICAgICAqLwoKCiAgICBTcGFya01ENS5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKHN0cikgewogICAgICAvLyBjb252ZXJ0cyB0aGUgc3RyaW5nIHRvIHV0ZjggYnl0ZXMgaWYgbmVjZXNzYXJ5CiAgICAgIGlmICgvW1x1MDA4MC1cdUZGRkZdLy50ZXN0KHN0cikpIHsKICAgICAgICBzdHIgPSB1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQoc3RyKSk7CiAgICAgIH0gLy8gdGhlbiBhcHBlbmQgYXMgYmluYXJ5CgoKICAgICAgdGhpcy5hcHBlbmRCaW5hcnkoc3RyKTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBBcHBlbmRzIGEgYmluYXJ5IHN0cmluZy4KICAgICAqCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY29udGVudHMgVGhlIGJpbmFyeSBzdHJpbmcgdG8gYmUgYXBwZW5kZWQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtTcGFya01ENX0gVGhlIGluc3RhbmNlIGl0c2VsZgogICAgICovCgoKICAgIFNwYXJrTUQ1LnByb3RvdHlwZS5hcHBlbmRCaW5hcnkgPSBmdW5jdGlvbiAoY29udGVudHMpIHsKICAgICAgdGhpcy5fYnVmZiArPSBjb250ZW50czsKICAgICAgdGhpcy5fbGVuZ3RoICs9IGNvbnRlbnRzLmxlbmd0aDsKICAgICAgdmFyIGxlbmd0aCA9IHRoaXMuX2J1ZmYubGVuZ3RoLAogICAgICAgICAgaTsKCiAgICAgIGZvciAoaSA9IDY0OyBpIDw9IGxlbmd0aDsgaSArPSA2NCkgewogICAgICAgIG1kNWN5Y2xlKHRoaXMuX3N0YXRlLCBtZDVibGsodGhpcy5fYnVmZi5zdWJzdHJpbmcoaSAtIDY0LCBpKSkpOwogICAgICB9CgogICAgICB0aGlzLl9idWZmID0gdGhpcy5fYnVmZi5zdWJzdHIoaSAtIDY0KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBGaW5pc2hlcyB0aGUgaW5jcmVtZW50YWwgY29tcHV0YXRpb24sIHJlc2V0aW5nIHRoZSBpbnRlcm5hbCBzdGF0ZSBhbmQKICAgICAqIHJldHVybmluZyB0aGUgcmVzdWx0LgogICAgICogVXNlIHRoZSByYXcgcGFyYW1ldGVyIHRvIG9idGFpbiB0aGUgcmF3IHJlc3VsdCBpbnN0ZWFkIG9mIHRoZSBoZXggb25lLgogICAgICoKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3IFRydWUgdG8gZ2V0IHRoZSByYXcgcmVzdWx0LCBmYWxzZSB0byBnZXQgdGhlIGhleCByZXN1bHQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHQKICAgICAqLwoKCiAgICBTcGFya01ENS5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24gKHJhdykgewogICAgICB2YXIgYnVmZiA9IHRoaXMuX2J1ZmYsCiAgICAgICAgICBsZW5ndGggPSBidWZmLmxlbmd0aCwKICAgICAgICAgIGksCiAgICAgICAgICB0YWlsID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLAogICAgICAgICAgcmV0OwoKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgdGFpbFtpID4+IDJdIHw9IGJ1ZmYuY2hhckNvZGVBdChpKSA8PCAoaSAlIDQgPDwgMyk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2ZpbmlzaCh0YWlsLCBsZW5ndGgpOwoKICAgICAgcmV0ID0gISFyYXcgPyB0aGlzLl9zdGF0ZSA6IGhleCh0aGlzLl9zdGF0ZSk7CiAgICAgIHRoaXMucmVzZXQoKTsKICAgICAgcmV0dXJuIHJldDsKICAgIH07CiAgICAvKioKICAgICAqIEZpbmlzaCB0aGUgZmluYWwgY2FsY3VsYXRpb24gYmFzZWQgb24gdGhlIHRhaWwuCiAgICAgKgogICAgICogQHBhcmFtIHtBcnJheX0gIHRhaWwgICBUaGUgdGFpbCAod2lsbCBiZSBtb2RpZmllZCkKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBsZW5ndGggVGhlIGxlbmd0aCBvZiB0aGUgcmVtYWluaW5nIGJ1ZmZlcgogICAgICovCgoKICAgIFNwYXJrTUQ1LnByb3RvdHlwZS5fZmluaXNoID0gZnVuY3Rpb24gKHRhaWwsIGxlbmd0aCkgewogICAgICB2YXIgaSA9IGxlbmd0aCwKICAgICAgICAgIHRtcCwKICAgICAgICAgIGxvLAogICAgICAgICAgaGk7CiAgICAgIHRhaWxbaSA+PiAyXSB8PSAweDgwIDw8IChpICUgNCA8PCAzKTsKCiAgICAgIGlmIChpID4gNTUpIHsKICAgICAgICBtZDVjeWNsZSh0aGlzLl9zdGF0ZSwgdGFpbCk7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSArPSAxKSB7CiAgICAgICAgICB0YWlsW2ldID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gRG8gdGhlIGZpbmFsIGNvbXB1dGF0aW9uIGJhc2VkIG9uIHRoZSB0YWlsIGFuZCBsZW5ndGgKICAgICAgLy8gQmV3YXJlIHRoYXQgdGhlIGZpbmFsIGxlbmd0aCBtYXkgbm90IGZpdCBpbiAzMiBiaXRzIHNvIHdlIHRha2UgY2FyZSBvZiB0aGF0CgoKICAgICAgdG1wID0gdGhpcy5fbGVuZ3RoICogODsKICAgICAgdG1wID0gdG1wLnRvU3RyaW5nKDE2KS5tYXRjaCgvKC4qPykoLnswLDh9KSQvKTsKICAgICAgbG8gPSBwYXJzZUludCh0bXBbMl0sIDE2KTsKICAgICAgaGkgPSBwYXJzZUludCh0bXBbMV0sIDE2KSB8fCAwOwogICAgICB0YWlsWzE0XSA9IGxvOwogICAgICB0YWlsWzE1XSA9IGhpOwogICAgICBtZDVjeWNsZSh0aGlzLl9zdGF0ZSwgdGFpbCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBSZXNldHMgdGhlIGludGVybmFsIHN0YXRlIG9mIHRoZSBjb21wdXRhdGlvbi4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtTcGFya01ENX0gVGhlIGluc3RhbmNlIGl0c2VsZgogICAgICovCgoKICAgIFNwYXJrTUQ1LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5fYnVmZiA9ICIiOwogICAgICB0aGlzLl9sZW5ndGggPSAwOwogICAgICB0aGlzLl9zdGF0ZSA9IFsxNzMyNTg0MTkzLCAtMjcxNzMzODc5LCAtMTczMjU4NDE5NCwgMjcxNzMzODc4XTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwogICAgLyoqCiAgICAgKiBSZWxlYXNlcyBtZW1vcnkgdXNlZCBieSB0aGUgaW5jcmVtZW50YWwgYnVmZmVyIGFuZCBvdGhlciBhZGl0aW9uYWwKICAgICAqIHJlc291cmNlcy4gSWYgeW91IHBsYW4gdG8gdXNlIHRoZSBpbnN0YW5jZSBhZ2FpbiwgdXNlIHJlc2V0IGluc3RlYWQuCiAgICAgKi8KCgogICAgU3BhcmtNRDUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9zdGF0ZTsKICAgICAgZGVsZXRlIHRoaXMuX2J1ZmY7CiAgICAgIGRlbGV0ZSB0aGlzLl9sZW5ndGg7CiAgICB9OwogICAgLyoqCiAgICAgKiBQZXJmb3JtcyB0aGUgbWQ1IGhhc2ggb24gYSBzdHJpbmcuCiAgICAgKiBBIGNvbnZlcnNpb24gd2lsbCBiZSBhcHBsaWVkIGlmIHV0Zjggc3RyaW5nIGlzIGRldGVjdGVkLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgc3RyIFRoZSBzdHJpbmcKICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcmF3IFRydWUgdG8gZ2V0IHRoZSByYXcgcmVzdWx0LCBmYWxzZSB0byBnZXQgdGhlIGhleCByZXN1bHQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHQKICAgICAqLwoKCiAgICBTcGFya01ENS5oYXNoID0gZnVuY3Rpb24gKHN0ciwgcmF3KSB7CiAgICAgIC8vIGNvbnZlcnRzIHRoZSBzdHJpbmcgdG8gdXRmOCBieXRlcyBpZiBuZWNlc3NhcnkKICAgICAgaWYgKC9bXHUwMDgwLVx1RkZGRl0vLnRlc3Qoc3RyKSkgewogICAgICAgIHN0ciA9IHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKTsKICAgICAgfQoKICAgICAgdmFyIGhhc2ggPSBtZDUxKHN0cik7CiAgICAgIHJldHVybiAhIXJhdyA/IGhhc2ggOiBoZXgoaGFzaCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBQZXJmb3JtcyB0aGUgbWQ1IGhhc2ggb24gYSBiaW5hcnkgc3RyaW5nLgogICAgICoKICAgICAqIEBwYXJhbSB7U3RyaW5nfSAgY29udGVudCBUaGUgYmluYXJ5IHN0cmluZwogICAgICogQHBhcmFtIHtCb29sZWFufSByYXcgICAgIFRydWUgdG8gZ2V0IHRoZSByYXcgcmVzdWx0LCBmYWxzZSB0byBnZXQgdGhlIGhleCByZXN1bHQKICAgICAqCiAgICAgKiBAcmV0dXJuIHtTdHJpbmd8QXJyYXl9IFRoZSByZXN1bHQKICAgICAqLwoKCiAgICBTcGFya01ENS5oYXNoQmluYXJ5ID0gZnVuY3Rpb24gKGNvbnRlbnQsIHJhdykgewogICAgICB2YXIgaGFzaCA9IG1kNTEoY29udGVudCk7CiAgICAgIHJldHVybiAhIXJhdyA/IGhhc2ggOiBoZXgoaGFzaCk7CiAgICB9OwogICAgLyoqCiAgICAgKiBTcGFya01ENSBPT1AgaW1wbGVtZW50YXRpb24gZm9yIGFycmF5IGJ1ZmZlcnMuCiAgICAgKgogICAgICogVXNlIHRoaXMgY2xhc3MgdG8gcGVyZm9ybSBhbiBpbmNyZW1lbnRhbCBtZDUgT05MWSBmb3IgYXJyYXkgYnVmZmVycy4KICAgICAqLwoKCiAgICBTcGFya01ENS5BcnJheUJ1ZmZlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgLy8gY2FsbCByZXNldCB0byBpbml0IHRoZSBpbnN0YW5jZQogICAgICB0aGlzLnJlc2V0KCk7CiAgICB9OyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgLyoqCiAgICAgKiBBcHBlbmRzIGFuIGFycmF5IGJ1ZmZlci4KICAgICAqCiAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBhcnIgVGhlIGFycmF5IHRvIGJlIGFwcGVuZGVkCiAgICAgKgogICAgICogQHJldHVybiB7U3BhcmtNRDUuQXJyYXlCdWZmZXJ9IFRoZSBpbnN0YW5jZSBpdHNlbGYKICAgICAqLwoKCiAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUuYXBwZW5kID0gZnVuY3Rpb24gKGFycikgewogICAgICAvLyBUT0RPOiB3ZSBjb3VsZCBhdm9pZCB0aGUgY29uY2F0ZW5hdGlvbiBoZXJlIGJ1dCB0aGUgYWxnb3JpdGhtIHdvdWxkIGJlIG1vcmUgY29tcGxleAogICAgICAvLyAgICAgICBpZiB5b3UgZmluZCB5b3Vyc2VsZiBuZWVkaW5nIGV4dHJhIHBlcmZvcm1hbmNlLCBwbGVhc2UgbWFrZSBhIFBSLgogICAgICB2YXIgYnVmZiA9IHRoaXMuX2NvbmNhdEFycmF5QnVmZmVyKHRoaXMuX2J1ZmYsIGFyciksCiAgICAgICAgICBsZW5ndGggPSBidWZmLmxlbmd0aCwKICAgICAgICAgIGk7CgogICAgICB0aGlzLl9sZW5ndGggKz0gYXJyLmJ5dGVMZW5ndGg7CgogICAgICBmb3IgKGkgPSA2NDsgaSA8PSBsZW5ndGg7IGkgKz0gNjQpIHsKICAgICAgICBtZDVjeWNsZSh0aGlzLl9zdGF0ZSwgbWQ1YmxrX2FycmF5KGJ1ZmYuc3ViYXJyYXkoaSAtIDY0LCBpKSkpOwogICAgICB9IC8vIEF2b2lkcyBJRTEwIHdlaXJkbmVzcyAoZG9jdW1lbnRlZCBhYm92ZSkKCgogICAgICB0aGlzLl9idWZmID0gaSAtIDY0IDwgbGVuZ3RoID8gYnVmZi5zdWJhcnJheShpIC0gNjQpIDogbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfTsKICAgIC8qKgogICAgICogRmluaXNoZXMgdGhlIGluY3JlbWVudGFsIGNvbXB1dGF0aW9uLCByZXNldGluZyB0aGUgaW50ZXJuYWwgc3RhdGUgYW5kCiAgICAgKiByZXR1cm5pbmcgdGhlIHJlc3VsdC4KICAgICAqIFVzZSB0aGUgcmF3IHBhcmFtZXRlciB0byBvYnRhaW4gdGhlIHJhdyByZXN1bHQgaW5zdGVhZCBvZiB0aGUgaGV4IG9uZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHJhdyBUcnVlIHRvIGdldCB0aGUgcmF3IHJlc3VsdCwgZmFsc2UgdG8gZ2V0IHRoZSBoZXggcmVzdWx0CiAgICAgKgogICAgICogQHJldHVybiB7U3RyaW5nfEFycmF5fSBUaGUgcmVzdWx0CiAgICAgKi8KCgogICAgU3BhcmtNRDUuQXJyYXlCdWZmZXIucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uIChyYXcpIHsKICAgICAgdmFyIGJ1ZmYgPSB0aGlzLl9idWZmLAogICAgICAgICAgbGVuZ3RoID0gYnVmZi5sZW5ndGgsCiAgICAgICAgICB0YWlsID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLAogICAgICAgICAgaSwKICAgICAgICAgIHJldDsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gMSkgewogICAgICAgIHRhaWxbaSA+PiAyXSB8PSBidWZmW2ldIDw8IChpICUgNCA8PCAzKTsKICAgICAgfQoKICAgICAgdGhpcy5fZmluaXNoKHRhaWwsIGxlbmd0aCk7CgogICAgICByZXQgPSAhIXJhdyA/IHRoaXMuX3N0YXRlIDogaGV4KHRoaXMuX3N0YXRlKTsKICAgICAgdGhpcy5yZXNldCgpOwogICAgICByZXR1cm4gcmV0OwogICAgfTsKCiAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUuX2ZpbmlzaCA9IFNwYXJrTUQ1LnByb3RvdHlwZS5fZmluaXNoOwogICAgLyoqCiAgICAgKiBSZXNldHMgdGhlIGludGVybmFsIHN0YXRlIG9mIHRoZSBjb21wdXRhdGlvbi4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtTcGFya01ENS5BcnJheUJ1ZmZlcn0gVGhlIGluc3RhbmNlIGl0c2VsZgogICAgICovCgogICAgU3BhcmtNRDUuQXJyYXlCdWZmZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLl9idWZmID0gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgIHRoaXMuX2xlbmd0aCA9IDA7CiAgICAgIHRoaXMuX3N0YXRlID0gWzE3MzI1ODQxOTMsIC0yNzE3MzM4NzksIC0xNzMyNTg0MTk0LCAyNzE3MzM4NzhdOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CiAgICAvKioKICAgICAqIFJlbGVhc2VzIG1lbW9yeSB1c2VkIGJ5IHRoZSBpbmNyZW1lbnRhbCBidWZmZXIgYW5kIG90aGVyIGFkaXRpb25hbAogICAgICogcmVzb3VyY2VzLiBJZiB5b3UgcGxhbiB0byB1c2UgdGhlIGluc3RhbmNlIGFnYWluLCB1c2UgcmVzZXQgaW5zdGVhZC4KICAgICAqLwoKCiAgICBTcGFya01ENS5BcnJheUJ1ZmZlci5wcm90b3R5cGUuZGVzdHJveSA9IFNwYXJrTUQ1LnByb3RvdHlwZS5kZXN0cm95OwogICAgLyoqCiAgICAgKiBDb25jYXRzIHR3byBhcnJheSBidWZmZXJzLCByZXR1cm5pbmcgYSBuZXcgb25lLgogICAgICoKICAgICAqIEBwYXJhbSAge0FycmF5QnVmZmVyfSBmaXJzdCAgVGhlIGZpcnN0IGFycmF5IGJ1ZmZlcgogICAgICogQHBhcmFtICB7QXJyYXlCdWZmZXJ9IHNlY29uZCBUaGUgc2Vjb25kIGFycmF5IGJ1ZmZlcgogICAgICoKICAgICAqIEByZXR1cm4ge0FycmF5QnVmZmVyfSBUaGUgbmV3IGFycmF5IGJ1ZmZlcgogICAgICovCgogICAgU3BhcmtNRDUuQXJyYXlCdWZmZXIucHJvdG90eXBlLl9jb25jYXRBcnJheUJ1ZmZlciA9IGZ1bmN0aW9uIChmaXJzdCwgc2Vjb25kKSB7CiAgICAgIHZhciBmaXJzdExlbmd0aCA9IGZpcnN0Lmxlbmd0aCwKICAgICAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KGZpcnN0TGVuZ3RoICsgc2Vjb25kLmJ5dGVMZW5ndGgpOwogICAgICByZXN1bHQuc2V0KGZpcnN0KTsKICAgICAgcmVzdWx0LnNldChuZXcgVWludDhBcnJheShzZWNvbmQpLCBmaXJzdExlbmd0aCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogICAgLyoqCiAgICAgKiBQZXJmb3JtcyB0aGUgbWQ1IGhhc2ggb24gYW4gYXJyYXkgYnVmZmVyLgogICAgICoKICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGFyciBUaGUgYXJyYXkgYnVmZmVyCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59ICAgICByYXcgVHJ1ZSB0byBnZXQgdGhlIHJhdyByZXN1bHQsIGZhbHNlIHRvIGdldCB0aGUgaGV4IHJlc3VsdAogICAgICoKICAgICAqIEByZXR1cm4ge1N0cmluZ3xBcnJheX0gVGhlIHJlc3VsdAogICAgICovCgoKICAgIFNwYXJrTUQ1LkFycmF5QnVmZmVyLmhhc2ggPSBmdW5jdGlvbiAoYXJyLCByYXcpIHsKICAgICAgdmFyIGhhc2ggPSBtZDUxX2FycmF5KG5ldyBVaW50OEFycmF5KGFycikpOwogICAgICByZXR1cm4gISFyYXcgPyBoYXNoIDogaGV4KGhhc2gpOwogICAgfTsKCiAgICByZXR1cm4gRmxhc2hSdW50aW1lLnJlZ2lzdGVyKCdNZDUnLCB7CiAgICAgIGluaXQ6IGZ1bmN0aW9uIGluaXQoKSB7Ly8gZG8gbm90aGluZy4KICAgICAgfSwKICAgICAgbG9hZEZyb21CbG9iOiBmdW5jdGlvbiBsb2FkRnJvbUJsb2IoZmlsZSkgewogICAgICAgIHZhciBibG9iID0gZmlsZS5nZXRTb3VyY2UoKSwKICAgICAgICAgICAgY2h1bmtTaXplID0gMiAqIDEwMjQgKiAxMDI0LAogICAgICAgICAgICBjaHVua3MgPSBNYXRoLmNlaWwoYmxvYi5zaXplIC8gY2h1bmtTaXplKSwKICAgICAgICAgICAgY2h1bmsgPSAwLAogICAgICAgICAgICBvd25lciA9IHRoaXMub3duZXIsCiAgICAgICAgICAgIHNwYXJrID0gbmV3IFNwYXJrTUQ1LkFycmF5QnVmZmVyKCksCiAgICAgICAgICAgIG1lID0gdGhpcywKICAgICAgICAgICAgYmxvYlNsaWNlID0gYmxvYi5tb3pTbGljZSB8fCBibG9iLndlYmtpdFNsaWNlIHx8IGJsb2Iuc2xpY2UsCiAgICAgICAgICAgIF9sb2FkTmV4dCwKICAgICAgICAgICAgZnI7CgogICAgICAgIGZyID0gbmV3IEZpbGVSZWFkZXIoKTsKCiAgICAgICAgX2xvYWROZXh0ID0gZnVuY3Rpb24gbG9hZE5leHQoKSB7CiAgICAgICAgICB2YXIgc3RhcnQsIGVuZDsKICAgICAgICAgIHN0YXJ0ID0gY2h1bmsgKiBjaHVua1NpemU7CiAgICAgICAgICBlbmQgPSBNYXRoLm1pbihzdGFydCArIGNodW5rU2l6ZSwgYmxvYi5zaXplKTsKCiAgICAgICAgICBmci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBzcGFyay5hcHBlbmQoZS50YXJnZXQucmVzdWx0KTsKICAgICAgICAgICAgb3duZXIudHJpZ2dlcigncHJvZ3Jlc3MnLCB7CiAgICAgICAgICAgICAgdG90YWw6IGZpbGUuc2l6ZSwKICAgICAgICAgICAgICBsb2FkZWQ6IGVuZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgZnIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmci5vbmxvYWRlbmQgPSBmci5vbmxvYWQgPSBudWxsOwoKICAgICAgICAgICAgaWYgKCsrY2h1bmsgPCBjaHVua3MpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KF9sb2FkTmV4dCwgMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBvd25lci50cmlnZ2VyKCdsb2FkJyk7CiAgICAgICAgICAgICAgICBtZS5yZXN1bHQgPSBzcGFyay5lbmQoKTsKICAgICAgICAgICAgICAgIF9sb2FkTmV4dCA9IGZpbGUgPSBibG9iID0gc3BhcmsgPSBudWxsOwogICAgICAgICAgICAgICAgb3duZXIudHJpZ2dlcignY29tcGxldGUnKTsKICAgICAgICAgICAgICB9LCA1MCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CgogICAgICAgICAgZnIucmVhZEFzQXJyYXlCdWZmZXIoYmxvYlNsaWNlLmNhbGwoYmxvYiwgc3RhcnQsIGVuZCkpOwogICAgICAgIH07CgogICAgICAgIF9sb2FkTmV4dCgpOwogICAgICB9LAogICAgICBnZXRSZXN1bHQ6IGZ1bmN0aW9uIGdldFJlc3VsdCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHQ7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgRmxhc2hSdW50aW1lCiAgICovCgogIGRlZmluZSgncnVudGltZS9mbGFzaC9ydW50aW1lJywgWydiYXNlJywgJ3J1bnRpbWUvcnVudGltZScsICdydW50aW1lL2NvbXBiYXNlJ10sIGZ1bmN0aW9uIChCYXNlLCBSdW50aW1lLCBDb21wQmFzZSkgewogICAgdmFyICQgPSBCYXNlLiQsCiAgICAgICAgdHlwZSA9ICdmbGFzaCcsCiAgICAgICAgY29tcG9uZW50cyA9IHt9OwoKICAgIGZ1bmN0aW9uIGdldEZsYXNoVmVyc2lvbigpIHsKICAgICAgdmFyIHZlcnNpb247CgogICAgICB0cnkgewogICAgICAgIHZlcnNpb24gPSBuYXZpZ2F0b3IucGx1Z2luc1snU2hvY2t3YXZlIEZsYXNoJ107CiAgICAgICAgdmVyc2lvbiA9IHZlcnNpb24uZGVzY3JpcHRpb247CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHZlcnNpb24gPSBuZXcgQWN0aXZlWE9iamVjdCgnU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2gnKS5HZXRWYXJpYWJsZSgnJHZlcnNpb24nKTsKICAgICAgICB9IGNhdGNoIChleDIpIHsKICAgICAgICAgIHZlcnNpb24gPSAnMC4wJzsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZlcnNpb24gPSB2ZXJzaW9uLm1hdGNoKC9cZCsvZyk7CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHZlcnNpb25bMF0gKyAnLicgKyB2ZXJzaW9uWzFdLCAxMCk7CiAgICB9CgogICAgZnVuY3Rpb24gRmxhc2hSdW50aW1lKCkgewogICAgICB2YXIgcG9vbCA9IHt9LAogICAgICAgICAgY2xpZW50cyA9IHt9LAogICAgICAgICAgZGVzdHJveSA9IHRoaXMuZGVzdHJveSwKICAgICAgICAgIG1lID0gdGhpcywKICAgICAgICAgIGpzcmVjaXZlciA9IEJhc2UuZ3VpZCgnd2VidXBsb2FkZXJfJyk7CiAgICAgIFJ1bnRpbWUuYXBwbHkobWUsIGFyZ3VtZW50cyk7CiAgICAgIG1lLnR5cGUgPSB0eXBlOyAvLyDov5nkuKrmlrnms5XnmoTosIPnlKjogIXvvIzlrp7pmYXkuIrmmK9SdW50aW1lQ2xpZW50CgogICAgICBtZS5leGVjID0gZnVuY3Rpb24gKGNvbXAsIGZuCiAgICAgIC8qLCBhcmdzLi4uKi8KICAgICAgKSB7CiAgICAgICAgdmFyIGNsaWVudCA9IHRoaXMsCiAgICAgICAgICAgIHVpZCA9IGNsaWVudC51aWQsCiAgICAgICAgICAgIGFyZ3MgPSBCYXNlLnNsaWNlKGFyZ3VtZW50cywgMiksCiAgICAgICAgICAgIGluc3RhbmNlOwogICAgICAgIGNsaWVudHNbdWlkXSA9IGNsaWVudDsKCiAgICAgICAgaWYgKGNvbXBvbmVudHNbY29tcF0pIHsKICAgICAgICAgIGlmICghcG9vbFt1aWRdKSB7CiAgICAgICAgICAgIHBvb2xbdWlkXSA9IG5ldyBjb21wb25lbnRzW2NvbXBdKGNsaWVudCwgbWUpOwogICAgICAgICAgfQoKICAgICAgICAgIGluc3RhbmNlID0gcG9vbFt1aWRdOwoKICAgICAgICAgIGlmIChpbnN0YW5jZVtmbl0pIHsKICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlW2ZuXS5hcHBseShpbnN0YW5jZSwgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWUuZmxhc2hFeGVjLmFwcGx5KGNsaWVudCwgYXJndW1lbnRzKTsKICAgICAgfTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZXIoZXZ0LCBvYmopIHsKICAgICAgICB2YXIgdHlwZSA9IGV2dC50eXBlIHx8IGV2dCwKICAgICAgICAgICAgcGFydHMsCiAgICAgICAgICAgIHVpZDsKICAgICAgICBwYXJ0cyA9IHR5cGUuc3BsaXQoJzo6Jyk7CiAgICAgICAgdWlkID0gcGFydHNbMF07CiAgICAgICAgdHlwZSA9IHBhcnRzWzFdOyAvLyBjb25zb2xlLmxvZy5hcHBseSggY29uc29sZSwgYXJndW1lbnRzICk7CgogICAgICAgIGlmICh0eXBlID09PSAnUmVhZHknICYmIHVpZCA9PT0gbWUudWlkKSB7CiAgICAgICAgICBtZS50cmlnZ2VyKCdyZWFkeScpOwogICAgICAgIH0gZWxzZSBpZiAoY2xpZW50c1t1aWRdKSB7CiAgICAgICAgICBjbGllbnRzW3VpZF0udHJpZ2dlcih0eXBlLnRvTG93ZXJDYXNlKCksIGV2dCwgb2JqKTsKICAgICAgICB9IC8vIEJhc2UubG9nKCBldnQsIG9iaiApOwoKICAgICAgfSAvLyBmbGFzaOeahOaOpeWPl+WZqOOAggoKCiAgICAgIHdpbmRvd1tqc3JlY2l2ZXJdID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzOyAvLyDkuLrkuobog73mjZXojrflvpfliLDjgIIKCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBoYW5kbGVyLmFwcGx5KG51bGwsIGFyZ3MpOwogICAgICAgIH0sIDEpOwogICAgICB9OwoKICAgICAgdGhpcy5qc3JlY2l2ZXIgPSBqc3JlY2l2ZXI7CgogICAgICB0aGlzLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gQHRvZG8g5Yig6Zmk5rGg5a2Q5Lit55qE5omA5pyJ5a6e5L6LCiAgICAgICAgcmV0dXJuIGRlc3Ryb3kgJiYgZGVzdHJveS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwoKICAgICAgdGhpcy5mbGFzaEV4ZWMgPSBmdW5jdGlvbiAoY29tcCwgZm4pIHsKICAgICAgICB2YXIgZmxhc2ggPSBtZS5nZXRGbGFzaCgpLAogICAgICAgICAgICBhcmdzID0gQmFzZS5zbGljZShhcmd1bWVudHMsIDIpOwogICAgICAgIHJldHVybiBmbGFzaC5leGVjKHRoaXMudWlkLCBjb21wLCBmbiwgYXJncyk7CiAgICAgIH07IC8vIEB0b2RvCgogICAgfQoKICAgIEJhc2UuaW5oZXJpdHMoUnVudGltZSwgewogICAgICBjb25zdHJ1Y3RvcjogRmxhc2hSdW50aW1lLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpLAogICAgICAgICAgICBvcHRzID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICBodG1sOyAvLyBpZiBub3QgdGhlIG1pbmltYWwgaGVpZ2h0LCBzaGltcyBhcmUgbm90IGluaXRpYWxpemVkCiAgICAgICAgLy8gaW4gb2xkZXIgYnJvd3NlcnMgKGUuZyBGRjMuNiwgSUU2LDcsOCwgU2FmYXJpIDQuMCw1LjAsIGV0YykKCiAgICAgICAgY29udGFpbmVyLmNzcyh7CiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICAgIHRvcDogJy04cHgnLAogICAgICAgICAgbGVmdDogJy04cHgnLAogICAgICAgICAgd2lkdGg6ICc5cHgnLAogICAgICAgICAgaGVpZ2h0OiAnOXB4JywKICAgICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJwogICAgICAgIH0pOyAvLyBpbnNlcnQgZmxhc2ggb2JqZWN0CgogICAgICAgIGh0bWwgPSAnPG9iamVjdCBpZD0iJyArIHRoaXMudWlkICsgJyIgdHlwZT0iYXBwbGljYXRpb24vJyArICd4LXNob2Nrd2F2ZS1mbGFzaCIgZGF0YT0iJyArIG9wdHMuc3dmICsgJyIgJzsKCiAgICAgICAgaWYgKEJhc2UuYnJvd3Nlci5pZSkgewogICAgICAgICAgaHRtbCArPSAnY2xhc3NpZD0iY2xzaWQ6ZDI3Y2RiNmUtYWU2ZC0xMWNmLTk2YjgtNDQ0NTUzNTQwMDAwIiAnOwogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSAnd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgc3R5bGU9Im91dGxpbmU6MCI+JyArICc8cGFyYW0gbmFtZT0ibW92aWUiIHZhbHVlPSInICsgb3B0cy5zd2YgKyAnIiAvPicgKyAnPHBhcmFtIG5hbWU9ImZsYXNodmFycyIgdmFsdWU9InVpZD0nICsgdGhpcy51aWQgKyAnJmpzcmVjaXZlcj0nICsgdGhpcy5qc3JlY2l2ZXIgKyAnIiAvPicgKyAnPHBhcmFtIG5hbWU9Indtb2RlIiB2YWx1ZT0idHJhbnNwYXJlbnQiIC8+JyArICc8cGFyYW0gbmFtZT0iYWxsb3dzY3JpcHRhY2Nlc3MiIHZhbHVlPSJhbHdheXMiIC8+JyArICc8L29iamVjdD4nOwogICAgICAgIGNvbnRhaW5lci5odG1sKGh0bWwpOwogICAgICB9LAogICAgICBnZXRGbGFzaDogZnVuY3Rpb24gZ2V0Rmxhc2goKSB7CiAgICAgICAgaWYgKHRoaXMuX2ZsYXNoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fZmxhc2g7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9mbGFzaCA9ICQoJyMnICsgdGhpcy51aWQpLmdldCgwKTsKICAgICAgICByZXR1cm4gdGhpcy5fZmxhc2g7CiAgICAgIH0KICAgIH0pOwoKICAgIEZsYXNoUnVudGltZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChuYW1lLCBjb21wb25lbnQpIHsKICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1tuYW1lXSA9IEJhc2UuaW5oZXJpdHMoQ29tcEJhc2UsICQuZXh0ZW5kKHsKICAgICAgICAvLyBAdG9kbyBmaXggdGhpcyBsYXRlcgogICAgICAgIGZsYXNoRXhlYzogZnVuY3Rpb24gZmxhc2hFeGVjKCkgewogICAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lciwKICAgICAgICAgICAgICBydW50aW1lID0gdGhpcy5nZXRSdW50aW1lKCk7CiAgICAgICAgICByZXR1cm4gcnVudGltZS5mbGFzaEV4ZWMuYXBwbHkob3duZXIsIGFyZ3VtZW50cyk7CiAgICAgICAgfQogICAgICB9LCBjb21wb25lbnQpKTsKICAgICAgcmV0dXJuIGNvbXBvbmVudDsKICAgIH07CgogICAgaWYgKGdldEZsYXNoVmVyc2lvbigpID49IDExLjQpIHsKICAgICAgUnVudGltZS5hZGRSdW50aW1lKHR5cGUsIEZsYXNoUnVudGltZSk7CiAgICB9CgogICAgcmV0dXJuIEZsYXNoUnVudGltZTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEZpbGVQaWNrZXIKICAgKi8KCiAgZGVmaW5lKCdydW50aW1lL2ZsYXNoL2ZpbGVwaWNrZXInLCBbJ2Jhc2UnLCAncnVudGltZS9mbGFzaC9ydW50aW1lJ10sIGZ1bmN0aW9uIChCYXNlLCBGbGFzaFJ1bnRpbWUpIHsKICAgIHZhciAkID0gQmFzZS4kOwogICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlcignRmlsZVBpY2tlcicsIHsKICAgICAgaW5pdDogZnVuY3Rpb24gaW5pdChvcHRzKSB7CiAgICAgICAgdmFyIGNvcHkgPSAkLmV4dGVuZCh7fSwgb3B0cyksCiAgICAgICAgICAgIGxlbiwKICAgICAgICAgICAgaTsgLy8g5L+u5aSNRmxhc2jlho3msqHmnInorr7nva50aXRsZeeahOaDheWGteS4i+aXoOazleW8ueWHumZsYXNo5paH5Lu26YCJ5oup5qGG55qEYnVnLgoKICAgICAgICBsZW4gPSBjb3B5LmFjY2VwdCAmJiBjb3B5LmFjY2VwdC5sZW5ndGg7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgICAgaWYgKCFjb3B5LmFjY2VwdFtpXS50aXRsZSkgewogICAgICAgICAgICBjb3B5LmFjY2VwdFtpXS50aXRsZSA9ICdGaWxlcyc7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkZWxldGUgY29weS5idXR0b247CiAgICAgICAgZGVsZXRlIGNvcHkuaWQ7CiAgICAgICAgZGVsZXRlIGNvcHkuY29udGFpbmVyOwogICAgICAgIHRoaXMuZmxhc2hFeGVjKCdGaWxlUGlja2VyJywgJ2luaXQnLCBjb3B5KTsKICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLmZsYXNoRXhlYygnRmlsZVBpY2tlcicsICdkZXN0cm95Jyk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg5Zu+54mH5Y6L57ypCiAgICovCgogIGRlZmluZSgncnVudGltZS9mbGFzaC9pbWFnZScsIFsncnVudGltZS9mbGFzaC9ydW50aW1lJ10sIGZ1bmN0aW9uIChGbGFzaFJ1bnRpbWUpIHsKICAgIHJldHVybiBGbGFzaFJ1bnRpbWUucmVnaXN0ZXIoJ0ltYWdlJywgewogICAgICAvLyBpbml0OiBmdW5jdGlvbiggb3B0aW9ucyApIHsKICAgICAgLy8gICAgIHZhciBvd25lciA9IHRoaXMub3duZXI7CiAgICAgIC8vICAgICB0aGlzLmZsYXNoRXhlYyggJ0ltYWdlJywgJ2luaXQnLCBvcHRpb25zICk7CiAgICAgIC8vICAgICBvd25lci5vbiggJ2xvYWQnLCBmdW5jdGlvbigpIHsKICAgICAgLy8gICAgICAgICBkZWJ1Z2dlcjsKICAgICAgLy8gICAgIH0pOwogICAgICAvLyB9LAogICAgICBsb2FkRnJvbUJsb2I6IGZ1bmN0aW9uIGxvYWRGcm9tQmxvYihibG9iKSB7CiAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lcjsKICAgICAgICBvd25lci5pbmZvKCkgJiYgdGhpcy5mbGFzaEV4ZWMoJ0ltYWdlJywgJ2luZm8nLCBvd25lci5pbmZvKCkpOwogICAgICAgIG93bmVyLm1ldGEoKSAmJiB0aGlzLmZsYXNoRXhlYygnSW1hZ2UnLCAnbWV0YScsIG93bmVyLm1ldGEoKSk7CiAgICAgICAgdGhpcy5mbGFzaEV4ZWMoJ0ltYWdlJywgJ2xvYWRGcm9tQmxvYicsIGJsb2IudWlkKTsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyAgVHJhbnNwb3J0IGZsYXNo5a6e546wCiAgICovCgogIGRlZmluZSgncnVudGltZS9mbGFzaC90cmFuc3BvcnQnLCBbJ2Jhc2UnLCAncnVudGltZS9mbGFzaC9ydW50aW1lJywgJ3J1bnRpbWUvY2xpZW50J10sIGZ1bmN0aW9uIChCYXNlLCBGbGFzaFJ1bnRpbWUsIFJ1bnRpbWVDbGllbnQpIHsKICAgIHZhciAkID0gQmFzZS4kOwogICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlcignVHJhbnNwb3J0JywgewogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHRoaXMuX3N0YXR1cyA9IDA7CiAgICAgICAgdGhpcy5fcmVzcG9uc2UgPSBudWxsOwogICAgICAgIHRoaXMuX3Jlc3BvbnNlSnNvbiA9IG51bGw7CiAgICAgIH0sCiAgICAgIHNlbmQ6IGZ1bmN0aW9uIHNlbmQoKSB7CiAgICAgICAgdmFyIG93bmVyID0gdGhpcy5vd25lciwKICAgICAgICAgICAgb3B0cyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgeGhyID0gdGhpcy5faW5pdEFqYXgoKSwKICAgICAgICAgICAgYmxvYiA9IG93bmVyLl9ibG9iLAogICAgICAgICAgICBzZXJ2ZXIgPSBvcHRzLnNlcnZlciwKICAgICAgICAgICAgYmluYXJ5OwoKICAgICAgICB4aHIuY29ubmVjdFJ1bnRpbWUoYmxvYi5ydWlkKTsKCiAgICAgICAgaWYgKG9wdHMuc2VuZEFzQmluYXJ5KSB7CiAgICAgICAgICBzZXJ2ZXIgKz0gKC9cPy8udGVzdChzZXJ2ZXIpID8gJyYnIDogJz8nKSArICQucGFyYW0ob3duZXIuX2Zvcm1EYXRhKTsKICAgICAgICAgIGJpbmFyeSA9IGJsb2IudWlkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAkLmVhY2gob3duZXIuX2Zvcm1EYXRhLCBmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICB4aHIuZXhlYygnYXBwZW5kJywgaywgdik7CiAgICAgICAgICB9KTsKICAgICAgICAgIHhoci5leGVjKCdhcHBlbmRCbG9iJywgb3B0cy5maWxlVmFsLCBibG9iLnVpZCwgb3B0cy5maWxlbmFtZSB8fCBvd25lci5fZm9ybURhdGEubmFtZSB8fCAnJyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9zZXRSZXF1ZXN0SGVhZGVyKHhociwgb3B0cy5oZWFkZXJzKTsKCiAgICAgICAgeGhyLmV4ZWMoJ3NlbmQnLCB7CiAgICAgICAgICBtZXRob2Q6IG9wdHMubWV0aG9kLAogICAgICAgICAgdXJsOiBzZXJ2ZXIsCiAgICAgICAgICBmb3JjZVVSTFN0cmVhbTogb3B0cy5mb3JjZVVSTFN0cmVhbSwKICAgICAgICAgIG1pbWVUeXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJwogICAgICAgIH0sIGJpbmFyeSk7CiAgICAgIH0sCiAgICAgIGdldFN0YXR1czogZnVuY3Rpb24gZ2V0U3RhdHVzKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zdGF0dXM7CiAgICAgIH0sCiAgICAgIGdldFJlc3BvbnNlOiBmdW5jdGlvbiBnZXRSZXNwb25zZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2UgfHwgJyc7CiAgICAgIH0sCiAgICAgIGdldFJlc3BvbnNlQXNKc29uOiBmdW5jdGlvbiBnZXRSZXNwb25zZUFzSnNvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5fcmVzcG9uc2VKc29uOwogICAgICB9LAogICAgICBnZXRSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uIGdldFJlc3BvbnNlSGVhZGVycygpIHsKICAgICAgICAvLyBmbGFzaCDmmoLkuI3mlK/mjIEKICAgICAgICByZXR1cm4ge307CiAgICAgIH0sCiAgICAgIGFib3J0OiBmdW5jdGlvbiBhYm9ydCgpIHsKICAgICAgICB2YXIgeGhyID0gdGhpcy5feGhyOwoKICAgICAgICBpZiAoeGhyKSB7CiAgICAgICAgICB4aHIuZXhlYygnYWJvcnQnKTsKICAgICAgICAgIHhoci5kZXN0cm95KCk7CiAgICAgICAgICB0aGlzLl94aHIgPSB4aHIgPSBudWxsOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgICB0aGlzLmFib3J0KCk7CiAgICAgIH0sCiAgICAgIF9pbml0QWpheDogZnVuY3Rpb24gX2luaXRBamF4KCkgewogICAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAgIHhociA9IG5ldyBSdW50aW1lQ2xpZW50KCdYTUxIdHRwUmVxdWVzdCcpOwogICAgICAgIHhoci5vbigndXBsb2FkcHJvZ3Jlc3MgcHJvZ3Jlc3MnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgdmFyIHBlcmNlbnQgPSBlLmxvYWRlZCAvIGUudG90YWw7CiAgICAgICAgICBwZXJjZW50ID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgcGVyY2VudCkpOwogICAgICAgICAgcmV0dXJuIG1lLnRyaWdnZXIoJ3Byb2dyZXNzJywgcGVyY2VudCk7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHN0YXR1cyA9IHhoci5leGVjKCdnZXRTdGF0dXMnKSwKICAgICAgICAgICAgICByZWFkQm9keSA9IGZhbHNlLAogICAgICAgICAgICAgIGVyciA9ICcnLAogICAgICAgICAgICAgIHA7CiAgICAgICAgICB4aHIub2ZmKCk7CiAgICAgICAgICBtZS5feGhyID0gbnVsbDsKCiAgICAgICAgICBpZiAoc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDApIHsKICAgICAgICAgICAgcmVhZEJvZHkgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPj0gNTAwICYmIHN0YXR1cyA8IDYwMCkgewogICAgICAgICAgICByZWFkQm9keSA9IHRydWU7CiAgICAgICAgICAgIGVyciA9ICdzZXJ2ZXItJyArIHN0YXR1czsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVyciA9ICdodHRwLScgKyBzdGF0dXM7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJlYWRCb2R5KSB7CiAgICAgICAgICAgIG1lLl9yZXNwb25zZSA9IHhoci5leGVjKCdnZXRSZXNwb25zZScpOwogICAgICAgICAgICBtZS5fcmVzcG9uc2UgPSBkZWNvZGVVUklDb21wb25lbnQobWUuX3Jlc3BvbnNlKTsgLy8gZmxhc2gg5aSE55CG5Y+v6IO95a2Y5ZyoIGJ1Zywg5rKh6L6Z5Y+q6IO96Z2gIGpzIOS6hgogICAgICAgICAgICAvLyB0cnkgewogICAgICAgICAgICAvLyAgICAgbWUuX3Jlc3BvbnNlSnNvbiA9IHhoci5leGVjKCdnZXRSZXNwb25zZUFzSnNvbicpOwogICAgICAgICAgICAvLyB9IGNhdGNoICggZXJyb3IgKSB7CgogICAgICAgICAgICBwID0gZnVuY3Rpb24gcChzKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuSlNPTiAmJiB3aW5kb3cuSlNPTi5wYXJzZSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCdyZXR1cm4gJyArIHMpLmNhbGwoKTsKICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIHJldHVybiB7fTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBtZS5fcmVzcG9uc2VKc29uID0gbWUuX3Jlc3BvbnNlID8gcChtZS5fcmVzcG9uc2UpIDoge307IC8vIH0KICAgICAgICAgIH0KCiAgICAgICAgICB4aHIuZGVzdHJveSgpOwogICAgICAgICAgeGhyID0gbnVsbDsKICAgICAgICAgIHJldHVybiBlcnIgPyBtZS50cmlnZ2VyKCdlcnJvcicsIGVycikgOiBtZS50cmlnZ2VyKCdsb2FkJyk7CiAgICAgICAgfSk7CiAgICAgICAgeGhyLm9uKCdlcnJvcicsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzdGF0dXMgPSB4aHIuZXhlYygnZ2V0U3RhdHVzJyksCiAgICAgICAgICAgICAgZXJyID0gc3RhdHVzID8gJ2h0dHAtJyArIHN0YXR1cyA6ICdodHRwJzsKICAgICAgICAgIHhoci5vZmYoKTsKICAgICAgICAgIG1lLl94aHIgPSBudWxsOwogICAgICAgICAgbWUudHJpZ2dlcignZXJyb3InLCBlcnIpOwogICAgICAgIH0pOwogICAgICAgIG1lLl94aHIgPSB4aHI7CiAgICAgICAgcmV0dXJuIHhocjsKICAgICAgfSwKICAgICAgX3NldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uIF9zZXRSZXF1ZXN0SGVhZGVyKHhociwgaGVhZGVycykgewogICAgICAgICQuZWFjaChoZWFkZXJzLCBmdW5jdGlvbiAoa2V5LCB2YWwpIHsKICAgICAgICAgIHhoci5leGVjKCdzZXRSZXF1ZXN0SGVhZGVyJywga2V5LCB2YWwpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICB9KTsKICAvKioKICAgKiBAZmlsZU92ZXJ2aWV3IEJsb2IgSHRtbOWunueOsAogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvZmxhc2gvYmxvYicsIFsncnVudGltZS9mbGFzaC9ydW50aW1lJywgJ2xpYi9ibG9iJ10sIGZ1bmN0aW9uIChGbGFzaFJ1bnRpbWUsIEJsb2IpIHsKICAgIHJldHVybiBGbGFzaFJ1bnRpbWUucmVnaXN0ZXIoJ0Jsb2InLCB7CiAgICAgIHNsaWNlOiBmdW5jdGlvbiBzbGljZShzdGFydCwgZW5kKSB7CiAgICAgICAgdmFyIGJsb2IgPSB0aGlzLmZsYXNoRXhlYygnQmxvYicsICdzbGljZScsIHN0YXJ0LCBlbmQpOwogICAgICAgIHJldHVybiBuZXcgQmxvYih0aGlzLmdldFJ1aWQoKSwgYmxvYik7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcgIE1kNSBmbGFzaOWunueOsAogICAqLwoKICBkZWZpbmUoJ3J1bnRpbWUvZmxhc2gvbWQ1JywgWydydW50aW1lL2ZsYXNoL3J1bnRpbWUnXSwgZnVuY3Rpb24gKEZsYXNoUnVudGltZSkgewogICAgcmV0dXJuIEZsYXNoUnVudGltZS5yZWdpc3RlcignTWQ1JywgewogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgey8vIGRvIG5vdGhpbmcuCiAgICAgIH0sCiAgICAgIGxvYWRGcm9tQmxvYjogZnVuY3Rpb24gbG9hZEZyb21CbG9iKGJsb2IpIHsKICAgICAgICByZXR1cm4gdGhpcy5mbGFzaEV4ZWMoJ01kNScsICdsb2FkRnJvbUJsb2InLCBibG9iLnVpZCk7CiAgICAgIH0KICAgIH0pOwogIH0pOwogIC8qKgogICAqIEBmaWxlT3ZlcnZpZXcg5a6M5YWo54mI5pys44CCCiAgICovCgogIGRlZmluZSgncHJlc2V0L2FsbCcsIFsnYmFzZScsIC8vIHdpZGdldHMKICAnd2lkZ2V0cy9maWxlZG5kJywgJ3dpZGdldHMvZmlsZXBhc3RlJywgJ3dpZGdldHMvZmlsZXBpY2tlcicsICd3aWRnZXRzL2ltYWdlJywgJ3dpZGdldHMvcXVldWUnLCAnd2lkZ2V0cy9ydW50aW1lJywgJ3dpZGdldHMvdXBsb2FkJywgJ3dpZGdldHMvdmFsaWRhdG9yJywgJ3dpZGdldHMvbWQ1JywgLy8gcnVudGltZXMKICAvLyBodG1sNQogICdydW50aW1lL2h0bWw1L2Jsb2InLCAncnVudGltZS9odG1sNS9kbmQnLCAncnVudGltZS9odG1sNS9maWxlcGFzdGUnLCAncnVudGltZS9odG1sNS9maWxlcGlja2VyJywgJ3J1bnRpbWUvaHRtbDUvaW1hZ2VtZXRhL2V4aWYnLCAncnVudGltZS9odG1sNS9hbmRyb2lkcGF0Y2gnLCAncnVudGltZS9odG1sNS9pbWFnZScsICdydW50aW1lL2h0bWw1L3RyYW5zcG9ydCcsICdydW50aW1lL2h0bWw1L21kNScsIC8vIGZsYXNoCiAgJ3J1bnRpbWUvZmxhc2gvZmlsZXBpY2tlcicsICdydW50aW1lL2ZsYXNoL2ltYWdlJywgJ3J1bnRpbWUvZmxhc2gvdHJhbnNwb3J0JywgJ3J1bnRpbWUvZmxhc2gvYmxvYicsICdydW50aW1lL2ZsYXNoL21kNSddLCBmdW5jdGlvbiAoQmFzZSkgewogICAgcmV0dXJuIEJhc2U7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyDml6Xlv5fnu4Tku7bvvIzkuLvopoHnlKjmnaXmlLbpm4bplJnor6/kv6Hmga/vvIzlj6/ku6XluK7liqkgd2VidXBsb2FkZXIg5pu05aW955qE5a6a5L2N6Zeu6aKY5ZKM5Y+R5bGV44CCCiAgICoKICAgKiDlpoLmnpzmgqjkuI3mg7PopoHlkK/nlKjmraTlip/og73vvIzor7flnKjmiZPljIXnmoTml7blgJnljrvmjokgbG9nIOaooeWdl+OAggogICAqCiAgICog5oiW6ICF5Y+v5Lul5Zyo5Yid5aeL5YyW55qE5pe25YCZ6YCa6L+HIG9wdGlvbnMuZGlzYWJsZVdpZGdldHMg5bGe5oCn56aB55So44CCCiAgICoKICAgKiDlpoLvvJoKICAgKiBXZWJVcGxvYWRlci5jcmVhdGUoewogICAqICAgICAuLi4KICAgKgogICAqICAgICBkaXNhYmxlV2lkZ2V0czogJ2xvZycsCiAgICoKICAgKiAgICAgLi4uCiAgICogfSkKICAgKi8KCiAgZGVmaW5lKCd3aWRnZXRzL2xvZycsIFsnYmFzZScsICd1cGxvYWRlcicsICd3aWRnZXRzL3dpZGdldCddLCBmdW5jdGlvbiAoQmFzZSwgVXBsb2FkZXIpIHsKICAgIHZhciAkID0gQmFzZS4kLAogICAgICAgIGxvZ1VybCA9ICcgaHR0cDovL3N0YXRpYy50aWViYS5iYWlkdS5jb20vdGIvcG1zL2ltZy9zdC5naWY/PycsCiAgICAgICAgcHJvZHVjdCA9IChsb2NhdGlvbi5ob3N0bmFtZSB8fCBsb2NhdGlvbi5ob3N0IHx8ICdwcm90ZWN0ZWQnKS50b0xvd2VyQ2FzZSgpLAogICAgICAgIC8vIOWPqumSiOWvuSBiYWlkdSDlhoXpg6jkuqflk4HnlKjmiLflgZrnu5/orqHlip/og73jgIIKICAgIGVuYWJsZSA9IHByb2R1Y3QgJiYgL2JhaWR1L2kuZXhlYyhwcm9kdWN0KSwKICAgICAgICBiYXNlOwoKICAgIGlmICghZW5hYmxlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBiYXNlID0gewogICAgICBkdjogMywKICAgICAgbWFzdGVyOiAnd2VidXBsb2FkZXInLAogICAgICBvbmxpbmU6IC90ZXN0Ly5leGVjKHByb2R1Y3QpID8gMCA6IDEsCiAgICAgIG1vZHVsZTogJycsCiAgICAgIHByb2R1Y3Q6IHByb2R1Y3QsCiAgICAgIHR5cGU6IDAKICAgIH07CgogICAgZnVuY3Rpb24gc2VuZChkYXRhKSB7CiAgICAgIHZhciBvYmogPSAkLmV4dGVuZCh7fSwgYmFzZSwgZGF0YSksCiAgICAgICAgICB1cmwgPSBsb2dVcmwucmVwbGFjZSgvXiguKilcPy8sICckMScgKyAkLnBhcmFtKG9iaikpLAogICAgICAgICAgaW1hZ2UgPSBuZXcgSW1hZ2UoKTsKICAgICAgaW1hZ2Uuc3JjID0gdXJsOwogICAgfQoKICAgIHJldHVybiBVcGxvYWRlci5yZWdpc3Rlcih7CiAgICAgIG5hbWU6ICdsb2cnLAogICAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHZhciBvd25lciA9IHRoaXMub3duZXIsCiAgICAgICAgICAgIGNvdW50ID0gMCwKICAgICAgICAgICAgc2l6ZSA9IDA7CiAgICAgICAgb3duZXIub24oJ2Vycm9yJywgZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICAgIHNlbmQoewogICAgICAgICAgICB0eXBlOiAyLAogICAgICAgICAgICBjX2Vycm9yX2NvZGU6IGNvZGUKICAgICAgICAgIH0pOwogICAgICAgIH0pLm9uKCd1cGxvYWRFcnJvcicsIGZ1bmN0aW9uIChmaWxlLCByZWFzb24pIHsKICAgICAgICAgIHNlbmQoewogICAgICAgICAgICB0eXBlOiAyLAogICAgICAgICAgICBjX2Vycm9yX2NvZGU6ICdVUExPQURfRVJST1InLAogICAgICAgICAgICBjX3JlYXNvbjogJycgKyByZWFzb24KICAgICAgICAgIH0pOwogICAgICAgIH0pLm9uKCd1cGxvYWRDb21wbGV0ZScsIGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgc2l6ZSArPSBmaWxlLnNpemU7CiAgICAgICAgfSkub24oJ3VwbG9hZEZpbmlzaGVkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgc2VuZCh7CiAgICAgICAgICAgIGNfY291bnQ6IGNvdW50LAogICAgICAgICAgICBjX3NpemU6IHNpemUKICAgICAgICAgIH0pOwogICAgICAgICAgY291bnQgPSBzaXplID0gMDsKICAgICAgICB9KTsKICAgICAgICBzZW5kKHsKICAgICAgICAgIGNfdXNhZ2U6IDEKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSk7CiAgLyoqCiAgICogQGZpbGVPdmVydmlldyBVcGxvYWRlcuS4iuS8oOexuwogICAqLwoKICBkZWZpbmUoJ3dlYnVwbG9hZGVyJywgWydwcmVzZXQvYWxsJywgJ3dpZGdldHMvbG9nJ10sIGZ1bmN0aW9uIChwcmVzZXQpIHsKICAgIHJldHVybiBwcmVzZXQ7CiAgfSk7CiAgcmV0dXJuIHJlcXVpcmUoJ3dlYnVwbG9hZGVyJyk7Cn0pOw=="},{"version":3,"sources":["E:/course/2022/学成在线/front_code/project-xczx2-portal-vue-ts/static/plugins/webuploader/dist/webuploader.js"],"names":["jQuery","root","factory","modules","_require","deps","callback","args","len","i","getModule","length","push","apply","_define","id","arguments","setModule","module","exports","returned","undefined","Error","exportsTo","obj","key","host","parts","part","last","ucFirst","str","charAt","toUpperCase","substr","hasOwnProperty","split","pop","shift","makeExport","dollar","__dollar","origin","define","amd","WebUploader","noConflict","window","require","req","$","Zepto","_","Deferred","when","isPromise","anything","then","promise","noop","call","Function","uncurryThis","fn","bindFn","context","createObject","proto","f","Object","create","prototype","version","browser","ua","ret","webkit","match","chrome","ie","firefox","safari","opera","parseFloat","navigator","userAgent","os","android","ios","replace","inherits","Super","protos","staticProtos","child","constructor","extend","__super__","log","console","nextTick","cb","setTimeout","slice","guid","counter","prefix","Date","toString","Math","floor","random","formatSize","size","pointLength","units","unit","toFixed","Base","separator","findHandlers","arr","name","grep","handler","e","_cb","ctx","eachEvent","events","iterator","each","triggerHanders","stoped","ctx2","on","me","set","_events","once","off","trigger","type","allEvents","installTo","Mediator","Uploader","opts","options","_init","upload","stop","getFile","getFiles","addFile","addFiles","sort","removeFile","cancelFile","skipFile","retry","isInProgress","makeThumb","md5File","getDimension","addButton","predictRuntimeType","refresh","disable","enable","reset","command","request","state","option","val","isPlainObject","getStats","stats","successNum","numOfSuccess","progressNum","numOfProgress","cancelNum","numOfCancel","invalidNum","numOfInvalid","uploadFailNum","numOfUploadFailed","queueNum","numOfQueue","interruptNum","numofInterrupt","substring","isFunction","concat","destroy","factories","getFirstKey","Runtime","container","document","body","uid","getContainer","parent","_container","createElement","attr","css","position","top","left","width","height","overflow","append","addClass","_parent","init","exec","remove","removeClass","orders","addRuntime","hasRuntime","runtime","cache","add","get","ruid","standalone","__standalone","RuntimeClient","component","deferred","runtimeReady","done","connectRuntime","runtimeOrder","__promise","resolve","__client","getRuntime","disconnectRuntime","unshift","getRuid","RuntimeClent","DragAndDrop","accept","disableGlobalDnd","_destroy","IGNORE","widgetClass","isArrayLike","nodeType","Widget","uploader","owner","invoke","apiName","map","responseMap","widgets","_widgets","deactives","disableWidgets","klass","indexOf","_name","rlts","dfds","widget","rlt","pipe","register","widgetProto","toLowerCase","unRegister","splice","Dnd","dnd","files","items","FilePaste","paste","Blob","source","ext","start","end","getSource","rExt","File","file","RegExp","$1","lastModifiedDate","toLocaleString","FilePicker","innerHTML","label","html","button","multiple","style","_refer","_resizeHandler","shimContainer","outerWidth","outerHeight","pos","offset","bottom","right","btn","pick","pickers","addBtn","promises","picker","swf","Image","_info","_meta","quality","crop","preserveHeaders","allowMagnify","info","meta","loadFromBlob","blob","resize","getAsDataUrl","getAsBlob","throttle","max","occupied","waiting","tick","item","emiter","thumb","compress","image","reason","beforeSendFile","compressSize","noCompressIfLarger","_compressed","always","reject","idPrefix","idSuffix","statusMap","gid","WUFile","statusText","Status","INITED","loaded","msg","setStatus","ERROR","status","text","prevStatus","getStatus","QUEUED","PROGRESS","COMPLETE","CANCELLED","INTERRUPT","INVALID","STATUS","Queue","numofDeleted","_queue","_map","_fileAdded","prepend","fileId","fetch","sts","inArray","existing","_delFile","cur","pre","_onFileStatusChange","curStatus","preStatus","extensions","join","queue","placeholder","_ruid","_wrapFile","acceptFile","invalid","test","_addFile","auto","fetchFile","noForceStart","sortFiles","support","Transport","_blob","_formData","formData","_headers","headers","_timeout","clearTimeout","_timer","server","method","withCredentials","fileVal","timeout","sendAsBinary","appendBlob","filename","value","setRequestHeader","send","abort","getResponseHeaders","getResponse","getResponseAsJson","duration","prepareNextFile","chunked","chunkSize","chunkRetry","threads","CuteFile","pending","total","chunks","ceil","index","api","has","block","min","chunk","cuted","blocks","remaning","runing","progress","pool","stack","__tick","_tick","v","transport","_trigged","_promise","startUpload","stopUpload","interrupt","_putback","_popBlock","_tr","_getStats","skipped","_nextBlock","_startSend","idx","_getStack","act","next","preparing","_prepareNextFile","_finishFile","fail","_doSend","percentage","updateFileProgress","tr","data","requestAccept","_raw","response","flag","retried","hds","totalPercent","uploaded","validators","addValidator","removeValidator","count","parseInt","fileNumLimit","fileSizeLimit","fileSingleSizeLimit","mapping","duplicate","hashString","hash","_char","charCodeAt","__hash","Md5","getResult","md5","notify","CompBase","components","Html5Runtime","comp","client","instance","FileReader","DataView","webkitSlice","mozSlice","elem","dragEnterHandler","_dragEnterHandler","dragOverHandler","_dragOverHandler","dragLeaveHandler","_dragLeaveHandler","dropHandler","_dropHandler","dndOver","denied","_denied","originalEvent","dataTransfer","dropEffect","parentElem","contains","currentTarget","_leaveTimer","getData","err","_getTansferFiles","results","canAccessFolder","webkitGetAsEntry","isDirectory","_traverseDirectoryTree","entry","isFile","createReader","readEntries","entries","mimeTypes","hander","_pasteHander","allowed","clipboardData","kind","getAsFile","preventDefault","stopPropagation","input","mouseHandler","changeHandler","opacity","display","cursor","background","clone","target","cloneNode","parentNode","replaceChild","urlAPI","createObjectURL","URL","revokeObjectURL","webkitURL","dataURL2Blob","dataURI","byteStr","intArray","ab","mimetype","atob","decodeURIComponent","ArrayBuffer","Uint8Array","arrayBufferToBlob","dataURL2ArrayBuffer","buffer","builder","BlobBuilder","WebKitBlobBuilder","bb","getBlob","canvasToDataUrl","canvas","toDataURL","parseMeta","updateImageHead","Util","parsers","maxMetaDataSize","parse","fr","onload","_parse","result","onerror","message","readAsArrayBuffer","noParse","byteLength","dataview","maxOffset","headLength","markerBytes","markerLength","getUint16","imageHead","subarray","head","buf1","buf2","bodyoffset","ImageMeta","EXIF","ExifMap","exifTagTypes","getValue","dataView","dataOffset","getUint8","String","fromCharCode","ascii","littleEndian","getUint32","getInt32","getExifValue","tiffOffset","tagType","tagSize","values","c","parseExifTag","tag","exif","parseExifTags","dirOffset","tagsNumber","dirEndOffset","parseExifData","JPEGEncoder","self","fround","round","ffloor","YTable","Array","UVTable","fdtbl_Y","fdtbl_UV","YDC_HT","UVDC_HT","YAC_HT","UVAC_HT","bitcode","category","outputfDCTQuant","DU","byteout","bytenew","bytepos","YDU","UDU","VDU","clt","RGB_YUV_TABLE","currentQuality","ZigZag","std_dc_luminance_nrcodes","std_dc_luminance_values","std_ac_luminance_nrcodes","std_ac_luminance_values","std_dc_chrominance_nrcodes","std_dc_chrominance_values","std_ac_chrominance_nrcodes","std_ac_chrominance_values","initQuantTables","sf","YQT","t","UVQT","j","u","aasf","k","row","col","computeHuffmanTbl","nrcodes","std_table","codevalue","pos_in_table","HT","initHuffmanTbl","initCategoryNumber","nrlower","nrupper","cat","nr","nrneg","initRGBYUVTable","writeBits","bs","posval","writeByte","writeWord","fDCTQuant","fdtbl","d0","d1","d2","d3","d4","d5","d6","d7","dataOff","I8","I64","tmp0","tmp7","tmp1","tmp6","tmp2","tmp5","tmp3","tmp4","tmp10","tmp13","tmp11","tmp12","z1","z5","z2","z4","z3","z11","z13","tmp0p2","tmp7p2","tmp1p2","tmp6p2","tmp2p2","tmp5p2","tmp3p2","tmp4p2","tmp10p2","tmp13p2","tmp11p2","tmp12p2","z1p2","z5p2","z2p2","z4p2","z3p2","z11p2","z13p2","writeAPP0","writeSOF0","writeDQT","writeDHT","l","m","n","o","p","writeSOS","processDU","CDU","DC","HTDC","HTAC","EOB","M16zeroes","I16","I63","DU_DCT","Diff","end0pos","lng","startpos","nrzeroes","nrmarker","initCharLookupTable","sfcc","encode","setQuality","DCY","DCU","DCV","displayName","imageData","quadWidth","tripleWidth","x","y","r","g","b","fillbits","jpegDataUri","btoa","encoder","supportJpeg","w","h","fragement","getContext","getImageData","BLANK","modified","img","_metas","error","_img","src","_canvas","_resize","s","cvs","iw","naturalWidth","ih","naturalHeight","orientation","getOrientation","_rotate2Orientaion","_renderImageToCanvas","clearRect","scale","translate","rotate","PI","drawImage","detectVerticalSquash","sy","ey","py","alpha","ratio","vertSquashRatio","detectSubsampling","subsampled","doSquash","d","dy","tmpCanvas","tmpCtx","dw","dh","sx","dx","save","restore","_status","_response","xhr","_initAjax","binary","attachInfoToQuery","param","FormData","open","_setRequestHeader","overrideMimeType","_parseJson","_xhr","onprogress","onreadystatechange","_parseHeader","raw","trim","XMLHttpRequest","XDomainRequest","lengthComputable","readyState","responseText","getAllResponseHeaders","json","JSON","ex","FlashRuntime","add32","a","cmn","q","ff","gg","hh","ii","md5cycle","md5blk","md5blks","md5blk_array","md51","tail","tmp","lo","hi","md51_array","hex_chr","rhex","hex","SparkMD5","lsw","msw","unescape","encodeURIComponent","appendBinary","contents","_buff","_length","_state","buff","_finish","hashBinary","content","_concatArrayBuffer","first","second","firstLength","spark","blobSlice","loadNext","onloadend","getFlashVersion","plugins","description","ActiveXObject","GetVariable","ex2","clients","jsreciver","flashExec","evt","flash","getFlash","_flash","copy","title","_responseJson","url","forceURLStream","mimeType","percent","readBody","logUrl","product","location","hostname","base","dv","master","online","code","c_error_code","c_reason","c_count","c_size","c_usage","preset"],"mappings":"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","sourcesContent":["/*! WebUploader 0.1.7-alpha */\n\n\n/**\n * @fileOverview 让内部各个部件的代码可以用[amd](https://github.com/amdjs/amdjs-api/wiki/AMD)模块定义方式组织起来。\n *\n * AMD API 内部的简单不完全实现，请忽略。只有当WebUploader被合并成一个文件的时候才会引入。\n */\nimport jQuery from './jquery.js'\n\n(function( root, factory ) {\n    var modules = {},\n\n        // 内部require, 简单不完全实现。\n        // https://github.com/amdjs/amdjs-api/wiki/require\n        _require = function( deps, callback ) {\n            var args, len, i;\n\n            // 如果deps不是数组，则直接返回指定module\n            if ( typeof deps === 'string' ) {\n                return getModule( deps );\n            } else {\n                args = [];\n                for( len = deps.length, i = 0; i < len; i++ ) {\n                    args.push( getModule( deps[ i ] ) );\n                }\n\n                return callback.apply( null, args );\n            }\n        },\n\n        // 内部define，暂时不支持不指定id.\n        _define = function( id, deps, factory ) {\n            if ( arguments.length === 2 ) {\n                factory = deps;\n                deps = null;\n            }\n\n            _require( deps || [], function() {\n                setModule( id, factory, arguments );\n            });\n        },\n\n        // 设置module, 兼容CommonJs写法。\n        setModule = function( id, factory, args ) {\n            var module = {\n                    exports: factory\n                },\n                returned;\n\n            if ( typeof factory === 'function' ) {\n                args.length || (args = [ _require, module.exports, module ]);\n                returned = factory.apply( null, args );\n                returned !== undefined && (module.exports = returned);\n            }\n\n            modules[ id ] = module.exports;\n        },\n\n        // 根据id获取module\n        getModule = function( id ) {\n            var module = modules[ id ] || root[ id ];\n\n            if ( !module ) {\n                throw new Error( '`' + id + '` is undefined' );\n            }\n\n            return module;\n        },\n\n        // 将所有modules，将路径ids装换成对象。\n        exportsTo = function( obj ) {\n            var key, host, parts, part, last, ucFirst;\n\n            // make the first character upper case.\n            ucFirst = function( str ) {\n                return str && (str.charAt( 0 ).toUpperCase() + str.substr( 1 ));\n            };\n\n            for ( key in modules ) {\n                host = obj;\n\n                if ( !modules.hasOwnProperty( key ) ) {\n                    continue;\n                }\n\n                parts = key.split('/');\n                last = ucFirst( parts.pop() );\n\n                while( (part = ucFirst( parts.shift() )) ) {\n                    host[ part ] = host[ part ] || {};\n                    host = host[ part ];\n                }\n\n                host[ last ] = modules[ key ];\n            }\n\n            return obj;\n        },\n\n        makeExport = function( dollar ) {\n            root.__dollar = dollar;\n\n            // exports every module.\n            return exportsTo( factory( root, _define, _require ) );\n        },\n\n        origin;\n\n    if ( typeof module === 'object' && typeof module.exports === 'object' ) {\n\n        // For CommonJS and CommonJS-like environments where a proper window is present,\n        module.exports = makeExport();\n    } else if ( typeof define === 'function' && define.amd ) {\n\n        // Allow using this built library as an AMD module\n        // in another project. That other project will only\n        // see this AMD call, not the internal modules in\n        // the closure below.\n        define([ 'jquery' ], makeExport );\n    } else {\n\n        // Browser globals case. Just assign the\n        // result to a property on the global.\n        origin = root.WebUploader;\n        root.WebUploader = makeExport();\n        root.WebUploader.noConflict = function() {\n            root.WebUploader = origin;\n        };\n    }\n})( window, function( window, define, require ) {\n\n\n    /**\n     * @fileOverview jQuery or Zepto\n     * @require \"jquery\"\n     * @require \"zepto\"\n     */\n    define('dollar-third',[],function() {\n        var req = window.require;\n        // var $ = window.__dollar ||\n        //     window.jQuery ||\n        //     window.Zepto ||\n        //     req('jquery') ||\n        //     req('zepto');\n      var $ = window.__dollar ||\n          jQuery ||\n          window.Zepto\n        if ( !$ ) {\n            throw new Error('jQuery or Zepto not found!');\n        }\n\n        return $;\n    });\n\n    /**\n     * @fileOverview Dom 操作相关\n     */\n    define('dollar',[\n        'dollar-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 使用jQuery的Promise\n     */\n    define('promise-third',[\n        'dollar'\n    ], function( $ ) {\n        return {\n            Deferred: $.Deferred,\n            when: $.when,\n\n            isPromise: function( anything ) {\n                return anything && typeof anything.then === 'function';\n            }\n        };\n    });\n    /**\n     * @fileOverview Promise/A+\n     */\n    define('promise',[\n        'promise-third'\n    ], function( _ ) {\n        return _;\n    });\n    /**\n     * @fileOverview 基础类方法。\n     */\n\n    /**\n     * Web Uploader内部类的详细说明，以下提及的功能类，都可以在`WebUploader`这个变量中访问到。\n     *\n     * As you know, Web Uploader的每个文件都是用过[AMD](https://github.com/amdjs/amdjs-api/wiki/AMD)规范中的`define`组织起来的, 每个Module都会有个module id.\n     * 默认module id为该文件的路径，而此路径将会转化成名字空间存放在WebUploader中。如：\n     *\n     * * module `base`：WebUploader.Base\n     * * module `file`: WebUploader.File\n     * * module `lib/dnd`: WebUploader.Lib.Dnd\n     * * module `runtime/html5/dnd`: WebUploader.Runtime.Html5.Dnd\n     *\n     *\n     * 以下文档中对类的使用可能省略掉了`WebUploader`前缀。\n     * @module WebUploader\n     * @title WebUploader API文档\n     */\n    define('base',[\n        'dollar',\n        'promise'\n    ], function( $, promise ) {\n\n        var noop = function() {},\n            call = Function.call;\n\n        // http://jsperf.com/uncurrythis\n        // 反科里化\n        function uncurryThis( fn ) {\n            return function() {\n                return call.apply( fn, arguments );\n            };\n        }\n\n        function bindFn( fn, context ) {\n            return function() {\n                return fn.apply( context, arguments );\n            };\n        }\n\n        function createObject( proto ) {\n            var f;\n\n            if ( Object.create ) {\n                return Object.create( proto );\n            } else {\n                f = function() {};\n                f.prototype = proto;\n                return new f();\n            }\n        }\n\n\n        /**\n         * 基础类，提供一些简单常用的方法。\n         * @class Base\n         */\n        return {\n\n            /**\n             * @property {String} version 当前版本号。\n             */\n            version: '0.1.7-alpha',\n\n            /**\n             * @property {jQuery|Zepto} $ 引用依赖的jQuery或者Zepto对象。\n             */\n            $: $,\n\n            Deferred: promise.Deferred,\n\n            isPromise: promise.isPromise,\n\n            when: promise.when,\n\n            /**\n             * @description  简单的浏览器检查结果。\n             *\n             * * `webkit`  webkit版本号，如果浏览器为非webkit内核，此属性为`undefined`。\n             * * `chrome`  chrome浏览器版本号，如果浏览器为chrome，此属性为`undefined`。\n             * * `ie`  ie浏览器版本号，如果浏览器为非ie，此属性为`undefined`。**暂不支持ie10+**\n             * * `firefox`  firefox浏览器版本号，如果浏览器为非firefox，此属性为`undefined`。\n             * * `safari`  safari浏览器版本号，如果浏览器为非safari，此属性为`undefined`。\n             * * `opera`  opera浏览器版本号，如果浏览器为非opera，此属性为`undefined`。\n             *\n             * @property {Object} [browser]\n             */\n            browser: (function( ua ) {\n                var ret = {},\n                    webkit = ua.match( /WebKit\\/([\\d.]+)/ ),\n                    chrome = ua.match( /Chrome\\/([\\d.]+)/ ) ||\n                        ua.match( /CriOS\\/([\\d.]+)/ ),\n\n                    ie = ua.match( /MSIE\\s([\\d\\.]+)/ ) ||\n                        ua.match( /(?:trident)(?:.*rv:([\\w.]+))?/i ),\n                    firefox = ua.match( /Firefox\\/([\\d.]+)/ ),\n                    safari = ua.match( /Safari\\/([\\d.]+)/ ),\n                    opera = ua.match( /OPR\\/([\\d.]+)/ );\n\n                webkit && (ret.webkit = parseFloat( webkit[ 1 ] ));\n                chrome && (ret.chrome = parseFloat( chrome[ 1 ] ));\n                ie && (ret.ie = parseFloat( ie[ 1 ] ));\n                firefox && (ret.firefox = parseFloat( firefox[ 1 ] ));\n                safari && (ret.safari = parseFloat( safari[ 1 ] ));\n                opera && (ret.opera = parseFloat( opera[ 1 ] ));\n\n                return ret;\n            })( navigator.userAgent ),\n\n            /**\n             * @description  操作系统检查结果。\n             *\n             * * `android`  如果在android浏览器环境下，此值为对应的android版本号，否则为`undefined`。\n             * * `ios` 如果在ios浏览器环境下，此值为对应的ios版本号，否则为`undefined`。\n             * @property {Object} [os]\n             */\n            os: (function( ua ) {\n                var ret = {},\n\n                    // osx = !!ua.match( /\\(Macintosh\\; Intel / ),\n                    android = ua.match( /(?:Android);?[\\s\\/]+([\\d.]+)?/ ),\n                    ios = ua.match( /(?:iPad|iPod|iPhone).*OS\\s([\\d_]+)/ );\n\n                // osx && (ret.osx = true);\n                android && (ret.android = parseFloat( android[ 1 ] ));\n                ios && (ret.ios = parseFloat( ios[ 1 ].replace( /_/g, '.' ) ));\n\n                return ret;\n            })( navigator.userAgent ),\n\n            /**\n             * 实现类与类之间的继承。\n             * @method inherits\n             * @grammar Base.inherits( super ) => child\n             * @grammar Base.inherits( super, protos ) => child\n             * @grammar Base.inherits( super, protos, statics ) => child\n             * @param  {Class} super 父类\n             * @param  {Object | Function} [protos] 子类或者对象。如果对象中包含constructor，子类将是用此属性值。\n             * @param  {Function} [protos.constructor] 子类构造器，不指定的话将创建个临时的直接执行父类构造器的方法。\n             * @param  {Object} [statics] 静态属性或方法。\n             * @return {Class} 返回子类。\n             * @example\n             * function Person() {\n             *     console.log( 'Super' );\n             * }\n             * Person.prototype.hello = function() {\n             *     console.log( 'hello' );\n             * };\n             *\n             * var Manager = Base.inherits( Person, {\n             *     world: function() {\n             *         console.log( 'World' );\n             *     }\n             * });\n             *\n             * // 因为没有指定构造器，父类的构造器将会执行。\n             * var instance = new Manager();    // => Super\n             *\n             * // 继承子父类的方法\n             * instance.hello();    // => hello\n             * instance.world();    // => World\n             *\n             * // 子类的__super__属性指向父类\n             * console.log( Manager.__super__ === Person );    // => true\n             */\n            inherits: function( Super, protos, staticProtos ) {\n                var child;\n\n                if ( typeof protos === 'function' ) {\n                    child = protos;\n                    protos = null;\n                } else if ( protos && protos.hasOwnProperty('constructor') ) {\n                    child = protos.constructor;\n                } else {\n                    child = function() {\n                        return Super.apply( this, arguments );\n                    };\n                }\n\n                // 复制静态方法\n                $.extend( true, child, Super, staticProtos || {} );\n\n                /* jshint camelcase: false */\n\n                // 让子类的__super__属性指向父类。\n                child.__super__ = Super.prototype;\n\n                // 构建原型，添加原型方法或属性。\n                // 暂时用Object.create实现。\n                child.prototype = createObject( Super.prototype );\n                protos && $.extend( true, child.prototype, protos );\n\n                return child;\n            },\n\n            /**\n             * 一个不做任何事情的方法。可以用来赋值给默认的callback.\n             * @method noop\n             */\n            noop: noop,\n\n            /**\n             * 返回一个新的方法，此方法将已指定的`context`来执行。\n             * @grammar Base.bindFn( fn, context ) => Function\n             * @method bindFn\n             * @example\n             * var doSomething = function() {\n             *         console.log( this.name );\n             *     },\n             *     obj = {\n             *         name: 'Object Name'\n             *     },\n             *     aliasFn = Base.bind( doSomething, obj );\n             *\n             *  aliasFn();    // => Object Name\n             *\n             */\n            bindFn: bindFn,\n\n            /**\n             * 引用Console.log如果存在的话，否则引用一个[空函数noop](#WebUploader:Base.noop)。\n             * @grammar Base.log( args... ) => undefined\n             * @method log\n             */\n            log: (function() {\n                if ( window.console ) {\n                    return bindFn( console.log, console );\n                }\n                return noop;\n            })(),\n\n            nextTick: (function() {\n\n                return function( cb ) {\n                    setTimeout( cb, 1 );\n                };\n\n                // @bug 当浏览器不在当前窗口时就停了。\n                // var next = window.requestAnimationFrame ||\n                //     window.webkitRequestAnimationFrame ||\n                //     window.mozRequestAnimationFrame ||\n                //     function( cb ) {\n                //         window.setTimeout( cb, 1000 / 60 );\n                //     };\n\n                // // fix: Uncaught TypeError: Illegal invocation\n                // return bindFn( next, window );\n            })(),\n\n            /**\n             * 被[uncurrythis](http://www.2ality.com/2011/11/uncurrying-this.html)的数组slice方法。\n             * 将用来将非数组对象转化成数组对象。\n             * @grammar Base.slice( target, start[, end] ) => Array\n             * @method slice\n             * @example\n             * function doSomthing() {\n             *     var args = Base.slice( arguments, 1 );\n             *     console.log( args );\n             * }\n             *\n             * doSomthing( 'ignored', 'arg2', 'arg3' );    // => Array [\"arg2\", \"arg3\"]\n             */\n            slice: uncurryThis( [].slice ),\n\n            /**\n             * 生成唯一的ID\n             * @method guid\n             * @grammar Base.guid() => String\n             * @grammar Base.guid( prefx ) => String\n             */\n            guid: (function() {\n                var counter = 0;\n\n                return function( prefix ) {\n                    var guid = (+new Date()).toString( 32 ),\n                        i = 0;\n\n                    for ( ; i < 5; i++ ) {\n                        guid += Math.floor( Math.random() * 65535 ).toString( 32 );\n                    }\n\n                    return (prefix || 'wu_') + guid + (counter++).toString( 32 );\n                };\n            })(),\n\n            /**\n             * 格式化文件大小, 输出成带单位的字符串\n             * @method formatSize\n             * @grammar Base.formatSize( size ) => String\n             * @grammar Base.formatSize( size, pointLength ) => String\n             * @grammar Base.formatSize( size, pointLength, units ) => String\n             * @param {Number} size 文件大小\n             * @param {Number} [pointLength=2] 精确到的小数点数。\n             * @param {Array} [units=[ 'B', 'K', 'M', 'G', 'TB' ]] 单位数组。从字节，到千字节，一直往上指定。如果单位数组里面只指定了到了K(千字节)，同时文件大小大于M, 此方法的输出将还是显示成多少K.\n             * @example\n             * console.log( Base.formatSize( 100 ) );    // => 100B\n             * console.log( Base.formatSize( 1024 ) );    // => 1.00K\n             * console.log( Base.formatSize( 1024, 0 ) );    // => 1K\n             * console.log( Base.formatSize( 1024 * 1024 ) );    // => 1.00M\n             * console.log( Base.formatSize( 1024 * 1024 * 1024 ) );    // => 1.00G\n             * console.log( Base.formatSize( 1024 * 1024 * 1024, 0, ['B', 'KB', 'MB'] ) );    // => 1024MB\n             */\n            formatSize: function( size, pointLength, units ) {\n                var unit;\n\n                units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\n\n                while ( (unit = units.shift()) && size > 1024 ) {\n                    size = size / 1024;\n                }\n\n                return (unit === 'B' ? size : size.toFixed( pointLength || 2 )) +\n                        unit;\n            }\n        };\n    });\n    /**\n     * 事件处理类，可以独立使用，也可以扩展给对象使用。\n     * @fileOverview Mediator\n     */\n    define('mediator',[\n        'base'\n    ], function( Base ) {\n        var $ = Base.$,\n            slice = [].slice,\n            separator = /\\s+/,\n            protos;\n\n        // 根据条件过滤出事件handlers.\n        function findHandlers( arr, name, callback, context ) {\n            return $.grep( arr, function( handler ) {\n                return handler &&\n                        (!name || handler.e === name) &&\n                        (!callback || handler.cb === callback ||\n                        handler.cb._cb === callback) &&\n                        (!context || handler.ctx === context);\n            });\n        }\n\n        function eachEvent( events, callback, iterator ) {\n            // 不支持对象，只支持多个event用空格隔开\n            $.each( (events || '').split( separator ), function( _, key ) {\n                iterator( key, callback );\n            });\n        }\n\n        function triggerHanders( events, args ) {\n            var stoped = false,\n                i = -1,\n                len = events.length,\n                handler;\n\n            while ( ++i < len ) {\n                handler = events[ i ];\n\n                if ( handler.cb.apply( handler.ctx2, args ) === false ) {\n                    stoped = true;\n                    break;\n                }\n            }\n\n            return !stoped;\n        }\n\n        protos = {\n\n            /**\n             * 绑定事件。\n             *\n             * `callback`方法在执行时，arguments将会来源于trigger的时候携带的参数。如\n             * ```javascript\n             * var obj = {};\n             *\n             * // 使得obj有事件行为\n             * Mediator.installTo( obj );\n             *\n             * obj.on( 'testa', function( arg1, arg2 ) {\n             *     console.log( arg1, arg2 ); // => 'arg1', 'arg2'\n             * });\n             *\n             * obj.trigger( 'testa', 'arg1', 'arg2' );\n             * ```\n             *\n             * 如果`callback`中，某一个方法`return false`了，则后续的其他`callback`都不会被执行到。\n             * 切会影响到`trigger`方法的返回值，为`false`。\n             *\n             * `on`还可以用来添加一个特殊事件`all`, 这样所有的事件触发都会响应到。同时此类`callback`中的arguments有一个不同处，\n             * 就是第一个参数为`type`，记录当前是什么事件在触发。此类`callback`的优先级比脚低，会再正常`callback`执行完后触发。\n             * ```javascript\n             * obj.on( 'all', function( type, arg1, arg2 ) {\n             *     console.log( type, arg1, arg2 ); // => 'testa', 'arg1', 'arg2'\n             * });\n             * ```\n             *\n             * @method on\n             * @grammar on( name, callback[, context] ) => self\n             * @param  {String}   name     事件名，支持多个事件用空格隔开\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             * @class Mediator\n             */\n            on: function( name, callback, context ) {\n                var me = this,\n                    set;\n\n                if ( !callback ) {\n                    return this;\n                }\n\n                set = this._events || (this._events = []);\n\n                eachEvent( name, callback, function( name, callback ) {\n                    var handler = { e: name };\n\n                    handler.cb = callback;\n                    handler.ctx = context;\n                    handler.ctx2 = context || me;\n                    handler.id = set.length;\n\n                    set.push( handler );\n                });\n\n                return this;\n            },\n\n            /**\n             * 绑定事件，且当handler执行完后，自动解除绑定。\n             * @method once\n             * @grammar once( name, callback[, context] ) => self\n             * @param  {String}   name     事件名\n             * @param  {Function} callback 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            once: function( name, callback, context ) {\n                var me = this;\n\n                if ( !callback ) {\n                    return me;\n                }\n\n                eachEvent( name, callback, function( name, callback ) {\n                    var once = function() {\n                            me.off( name, once );\n                            return callback.apply( context || me, arguments );\n                        };\n\n                    once._cb = callback;\n                    me.on( name, once, context );\n                });\n\n                return me;\n            },\n\n            /**\n             * 解除事件绑定\n             * @method off\n             * @grammar off( [name[, callback[, context] ] ] ) => self\n             * @param  {String}   [name]     事件名\n             * @param  {Function} [callback] 事件处理器\n             * @param  {Object}   [context]  事件处理器的上下文。\n             * @return {self} 返回自身，方便链式\n             * @chainable\n             */\n            off: function( name, cb, ctx ) {\n                var events = this._events;\n\n                if ( !events ) {\n                    return this;\n                }\n\n                if ( !name && !cb && !ctx ) {\n                    this._events = [];\n                    return this;\n                }\n\n                eachEvent( name, cb, function( name, cb ) {\n                    $.each( findHandlers( events, name, cb, ctx ), function() {\n                        delete events[ this.id ];\n                    });\n                });\n\n                return this;\n            },\n\n            /**\n             * 触发事件\n             * @method trigger\n             * @grammar trigger( name[, args...] ) => self\n             * @param  {String}   type     事件名\n             * @param  {*} [...] 任意参数\n             * @return {Boolean} 如果handler中return false了，则返回false, 否则返回true\n             */\n            trigger: function( type ) {\n                var args, events, allEvents;\n\n                if ( !this._events || !type ) {\n                    return this;\n                }\n\n                args = slice.call( arguments, 1 );\n                events = findHandlers( this._events, type );\n                allEvents = findHandlers( this._events, 'all' );\n\n                return triggerHanders( events, args ) &&\n                        triggerHanders( allEvents, arguments );\n            }\n        };\n\n        /**\n         * 中介者，它本身是个单例，但可以通过[installTo](#WebUploader:Mediator:installTo)方法，使任何对象具备事件行为。\n         * 主要目的是负责模块与模块之间的合作，降低耦合度。\n         *\n         * @class Mediator\n         */\n        return $.extend({\n\n            /**\n             * 可以通过这个接口，使任何对象具备事件功能。\n             * @method installTo\n             * @param  {Object} obj 需要具备事件行为的对象。\n             * @return {Object} 返回obj.\n             */\n            installTo: function( obj ) {\n                return $.extend( obj, protos );\n            }\n\n        }, protos );\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('uploader',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n\n        var $ = Base.$;\n\n        /**\n         * 上传入口类。\n         * @class Uploader\n         * @constructor\n         * @grammar new Uploader( opts ) => Uploader\n         * @example\n         * var uploader = WebUploader.Uploader({\n         *     swf: 'path_of_swf/Uploader.swf',\n         *\n         *     // 开起分片上传。\n         *     chunked: true\n         * });\n         */\n        function Uploader( opts ) {\n            this.options = $.extend( true, {}, Uploader.options, opts );\n            this._init( this.options );\n        }\n\n        // default Options\n        // widgets中有相应扩展\n        Uploader.options = {};\n        Mediator.installTo( Uploader.prototype );\n\n        // 批量添加纯命令式方法。\n        $.each({\n            upload: 'start-upload',\n            stop: 'stop-upload',\n            getFile: 'get-file',\n            getFiles: 'get-files',\n            addFile: 'add-file',\n            addFiles: 'add-file',\n            sort: 'sort-files',\n            removeFile: 'remove-file',\n            cancelFile: 'cancel-file',\n            skipFile: 'skip-file',\n            retry: 'retry',\n            isInProgress: 'is-in-progress',\n            makeThumb: 'make-thumb',\n            md5File: 'md5-file',\n            getDimension: 'get-dimension',\n            addButton: 'add-btn',\n            predictRuntimeType: 'predict-runtime-type',\n            refresh: 'refresh',\n            disable: 'disable',\n            enable: 'enable',\n            reset: 'reset'\n        }, function( fn, command ) {\n            Uploader.prototype[ fn ] = function() {\n                return this.request( command, arguments );\n            };\n        });\n\n        $.extend( Uploader.prototype, {\n            state: 'pending',\n\n            _init: function( opts ) {\n                var me = this;\n\n                me.request( 'init', opts, function() {\n                    me.state = 'ready';\n                    me.trigger('ready');\n                });\n            },\n\n            /**\n             * 获取或者设置Uploader配置项。\n             * @method option\n             * @grammar option( key ) => *\n             * @grammar option( key, val ) => self\n             * @example\n             *\n             * // 初始状态图片上传前不会压缩\n             * var uploader = new WebUploader.Uploader({\n             *     compress: null;\n             * });\n             *\n             * // 修改后图片上传前，尝试将图片压缩到1600 * 1600\n             * uploader.option( 'compress', {\n             *     width: 1600,\n             *     height: 1600\n             * });\n             */\n            option: function( key, val ) {\n                var opts = this.options;\n\n                // setter\n                if ( arguments.length > 1 ) {\n\n                    if ( $.isPlainObject( val ) &&\n                            $.isPlainObject( opts[ key ] ) ) {\n                        $.extend( opts[ key ], val );\n                    } else {\n                        opts[ key ] = val;\n                    }\n\n                } else {    // getter\n                    return key ? opts[ key ] : opts;\n                }\n            },\n\n            /**\n             * 获取文件统计信息。返回一个包含一下信息的对象。\n             * * `successNum` 上传成功的文件数\n             * * `progressNum` 上传中的文件数\n             * * `cancelNum` 被删除的文件数\n             * * `invalidNum` 无效的文件数\n             * * `uploadFailNum` 上传失败的文件数\n             * * `queueNum` 还在队列中的文件数\n             * * `interruptNum` 被暂停的文件数\n             * @method getStats\n             * @grammar getStats() => Object\n             */\n            getStats: function() {\n                // return this._mgr.getStats.apply( this._mgr, arguments );\n                var stats = this.request('get-stats');\n\n                return stats ? {\n                    successNum: stats.numOfSuccess,\n                    progressNum: stats.numOfProgress,\n\n                    // who care?\n                    // queueFailNum: 0,\n                    cancelNum: stats.numOfCancel,\n                    invalidNum: stats.numOfInvalid,\n                    uploadFailNum: stats.numOfUploadFailed,\n                    queueNum: stats.numOfQueue,\n                    interruptNum: stats.numofInterrupt\n                } : {};\n            },\n\n            // 需要重写此方法来来支持opts.onEvent和instance.onEvent的处理器\n            trigger: function( type/*, args...*/ ) {\n                var args = [].slice.call( arguments, 1 ),\n                    opts = this.options,\n                    name = 'on' + type.substring( 0, 1 ).toUpperCase() +\n                        type.substring( 1 );\n\n                if (\n                        // 调用通过on方法注册的handler.\n                        Mediator.trigger.apply( this, arguments ) === false ||\n\n                        // 调用opts.onEvent\n                        $.isFunction( opts[ name ] ) &&\n                        opts[ name ].apply( this, args ) === false ||\n\n                        // 调用this.onEvent\n                        $.isFunction( this[ name ] ) &&\n                        this[ name ].apply( this, args ) === false ||\n\n                        // 广播所有uploader的事件。\n                        Mediator.trigger.apply( Mediator,\n                        [ this, type ].concat( args ) ) === false ) {\n\n                    return false;\n                }\n\n                return true;\n            },\n\n            /**\n             * 销毁 webuploader 实例\n             * @method destroy\n             * @grammar destroy() => undefined\n             */\n            destroy: function() {\n                this.request( 'destroy', arguments );\n                this.off();\n            },\n\n            // widgets/widget.js将补充此方法的详细文档。\n            request: Base.noop\n        });\n\n        /**\n         * 创建Uploader实例，等同于new Uploader( opts );\n         * @method create\n         * @class Base\n         * @static\n         * @grammar Base.create( opts ) => Uploader\n         */\n        Base.create = Uploader.create = function( opts ) {\n            return new Uploader( opts );\n        };\n\n        // 暴露Uploader，可以通过它来扩展业务逻辑。\n        Base.Uploader = Uploader;\n\n        return Uploader;\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/runtime',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n\n        var $ = Base.$,\n            factories = {},\n\n            // 获取对象的第一个key\n            getFirstKey = function( obj ) {\n                for ( var key in obj ) {\n                    if ( obj.hasOwnProperty( key ) ) {\n                        return key;\n                    }\n                }\n                return null;\n            };\n\n        // 接口类。\n        function Runtime( options ) {\n            this.options = $.extend({\n                container: document.body\n            }, options );\n            this.uid = Base.guid('rt_');\n        }\n\n        $.extend( Runtime.prototype, {\n\n            getContainer: function() {\n                var opts = this.options,\n                    parent, container;\n\n                if ( this._container ) {\n                    return this._container;\n                }\n\n                parent = $( opts.container || document.body );\n                container = $( document.createElement('div') );\n\n                container.attr( 'id', 'rt_' + this.uid );\n                container.css({\n                    position: 'absolute',\n                    top: '0px',\n                    left: '0px',\n                    width: '1px',\n                    height: '1px',\n                    overflow: 'hidden'\n                });\n\n                parent.append( container );\n                parent.addClass('webuploader-container');\n                this._container = container;\n                this._parent = parent;\n                return container;\n            },\n\n            init: Base.noop,\n            exec: Base.noop,\n\n            destroy: function() {\n                this._container && this._container.remove();\n                this._parent && this._parent.removeClass('webuploader-container');\n                this.off();\n            }\n        });\n\n        Runtime.orders = 'html5,flash';\n\n\n        /**\n         * 添加Runtime实现。\n         * @param {String} type    类型\n         * @param {Runtime} factory 具体Runtime实现。\n         */\n        Runtime.addRuntime = function( type, factory ) {\n            factories[ type ] = factory;\n        };\n\n        Runtime.hasRuntime = function( type ) {\n            return !!(type ? factories[ type ] : getFirstKey( factories ));\n        };\n\n        Runtime.create = function( opts, orders ) {\n            var type, runtime;\n\n            orders = orders || Runtime.orders;\n            $.each( orders.split( /\\s*,\\s*/g ), function() {\n                if ( factories[ this ] ) {\n                    type = this;\n                    return false;\n                }\n            });\n\n            type = type || getFirstKey( factories );\n\n            if ( !type ) {\n                throw new Error('Runtime Error');\n            }\n\n            runtime = new factories[ type ]( opts );\n            return runtime;\n        };\n\n        Mediator.installTo( Runtime.prototype );\n        return Runtime;\n    });\n\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/client',[\n        'base',\n        'mediator',\n        'runtime/runtime'\n    ], function( Base, Mediator, Runtime ) {\n\n        var cache;\n\n        cache = (function() {\n            var obj = {};\n\n            return {\n                add: function( runtime ) {\n                    obj[ runtime.uid ] = runtime;\n                },\n\n                get: function( ruid, standalone ) {\n                    var i;\n\n                    if ( ruid ) {\n                        return obj[ ruid ];\n                    }\n\n                    for ( i in obj ) {\n                        // 有些类型不能重用，比如filepicker.\n                        if ( standalone && obj[ i ].__standalone ) {\n                            continue;\n                        }\n\n                        return obj[ i ];\n                    }\n\n                    return null;\n                },\n\n                remove: function( runtime ) {\n                    delete obj[ runtime.uid ];\n                }\n            };\n        })();\n\n        function RuntimeClient( component, standalone ) {\n            var deferred = Base.Deferred(),\n                runtime;\n\n            this.uid = Base.guid('client_');\n\n            // 允许runtime没有初始化之前，注册一些方法在初始化后执行。\n            this.runtimeReady = function( cb ) {\n                return deferred.done( cb );\n            };\n\n            this.connectRuntime = function( opts, cb ) {\n\n                // already connected.\n                if ( runtime ) {\n                    throw new Error('already connected!');\n                }\n\n                deferred.done( cb );\n\n                if ( typeof opts === 'string' && cache.get( opts ) ) {\n                    runtime = cache.get( opts );\n                }\n\n                // 像filePicker只能独立存在，不能公用。\n                runtime = runtime || cache.get( null, standalone );\n\n                // 需要创建\n                if ( !runtime ) {\n                    runtime = Runtime.create( opts, opts.runtimeOrder );\n                    runtime.__promise = deferred.promise();\n                    runtime.once( 'ready', deferred.resolve );\n                    runtime.init();\n                    cache.add( runtime );\n                    runtime.__client = 1;\n                } else {\n                    // 来自cache\n                    Base.$.extend( runtime.options, opts );\n                    runtime.__promise.then( deferred.resolve );\n                    runtime.__client++;\n                }\n\n                standalone && (runtime.__standalone = standalone);\n                return runtime;\n            };\n\n            this.getRuntime = function() {\n                return runtime;\n            };\n\n            this.disconnectRuntime = function() {\n                if ( !runtime ) {\n                    return;\n                }\n\n                runtime.__client--;\n\n                if ( runtime.__client <= 0 ) {\n                    cache.remove( runtime );\n                    delete runtime.__promise;\n                    runtime.destroy();\n                }\n\n                runtime = null;\n            };\n\n            this.exec = function() {\n                if ( !runtime ) {\n                    return;\n                }\n\n                var args = Base.slice( arguments );\n                component && args.unshift( component );\n\n                return runtime.exec.apply( this, args );\n            };\n\n            this.getRuid = function() {\n                return runtime && runtime.uid;\n            };\n\n            this.destroy = (function( destroy ) {\n                return function() {\n                    destroy && destroy.apply( this, arguments );\n                    this.trigger('destroy');\n                    this.off();\n                    this.exec('destroy');\n                    this.disconnectRuntime();\n                };\n            })( this.destroy );\n        }\n\n        Mediator.installTo( RuntimeClient.prototype );\n        return RuntimeClient;\n    });\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/dnd',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n\n        var $ = Base.$;\n\n        function DragAndDrop( opts ) {\n            opts = this.options = $.extend({}, DragAndDrop.options, opts );\n\n            opts.container = $( opts.container );\n\n            if ( !opts.container.length ) {\n                return;\n            }\n\n            RuntimeClent.call( this, 'DragAndDrop' );\n        }\n\n        DragAndDrop.options = {\n            accept: null,\n            disableGlobalDnd: false\n        };\n\n        Base.inherits( RuntimeClent, {\n            constructor: DragAndDrop,\n\n            init: function() {\n                var me = this;\n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n\n        Mediator.installTo( DragAndDrop.prototype );\n\n        return DragAndDrop;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/widget',[\n        'base',\n        'uploader'\n    ], function( Base, Uploader ) {\n\n        var $ = Base.$,\n            _init = Uploader.prototype._init,\n            _destroy = Uploader.prototype.destroy,\n            IGNORE = {},\n            widgetClass = [];\n\n        function isArrayLike( obj ) {\n            if ( !obj ) {\n                return false;\n            }\n\n            var length = obj.length,\n                type = $.type( obj );\n\n            if ( obj.nodeType === 1 && length ) {\n                return true;\n            }\n\n            return type === 'array' || type !== 'function' && type !== 'string' &&\n                    (length === 0 || typeof length === 'number' && length > 0 &&\n                    (length - 1) in obj);\n        }\n\n        function Widget( uploader ) {\n            this.owner = uploader;\n            this.options = uploader.options;\n        }\n\n        $.extend( Widget.prototype, {\n\n            init: Base.noop,\n\n            // 类Backbone的事件监听声明，监听uploader实例上的事件\n            // widget直接无法监听事件，事件只能通过uploader来传递\n            invoke: function( apiName, args ) {\n\n                /*\n                    {\n                        'make-thumb': 'makeThumb'\n                    }\n                 */\n                var map = this.responseMap;\n\n                // 如果无API响应声明则忽略\n                if ( !map || !(apiName in map) || !(map[ apiName ] in this) ||\n                        !$.isFunction( this[ map[ apiName ] ] ) ) {\n\n                    return IGNORE;\n                }\n\n                return this[ map[ apiName ] ].apply( this, args );\n\n            },\n\n            /**\n             * 发送命令。当传入`callback`或者`handler`中返回`promise`时。返回一个当所有`handler`中的promise都完成后完成的新`promise`。\n             * @method request\n             * @grammar request( command, args ) => * | Promise\n             * @grammar request( command, args, callback ) => Promise\n             * @for  Uploader\n             */\n            request: function() {\n                return this.owner.request.apply( this.owner, arguments );\n            }\n        });\n\n        // 扩展Uploader.\n        $.extend( Uploader.prototype, {\n\n            /**\n             * @property {String | Array} [disableWidgets=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 默认所有 Uploader.register 了的 widget 都会被加载，如果禁用某一部分，请通过此 option 指定黑名单。\n             */\n\n            // 覆写_init用来初始化widgets\n            _init: function() {\n                var me = this,\n                    widgets = me._widgets = [],\n                    deactives = me.options.disableWidgets || '';\n\n                $.each( widgetClass, function( _, klass ) {\n                    (!deactives || !~deactives.indexOf( klass._name )) &&\n                        widgets.push( new klass( me ) );\n                });\n\n                return _init.apply( me, arguments );\n            },\n\n            request: function( apiName, args, callback ) {\n                var i = 0,\n                    widgets = this._widgets,\n                    len = widgets && widgets.length,\n                    rlts = [],\n                    dfds = [],\n                    widget, rlt, promise, key;\n\n                args = isArrayLike( args ) ? args : [ args ];\n\n                for ( ; i < len; i++ ) {\n                    widget = widgets[ i ];\n                    rlt = widget.invoke( apiName, args );\n\n                    if ( rlt !== IGNORE ) {\n\n                        // Deferred对象\n                        if ( Base.isPromise( rlt ) ) {\n                            dfds.push( rlt );\n                        } else {\n                            rlts.push( rlt );\n                        }\n                    }\n                }\n\n                // 如果有callback，则用异步方式。\n                if ( callback || dfds.length ) {\n                    promise = Base.when.apply( Base, dfds );\n                    key = promise.pipe ? 'pipe' : 'then';\n\n                    // 很重要不能删除。删除了会死循环。\n                    // 保证执行顺序。让callback总是在下一个 tick 中执行。\n                    return promise[ key ](function() {\n                                var deferred = Base.Deferred(),\n                                    args = arguments;\n\n                                if ( args.length === 1 ) {\n                                    args = args[ 0 ];\n                                }\n\n                                setTimeout(function() {\n                                    deferred.resolve( args );\n                                }, 1 );\n\n                                return deferred.promise();\n                            })[ callback ? key : 'done' ]( callback || Base.noop );\n                } else {\n                    return rlts[ 0 ];\n                }\n            },\n\n            destroy: function() {\n                _destroy.apply( this, arguments );\n                this._widgets = null;\n            }\n        });\n\n        /**\n         * 添加组件\n         * @grammar Uploader.register(proto);\n         * @grammar Uploader.register(map, proto);\n         * @param  {object} responseMap API 名称与函数实现的映射\n         * @param  {object} proto 组件原型，构造函数通过 constructor 属性定义\n         * @method Uploader.register\n         * @for Uploader\n         * @example\n         * Uploader.register({\n         *     'make-thumb': 'makeThumb'\n         * }, {\n         *     init: function( options ) {},\n         *     makeThumb: function() {}\n         * });\n         *\n         * Uploader.register({\n         *     'make-thumb': function() {\n         *\n         *     }\n         * });\n         */\n        Uploader.register = Widget.register = function( responseMap, widgetProto ) {\n            var map = { init: 'init', destroy: 'destroy', name: 'anonymous' },\n                klass;\n\n            if ( arguments.length === 1 ) {\n                widgetProto = responseMap;\n\n                // 自动生成 map 表。\n                $.each(widgetProto, function(key) {\n                    if ( key[0] === '_' || key === 'name' ) {\n                        key === 'name' && (map.name = widgetProto.name);\n                        return;\n                    }\n\n                    map[key.replace(/[A-Z]/g, '-$&').toLowerCase()] = key;\n                });\n\n            } else {\n                map = $.extend( map, responseMap );\n            }\n\n            widgetProto.responseMap = map;\n            klass = Base.inherits( Widget, widgetProto );\n            klass._name = map.name;\n            widgetClass.push( klass );\n\n            return klass;\n        };\n\n        /**\n         * 删除插件，只有在注册时指定了名字的才能被删除。\n         * @grammar Uploader.unRegister(name);\n         * @param  {string} name 组件名字\n         * @method Uploader.unRegister\n         * @for Uploader\n         * @example\n         *\n         * Uploader.register({\n         *     name: 'custom',\n         *\n         *     'make-thumb': function() {\n         *\n         *     }\n         * });\n         *\n         * Uploader.unRegister('custom');\n         */\n        Uploader.unRegister = Widget.unRegister = function( name ) {\n            if ( !name || name === 'anonymous' ) {\n                return;\n            }\n\n            // 删除指定的插件。\n            for ( var i = widgetClass.length; i--; ) {\n                if ( widgetClass[i]._name === name ) {\n                    widgetClass.splice(i, 1)\n                }\n            }\n        };\n\n        return Widget;\n    });\n    /**\n     * @fileOverview DragAndDrop Widget。\n     */\n    define('widgets/filednd',[\n        'base',\n        'uploader',\n        'lib/dnd',\n        'widgets/widget'\n    ], function( Base, Uploader, Dnd ) {\n        var $ = Base.$;\n\n        Uploader.options.dnd = '';\n\n        /**\n         * @property {Selector} [dnd=undefined]  指定Drag And Drop拖拽的容器，如果不指定，则不启动。\n         * @namespace options\n         * @for Uploader\n         */\n\n        /**\n         * @property {Selector} [disableGlobalDnd=false]  是否禁掉整个页面的拖拽功能，如果不禁用，图片拖进来的时候会默认被浏览器打开。\n         * @namespace options\n         * @for Uploader\n         */\n\n        /**\n         * @event dndAccept\n         * @param {DataTransferItemList} items DataTransferItem\n         * @description 阻止此事件可以拒绝某些类型的文件拖入进来。目前只有 chrome 提供这样的 API，且只能通过 mime-type 验证。\n         * @for  Uploader\n         */\n        return Uploader.register({\n            name: 'dnd',\n\n            init: function( opts ) {\n\n                if ( !opts.dnd ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n\n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        disableGlobalDnd: opts.disableGlobalDnd,\n                        container: opts.dnd,\n                        accept: opts.accept\n                    }),\n                    dnd;\n\n                this.dnd = dnd = new Dnd( options );\n\n                dnd.once( 'ready', deferred.resolve );\n                dnd.on( 'drop', function( files ) {\n                    me.request( 'add-file', [ files ]);\n                });\n\n                // 检测文件是否全部允许添加。\n                dnd.on( 'accept', function( items ) {\n                    return me.owner.trigger( 'dndAccept', items );\n                });\n\n                dnd.init();\n\n                return deferred.promise();\n            },\n\n            destroy: function() {\n                this.dnd && this.dnd.destroy();\n            }\n        });\n    });\n\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepaste',[\n        'base',\n        'mediator',\n        'runtime/client'\n    ], function( Base, Mediator, RuntimeClent ) {\n\n        var $ = Base.$;\n\n        function FilePaste( opts ) {\n            opts = this.options = $.extend({}, opts );\n            opts.container = $( opts.container || document.body );\n            RuntimeClent.call( this, 'FilePaste' );\n        }\n\n        Base.inherits( RuntimeClent, {\n            constructor: FilePaste,\n\n            init: function() {\n                var me = this;\n\n                me.connectRuntime( me.options, function() {\n                    me.exec('init');\n                    me.trigger('ready');\n                });\n            }\n        });\n\n        Mediator.installTo( FilePaste.prototype );\n\n        return FilePaste;\n    });\n    /**\n     * @fileOverview 组件基类。\n     */\n    define('widgets/filepaste',[\n        'base',\n        'uploader',\n        'lib/filepaste',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePaste ) {\n        var $ = Base.$;\n\n        /**\n         * @property {Selector} [paste=undefined]  指定监听paste事件的容器，如果不指定，不启用此功能。此功能为通过粘贴来添加截屏的图片。建议设置为`document.body`.\n         * @namespace options\n         * @for Uploader\n         */\n        return Uploader.register({\n            name: 'paste',\n\n            init: function( opts ) {\n\n                if ( !opts.paste ||\n                        this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n\n                var me = this,\n                    deferred = Base.Deferred(),\n                    options = $.extend({}, {\n                        container: opts.paste,\n                        accept: opts.accept\n                    }),\n                    paste;\n\n                this.paste = paste = new FilePaste( options );\n\n                paste.once( 'ready', deferred.resolve );\n                paste.on( 'paste', function( files ) {\n                    me.owner.request( 'add-file', [ files ]);\n                });\n                paste.init();\n\n                return deferred.promise();\n            },\n\n            destroy: function() {\n                this.paste && this.paste.destroy();\n            }\n        });\n    });\n    /**\n     * @fileOverview Blob\n     */\n    define('lib/blob',[\n        'base',\n        'runtime/client'\n    ], function( Base, RuntimeClient ) {\n\n        function Blob( ruid, source ) {\n            var me = this;\n\n            me.source = source;\n            me.ruid = ruid;\n            this.size = source.size || 0;\n\n            // 如果没有指定 mimetype, 但是知道文件后缀。\n            if ( !source.type && this.ext &&\n                    ~'jpg,jpeg,png,gif,bmp'.indexOf( this.ext ) ) {\n                this.type = 'image/' + (this.ext === 'jpg' ? 'jpeg' : this.ext);\n            } else {\n                this.type = source.type || 'application/octet-stream';\n            }\n\n            RuntimeClient.call( me, 'Blob' );\n            this.uid = source.uid || this.uid;\n\n            if ( ruid ) {\n                me.connectRuntime( ruid );\n            }\n        }\n\n        Base.inherits( RuntimeClient, {\n            constructor: Blob,\n\n            slice: function( start, end ) {\n                return this.exec( 'slice', start, end );\n            },\n\n            getSource: function() {\n                return this.source;\n            }\n        });\n\n        return Blob;\n    });\n    /**\n     * 为了统一化Flash的File和HTML5的File而存在。\n     * 以至于要调用Flash里面的File，也可以像调用HTML5版本的File一下。\n     * @fileOverview File\n     */\n    define('lib/file',[\n        'base',\n        'lib/blob'\n    ], function( Base, Blob ) {\n\n        var uid = 1,\n            rExt = /\\.([^.]+)$/;\n\n        function File( ruid, file ) {\n            var ext;\n\n            this.name = file.name || ('untitled' + uid++);\n            ext = rExt.exec( file.name ) ? RegExp.$1.toLowerCase() : '';\n\n            // todo 支持其他类型文件的转换。\n            // 如果有 mimetype, 但是文件名里面没有找出后缀规律\n            if ( !ext && file.type ) {\n                ext = /\\/(jpg|jpeg|png|gif|bmp)$/i.exec( file.type ) ?\n                        RegExp.$1.toLowerCase() : '';\n                this.name += '.' + ext;\n            }\n\n            this.ext = ext;\n            this.lastModifiedDate = file.lastModifiedDate ||\n                    (new Date()).toLocaleString();\n\n            Blob.apply( this, arguments );\n        }\n\n        return Base.inherits( Blob, File );\n    });\n\n    /**\n     * @fileOverview 错误信息\n     */\n    define('lib/filepicker',[\n        'base',\n        'runtime/client',\n        'lib/file'\n    ], function( Base, RuntimeClient, File ) {\n\n        var $ = Base.$;\n\n        function FilePicker( opts ) {\n            opts = this.options = $.extend({}, FilePicker.options, opts );\n\n            opts.container = $( opts.id );\n\n            if ( !opts.container.length ) {\n                throw new Error('按钮指定错误');\n            }\n\n            opts.innerHTML = opts.innerHTML || opts.label ||\n                    opts.container.html() || '';\n\n            opts.button = $( opts.button || document.createElement('div') );\n            opts.button.html( opts.innerHTML );\n            opts.container.html( opts.button );\n\n            RuntimeClient.call( this, 'FilePicker', true );\n        }\n\n        FilePicker.options = {\n            button: null,\n            container: null,\n            label: null,\n            innerHTML: null,\n            multiple: true,\n            accept: null,\n            name: 'file',\n            style: 'webuploader-pick'   //pick element class attribute, default is \"webuploader-pick\"\n        };\n\n        Base.inherits( RuntimeClient, {\n            constructor: FilePicker,\n\n            init: function() {\n                var me = this,\n                    opts = me.options,\n                    button = opts.button,\n                    style = opts.style;\n\n                if (style)\n                    button.addClass('webuploader-pick');\n\n                me.on( 'all', function( type ) {\n                    var files;\n\n                    switch ( type ) {\n                        case 'mouseenter':\n                            if (style)\n                                button.addClass('webuploader-pick-hover');\n                            break;\n\n                        case 'mouseleave':\n                            if (style)\n                                button.removeClass('webuploader-pick-hover');\n                            break;\n\n                        case 'change':\n                            files = me.exec('getFiles');\n                            me.trigger( 'select', $.map( files, function( file ) {\n                                file = new File( me.getRuid(), file );\n\n                                // 记录来源。\n                                file._refer = opts.container;\n                                return file;\n                            }), opts.container );\n                            break;\n                    }\n                });\n\n                me.connectRuntime( opts, function() {\n                    me.refresh();\n                    me.exec( 'init', opts );\n                    me.trigger('ready');\n                });\n\n                this._resizeHandler = Base.bindFn( this.refresh, this );\n                $( window ).on( 'resize', this._resizeHandler );\n            },\n\n            refresh: function() {\n                var shimContainer = this.getRuntime().getContainer(),\n                    button = this.options.button,\n                    width = button.outerWidth ?\n                            button.outerWidth() : button.width(),\n\n                    height = button.outerHeight ?\n                            button.outerHeight() : button.height(),\n\n                    pos = button.offset();\n\n                width && height && shimContainer.css({\n                    bottom: 'auto',\n                    right: 'auto',\n                    width: width + 'px',\n                    height: height + 'px'\n                }).offset( pos );\n            },\n\n            enable: function() {\n                var btn = this.options.button;\n\n                btn.removeClass('webuploader-pick-disable');\n                this.refresh();\n            },\n\n            disable: function() {\n                var btn = this.options.button;\n\n                this.getRuntime().getContainer().css({\n                    top: '-99999px'\n                });\n\n                btn.addClass('webuploader-pick-disable');\n            },\n\n            destroy: function() {\n                var btn = this.options.button;\n                $( window ).off( 'resize', this._resizeHandler );\n                btn.removeClass('webuploader-pick-disable webuploader-pick-hover ' +\n                    'webuploader-pick');\n            }\n        });\n\n        return FilePicker;\n    });\n\n    /**\n     * @fileOverview 文件选择相关\n     */\n    define('widgets/filepicker',[\n        'base',\n        'uploader',\n        'lib/filepicker',\n        'widgets/widget'\n    ], function( Base, Uploader, FilePicker ) {\n        var $ = Base.$;\n\n        $.extend( Uploader.options, {\n\n            /**\n             * @property {Selector | Object} [pick=undefined]\n             * @namespace options\n             * @for Uploader\n             * @description 指定选择文件的按钮容器，不指定则不创建按钮。\n             *\n             * * `id` {Seletor|dom} 指定选择文件的按钮容器，不指定则不创建按钮。**注意** 这里虽然写的是 id, 但是不是只支持 id, 还支持 class, 或者 dom 节点。\n             * * `label` {String} 请采用 `innerHTML` 代替\n             * * `innerHTML` {String} 指定按钮文字。不指定时优先从指定的容器中看是否自带文字。\n             * * `multiple` {Boolean} 是否开起同时选择多个文件能力。\n             */\n            pick: null,\n\n            /**\n             * @property {Arroy} [accept=null]\n             * @namespace options\n             * @for Uploader\n             * @description 指定接受哪些类型的文件。 由于目前还有ext转mimeType表，所以这里需要分开指定。\n             *\n             * * `title` {String} 文字描述\n             * * `extensions` {String} 允许的文件后缀，不带点，多个用逗号分割。\n             * * `mimeTypes` {String} 多个用逗号分割。\n             *\n             * 如：\n             *\n             * ```\n             * {\n             *     title: 'Images',\n             *     extensions: 'gif,jpg,jpeg,bmp,png',\n             *     mimeTypes: 'image/*'\n             * }\n             * ```\n             */\n            accept: null/*{\n                title: 'Images',\n                extensions: 'gif,jpg,jpeg,bmp,png',\n                mimeTypes: 'image/*'\n            }*/\n        });\n\n        return Uploader.register({\n            name: 'picker',\n\n            init: function( opts ) {\n                this.pickers = [];\n                return opts.pick && this.addBtn( opts.pick );\n            },\n\n            refresh: function() {\n                $.each( this.pickers, function() {\n                    this.refresh();\n                });\n            },\n\n            /**\n             * @method addBtn\n             * @for Uploader\n             * @grammar addBtn( pick ) => Promise\n             * @description\n             * 添加文件选择按钮，如果一个按钮不够，需要调用此方法来添加。参数跟[options.pick](#WebUploader:Uploader:options)一致。\n             * @example\n             * uploader.addBtn({\n             *     id: '#btnContainer',\n             *     innerHTML: '选择文件'\n             * });\n             */\n            addBtn: function( pick ) {\n                var me = this,\n                    opts = me.options,\n                    accept = opts.accept,\n                    promises = [];\n\n                if ( !pick ) {\n                    return;\n                }\n\n                $.isPlainObject( pick ) || (pick = {\n                    id: pick\n                });\n\n                $( pick.id ).each(function() {\n                    var options, picker, deferred;\n\n                    deferred = Base.Deferred();\n\n                    options = $.extend({}, pick, {\n                        accept: $.isPlainObject( accept ) ? [ accept ] : accept,\n                        swf: opts.swf,\n                        runtimeOrder: opts.runtimeOrder,\n                        id: this\n                    });\n\n                    picker = new FilePicker( options );\n\n                    picker.once( 'ready', deferred.resolve );\n                    picker.on( 'select', function( files ) {\n                        me.owner.request( 'add-file', [ files ]);\n                    });\n                    picker.on('dialogopen', function() {\n                        me.owner.trigger('dialogOpen', picker.button);\n                    });\n                    picker.init();\n\n                    me.pickers.push( picker );\n\n                    promises.push( deferred.promise() );\n                });\n\n                return Base.when.apply( Base, promises );\n            },\n\n            disable: function() {\n                $.each( this.pickers, function() {\n                    this.disable();\n                });\n            },\n\n            enable: function() {\n                $.each( this.pickers, function() {\n                    this.enable();\n                });\n            },\n\n            destroy: function() {\n                $.each( this.pickers, function() {\n                    this.destroy();\n                });\n                this.pickers = null;\n            }\n        });\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('lib/image',[\n        'base',\n        'runtime/client',\n        'lib/blob'\n    ], function( Base, RuntimeClient, Blob ) {\n        var $ = Base.$;\n\n        // 构造器。\n        function Image( opts ) {\n            this.options = $.extend({}, Image.options, opts );\n            RuntimeClient.call( this, 'Image' );\n\n            this.on( 'load', function() {\n                this._info = this.exec('info');\n                this._meta = this.exec('meta');\n            });\n        }\n\n        // 默认选项。\n        Image.options = {\n\n            // 默认的图片处理质量\n            quality: 90,\n\n            // 是否裁剪\n            crop: false,\n\n            // 是否保留头部信息\n            preserveHeaders: false,\n\n            // 是否允许放大。\n            allowMagnify: false\n        };\n\n        // 继承RuntimeClient.\n        Base.inherits( RuntimeClient, {\n            constructor: Image,\n\n            info: function( val ) {\n\n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n\n                // getter\n                return this._info;\n            },\n\n            meta: function( val ) {\n\n                // setter\n                if ( val ) {\n                    this._meta = val;\n                    return this;\n                }\n\n                // getter\n                return this._meta;\n            },\n\n            loadFromBlob: function( blob ) {\n                var me = this,\n                    ruid = blob.getRuid();\n\n                this.connectRuntime( ruid, function() {\n                    me.exec( 'init', me.options );\n                    me.exec( 'loadFromBlob', blob );\n                });\n            },\n\n            resize: function() {\n                var args = Base.slice( arguments );\n                return this.exec.apply( this, [ 'resize' ].concat( args ) );\n            },\n\n            crop: function() {\n                var args = Base.slice( arguments );\n                return this.exec.apply( this, [ 'crop' ].concat( args ) );\n            },\n\n            getAsDataUrl: function( type ) {\n                return this.exec( 'getAsDataUrl', type );\n            },\n\n            getAsBlob: function( type ) {\n                var blob = this.exec( 'getAsBlob', type );\n\n                return new Blob( this.getRuid(), blob );\n            }\n        });\n\n        return Image;\n    });\n    /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n    define('widgets/image',[\n        'base',\n        'uploader',\n        'lib/image',\n        'widgets/widget'\n    ], function( Base, Uploader, Image ) {\n\n        var $ = Base.$,\n            throttle;\n\n        // 根据要处理的文件大小来节流，一次不能处理太多，会卡。\n        throttle = (function( max ) {\n            var occupied = 0,\n                waiting = [],\n                tick = function() {\n                    var item;\n\n                    while ( waiting.length && occupied < max ) {\n                        item = waiting.shift();\n                        occupied += item[ 0 ];\n                        item[ 1 ]();\n                    }\n                };\n\n            return function( emiter, size, cb ) {\n                waiting.push([ size, cb ]);\n                emiter.once( 'destroy', function() {\n                    occupied -= size;\n                    setTimeout( tick, 1 );\n                });\n                setTimeout( tick, 1 );\n            };\n        })( 5 * 1024 * 1024 );\n\n        $.extend( Uploader.options, {\n\n            /**\n             * @property {Object} [thumb]\n             * @namespace options\n             * @for Uploader\n             * @description 配置生成缩略图的选项。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 110,\n             *     height: 110,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 70,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: true,\n             *\n             *     // 是否允许裁剪。\n             *     crop: true,\n             *\n             *     // 为空的话则保留原有图片格式。\n             *     // 否则强制转换成指定的类型。\n             *     type: 'image/jpeg'\n             * }\n             * ```\n             */\n            thumb: {\n                width: 110,\n                height: 110,\n                quality: 70,\n                allowMagnify: true,\n                crop: true,\n                preserveHeaders: false,\n\n                // 为空的话则保留原有图片格式。\n                // 否则强制转换成指定的类型。\n                // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\n                // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\n                type: 'image/jpeg'\n            },\n\n            /**\n             * @property {Object} [compress]\n             * @namespace options\n             * @for Uploader\n             * @description 配置压缩的图片的选项。如果此选项为`false`, 则图片在上传前不进行压缩。\n             *\n             * 默认为：\n             *\n             * ```javascript\n             * {\n             *     width: 1600,\n             *     height: 1600,\n             *\n             *     // 图片质量，只有type为`image/jpeg`的时候才有效。\n             *     quality: 90,\n             *\n             *     // 是否允许放大，如果想要生成小图的时候不失真，此选项应该设置为false.\n             *     allowMagnify: false,\n             *\n             *     // 是否允许裁剪。\n             *     crop: false,\n             *\n             *     // 是否保留头部meta信息。\n             *     preserveHeaders: true,\n             *\n             *     // 如果发现压缩后文件大小比原来还大，则使用原来图片\n             *     // 此属性可能会影响图片自动纠正功能\n             *     noCompressIfLarger: false,\n             *\n             *     // 单位字节，如果图片大小小于此值，不会采用压缩。\n             *     compressSize: 0\n             * }\n             * ```\n             */\n            compress: {\n                width: 1600,\n                height: 1600,\n                quality: 90,\n                allowMagnify: false,\n                crop: false,\n                preserveHeaders: true\n            }\n        });\n\n        return Uploader.register({\n\n            name: 'image',\n\n\n            /**\n             * 生成缩略图，此过程为异步，所以需要传入`callback`。\n             * 通常情况在图片加入队里后调用此方法来生成预览图以增强交互效果。\n             *\n             * 当 width 或者 height 的值介于 0 - 1 时，被当成百分比使用。\n             *\n             * `callback`中可以接收到两个参数。\n             * * 第一个为error，如果生成缩略图有错误，此error将为真。\n             * * 第二个为ret, 缩略图的Data URL值。\n             *\n             * **注意**\n             * Date URL在IE6/7中不支持，所以不用调用此方法了，直接显示一张暂不支持预览图片好了。\n             * 也可以借助服务端，将 base64 数据传给服务端，生成一个临时文件供预览。\n             *\n             * @method makeThumb\n             * @grammar makeThumb( file, callback ) => undefined\n             * @grammar makeThumb( file, callback, width, height ) => undefined\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.makeThumb( file, function( error, ret ) {\n             *         if ( error ) {\n             *             $li.text('预览错误');\n             *         } else {\n             *             $li.append('<img alt=\"\" src=\"' + ret + '\" />');\n             *         }\n             *     });\n             *\n             * });\n             */\n            makeThumb: function( file, cb, width, height ) {\n                var opts, image;\n\n                file = this.request( 'get-file', file );\n\n                // 只预览图片格式。\n                if ( !file.type.match( /^image/ ) ) {\n                    cb( true );\n                    return;\n                }\n\n                opts = $.extend({}, this.options.thumb );\n\n                // 如果传入的是object.\n                if ( $.isPlainObject( width ) ) {\n                    opts = $.extend( opts, width );\n                    width = null;\n                }\n\n                width = width || opts.width;\n                height = height || opts.height;\n\n                image = new Image( opts );\n\n                image.once( 'load', function() {\n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n\n                    // 如果 width 的值介于 0 - 1\n                    // 说明设置的是百分比。\n                    if ( width <= 1 && width > 0 ) {\n                        width = file._info.width * width;\n                    }\n\n                    // 同样的规则应用于 height\n                    if ( height <= 1 && height > 0 ) {\n                        height = file._info.height * height;\n                    }\n\n                    image.resize( width, height );\n                });\n\n                // 当 resize 完后\n                image.once( 'complete', function() {\n                    cb( false, image.getAsDataUrl( opts.type ) );\n                    image.destroy();\n                });\n\n                image.once( 'error', function( reason ) {\n                    cb( reason || true );\n                    image.destroy();\n                });\n\n                throttle( image, file.source.size, function() {\n                    file._info && image.info( file._info );\n                    file._meta && image.meta( file._meta );\n                    image.loadFromBlob( file.source );\n                });\n            },\n\n            beforeSendFile: function( file ) {\n                var opts = this.options.compress || this.options.resize,\n                    compressSize = opts && opts.compressSize || 0,\n                    noCompressIfLarger = opts && opts.noCompressIfLarger || false,\n                    image, deferred;\n\n                file = this.request( 'get-file', file );\n\n                // 只压缩 jpeg 图片格式。\n                // gif 可能会丢失针\n                // bmp png 基本上尺寸都不大，且压缩比比较小。\n                if ( !opts || !~'image/jpeg,image/jpg'.indexOf( file.type ) ||\n                        file.size < compressSize ||\n                        file._compressed ) {\n                    return;\n                }\n\n                opts = $.extend({}, opts );\n                deferred = Base.Deferred();\n\n                image = new Image( opts );\n\n                deferred.always(function() {\n                    image.destroy();\n                    image = null;\n                });\n                image.once( 'error', deferred.reject );\n                image.once( 'load', function() {\n                    var width = opts.width,\n                        height = opts.height;\n\n                    file._info = file._info || image.info();\n                    file._meta = file._meta || image.meta();\n\n                    // 如果 width 的值介于 0 - 1\n                    // 说明设置的是百分比。\n                    if ( width <= 1 && width > 0 ) {\n                        width = file._info.width * width;\n                    }\n\n                    // 同样的规则应用于 height\n                    if ( height <= 1 && height > 0 ) {\n                        height = file._info.height * height;\n                    }\n\n                    image.resize( width, height );\n                });\n\n                image.once( 'complete', function() {\n                    var blob, size;\n\n                    // 移动端 UC / qq 浏览器的无图模式下\n                    // ctx.getImageData 处理大图的时候会报 Exception\n                    // INDEX_SIZE_ERR: DOM Exception 1\n                    try {\n                        blob = image.getAsBlob( opts.type );\n\n                        size = file.size;\n\n                        // 如果压缩后，比原来还大则不用压缩后的。\n                        if ( !noCompressIfLarger || blob.size < size ) {\n                            // file.source.destroy && file.source.destroy();\n                            file.source = blob;\n                            file.size = blob.size;\n\n                            file.trigger( 'resize', blob.size, size );\n                        }\n\n                        // 标记，避免重复压缩。\n                        file._compressed = true;\n                        deferred.resolve();\n                    } catch ( e ) {\n                        // 出错了直接继续，让其上传原始图片\n                        deferred.resolve();\n                    }\n                });\n\n                file._info && image.info( file._info );\n                file._meta && image.meta( file._meta );\n\n                image.loadFromBlob( file.source );\n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview 文件属性封装\n     */\n    define('file',[\n        'base',\n        'mediator'\n    ], function( Base, Mediator ) {\n\n        var $ = Base.$,\n            idPrefix = 'WU_FILE_',\n            idSuffix = 0,\n            rExt = /\\.([^.]+)$/,\n            statusMap = {};\n\n        function gid() {\n            return idPrefix + idSuffix++;\n        }\n\n        /**\n         * 文件类\n         * @class File\n         * @constructor 构造函数\n         * @grammar new File( source ) => File\n         * @param {Lib.File} source [lib.File](#Lib.File)实例, 此source对象是带有Runtime信息的。\n         */\n        function WUFile( source ) {\n\n            /**\n             * 文件名，包括扩展名（后缀）\n             * @property name\n             * @type {string}\n             */\n            this.name = source.name || 'Untitled';\n\n            /**\n             * 文件体积（字节）\n             * @property size\n             * @type {uint}\n             * @default 0\n             */\n            this.size = source.size || 0;\n\n            /**\n             * 文件MIMETYPE类型，与文件类型的对应关系请参考[http://t.cn/z8ZnFny](http://t.cn/z8ZnFny)\n             * @property type\n             * @type {string}\n             * @default 'application/octet-stream'\n             */\n            this.type = source.type || 'application/octet-stream';\n\n            /**\n             * 文件最后修改日期\n             * @property lastModifiedDate\n             * @type {int}\n             * @default 当前时间戳\n             */\n            this.lastModifiedDate = source.lastModifiedDate || (new Date() * 1);\n\n            /**\n             * 文件ID，每个对象具有唯一ID，与文件名无关\n             * @property id\n             * @type {string}\n             */\n            this.id = gid();\n\n            /**\n             * 文件扩展名，通过文件名获取，例如test.png的扩展名为png\n             * @property ext\n             * @type {string}\n             */\n            this.ext = rExt.exec( this.name ) ? RegExp.$1 : '';\n\n\n            /**\n             * 状态文字说明。在不同的status语境下有不同的用途。\n             * @property statusText\n             * @type {string}\n             */\n            this.statusText = '';\n\n            // 存储文件状态，防止通过属性直接修改\n            statusMap[ this.id ] = WUFile.Status.INITED;\n\n            this.source = source;\n            this.loaded = 0;\n\n            this.on( 'error', function( msg ) {\n                this.setStatus( WUFile.Status.ERROR, msg );\n            });\n        }\n\n        $.extend( WUFile.prototype, {\n\n            /**\n             * 设置状态，状态变化时会触发`change`事件。\n             * @method setStatus\n             * @grammar setStatus( status[, statusText] );\n             * @param {File.Status|String} status [文件状态值](#WebUploader:File:File.Status)\n             * @param {String} [statusText=''] 状态说明，常在error时使用，用http, abort,server等来标记是由于什么原因导致文件错误。\n             */\n            setStatus: function( status, text ) {\n\n                var prevStatus = statusMap[ this.id ];\n\n                typeof text !== 'undefined' && (this.statusText = text);\n\n                if ( status !== prevStatus ) {\n                    statusMap[ this.id ] = status;\n                    /**\n                     * 文件状态变化\n                     * @event statuschange\n                     */\n                    this.trigger( 'statuschange', status, prevStatus );\n                }\n\n            },\n\n            /**\n             * 获取文件状态\n             * @return {File.Status}\n             * @example\n                     文件状态具体包括以下几种类型：\n                     {\n                         // 初始化\n                        INITED:     0,\n                        // 已入队列\n                        QUEUED:     1,\n                        // 正在上传\n                        PROGRESS:     2,\n                        // 上传出错\n                        ERROR:         3,\n                        // 上传成功\n                        COMPLETE:     4,\n                        // 上传取消\n                        CANCELLED:     5\n                    }\n             */\n            getStatus: function() {\n                return statusMap[ this.id ];\n            },\n\n            /**\n             * 获取文件原始信息。\n             * @return {*}\n             */\n            getSource: function() {\n                return this.source;\n            },\n\n            destroy: function() {\n                this.off();\n                delete statusMap[ this.id ];\n            }\n        });\n\n        Mediator.installTo( WUFile.prototype );\n\n        /**\n         * 文件状态值，具体包括以下几种类型：\n         * * `inited` 初始状态\n         * * `queued` 已经进入队列, 等待上传\n         * * `progress` 上传中\n         * * `complete` 上传完成。\n         * * `error` 上传出错，可重试\n         * * `interrupt` 上传中断，可续传。\n         * * `invalid` 文件不合格，不能重试上传。会自动从队列中移除。\n         * * `cancelled` 文件被移除。\n         * @property {Object} Status\n         * @namespace File\n         * @class File\n         * @static\n         */\n        WUFile.Status = {\n            INITED:     'inited',    // 初始状态\n            QUEUED:     'queued',    // 已经进入队列, 等待上传\n            PROGRESS:   'progress',    // 上传中\n            ERROR:      'error',    // 上传出错，可重试\n            COMPLETE:   'complete',    // 上传完成。\n            CANCELLED:  'cancelled',    // 上传取消。\n            INTERRUPT:  'interrupt',    // 上传中断，可续传。\n            INVALID:    'invalid'    // 文件不合格，不能重试上传。\n        };\n\n        return WUFile;\n    });\n\n    /**\n     * @fileOverview 文件队列\n     */\n    define('queue',[\n        'base',\n        'mediator',\n        'file'\n    ], function( Base, Mediator, WUFile ) {\n\n        var $ = Base.$,\n            STATUS = WUFile.Status;\n\n        /**\n         * 文件队列, 用来存储各个状态中的文件。\n         * @class Queue\n         * @extends Mediator\n         */\n        function Queue() {\n\n            /**\n             * 统计文件数。\n             * * `numOfQueue` 队列中的文件数。\n             * * `numOfSuccess` 上传成功的文件数\n             * * `numOfCancel` 被取消的文件数\n             * * `numOfProgress` 正在上传中的文件数\n             * * `numOfUploadFailed` 上传错误的文件数。\n             * * `numOfInvalid` 无效的文件数。\n             * * `numofDeleted` 被移除的文件数。\n             * @property {Object} stats\n             */\n            this.stats = {\n                numOfQueue: 0,\n                numOfSuccess: 0,\n                numOfCancel: 0,\n                numOfProgress: 0,\n                numOfUploadFailed: 0,\n                numOfInvalid: 0,\n                numofDeleted: 0,\n                numofInterrupt: 0\n            };\n\n            // 上传队列，仅包括等待上传的文件\n            this._queue = [];\n\n            // 存储所有文件\n            this._map = {};\n        }\n\n        $.extend( Queue.prototype, {\n\n            /**\n             * 将新文件加入对队列尾部\n             *\n             * @method append\n             * @param  {File} file   文件对象\n             */\n            append: function( file ) {\n                this._queue.push( file );\n                this._fileAdded( file );\n                return this;\n            },\n\n            /**\n             * 将新文件加入对队列头部\n             *\n             * @method prepend\n             * @param  {File} file   文件对象\n             */\n            prepend: function( file ) {\n                this._queue.unshift( file );\n                this._fileAdded( file );\n                return this;\n            },\n\n            /**\n             * 获取文件对象\n             *\n             * @method getFile\n             * @param  {String} fileId   文件ID\n             * @return {File}\n             */\n            getFile: function( fileId ) {\n                if ( typeof fileId !== 'string' ) {\n                    return fileId;\n                }\n                return this._map[ fileId ];\n            },\n\n            /**\n             * 从队列中取出一个指定状态的文件。\n             * @grammar fetch( status ) => File\n             * @method fetch\n             * @param {String} status [文件状态值](#WebUploader:File:File.Status)\n             * @return {File} [File](#WebUploader:File)\n             */\n            fetch: function( status ) {\n                var len = this._queue.length,\n                    i, file;\n\n                status = status || STATUS.QUEUED;\n\n                for ( i = 0; i < len; i++ ) {\n                    file = this._queue[ i ];\n\n                    if ( status === file.getStatus() ) {\n                        return file;\n                    }\n                }\n\n                return null;\n            },\n\n            /**\n             * 对队列进行排序，能够控制文件上传顺序。\n             * @grammar sort( fn ) => undefined\n             * @method sort\n             * @param {Function} fn 排序方法\n             */\n            sort: function( fn ) {\n                if ( typeof fn === 'function' ) {\n                    this._queue.sort( fn );\n                }\n            },\n\n            /**\n             * 获取指定类型的文件列表, 列表中每一个成员为[File](#WebUploader:File)对象。\n             * @grammar getFiles( [status1[, status2 ...]] ) => Array\n             * @method getFiles\n             * @param {String} [status] [文件状态值](#WebUploader:File:File.Status)\n             */\n            getFiles: function() {\n                var sts = [].slice.call( arguments, 0 ),\n                    ret = [],\n                    i = 0,\n                    len = this._queue.length,\n                    file;\n\n                for ( ; i < len; i++ ) {\n                    file = this._queue[ i ];\n\n                    if ( sts.length && !~$.inArray( file.getStatus(), sts ) ) {\n                        continue;\n                    }\n\n                    ret.push( file );\n                }\n\n                return ret;\n            },\n\n            /**\n             * 在队列中删除文件。\n             * @grammar removeFile( file ) => Array\n             * @method removeFile\n             * @param {File} 文件对象。\n             */\n            removeFile: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n\n                if ( existing ) {\n                    delete this._map[ file.id ];\n                    this._delFile(file);\n                    file.destroy();\n                    this.stats.numofDeleted++;\n\n                }\n            },\n\n            _fileAdded: function( file ) {\n                var me = this,\n                    existing = this._map[ file.id ];\n\n                if ( !existing ) {\n                    this._map[ file.id ] = file;\n\n                    file.on( 'statuschange', function( cur, pre ) {\n                        me._onFileStatusChange( cur, pre );\n                    });\n                }\n            },\n\n            _delFile : function(file){\n                for(var i = this._queue.length - 1 ; i >= 0 ; i-- ){\n                    if(this._queue[i] == file){\n                        this._queue.splice(i,1);\n                        break;\n                    }\n                }\n            },\n\n            _onFileStatusChange: function( curStatus, preStatus ) {\n                var stats = this.stats;\n\n                switch ( preStatus ) {\n                    case STATUS.PROGRESS:\n                        stats.numOfProgress--;\n                        break;\n\n                    case STATUS.QUEUED:\n                        stats.numOfQueue --;\n                        break;\n\n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed--;\n                        break;\n\n                    case STATUS.INVALID:\n                        stats.numOfInvalid--;\n                        break;\n\n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt--;\n                        break;\n                }\n\n                switch ( curStatus ) {\n                    case STATUS.QUEUED:\n                        stats.numOfQueue++;\n                        break;\n\n                    case STATUS.PROGRESS:\n                        stats.numOfProgress++;\n                        break;\n\n                    case STATUS.ERROR:\n                        stats.numOfUploadFailed++;\n                        break;\n\n                    case STATUS.COMPLETE:\n                        stats.numOfSuccess++;\n                        break;\n\n                    case STATUS.CANCELLED:\n                        stats.numOfCancel++;\n                        break;\n\n\n                    case STATUS.INVALID:\n                        stats.numOfInvalid++;\n                        break;\n\n                    case STATUS.INTERRUPT:\n                        stats.numofInterrupt++;\n                        break;\n                }\n            }\n\n        });\n\n        Mediator.installTo( Queue.prototype );\n\n        return Queue;\n    });\n\n    /**\n     * @fileOverview 队列\n     */\n    define('widgets/queue',[\n        'base',\n        'uploader',\n        'queue',\n        'file',\n        'lib/file',\n        'runtime/client',\n        'widgets/widget'\n    ], function( Base, Uploader, Queue, WUFile, File, RuntimeClient ) {\n\n        var $ = Base.$,\n            rExt = /\\.\\w+$/,\n            Status = WUFile.Status;\n\n        return Uploader.register({\n            name: 'queue',\n\n            init: function( opts ) {\n                var me = this,\n                    deferred, len, i, item, arr, accept, runtime;\n\n                if ( $.isPlainObject( opts.accept ) ) {\n                    opts.accept = [ opts.accept ];\n                }\n\n                // accept中的中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].extensions;\n                        item && arr.push( item );\n                    }\n\n                    if ( arr.length ) {\n                        accept = '\\\\.' + arr.join(',')\n                                .replace( /,/g, '$|\\\\.' )\n                                .replace( /\\*/g, '.*' ) + '$';\n                    }\n\n                    me.accept = new RegExp( accept, 'i' );\n                }\n\n                me.queue = new Queue();\n                me.stats = me.queue.stats;\n\n                // 如果当前不是html5运行时，那就算了。\n                // 不执行后续操作\n                if ( this.request('predict-runtime-type') !== 'html5' ) {\n                    return;\n                }\n\n                // 创建一个 html5 运行时的 placeholder\n                // 以至于外部添加原生 File 对象的时候能正确包裹一下供 webuploader 使用。\n                deferred = Base.Deferred();\n                this.placeholder = runtime = new RuntimeClient('Placeholder');\n                runtime.connectRuntime({\n                    runtimeOrder: 'html5'\n                }, function() {\n                    me._ruid = runtime.getRuid();\n                    deferred.resolve();\n                });\n                return deferred.promise();\n            },\n\n\n            // 为了支持外部直接添加一个原生File对象。\n            _wrapFile: function( file ) {\n                if ( !(file instanceof WUFile) ) {\n\n                    if ( !(file instanceof File) ) {\n                        if ( !this._ruid ) {\n                            throw new Error('Can\\'t add external files.');\n                        }\n                        file = new File( this._ruid, file );\n                    }\n\n                    file = new WUFile( file );\n                }\n\n                return file;\n            },\n\n            // 判断文件是否可以被加入队列\n            acceptFile: function( file ) {\n                var invalid = !file || !file.size || this.accept &&\n\n                        // 如果名字中有后缀，才做后缀白名单处理。\n                        rExt.exec( file.name ) && !this.accept.test( file.name );\n\n                return !invalid;\n            },\n\n\n            /**\n             * @event beforeFileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列之前触发，此事件的handler返回值为`false`，则此文件不会被添加进入队列。\n             * @for  Uploader\n             */\n\n            /**\n             * @event fileQueued\n             * @param {File} file File对象\n             * @description 当文件被加入队列以后触发。\n             * @for  Uploader\n             */\n\n            _addFile: function( file ) {\n                var me = this;\n\n                file = me._wrapFile( file );\n\n                // 不过类型判断允许不允许，先派送 `beforeFileQueued`\n                if ( !me.owner.trigger( 'beforeFileQueued', file ) ) {\n                    return;\n                }\n\n                // 类型不匹配，则派送错误事件，并返回。\n                if ( !me.acceptFile( file ) ) {\n                    me.owner.trigger( 'error', 'Q_TYPE_DENIED', file );\n                    return;\n                }\n\n                me.queue.append( file );\n                me.owner.trigger( 'fileQueued', file );\n                return file;\n            },\n\n            getFile: function( fileId ) {\n                return this.queue.getFile( fileId );\n            },\n\n            /**\n             * @event filesQueued\n             * @param {File} files 数组，内容为原始File(lib/File）对象。\n             * @description 当一批文件添加进队列以后触发。\n             * @for  Uploader\n             */\n\n            /**\n             * @property {Boolean} [auto=false]\n             * @namespace options\n             * @for Uploader\n             * @description 设置为 true 后，不需要手动调用上传，有文件选择即开始上传。\n             *\n             */\n\n            /**\n             * @method addFiles\n             * @grammar addFiles( file ) => undefined\n             * @grammar addFiles( [file1, file2 ...] ) => undefined\n             * @param {Array of File or File} [files] Files 对象 数组\n             * @description 添加文件到队列\n             * @for  Uploader\n             */\n            addFile: function( files ) {\n                var me = this;\n\n                if ( !files.length ) {\n                    files = [ files ];\n                }\n\n                files = $.map( files, function( file ) {\n                    return me._addFile( file );\n                });\n\n    \t\t\tif ( files.length ) {\n\n                    me.owner.trigger( 'filesQueued', files );\n\n    \t\t\t\tif ( me.options.auto ) {\n    \t\t\t\t\tsetTimeout(function() {\n    \t\t\t\t\t\tme.request('start-upload');\n    \t\t\t\t\t}, 20 );\n    \t\t\t\t}\n                }\n            },\n\n            getStats: function() {\n                return this.stats;\n            },\n\n            /**\n             * @event fileDequeued\n             * @param {File} file File对象\n             * @description 当文件被移除队列后触发。\n             * @for  Uploader\n             */\n\n             /**\n             * @method removeFile\n             * @grammar removeFile( file ) => undefined\n             * @grammar removeFile( id ) => undefined\n             * @grammar removeFile( file, true ) => undefined\n             * @grammar removeFile( id, true ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 移除某一文件, 默认只会标记文件状态为已取消，如果第二个参数为 `true` 则会从 queue 中移除。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.removeFile( file );\n             * })\n             */\n            removeFile: function( file, remove ) {\n                var me = this;\n\n                file = file.id ? file : me.queue.getFile( file );\n\n                this.request( 'cancel-file', file );\n\n                if ( remove ) {\n                    this.queue.removeFile( file );\n                }\n            },\n\n            /**\n             * @method getFiles\n             * @grammar getFiles() => Array\n             * @grammar getFiles( status1, status2, status... ) => Array\n             * @description 返回指定状态的文件集合，不传参数将返回所有状态的文件。\n             * @for  Uploader\n             * @example\n             * console.log( uploader.getFiles() );    // => all files\n             * console.log( uploader.getFiles('error') )    // => all error files.\n             */\n            getFiles: function() {\n                return this.queue.getFiles.apply( this.queue, arguments );\n            },\n\n            fetchFile: function() {\n                return this.queue.fetch.apply( this.queue, arguments );\n            },\n\n            /**\n             * @method retry\n             * @grammar retry() => undefined\n             * @grammar retry( file ) => undefined\n             * @description 重试上传，重试指定文件，或者从出错的文件开始重新上传。\n             * @for  Uploader\n             * @example\n             * function retry() {\n             *     uploader.retry();\n             * }\n             */\n            retry: function( file, noForceStart ) {\n                var me = this,\n                    files, i, len;\n\n                if ( file ) {\n                    file = file.id ? file : me.queue.getFile( file );\n                    file.setStatus( Status.QUEUED );\n                    noForceStart || me.request('start-upload');\n                    return;\n                }\n\n                files = me.queue.getFiles( Status.ERROR );\n                i = 0;\n                len = files.length;\n\n                for ( ; i < len; i++ ) {\n                    file = files[ i ];\n                    file.setStatus( Status.QUEUED );\n                }\n\n                me.request('start-upload');\n            },\n\n            /**\n             * @method sort\n             * @grammar sort( fn ) => undefined\n             * @description 排序队列中的文件，在上传之前调整可以控制上传顺序。\n             * @for  Uploader\n             */\n            sortFiles: function() {\n                return this.queue.sort.apply( this.queue, arguments );\n            },\n\n            /**\n             * @event reset\n             * @description 当 uploader 被重置的时候触发。\n             * @for  Uploader\n             */\n\n            /**\n             * @method reset\n             * @grammar reset() => undefined\n             * @description 重置uploader。目前只重置了队列。\n             * @for  Uploader\n             * @example\n             * uploader.reset();\n             */\n            reset: function() {\n                this.owner.trigger('reset');\n                this.queue = new Queue();\n                this.stats = this.queue.stats;\n            },\n\n            destroy: function() {\n                this.reset();\n                this.placeholder && this.placeholder.destroy();\n            }\n        });\n\n    });\n    /**\n     * @fileOverview 添加获取Runtime相关信息的方法。\n     */\n    define('widgets/runtime',[\n        'uploader',\n        'runtime/runtime',\n        'widgets/widget'\n    ], function( Uploader, Runtime ) {\n\n        Uploader.support = function() {\n            return Runtime.hasRuntime.apply( Runtime, arguments );\n        };\n\n        /**\n         * @property {Object} [runtimeOrder=html5,flash]\n         * @namespace options\n         * @for Uploader\n         * @description 指定运行时启动顺序。默认会想尝试 html5 是否支持，如果支持则使用 html5, 否则则使用 flash.\n         *\n         * 可以将此值设置成 `flash`，来强制使用 flash 运行时。\n         */\n\n        return Uploader.register({\n            name: 'runtime',\n\n            init: function() {\n                if ( !this.predictRuntimeType() ) {\n                    throw Error('Runtime Error');\n                }\n            },\n\n            /**\n             * 预测Uploader将采用哪个`Runtime`\n             * @grammar predictRuntimeType() => String\n             * @method predictRuntimeType\n             * @for  Uploader\n             */\n            predictRuntimeType: function() {\n                var orders = this.options.runtimeOrder || Runtime.orders,\n                    type = this.type,\n                    i, len;\n\n                if ( !type ) {\n                    orders = orders.split( /\\s*,\\s*/g );\n\n                    for ( i = 0, len = orders.length; i < len; i++ ) {\n                        if ( Runtime.hasRuntime( orders[ i ] ) ) {\n                            this.type = type = orders[ i ];\n                            break;\n                        }\n                    }\n                }\n\n                return type;\n            }\n        });\n    });\n    /**\n     * @fileOverview Transport\n     */\n    define('lib/transport',[\n        'base',\n        'runtime/client',\n        'mediator'\n    ], function( Base, RuntimeClient, Mediator ) {\n\n        var $ = Base.$;\n\n        function Transport( opts ) {\n            var me = this;\n\n            opts = me.options = $.extend( true, {}, Transport.options, opts || {} );\n            RuntimeClient.call( this, 'Transport' );\n\n            this._blob = null;\n            this._formData = opts.formData || {};\n            this._headers = opts.headers || {};\n\n            this.on( 'progress', this._timeout );\n            this.on( 'load error', function() {\n                me.trigger( 'progress', 1 );\n                clearTimeout( me._timer );\n            });\n        }\n\n        Transport.options = {\n            server: '',\n            method: 'POST',\n\n            // 跨域时，是否允许携带cookie, 只有html5 runtime才有效\n            withCredentials: false,\n            fileVal: 'file',\n            timeout: 2 * 60 * 1000,    // 2分钟\n            formData: {},\n            headers: {},\n            sendAsBinary: false\n        };\n\n        $.extend( Transport.prototype, {\n\n            // 添加Blob, 只能添加一次，最后一次有效。\n            appendBlob: function( key, blob, filename ) {\n                var me = this,\n                    opts = me.options;\n\n                if ( me.getRuid() ) {\n                    me.disconnectRuntime();\n                }\n\n                // 连接到blob归属的同一个runtime.\n                me.connectRuntime( blob.ruid, function() {\n                    me.exec('init');\n                });\n\n                me._blob = blob;\n                opts.fileVal = key || opts.fileVal;\n                opts.filename = filename || opts.filename;\n            },\n\n            // 添加其他字段\n            append: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._formData, key );\n                } else {\n                    this._formData[ key ] = value;\n                }\n            },\n\n            setRequestHeader: function( key, value ) {\n                if ( typeof key === 'object' ) {\n                    $.extend( this._headers, key );\n                } else {\n                    this._headers[ key ] = value;\n                }\n            },\n\n            send: function( method ) {\n                this.exec( 'send', method );\n                this._timeout();\n            },\n\n            abort: function() {\n                clearTimeout( this._timer );\n                return this.exec('abort');\n            },\n\n            destroy: function() {\n                this.trigger('destroy');\n                this.off();\n                this.exec('destroy');\n                this.disconnectRuntime();\n            },\n\n            getResponseHeaders: function() {\n                return this.exec('getResponseHeaders');\n            },\n\n            getResponse: function() {\n                return this.exec('getResponse');\n            },\n\n            getResponseAsJson: function() {\n                return this.exec('getResponseAsJson');\n            },\n\n            getStatus: function() {\n                return this.exec('getStatus');\n            },\n\n            _timeout: function() {\n                var me = this,\n                    duration = me.options.timeout;\n\n                if ( !duration ) {\n                    return;\n                }\n\n                clearTimeout( me._timer );\n                me._timer = setTimeout(function() {\n                    me.abort();\n                    me.trigger( 'error', 'timeout' );\n                }, duration );\n            }\n\n        });\n\n        // 让Transport具备事件功能。\n        Mediator.installTo( Transport.prototype );\n\n        return Transport;\n    });\n\n    /**\n     * @fileOverview 负责文件上传相关。\n     */\n    define('widgets/upload',[\n        'base',\n        'uploader',\n        'file',\n        'lib/transport',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile, Transport ) {\n\n        var $ = Base.$,\n            isPromise = Base.isPromise,\n            Status = WUFile.Status;\n\n        // 添加默认配置项\n        $.extend( Uploader.options, {\n\n\n            /**\n             * @property {Boolean} [prepareNextFile=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否允许在文件传输时提前把下一个文件准备好。\n             * 对于一个文件的准备工作比较耗时，比如图片压缩，md5序列化。\n             * 如果能提前在当前文件传输期处理，可以节省总体耗时。\n             */\n            prepareNextFile: false,\n\n            /**\n             * @property {Boolean} [chunked=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否要分片处理大文件上传。\n             */\n            chunked: false,\n\n            /**\n             * @property {Boolean} [chunkSize=5242880]\n             * @namespace options\n             * @for Uploader\n             * @description 如果要分片，分多大一片？ 默认大小为5M.\n             */\n            chunkSize: 5 * 1024 * 1024,\n\n            /**\n             * @property {Boolean} [chunkRetry=2]\n             * @namespace options\n             * @for Uploader\n             * @description 如果某个分片由于网络问题出错，允许自动重传多少次？\n             */\n            chunkRetry: 2,\n\n            /**\n             * @property {Boolean} [threads=3]\n             * @namespace options\n             * @for Uploader\n             * @description 上传并发数。允许同时最大上传进程数。\n             */\n            threads: 3,\n\n\n            /**\n             * @property {Object} [formData={}]\n             * @namespace options\n             * @for Uploader\n             * @description 文件上传请求的参数表，每次发送都会发送此对象中的参数。\n             */\n            formData: {}\n\n            /**\n             * @property {Object} [fileVal='file']\n             * @namespace options\n             * @for Uploader\n             * @description 设置文件上传域的name。\n             */\n\n            /**\n             * @property {Object} [sendAsBinary=false]\n             * @namespace options\n             * @for Uploader\n             * @description 是否已二进制的流的方式发送文件，这样整个上传内容`php://input`都为文件内容，\n             * 其他参数在$_GET数组中。\n             */\n        });\n\n        // 负责将文件切片。\n        function CuteFile( file, chunkSize ) {\n            var pending = [],\n                blob = file.source,\n                total = blob.size,\n                chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n                start = 0,\n                index = 0,\n                len, api;\n\n            api = {\n                file: file,\n\n                has: function() {\n                    return !!pending.length;\n                },\n\n                shift: function() {\n                    return pending.shift();\n                },\n\n                unshift: function( block ) {\n                    pending.unshift( block );\n                }\n            };\n\n            while ( index < chunks ) {\n                len = Math.min( chunkSize, total - start );\n\n                pending.push({\n                    file: file,\n                    start: start,\n                    end: chunkSize ? (start + len) : total,\n                    total: total,\n                    chunks: chunks,\n                    chunk: index++,\n                    cuted: api\n                });\n                start += len;\n            }\n\n            file.blocks = pending.concat();\n            file.remaning = pending.length;\n\n            return api;\n        }\n\n        Uploader.register({\n            name: 'upload',\n\n            init: function() {\n                var owner = this.owner,\n                    me = this;\n\n                this.runing = false;\n                this.progress = false;\n\n                owner\n                    .on( 'startUpload', function() {\n                        me.progress = true;\n                    })\n                    .on( 'uploadFinished', function() {\n                        me.progress = false;\n                    });\n\n                // 记录当前正在传的数据，跟threads相关\n                this.pool = [];\n\n                // 缓存分好片的文件。\n                this.stack = [];\n\n                // 缓存即将上传的文件。\n                this.pending = [];\n\n                // 跟踪还有多少分片在上传中但是没有完成上传。\n                this.remaning = 0;\n                this.__tick = Base.bindFn( this._tick, this );\n\n                // 销毁上传相关的属性。\n                owner.on( 'uploadComplete', function( file ) {\n\n                    // 把其他块取消了。\n                    file.blocks && $.each( file.blocks, function( _, v ) {\n                        v.transport && (v.transport.abort(), v.transport.destroy());\n                        delete v.transport;\n                    });\n\n                    delete file.blocks;\n                    delete file.remaning;\n                });\n            },\n\n            reset: function() {\n                this.request( 'stop-upload', true );\n                this.runing = false;\n                this.pool = [];\n                this.stack = [];\n                this.pending = [];\n                this.remaning = 0;\n                this._trigged = false;\n                this._promise = null;\n            },\n\n            /**\n             * @event startUpload\n             * @description 当开始上传流程时触发。\n             * @for  Uploader\n             */\n\n            /**\n             * 开始上传。此方法可以从初始状态调用开始上传流程，也可以从暂停状态调用，继续上传流程。\n             *\n             * 可以指定开始某一个文件。\n             * @grammar upload() => undefined\n             * @grammar upload( file | fileId) => undefined\n             * @method upload\n             * @for  Uploader\n             */\n            startUpload: function(file) {\n                var me = this;\n\n                // 移出invalid的文件\n                $.each( me.request( 'get-files', Status.INVALID ), function() {\n                    me.request( 'remove-file', this );\n                });\n\n                // 如果指定了开始某个文件，则只开始指定的文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n\n                    if (file.getStatus() === Status.INTERRUPT) {\n                        file.setStatus( Status.QUEUED );\n\n                        $.each( me.pool, function( _, v ) {\n\n                            // 之前暂停过。\n                            if (v.file !== file) {\n                                return;\n                            }\n\n                            v.transport && v.transport.send();\n                            file.setStatus( Status.PROGRESS );\n                        });\n\n\n                    } else if (file.getStatus() !== Status.PROGRESS) {\n                        file.setStatus( Status.QUEUED );\n                    }\n                } else {\n                    $.each( me.request( 'get-files', [ Status.INITED ] ), function() {\n                        this.setStatus( Status.QUEUED );\n                    });\n                }\n\n                if ( me.runing ) {\n                    me.owner.trigger('startUpload', file);// 开始上传或暂停恢复的，trigger event\n                    return Base.nextTick( me.__tick );\n                }\n\n                me.runing = true;\n                var files = [];\n\n                // 如果有暂停的，则续传\n                file || $.each( me.pool, function( _, v ) {\n                    var file = v.file;\n\n                    if ( file.getStatus() === Status.INTERRUPT ) {\n                        me._trigged = false;\n                        files.push(file);\n                        v.transport && v.transport.send();\n                    }\n                });\n\n                $.each(files, function() {\n                    this.setStatus( Status.PROGRESS );\n                });\n\n                file || $.each( me.request( 'get-files',\n                        Status.INTERRUPT ), function() {\n                    this.setStatus( Status.PROGRESS );\n                });\n\n                me._trigged = false;\n                Base.nextTick( me.__tick );\n                me.owner.trigger('startUpload');\n            },\n\n            /**\n             * @event stopUpload\n             * @description 当开始上传流程暂停时触发。\n             * @for  Uploader\n             */\n\n            /**\n             * 暂停上传。第一个参数为是否中断上传当前正在上传的文件。\n             *\n             * 如果第一个参数是文件，则只暂停指定文件。\n             * @grammar stop() => undefined\n             * @grammar stop( true ) => undefined\n             * @grammar stop( file ) => undefined\n             * @method stop\n             * @for  Uploader\n             */\n            stopUpload: function( file, interrupt ) {\n                var me = this;\n\n                if (file === true) {\n                    interrupt = file;\n                    file = null;\n                }\n\n                if ( me.runing === false ) {\n                    return;\n                }\n\n                // 如果只是暂停某个文件。\n                if ( file ) {\n                    file = file.id ? file : me.request( 'get-file', file );\n\n                    if ( file.getStatus() !== Status.PROGRESS &&\n                            file.getStatus() !== Status.QUEUED ) {\n                        return;\n                    }\n\n                    file.setStatus( Status.INTERRUPT );\n\n\n                    $.each( me.pool, function( _, v ) {\n\n                        // 只 abort 指定的文件，每一个分片。\n                        if (v.file === file) {\n                            v.transport && v.transport.abort();\n\n                            if (interrupt) {\n                                me._putback(v);\n                                me._popBlock(v);\n                            }\n                        }\n                    });\n\n                    me.owner.trigger('stopUpload', file);// 暂停，trigger event\n\n                    return Base.nextTick( me.__tick );\n                }\n\n                me.runing = false;\n\n                // 正在准备中的文件。\n                if (this._promise && this._promise.file) {\n                    this._promise.file.setStatus( Status.INTERRUPT );\n                }\n\n                interrupt && $.each( me.pool, function( _, v ) {\n                    v.transport && v.transport.abort();\n                    v.file.setStatus( Status.INTERRUPT );\n                });\n\n                me.owner.trigger('stopUpload');\n            },\n\n            /**\n             * @method cancelFile\n             * @grammar cancelFile( file ) => undefined\n             * @grammar cancelFile( id ) => undefined\n             * @param {File|id} file File对象或这File对象的id\n             * @description 标记文件状态为已取消, 同时将中断文件传输。\n             * @for  Uploader\n             * @example\n             *\n             * $li.on('click', '.remove-this', function() {\n             *     uploader.cancelFile( file );\n             * })\n             */\n            cancelFile: function( file ) {\n                file = file.id ? file : this.request( 'get-file', file );\n\n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n\n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n\n                file.setStatus( Status.CANCELLED );\n                this.owner.trigger( 'fileDequeued', file );\n            },\n\n            /**\n             * 判断`Uplaode`r是否正在上传中。\n             * @grammar isInProgress() => Boolean\n             * @method isInProgress\n             * @for  Uploader\n             */\n            isInProgress: function() {\n                return !!this.progress;\n            },\n\n            _getStats: function() {\n                return this.request('get-stats');\n            },\n\n            /**\n             * 掉过一个文件上传，直接标记指定文件为已上传状态。\n             * @grammar skipFile( file ) => undefined\n             * @method skipFile\n             * @for  Uploader\n             */\n            skipFile: function( file, status ) {\n                file = file.id ? file : this.request( 'get-file', file );\n\n                file.setStatus( status || Status.COMPLETE );\n                file.skipped = true;\n\n                // 如果正在上传。\n                file.blocks && $.each( file.blocks, function( _, v ) {\n                    var _tr = v.transport;\n\n                    if ( _tr ) {\n                        _tr.abort();\n                        _tr.destroy();\n                        delete v.transport;\n                    }\n                });\n\n                this.owner.trigger( 'uploadSkip', file );\n            },\n\n            /**\n             * @event uploadFinished\n             * @description 当所有文件上传结束时触发。\n             * @for  Uploader\n             */\n            _tick: function() {\n                var me = this,\n                    opts = me.options,\n                    fn, val;\n\n                // 上一个promise还没有结束，则等待完成后再执行。\n                if ( me._promise ) {\n                    return me._promise.always( me.__tick );\n                }\n\n                // 还有位置，且还有文件要处理的话。\n                if ( me.pool.length < opts.threads && (val = me._nextBlock()) ) {\n                    me._trigged = false;\n\n                    fn = function( val ) {\n                        me._promise = null;\n\n                        // 有可能是reject过来的，所以要检测val的类型。\n                        val && val.file && me._startSend( val );\n                        Base.nextTick( me.__tick );\n                    };\n\n                    me._promise = isPromise( val ) ? val.always( fn ) : fn( val );\n\n                // 没有要上传的了，且没有正在传输的了。\n                } else if ( !me.remaning && !me._getStats().numOfQueue &&\n                    !me._getStats().numofInterrupt ) {\n                    me.runing = false;\n\n                    me._trigged || Base.nextTick(function() {\n                        me.owner.trigger('uploadFinished');\n                    });\n                    me._trigged = true;\n                }\n            },\n\n            _putback: function(block) {\n                var idx;\n\n                block.cuted.unshift(block);\n                idx = this.stack.indexOf(block.cuted);\n\n                if (!~idx) {\n                    this.stack.unshift(block.cuted);\n                }\n            },\n\n            _getStack: function() {\n                var i = 0,\n                    act;\n\n                while ( (act = this.stack[ i++ ]) ) {\n                    if ( act.has() && act.file.getStatus() === Status.PROGRESS ) {\n                        return act;\n                    } else if (!act.has() ||\n                            act.file.getStatus() !== Status.PROGRESS &&\n                            act.file.getStatus() !== Status.INTERRUPT ) {\n\n                        // 把已经处理完了的，或者，状态为非 progress（上传中）、\n                        // interupt（暂停中） 的移除。\n                        this.stack.splice( --i, 1 );\n                    }\n                }\n\n                return null;\n            },\n\n            _nextBlock: function() {\n                var me = this,\n                    opts = me.options,\n                    act, next, done, preparing;\n\n                // 如果当前文件还有没有需要传输的，则直接返回剩下的。\n                if ( (act = this._getStack()) ) {\n\n                    // 是否提前准备下一个文件\n                    if ( opts.prepareNextFile && !me.pending.length ) {\n                        me._prepareNextFile();\n                    }\n\n                    return act.shift();\n\n                // 否则，如果正在运行，则准备下一个文件，并等待完成后返回下个分片。\n                } else if ( me.runing ) {\n\n                    // 如果缓存中有，则直接在缓存中取，没有则去queue中取。\n                    if ( !me.pending.length && me._getStats().numOfQueue ) {\n                        me._prepareNextFile();\n                    }\n\n                    next = me.pending.shift();\n                    done = function( file ) {\n                        if ( !file ) {\n                            return null;\n                        }\n\n                        act = CuteFile( file, opts.chunked ? opts.chunkSize : 0 );\n                        me.stack.push(act);\n                        return act.shift();\n                    };\n\n                    // 文件可能还在prepare中，也有可能已经完全准备好了。\n                    if ( isPromise( next) ) {\n                        preparing = next.file;\n                        next = next[ next.pipe ? 'pipe' : 'then' ]( done );\n                        next.file = preparing;\n                        return next;\n                    }\n\n                    return done( next );\n                }\n            },\n\n\n            /**\n             * @event uploadStart\n             * @param {File} file File对象\n             * @description 某个文件开始上传前触发，一个文件只会触发一次。\n             * @for  Uploader\n             */\n            _prepareNextFile: function() {\n                var me = this,\n                    file = me.request('fetch-file'),\n                    pending = me.pending,\n                    promise;\n\n                if ( file ) {\n                    promise = me.request( 'before-send-file', file, function() {\n\n                        // 有可能文件被skip掉了。文件被skip掉后，状态坑定不是Queued.\n                        if ( file.getStatus() === Status.PROGRESS ||\n                            file.getStatus() === Status.INTERRUPT ) {\n                            return file;\n                        }\n\n                        return me._finishFile( file );\n                    });\n\n                    me.owner.trigger( 'uploadStart', file );\n                    file.setStatus( Status.PROGRESS );\n\n                    promise.file = file;\n\n                    // 如果还在pending中，则替换成文件本身。\n                    promise.done(function() {\n                        var idx = $.inArray( promise, pending );\n\n                        ~idx && pending.splice( idx, 1, file );\n                    });\n\n                    // befeore-send-file的钩子就有错误发生。\n                    promise.fail(function( reason ) {\n                        file.setStatus( Status.ERROR, reason );\n                        me.owner.trigger( 'uploadError', file, reason );\n                        me.owner.trigger( 'uploadComplete', file );\n                    });\n\n                    pending.push( promise );\n                }\n            },\n\n            // 让出位置了，可以让其他分片开始上传\n            _popBlock: function( block ) {\n                var idx = $.inArray( block, this.pool );\n\n                this.pool.splice( idx, 1 );\n                block.file.remaning--;\n                this.remaning--;\n            },\n\n            // 开始上传，可以被掉过。如果promise被reject了，则表示跳过此分片。\n            _startSend: function( block ) {\n                var me = this,\n                    file = block.file,\n                    promise;\n\n                // 有可能在 before-send-file 的 promise 期间改变了文件状态。\n                // 如：暂停，取消\n                // 我们不能中断 promise, 但是可以在 promise 完后，不做上传操作。\n                if ( file.getStatus() !== Status.PROGRESS ) {\n\n                    // 如果是中断，则还需要放回去。\n                    if (file.getStatus() === Status.INTERRUPT) {\n                        me._putback(block);\n                    }\n\n                    return;\n                }\n\n                me.pool.push( block );\n                me.remaning++;\n\n                // 如果没有分片，则直接使用原始的。\n                // 不会丢失content-type信息。\n                block.blob = block.chunks === 1 ? file.source :\n                        file.source.slice( block.start, block.end );\n\n                // hook, 每个分片发送之前可能要做些异步的事情。\n                promise = me.request( 'before-send', block, function() {\n\n                    // 有可能文件已经上传出错了，所以不需要再传输了。\n                    if ( file.getStatus() === Status.PROGRESS ) {\n                        me._doSend( block );\n                    } else {\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n\n                // 如果为fail了，则跳过此分片。\n                promise.fail(function() {\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file ).always(function() {\n                            block.percentage = 1;\n                            me._popBlock( block );\n                            me.owner.trigger( 'uploadComplete', file );\n                            Base.nextTick( me.__tick );\n                        });\n                    } else {\n                        block.percentage = 1;\n                        me.updateFileProgress( file );\n                        me._popBlock( block );\n                        Base.nextTick( me.__tick );\n                    }\n                });\n            },\n\n\n            /**\n             * @event uploadBeforeSend\n             * @param {Object} object\n             * @param {Object} data 默认的上传参数，可以扩展此对象来控制上传参数。\n             * @param {Object} headers 可以扩展此对象来控制上传头部。\n             * @description 当某个文件的分块在发送前触发，主要用来询问是否要添加附带参数，大文件在开起分片上传的前提下此事件可能会触发多次。\n             * @for  Uploader\n             */\n\n            /**\n             * @event uploadAccept\n             * @param {Object} object\n             * @param {Object} ret 服务端的返回数据，json格式，如果服务端不是json格式，从ret._raw中取数据，自行解析。\n             * @description 当某个文件上传到服务端响应后，会派送此事件来询问服务端响应是否有效。如果此事件handler返回值为`false`, 则此文件将派送`server`类型的`uploadError`事件。\n             * @for  Uploader\n             */\n\n            /**\n             * @event uploadProgress\n             * @param {File} file File对象\n             * @param {Number} percentage 上传进度\n             * @description 上传过程中触发，携带上传进度。\n             * @for  Uploader\n             */\n\n\n            /**\n             * @event uploadError\n             * @param {File} file File对象\n             * @param {String} reason 出错的code\n             * @description 当文件上传出错时触发。\n             * @for  Uploader\n             */\n\n            /**\n             * @event uploadSuccess\n             * @param {File} file File对象\n             * @param {Object} response 服务端返回的数据\n             * @description 当文件上传成功时触发。\n             * @for  Uploader\n             */\n\n            /**\n             * @event uploadComplete\n             * @param {File} [file] File对象\n             * @description 不管成功或者失败，文件上传完成时触发。\n             * @for  Uploader\n             */\n\n            // 做上传操作。\n            _doSend: function( block ) {\n                var me = this,\n                    owner = me.owner,\n                    opts = $.extend({}, me.options, block.options),\n                    file = block.file,\n                    tr = new Transport( opts ),\n                    data = $.extend({}, opts.formData ),\n                    headers = $.extend({}, opts.headers ),\n                    requestAccept, ret;\n\n                block.transport = tr;\n\n                tr.on( 'destroy', function() {\n                    delete block.transport;\n                    me._popBlock( block );\n                    Base.nextTick( me.__tick );\n                });\n\n                // 广播上传进度。以文件为单位。\n                tr.on( 'progress', function( percentage ) {\n                    block.percentage = percentage;\n                    me.updateFileProgress( file );\n                });\n\n                // 用来询问，是否返回的结果是有错误的。\n                requestAccept = function( reject ) {\n                    var fn;\n\n                    ret = tr.getResponseAsJson() || {};\n                    ret._raw = tr.getResponse();\n                    ret._headers = tr.getResponseHeaders();\n                    block.response = ret;\n                    fn = function( value ) {\n                        reject = value;\n                    };\n\n                    // 服务端响应了，不代表成功了，询问是否响应正确。\n                    if ( !owner.trigger( 'uploadAccept', block, ret, fn ) ) {\n                        reject = reject || 'server';\n                    }\n\n                    return reject;\n                };\n\n                // 尝试重试，然后广播文件上传出错。\n                tr.on( 'error', function( type, flag ) {\n                    block.retried = block.retried || 0;\n\n                    // 自动重试\n                    if ( block.chunks > 1 && ~'http,abort'.indexOf( type ) &&\n                            block.retried < opts.chunkRetry ) {\n\n                        block.retried++;\n                        tr.send();\n\n                    } else {\n\n                        // http status 500 ~ 600\n                        if ( !flag && type === 'server' ) {\n                            type = requestAccept( type );\n                        }\n\n                        file.setStatus( Status.ERROR, type );\n                        owner.trigger( 'uploadError', file, type );\n                        owner.trigger( 'uploadComplete', file );\n                    }\n                });\n\n                // 上传成功\n                tr.on( 'load', function() {\n                    var reason;\n\n                    // 如果非预期，转向上传出错。\n                    if ( (reason = requestAccept()) ) {\n                        tr.trigger( 'error', reason, true );\n                        return;\n                    }\n\n                    // 全部上传完成。\n                    if ( file.remaning === 1 ) {\n                        me._finishFile( file, ret );\n                    } else {\n                        tr.destroy();\n                    }\n                });\n\n                // 配置默认的上传字段。\n                data = $.extend( data, {\n                    id: file.id,\n                    name: file.name,\n                    type: file.type,\n                    lastModifiedDate: file.lastModifiedDate,\n                    size: file.size\n                });\n\n                block.chunks > 1 && $.extend( data, {\n                    chunks: block.chunks,\n                    chunk: block.chunk\n                });\n\n                // 在发送之间可以添加字段什么的。。。\n                // 如果默认的字段不够使用，可以通过监听此事件来扩展\n                owner.trigger( 'uploadBeforeSend', block, data, headers );\n\n                // 开始发送。\n                tr.appendBlob( opts.fileVal, block.blob, file.name );\n                tr.append( data );\n                tr.setRequestHeader( headers );\n                tr.send();\n            },\n\n            // 完成上传。\n            _finishFile: function( file, ret, hds ) {\n                var owner = this.owner;\n\n                return owner\n                        .request( 'after-send-file', arguments, function() {\n                            file.setStatus( Status.COMPLETE );\n                            owner.trigger( 'uploadSuccess', file, ret, hds );\n                        })\n                        .fail(function( reason ) {\n\n                            // 如果外部已经标记为invalid什么的，不再改状态。\n                            if ( file.getStatus() === Status.PROGRESS ) {\n                                file.setStatus( Status.ERROR, reason );\n                            }\n\n                            owner.trigger( 'uploadError', file, reason );\n                        })\n                        .always(function() {\n                            owner.trigger( 'uploadComplete', file );\n                        });\n            },\n\n            updateFileProgress: function(file) {\n                var totalPercent = 0,\n                    uploaded = 0;\n\n                if (!file.blocks) {\n                    return;\n                }\n\n                $.each( file.blocks, function( _, v ) {\n                    uploaded += (v.percentage || 0) * (v.end - v.start);\n                });\n\n                totalPercent = uploaded / file.size;\n                this.owner.trigger( 'uploadProgress', file, totalPercent || 0 );\n            }\n\n        });\n    });\n\n    /**\n     * @fileOverview 各种验证，包括文件总大小是否超出、单文件是否超出和文件是否重复。\n     */\n\n    define('widgets/validator',[\n        'base',\n        'uploader',\n        'file',\n        'widgets/widget'\n    ], function( Base, Uploader, WUFile ) {\n\n        var $ = Base.$,\n            validators = {},\n            api;\n\n        /**\n         * @event error\n         * @param {String} type 错误类型。\n         * @description 当validate不通过时，会以派送错误事件的形式通知调用者。通过`upload.on('error', handler)`可以捕获到此类错误，目前有以下错误会在特定的情况下派送错来。\n         *\n         * * `Q_EXCEED_NUM_LIMIT` 在设置了`fileNumLimit`且尝试给`uploader`添加的文件数量超出这个值时派送。\n         * * `Q_EXCEED_SIZE_LIMIT` 在设置了`Q_EXCEED_SIZE_LIMIT`且尝试给`uploader`添加的文件总大小超出这个值时派送。\n         * * `Q_TYPE_DENIED` 当文件类型不满足时触发。。\n         * @for  Uploader\n         */\n\n        // 暴露给外面的api\n        api = {\n\n            // 添加验证器\n            addValidator: function( type, cb ) {\n                validators[ type ] = cb;\n            },\n\n            // 移除验证器\n            removeValidator: function( type ) {\n                delete validators[ type ];\n            }\n        };\n\n        // 在Uploader初始化的时候启动Validators的初始化\n        Uploader.register({\n            name: 'validator',\n\n            init: function() {\n                var me = this;\n                Base.nextTick(function() {\n                    $.each( validators, function() {\n                        this.call( me.owner );\n                    });\n                });\n            }\n        });\n\n        /**\n         * @property {int} [fileNumLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总数量, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileNumLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileNumLimit, 10 ),\n                flag = true;\n\n            if ( !max ) {\n                return;\n            }\n\n            uploader.on( 'beforeFileQueued', function( file ) {\n                    // 增加beforeFileQueuedCheckfileNumLimit验证,主要为了再次加载时(已存在历史文件)验证数量是否超过设置项\n                if (!this.trigger('beforeFileQueuedCheckfileNumLimit', file,count)) {\n                    return false;\n                }\n                if ( count >= max && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_NUM_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n\n                return count >= max ? false : true;\n            });\n\n            uploader.on( 'fileQueued', function() {\n                count++;\n            });\n\n            uploader.on( 'fileDequeued', function() {\n                count--;\n            });\n\n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n\n\n        /**\n         * @property {int} [fileSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证文件总大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                count = 0,\n                max = parseInt( opts.fileSizeLimit, 10 ),\n                flag = true;\n\n            if ( !max ) {\n                return;\n            }\n\n            uploader.on( 'beforeFileQueued', function( file ) {\n                var invalid = count + file.size > max;\n\n                if ( invalid && flag ) {\n                    flag = false;\n                    this.trigger( 'error', 'Q_EXCEED_SIZE_LIMIT', max, file );\n                    setTimeout(function() {\n                        flag = true;\n                    }, 1 );\n                }\n\n                return invalid ? false : true;\n            });\n\n            uploader.on( 'fileQueued', function( file ) {\n                count += file.size;\n            });\n\n            uploader.on( 'fileDequeued', function( file ) {\n                count -= file.size;\n            });\n\n            uploader.on( 'reset', function() {\n                count = 0;\n            });\n        });\n\n        /**\n         * @property {int} [fileSingleSizeLimit=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 验证单个文件大小是否超出限制, 超出则不允许加入队列。\n         */\n        api.addValidator( 'fileSingleSizeLimit', function() {\n            var uploader = this,\n                opts = uploader.options,\n                max = opts.fileSingleSizeLimit;\n\n            if ( !max ) {\n                return;\n            }\n\n            uploader.on( 'beforeFileQueued', function( file ) {\n\n                if ( file.size > max ) {\n                    file.setStatus( WUFile.Status.INVALID, 'exceed_size' );\n                    this.trigger( 'error', 'F_EXCEED_SIZE', max, file );\n                    return false;\n                }\n\n            });\n\n        });\n\n        /**\n         * @property {Boolean} [duplicate=undefined]\n         * @namespace options\n         * @for Uploader\n         * @description 去重， 根据文件名字、文件大小和最后修改时间来生成hash Key.\n         */\n        api.addValidator( 'duplicate', function() {\n            var uploader = this,\n                opts = uploader.options,\n                mapping = {};\n\n            if ( opts.duplicate ) {\n                return;\n            }\n\n            function hashString( str ) {\n                var hash = 0,\n                    i = 0,\n                    len = str.length,\n                    _char;\n\n                for ( ; i < len; i++ ) {\n                    _char = str.charCodeAt( i );\n                    hash = _char + (hash << 6) + (hash << 16) - hash;\n                }\n\n                return hash;\n            }\n\n            uploader.on( 'beforeFileQueued', function( file ) {\n                var hash = file.__hash || (file.__hash = hashString( file.name +\n                        file.size + file.lastModifiedDate ));\n\n                // 已经重复了\n                if ( mapping[ hash ] ) {\n                    this.trigger( 'error', 'F_DUPLICATE', file );\n                    return false;\n                }\n            });\n\n            uploader.on( 'fileQueued', function( file ) {\n                var hash = file.__hash;\n\n                hash && (mapping[ hash ] = true);\n            });\n\n            uploader.on( 'fileDequeued', function( file ) {\n                var hash = file.__hash;\n\n                hash && (delete mapping[ hash ]);\n            });\n\n            uploader.on( 'reset', function() {\n                mapping = {};\n            });\n        });\n\n        return api;\n    });\n\n    /**\n     * @fileOverview Md5\n     */\n    define('lib/md5',[\n        'runtime/client',\n        'mediator'\n    ], function( RuntimeClient, Mediator ) {\n\n        function Md5() {\n            RuntimeClient.call( this, 'Md5' );\n        }\n\n        // 让 Md5 具备事件功能。\n        Mediator.installTo( Md5.prototype );\n\n        Md5.prototype.loadFromBlob = function( blob ) {\n            var me = this;\n\n            if ( me.getRuid() ) {\n                me.disconnectRuntime();\n            }\n\n            // 连接到blob归属的同一个runtime.\n            me.connectRuntime( blob.ruid, function() {\n                me.exec('init');\n                me.exec( 'loadFromBlob', blob );\n            });\n        };\n\n        Md5.prototype.getResult = function() {\n            return this.exec('getResult');\n        };\n\n        return Md5;\n    });\n    /**\n     * @fileOverview 图片操作, 负责预览图片和上传前压缩图片\n     */\n    define('widgets/md5',[\n        'base',\n        'uploader',\n        'lib/md5',\n        'lib/blob',\n        'widgets/widget'\n    ], function( Base, Uploader, Md5, Blob ) {\n\n        return Uploader.register({\n            name: 'md5',\n\n\n            /**\n             * 计算文件 md5 值，返回一个 promise 对象，可以监听 progress 进度。\n             *\n             *\n             * @method md5File\n             * @grammar md5File( file[, start[, end]] ) => promise\n             * @for Uploader\n             * @example\n             *\n             * uploader.on( 'fileQueued', function( file ) {\n             *     var $li = ...;\n             *\n             *     uploader.md5File( file )\n             *\n             *         // 及时显示进度\n             *         .progress(function(percentage) {\n             *             console.log('Percentage:', percentage);\n             *         })\n             *\n             *         // 完成\n             *         .then(function(val) {\n             *             console.log('md5 result:', val);\n             *         });\n             *\n             * });\n             */\n            md5File: function( file, start, end ) {\n                var md5 = new Md5(),\n                    deferred = Base.Deferred(),\n                    blob = (file instanceof Blob) ? file :\n                        this.request( 'get-file', file ).source;\n\n                md5.on( 'progress load', function( e ) {\n                    e = e || {};\n                    deferred.notify( e.total ? e.loaded / e.total : 1 );\n                });\n\n                md5.on( 'complete', function() {\n                    deferred.resolve( md5.getResult() );\n                });\n\n                md5.on( 'error', function( reason ) {\n                    deferred.reject( reason );\n                });\n\n                if ( arguments.length > 1 ) {\n                    start = start || 0;\n                    end = end || 0;\n                    start < 0 && (start = blob.size + start);\n                    end < 0 && (end = blob.size + end);\n                    end = Math.min( end, blob.size );\n                    blob = blob.slice( start, end );\n                }\n\n                md5.loadFromBlob( blob );\n\n                return deferred.promise();\n            }\n        });\n    });\n    /**\n     * @fileOverview Runtime管理器，负责Runtime的选择, 连接\n     */\n    define('runtime/compbase',[],function() {\n\n        function CompBase( owner, runtime ) {\n\n            this.owner = owner;\n            this.options = owner.options;\n\n            this.getRuntime = function() {\n                return runtime;\n            };\n\n            this.getRuid = function() {\n                return runtime.uid;\n            };\n\n            this.trigger = function() {\n                return owner.trigger.apply( owner, arguments );\n            };\n        }\n\n        return CompBase;\n    });\n    /**\n     * @fileOverview Html5Runtime\n     */\n    define('runtime/html5/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n\n        var type = 'html5',\n            components = {};\n\n        function Html5Runtime() {\n            var pool = {},\n                me = this,\n                destroy = this.destroy;\n\n            Runtime.apply( me, arguments );\n            me.type = type;\n\n\n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n\n                if ( components[ comp ] ) {\n                    instance = pool[ uid ] = pool[ uid ] ||\n                            new components[ comp ]( client, me );\n\n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n            };\n\n            me.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n        }\n\n        Base.inherits( Runtime, {\n            constructor: Html5Runtime,\n\n            // 不需要连接其他程序，直接执行callback\n            init: function() {\n                var me = this;\n                setTimeout(function() {\n                    me.trigger('ready');\n                }, 1 );\n            }\n\n        });\n\n        // 注册Components\n        Html5Runtime.register = function( name, component ) {\n            var klass = components[ name ] = Base.inherits( CompBase, component );\n            return klass;\n        };\n\n        // 注册html5运行时。\n        // 只有在支持的前提下注册。\n        if ( window.Blob && window.FileReader && window.DataView ) {\n            Runtime.addRuntime( type, Html5Runtime );\n        }\n\n        return Html5Runtime;\n    });\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/html5/blob',[\n        'runtime/html5/runtime',\n        'lib/blob'\n    ], function( Html5Runtime, Blob ) {\n\n        return Html5Runtime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.owner.source,\n                    slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n\n                blob = slice.call( blob, start, end );\n\n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    });\n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/dnd',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n\n        var $ = Base.$,\n            prefix = 'webuploader-dnd-';\n\n        return Html5Runtime.register( 'DragAndDrop', {\n            init: function() {\n                var elem = this.elem = this.options.container;\n\n                this.dragEnterHandler = Base.bindFn( this._dragEnterHandler, this );\n                this.dragOverHandler = Base.bindFn( this._dragOverHandler, this );\n                this.dragLeaveHandler = Base.bindFn( this._dragLeaveHandler, this );\n                this.dropHandler = Base.bindFn( this._dropHandler, this );\n                this.dndOver = false;\n\n                elem.on( 'dragenter', this.dragEnterHandler );\n                elem.on( 'dragover', this.dragOverHandler );\n                elem.on( 'dragleave', this.dragLeaveHandler );\n                elem.on( 'drop', this.dropHandler );\n\n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).on( 'dragover', this.dragOverHandler );\n                    $( document ).on( 'drop', this.dropHandler );\n                }\n            },\n\n            _dragEnterHandler: function( e ) {\n                var me = this,\n                    denied = me._denied || false,\n                    items;\n\n                e = e.originalEvent || e;\n\n                if ( !me.dndOver ) {\n                    me.dndOver = true;\n\n                    // 注意只有 chrome 支持。\n                    items = e.dataTransfer.items;\n\n                    if ( items && items.length ) {\n                        me._denied = denied = !me.trigger( 'accept', items );\n                    }\n\n                    me.elem.addClass( prefix + 'over' );\n                    me.elem[ denied ? 'addClass' :\n                            'removeClass' ]( prefix + 'denied' );\n                }\n\n                e.dataTransfer.dropEffect = denied ? 'none' : 'copy';\n\n                return false;\n            },\n\n            _dragOverHandler: function( e ) {\n                // 只处理框内的。\n                var parentElem = this.elem.parent().get( 0 );\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n\n                clearTimeout( this._leaveTimer );\n                this._dragEnterHandler.call( this, e );\n\n                return false;\n            },\n\n            _dragLeaveHandler: function() {\n                var me = this,\n                    handler;\n\n                handler = function() {\n                    me.dndOver = false;\n                    me.elem.removeClass( prefix + 'over ' + prefix + 'denied' );\n                };\n\n                clearTimeout( me._leaveTimer );\n                me._leaveTimer = setTimeout( handler, 100 );\n                return false;\n            },\n\n            _dropHandler: function( e ) {\n                var me = this,\n                    ruid = me.getRuid(),\n                    parentElem = me.elem.parent().get( 0 ),\n                    dataTransfer, data;\n\n                // 只处理框内的。\n                if ( parentElem && !$.contains( parentElem, e.currentTarget ) ) {\n                    return false;\n                }\n\n                e = e.originalEvent || e;\n                dataTransfer = e.dataTransfer;\n\n                // 如果是页面内拖拽，还不能处理，不阻止事件。\n                // 此处 ie11 下会报参数错误，\n                try {\n                    data = dataTransfer.getData('text/html');\n                } catch( err ) {\n                }\n\n                me.dndOver = false;\n                me.elem.removeClass( prefix + 'over' );\n\n                if ( !dataTransfer || data ) {\n                    return;\n                }\n\n                me._getTansferFiles( dataTransfer, function( results ) {\n                    me.trigger( 'drop', $.map( results, function( file ) {\n                        return new File( ruid, file );\n                    }) );\n                });\n\n                return false;\n            },\n\n            // 如果传入 callback 则去查看文件夹，否则只管当前文件夹。\n            _getTansferFiles: function( dataTransfer, callback ) {\n                var results  = [],\n                    promises = [],\n                    items, files, file, item, i, len, canAccessFolder;\n\n                items = dataTransfer.items;\n                files = dataTransfer.files;\n\n                canAccessFolder = !!(items && items[ 0 ].webkitGetAsEntry);\n\n                for ( i = 0, len = files.length; i < len; i++ ) {\n                    file = files[ i ];\n                    item = items && items[ i ];\n\n                    if ( canAccessFolder && item.webkitGetAsEntry().isDirectory ) {\n\n                        promises.push( this._traverseDirectoryTree(\n                                item.webkitGetAsEntry(), results ) );\n                    } else {\n                        results.push( file );\n                    }\n                }\n\n                Base.when.apply( Base, promises ).done(function() {\n\n                    if ( !results.length ) {\n                        return;\n                    }\n\n                    callback( results );\n                });\n            },\n\n            _traverseDirectoryTree: function( entry, results ) {\n                var deferred = Base.Deferred(),\n                    me = this;\n\n                if ( entry.isFile ) {\n                    entry.file(function( file ) {\n                        results.push( file );\n                        deferred.resolve();\n                    });\n                } else if ( entry.isDirectory ) {\n                    entry.createReader().readEntries(function( entries ) {\n                        var len = entries.length,\n                            promises = [],\n                            arr = [],    // 为了保证顺序。\n                            i;\n\n                        for ( i = 0; i < len; i++ ) {\n                            promises.push( me._traverseDirectoryTree(\n                                    entries[ i ], arr ) );\n                        }\n\n                        Base.when.apply( Base, promises ).then(function() {\n                            results.push.apply( results, arr );\n                            deferred.resolve();\n                        }, deferred.reject );\n                    });\n                }\n\n                return deferred.promise();\n            },\n\n            destroy: function() {\n                var elem = this.elem;\n\n                // 还没 init 就调用 destroy\n                if (!elem) {\n                    return;\n                }\n\n                elem.off( 'dragenter', this.dragEnterHandler );\n                elem.off( 'dragover', this.dragOverHandler );\n                elem.off( 'dragleave', this.dragLeaveHandler );\n                elem.off( 'drop', this.dropHandler );\n\n                if ( this.options.disableGlobalDnd ) {\n                    $( document ).off( 'dragover', this.dragOverHandler );\n                    $( document ).off( 'drop', this.dropHandler );\n                }\n            }\n        });\n    });\n\n    /**\n     * @fileOverview FilePaste\n     */\n    define('runtime/html5/filepaste',[\n        'base',\n        'runtime/html5/runtime',\n        'lib/file'\n    ], function( Base, Html5Runtime, File ) {\n\n        return Html5Runtime.register( 'FilePaste', {\n            init: function() {\n                var opts = this.options,\n                    elem = this.elem = opts.container,\n                    accept = '.*',\n                    arr, i, len, item;\n\n                // accetp的mimeTypes中生成匹配正则。\n                if ( opts.accept ) {\n                    arr = [];\n\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        item = opts.accept[ i ].mimeTypes;\n                        item && arr.push( item );\n                    }\n\n                    if ( arr.length ) {\n                        accept = arr.join(',');\n                        accept = accept.replace( /,/g, '|' ).replace( /\\*/g, '.*' );\n                    }\n                }\n                this.accept = accept = new RegExp( accept, 'i' );\n                this.hander = Base.bindFn( this._pasteHander, this );\n                elem.on( 'paste', this.hander );\n            },\n\n            _pasteHander: function( e ) {\n                var allowed = [],\n                    ruid = this.getRuid(),\n                    items, item, blob, i, len;\n\n                e = e.originalEvent || e;\n                items = e.clipboardData.items;\n\n                for ( i = 0, len = items.length; i < len; i++ ) {\n                    item = items[ i ];\n\n                    if ( item.kind !== 'file' || !(blob = item.getAsFile()) ) {\n                        continue;\n                    }\n\n                    allowed.push( new File( ruid, blob ) );\n                }\n\n                if ( allowed.length ) {\n                    // 不阻止非文件粘贴（文字粘贴）的事件冒泡\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.trigger( 'paste', allowed );\n                }\n            },\n\n            destroy: function() {\n                this.elem.off( 'paste', this.hander );\n            }\n        });\n    });\n\n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/html5/filepicker',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n\n        var $ = Base.$;\n\n        return Html5Runtime.register( 'FilePicker', {\n            init: function() {\n                var container = this.getRuntime().getContainer(),\n                    me = this,\n                    owner = me.owner,\n                    opts = me.options,\n                    label = this.label = $( document.createElement('label') ),\n                    input =  this.input = $( document.createElement('input') ),\n                    arr, i, len, mouseHandler, changeHandler;\n\n                input.attr( 'type', 'file' );\n                input.attr( 'capture', 'camera');\n                input.attr( 'name', opts.name );\n                input.addClass('webuploader-element-invisible');\n\n                label.on( 'click', function(e) {\n                    input.trigger('click');\n                    e.stopPropagation();\n                    owner.trigger('dialogopen');\n                });\n\n                label.css({\n                    opacity: 0,\n                    width: '100%',\n                    height: '100%',\n                    display: 'block',\n                    cursor: 'pointer',\n                    background: '#ffffff'\n                });\n\n                if ( opts.multiple ) {\n                    input.attr( 'multiple', 'multiple' );\n                }\n\n                // @todo Firefox不支持单独指定后缀\n                if ( opts.accept && opts.accept.length > 0 ) {\n                    arr = [];\n\n                    for ( i = 0, len = opts.accept.length; i < len; i++ ) {\n                        arr.push( opts.accept[ i ].mimeTypes );\n                    }\n\n                    input.attr( 'accept', arr.join(',') );\n                }\n\n                container.append( input );\n                container.append( label );\n\n                mouseHandler = function( e ) {\n                    owner.trigger( e.type );\n                };\n\n                changeHandler = function( e ) {\n                    var clone;\n\n                    // 解决chrome 56 第二次打开文件选择器，然后点击取消，依然会触发change事件的问题\n                    if (e.target.files.length === 0){\n                        return false;\n                    }\n\n                    // 第一次上传图片后，第二次再点击弹出文件选择器窗，等待\n                    me.files = e.target.files;\n\n\n                    // reset input\n                    clone = this.cloneNode( true );\n                    clone.value = null;\n                    this.parentNode.replaceChild( clone, this );\n\n                    input.off();\n                    input = $( clone ).on( 'change', changeHandler )\n                            .on( 'mouseenter mouseleave', mouseHandler );\n\n                    owner.trigger('change');\n                }\n                input.on( 'change', changeHandler);\n                label.on( 'mouseenter mouseleave', mouseHandler );\n\n            },\n\n\n            getFiles: function() {\n                return this.files;\n            },\n\n            destroy: function() {\n                this.input.off();\n                this.label.off();\n            }\n        });\n    });\n\n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/util',[\n        'base'\n    ], function( Base ) {\n\n        var urlAPI = window.createObjectURL && window ||\n                window.URL && URL.revokeObjectURL && URL ||\n                window.webkitURL,\n            createObjectURL = Base.noop,\n            revokeObjectURL = createObjectURL;\n\n        if ( urlAPI ) {\n\n            // 更安全的方式调用，比如android里面就能把context改成其他的对象。\n            createObjectURL = function() {\n                return urlAPI.createObjectURL.apply( urlAPI, arguments );\n            };\n\n            revokeObjectURL = function() {\n                return urlAPI.revokeObjectURL.apply( urlAPI, arguments );\n            };\n        }\n\n        return {\n            createObjectURL: createObjectURL,\n            revokeObjectURL: revokeObjectURL,\n\n            dataURL2Blob: function( dataURI ) {\n                var byteStr, intArray, ab, i, mimetype, parts;\n\n                parts = dataURI.split(',');\n\n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n\n                ab = new ArrayBuffer( byteStr.length );\n                intArray = new Uint8Array( ab );\n\n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n\n                mimetype = parts[ 0 ].split(':')[ 1 ].split(';')[ 0 ];\n\n                return this.arrayBufferToBlob( ab, mimetype );\n            },\n\n            dataURL2ArrayBuffer: function( dataURI ) {\n                var byteStr, intArray, i, parts;\n\n                parts = dataURI.split(',');\n\n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    byteStr = atob( parts[ 1 ] );\n                } else {\n                    byteStr = decodeURIComponent( parts[ 1 ] );\n                }\n\n                intArray = new Uint8Array( byteStr.length );\n\n                for ( i = 0; i < byteStr.length; i++ ) {\n                    intArray[ i ] = byteStr.charCodeAt( i );\n                }\n\n                return intArray.buffer;\n            },\n\n            arrayBufferToBlob: function( buffer, type ) {\n                var builder = window.BlobBuilder || window.WebKitBlobBuilder,\n                    bb;\n\n                // android不支持直接new Blob, 只能借助blobbuilder.\n                if ( builder ) {\n                    bb = new builder();\n                    bb.append( buffer );\n                    return bb.getBlob( type );\n                }\n\n                return new Blob([ buffer ], type ? { type: type } : {} );\n            },\n\n            // 抽出来主要是为了解决android下面canvas.toDataUrl不支持jpeg.\n            // 你得到的结果是png.\n            canvasToDataUrl: function( canvas, type, quality ) {\n                return canvas.toDataURL( type, quality / 100 );\n            },\n\n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            parseMeta: function( blob, callback ) {\n                callback( false, {});\n            },\n\n            // imagemeat会复写这个方法，如果用户选择加载那个文件了的话。\n            updateImageHead: function( data ) {\n                return data;\n            }\n        };\n    });\n    /**\n     * Terms:\n     *\n     * Uint8Array, FileReader, BlobBuilder, atob, ArrayBuffer\n     * @fileOverview Image控件\n     */\n    define('runtime/html5/imagemeta',[\n        'runtime/html5/util'\n    ], function( Util ) {\n\n        var api;\n\n        api = {\n            parsers: {\n                0xffe1: []\n            },\n\n            maxMetaDataSize: 262144,\n\n            parse: function( blob, cb ) {\n                var me = this,\n                    fr = new FileReader();\n\n                fr.onload = function() {\n                    cb( false, me._parse( this.result ) );\n                    fr = fr.onload = fr.onerror = null;\n                };\n\n                fr.onerror = function( e ) {\n                    cb( e.message );\n                    fr = fr.onload = fr.onerror = null;\n                };\n\n                blob = blob.slice( 0, me.maxMetaDataSize );\n                fr.readAsArrayBuffer( blob.getSource() );\n            },\n\n            _parse: function( buffer, noParse ) {\n                if ( buffer.byteLength < 6 ) {\n                    return;\n                }\n\n                var dataview = new DataView( buffer ),\n                    offset = 2,\n                    maxOffset = dataview.byteLength - 4,\n                    headLength = offset,\n                    ret = {},\n                    markerBytes, markerLength, parsers, i;\n\n                if ( dataview.getUint16( 0 ) === 0xffd8 ) {\n\n                    while ( offset < maxOffset ) {\n                        markerBytes = dataview.getUint16( offset );\n\n                        if ( markerBytes >= 0xffe0 && markerBytes <= 0xffef ||\n                                markerBytes === 0xfffe ) {\n\n                            markerLength = dataview.getUint16( offset + 2 ) + 2;\n\n                            if ( offset + markerLength > dataview.byteLength ) {\n                                break;\n                            }\n\n                            parsers = api.parsers[ markerBytes ];\n\n                            if ( !noParse && parsers ) {\n                                for ( i = 0; i < parsers.length; i += 1 ) {\n                                    parsers[ i ].call( api, dataview, offset,\n                                            markerLength, ret );\n                                }\n                            }\n\n                            offset += markerLength;\n                            headLength = offset;\n                        } else {\n                            break;\n                        }\n                    }\n\n                    if ( headLength > 6 ) {\n                        if ( buffer.slice ) {\n                            ret.imageHead = buffer.slice( 2, headLength );\n                        } else {\n                            // Workaround for IE10, which does not yet\n                            // support ArrayBuffer.slice:\n                            ret.imageHead = new Uint8Array( buffer )\n                                    .subarray( 2, headLength );\n                        }\n                    }\n                }\n\n                return ret;\n            },\n\n            updateImageHead: function( buffer, head ) {\n                var data = this._parse( buffer, true ),\n                    buf1, buf2, bodyoffset;\n\n\n                bodyoffset = 2;\n                if ( data.imageHead ) {\n                    bodyoffset = 2 + data.imageHead.byteLength;\n                }\n\n                if ( buffer.slice ) {\n                    buf2 = buffer.slice( bodyoffset );\n                } else {\n                    buf2 = new Uint8Array( buffer ).subarray( bodyoffset );\n                }\n\n                buf1 = new Uint8Array( head.byteLength + 2 + buf2.byteLength );\n\n                buf1[ 0 ] = 0xFF;\n                buf1[ 1 ] = 0xD8;\n                buf1.set( new Uint8Array( head ), 2 );\n                buf1.set( new Uint8Array( buf2 ), head.byteLength + 2 );\n\n                return buf1.buffer;\n            }\n        };\n\n        Util.parseMeta = function() {\n            return api.parse.apply( api, arguments );\n        };\n\n        Util.updateImageHead = function() {\n            return api.updateImageHead.apply( api, arguments );\n        };\n\n        return api;\n    });\n    /**\n     * 代码来自于：https://github.com/blueimp/JavaScript-Load-Image\n     * 暂时项目中只用了orientation.\n     *\n     * 去除了 Exif Sub IFD Pointer, GPS Info IFD Pointer, Exif Thumbnail.\n     * @fileOverview EXIF解析\n     */\n\n    // Sample\n    // ====================================\n    // Make : Apple\n    // Model : iPhone 4S\n    // Orientation : 1\n    // XResolution : 72 [72/1]\n    // YResolution : 72 [72/1]\n    // ResolutionUnit : 2\n    // Software : QuickTime 7.7.1\n    // DateTime : 2013:09:01 22:53:55\n    // ExifIFDPointer : 190\n    // ExposureTime : 0.058823529411764705 [1/17]\n    // FNumber : 2.4 [12/5]\n    // ExposureProgram : Normal program\n    // ISOSpeedRatings : 800\n    // ExifVersion : 0220\n    // DateTimeOriginal : 2013:09:01 22:52:51\n    // DateTimeDigitized : 2013:09:01 22:52:51\n    // ComponentsConfiguration : YCbCr\n    // ShutterSpeedValue : 4.058893515764426\n    // ApertureValue : 2.5260688216892597 [4845/1918]\n    // BrightnessValue : -0.3126686601998395\n    // MeteringMode : Pattern\n    // Flash : Flash did not fire, compulsory flash mode\n    // FocalLength : 4.28 [107/25]\n    // SubjectArea : [4 values]\n    // FlashpixVersion : 0100\n    // ColorSpace : 1\n    // PixelXDimension : 2448\n    // PixelYDimension : 3264\n    // SensingMethod : One-chip color area sensor\n    // ExposureMode : 0\n    // WhiteBalance : Auto white balance\n    // FocalLengthIn35mmFilm : 35\n    // SceneCaptureType : Standard\n    define('runtime/html5/imagemeta/exif',[\n        'base',\n        'runtime/html5/imagemeta'\n    ], function( Base, ImageMeta ) {\n\n        var EXIF = {};\n\n        EXIF.ExifMap = function() {\n            return this;\n        };\n\n        EXIF.ExifMap.prototype.map = {\n            'Orientation': 0x0112\n        };\n\n        EXIF.ExifMap.prototype.get = function( id ) {\n            return this[ id ] || this[ this.map[ id ] ];\n        };\n\n        EXIF.exifTagTypes = {\n            // byte, 8-bit unsigned int:\n            1: {\n                getValue: function( dataView, dataOffset ) {\n                    return dataView.getUint8( dataOffset );\n                },\n                size: 1\n            },\n\n            // ascii, 8-bit byte:\n            2: {\n                getValue: function( dataView, dataOffset ) {\n                    return String.fromCharCode( dataView.getUint8( dataOffset ) );\n                },\n                size: 1,\n                ascii: true\n            },\n\n            // short, 16 bit int:\n            3: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint16( dataOffset, littleEndian );\n                },\n                size: 2\n            },\n\n            // long, 32 bit int:\n            4: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n\n            // rational = two long values,\n            // first is numerator, second is denominator:\n            5: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getUint32( dataOffset, littleEndian ) /\n                        dataView.getUint32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            },\n\n            // slong, 32 bit signed int:\n            9: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian );\n                },\n                size: 4\n            },\n\n            // srational, two slongs, first is numerator, second is denominator:\n            10: {\n                getValue: function( dataView, dataOffset, littleEndian ) {\n                    return dataView.getInt32( dataOffset, littleEndian ) /\n                        dataView.getInt32( dataOffset + 4, littleEndian );\n                },\n                size: 8\n            }\n        };\n\n        // undefined, 8-bit byte, value depending on field:\n        EXIF.exifTagTypes[ 7 ] = EXIF.exifTagTypes[ 1 ];\n\n        EXIF.getExifValue = function( dataView, tiffOffset, offset, type, length,\n                littleEndian ) {\n\n            var tagType = EXIF.exifTagTypes[ type ],\n                tagSize, dataOffset, values, i, str, c;\n\n            if ( !tagType ) {\n                Base.log('Invalid Exif data: Invalid tag type.');\n                return;\n            }\n\n            tagSize = tagType.size * length;\n\n            // Determine if the value is contained in the dataOffset bytes,\n            // or if the value at the dataOffset is a pointer to the actual data:\n            dataOffset = tagSize > 4 ? tiffOffset + dataView.getUint32( offset + 8,\n                    littleEndian ) : (offset + 8);\n\n            if ( dataOffset + tagSize > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid data offset.');\n                return;\n            }\n\n            if ( length === 1 ) {\n                return tagType.getValue( dataView, dataOffset, littleEndian );\n            }\n\n            values = [];\n\n            for ( i = 0; i < length; i += 1 ) {\n                values[ i ] = tagType.getValue( dataView,\n                        dataOffset + i * tagType.size, littleEndian );\n            }\n\n            if ( tagType.ascii ) {\n                str = '';\n\n                // Concatenate the chars:\n                for ( i = 0; i < values.length; i += 1 ) {\n                    c = values[ i ];\n\n                    // Ignore the terminating NULL byte(s):\n                    if ( c === '\\u0000' ) {\n                        break;\n                    }\n                    str += c;\n                }\n\n                return str;\n            }\n            return values;\n        };\n\n        EXIF.parseExifTag = function( dataView, tiffOffset, offset, littleEndian,\n                data ) {\n\n            var tag = dataView.getUint16( offset, littleEndian );\n            data.exif[ tag ] = EXIF.getExifValue( dataView, tiffOffset, offset,\n                    dataView.getUint16( offset + 2, littleEndian ),    // tag type\n                    dataView.getUint32( offset + 4, littleEndian ),    // tag length\n                    littleEndian );\n        };\n\n        EXIF.parseExifTags = function( dataView, tiffOffset, dirOffset,\n                littleEndian, data ) {\n\n            var tagsNumber, dirEndOffset, i;\n\n            if ( dirOffset + 6 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory offset.');\n                return;\n            }\n\n            tagsNumber = dataView.getUint16( dirOffset, littleEndian );\n            dirEndOffset = dirOffset + 2 + 12 * tagsNumber;\n\n            if ( dirEndOffset + 4 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid directory size.');\n                return;\n            }\n\n            for ( i = 0; i < tagsNumber; i += 1 ) {\n                this.parseExifTag( dataView, tiffOffset,\n                        dirOffset + 2 + 12 * i,    // tag offset\n                        littleEndian, data );\n            }\n\n            // Return the offset to the next directory:\n            return dataView.getUint32( dirEndOffset, littleEndian );\n        };\n\n        // EXIF.getExifThumbnail = function(dataView, offset, length) {\n        //     var hexData,\n        //         i,\n        //         b;\n        //     if (!length || offset + length > dataView.byteLength) {\n        //         Base.log('Invalid Exif data: Invalid thumbnail data.');\n        //         return;\n        //     }\n        //     hexData = [];\n        //     for (i = 0; i < length; i += 1) {\n        //         b = dataView.getUint8(offset + i);\n        //         hexData.push((b < 16 ? '0' : '') + b.toString(16));\n        //     }\n        //     return 'data:image/jpeg,%' + hexData.join('%');\n        // };\n\n        EXIF.parseExifData = function( dataView, offset, length, data ) {\n\n            var tiffOffset = offset + 10,\n                littleEndian, dirOffset;\n\n            // Check for the ASCII code for \"Exif\" (0x45786966):\n            if ( dataView.getUint32( offset + 4 ) !== 0x45786966 ) {\n                // No Exif data, might be XMP data instead\n                return;\n            }\n            if ( tiffOffset + 8 > dataView.byteLength ) {\n                Base.log('Invalid Exif data: Invalid segment size.');\n                return;\n            }\n\n            // Check for the two null bytes:\n            if ( dataView.getUint16( offset + 8 ) !== 0x0000 ) {\n                Base.log('Invalid Exif data: Missing byte alignment offset.');\n                return;\n            }\n\n            // Check the byte alignment:\n            switch ( dataView.getUint16( tiffOffset ) ) {\n                case 0x4949:\n                    littleEndian = true;\n                    break;\n\n                case 0x4D4D:\n                    littleEndian = false;\n                    break;\n\n                default:\n                    Base.log('Invalid Exif data: Invalid byte alignment marker.');\n                    return;\n            }\n\n            // Check for the TIFF tag marker (0x002A):\n            if ( dataView.getUint16( tiffOffset + 2, littleEndian ) !== 0x002A ) {\n                Base.log('Invalid Exif data: Missing TIFF marker.');\n                return;\n            }\n\n            // Retrieve the directory offset bytes, usually 0x00000008 or 8 decimal:\n            dirOffset = dataView.getUint32( tiffOffset + 4, littleEndian );\n            // Create the exif object to store the tags:\n            data.exif = new EXIF.ExifMap();\n            // Parse the tags of the main image directory and retrieve the\n            // offset to the next directory, usually the thumbnail directory:\n            dirOffset = EXIF.parseExifTags( dataView, tiffOffset,\n                    tiffOffset + dirOffset, littleEndian, data );\n\n            // 尝试读取缩略图\n            // if ( dirOffset ) {\n            //     thumbnailData = {exif: {}};\n            //     dirOffset = EXIF.parseExifTags(\n            //         dataView,\n            //         tiffOffset,\n            //         tiffOffset + dirOffset,\n            //         littleEndian,\n            //         thumbnailData\n            //     );\n\n            //     // Check for JPEG Thumbnail offset:\n            //     if (thumbnailData.exif[0x0201]) {\n            //         data.exif.Thumbnail = EXIF.getExifThumbnail(\n            //             dataView,\n            //             tiffOffset + thumbnailData.exif[0x0201],\n            //             thumbnailData.exif[0x0202] // Thumbnail data length\n            //         );\n            //     }\n            // }\n        };\n\n        ImageMeta.parsers[ 0xffe1 ].push( EXIF.parseExifData );\n        return EXIF;\n    });\n    /**\n     * 这个方式性能不行，但是可以解决android里面的toDataUrl的bug\n     * android里面toDataUrl('image/jpege')得到的结果却是png.\n     *\n     * 所以这里没辙，只能借助这个工具\n     * @fileOverview jpeg encoder\n     */\n    define('runtime/html5/jpegencoder',[], function( require, exports, module ) {\n\n        /*\n          Copyright (c) 2008, Adobe Systems Incorporated\n          All rights reserved.\n\n          Redistribution and use in source and binary forms, with or without\n          modification, are permitted provided that the following conditions are\n          met:\n\n          * Redistributions of source code must retain the above copyright notice,\n            this list of conditions and the following disclaimer.\n\n          * Redistributions in binary form must reproduce the above copyright\n            notice, this list of conditions and the following disclaimer in the\n            documentation and/or other materials provided with the distribution.\n\n          * Neither the name of Adobe Systems Incorporated nor the names of its\n            contributors may be used to endorse or promote products derived from\n            this software without specific prior written permission.\n\n          THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS\n          IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n          THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n          PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n          CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n          EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n          PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n          PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF\n          LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING\n          NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n          SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n        */\n        /*\n        JPEG encoder ported to JavaScript and optimized by Andreas Ritter, www.bytestrom.eu, 11/2009\n\n        Basic GUI blocking jpeg encoder\n        */\n\n        function JPEGEncoder(quality) {\n          var self = this;\n            var fround = Math.round;\n            var ffloor = Math.floor;\n            var YTable = new Array(64);\n            var UVTable = new Array(64);\n            var fdtbl_Y = new Array(64);\n            var fdtbl_UV = new Array(64);\n            var YDC_HT;\n            var UVDC_HT;\n            var YAC_HT;\n            var UVAC_HT;\n\n            var bitcode = new Array(65535);\n            var category = new Array(65535);\n            var outputfDCTQuant = new Array(64);\n            var DU = new Array(64);\n            var byteout = [];\n            var bytenew = 0;\n            var bytepos = 7;\n\n            var YDU = new Array(64);\n            var UDU = new Array(64);\n            var VDU = new Array(64);\n            var clt = new Array(256);\n            var RGB_YUV_TABLE = new Array(2048);\n            var currentQuality;\n\n            var ZigZag = [\n                     0, 1, 5, 6,14,15,27,28,\n                     2, 4, 7,13,16,26,29,42,\n                     3, 8,12,17,25,30,41,43,\n                     9,11,18,24,31,40,44,53,\n                    10,19,23,32,39,45,52,54,\n                    20,22,33,38,46,51,55,60,\n                    21,34,37,47,50,56,59,61,\n                    35,36,48,49,57,58,62,63\n                ];\n\n            var std_dc_luminance_nrcodes = [0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];\n            var std_dc_luminance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n            var std_ac_luminance_nrcodes = [0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];\n            var std_ac_luminance_values = [\n                    0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,\n                    0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,\n                    0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,\n                    0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,\n                    0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,\n                    0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,\n                    0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,\n                    0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,\n                    0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,\n                    0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,\n                    0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,\n                    0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,\n                    0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,\n                    0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,\n                    0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,\n                    0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,\n                    0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,\n                    0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,\n                    0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,\n                    0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n                    0xf9,0xfa\n                ];\n\n            var std_dc_chrominance_nrcodes = [0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];\n            var std_dc_chrominance_values = [0,1,2,3,4,5,6,7,8,9,10,11];\n            var std_ac_chrominance_nrcodes = [0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];\n            var std_ac_chrominance_values = [\n                    0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,\n                    0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,\n                    0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,\n                    0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,\n                    0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,\n                    0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,\n                    0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,\n                    0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,\n                    0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,\n                    0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,\n                    0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,\n                    0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,\n                    0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,\n                    0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,\n                    0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,\n                    0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,\n                    0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,\n                    0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,\n                    0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,\n                    0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,\n                    0xf9,0xfa\n                ];\n\n            function initQuantTables(sf){\n                    var YQT = [\n                        16, 11, 10, 16, 24, 40, 51, 61,\n                        12, 12, 14, 19, 26, 58, 60, 55,\n                        14, 13, 16, 24, 40, 57, 69, 56,\n                        14, 17, 22, 29, 51, 87, 80, 62,\n                        18, 22, 37, 56, 68,109,103, 77,\n                        24, 35, 55, 64, 81,104,113, 92,\n                        49, 64, 78, 87,103,121,120,101,\n                        72, 92, 95, 98,112,100,103, 99\n                    ];\n\n                    for (var i = 0; i < 64; i++) {\n                        var t = ffloor((YQT[i]*sf+50)/100);\n                        if (t < 1) {\n                            t = 1;\n                        } else if (t > 255) {\n                            t = 255;\n                        }\n                        YTable[ZigZag[i]] = t;\n                    }\n                    var UVQT = [\n                        17, 18, 24, 47, 99, 99, 99, 99,\n                        18, 21, 26, 66, 99, 99, 99, 99,\n                        24, 26, 56, 99, 99, 99, 99, 99,\n                        47, 66, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99,\n                        99, 99, 99, 99, 99, 99, 99, 99\n                    ];\n                    for (var j = 0; j < 64; j++) {\n                        var u = ffloor((UVQT[j]*sf+50)/100);\n                        if (u < 1) {\n                            u = 1;\n                        } else if (u > 255) {\n                            u = 255;\n                        }\n                        UVTable[ZigZag[j]] = u;\n                    }\n                    var aasf = [\n                        1.0, 1.387039845, 1.306562965, 1.175875602,\n                        1.0, 0.785694958, 0.541196100, 0.275899379\n                    ];\n                    var k = 0;\n                    for (var row = 0; row < 8; row++)\n                    {\n                        for (var col = 0; col < 8; col++)\n                        {\n                            fdtbl_Y[k]  = (1.0 / (YTable [ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n                            fdtbl_UV[k] = (1.0 / (UVTable[ZigZag[k]] * aasf[row] * aasf[col] * 8.0));\n                            k++;\n                        }\n                    }\n                }\n\n                function computeHuffmanTbl(nrcodes, std_table){\n                    var codevalue = 0;\n                    var pos_in_table = 0;\n                    var HT = new Array();\n                    for (var k = 1; k <= 16; k++) {\n                        for (var j = 1; j <= nrcodes[k]; j++) {\n                            HT[std_table[pos_in_table]] = [];\n                            HT[std_table[pos_in_table]][0] = codevalue;\n                            HT[std_table[pos_in_table]][1] = k;\n                            pos_in_table++;\n                            codevalue++;\n                        }\n                        codevalue*=2;\n                    }\n                    return HT;\n                }\n\n                function initHuffmanTbl()\n                {\n                    YDC_HT = computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);\n                    UVDC_HT = computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);\n                    YAC_HT = computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);\n                    UVAC_HT = computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);\n                }\n\n                function initCategoryNumber()\n                {\n                    var nrlower = 1;\n                    var nrupper = 2;\n                    for (var cat = 1; cat <= 15; cat++) {\n                        //Positive numbers\n                        for (var nr = nrlower; nr<nrupper; nr++) {\n                            category[32767+nr] = cat;\n                            bitcode[32767+nr] = [];\n                            bitcode[32767+nr][1] = cat;\n                            bitcode[32767+nr][0] = nr;\n                        }\n                        //Negative numbers\n                        for (var nrneg =-(nrupper-1); nrneg<=-nrlower; nrneg++) {\n                            category[32767+nrneg] = cat;\n                            bitcode[32767+nrneg] = [];\n                            bitcode[32767+nrneg][1] = cat;\n                            bitcode[32767+nrneg][0] = nrupper-1+nrneg;\n                        }\n                        nrlower <<= 1;\n                        nrupper <<= 1;\n                    }\n                }\n\n                function initRGBYUVTable() {\n                    for(var i = 0; i < 256;i++) {\n                        RGB_YUV_TABLE[i]            =  19595 * i;\n                        RGB_YUV_TABLE[(i+ 256)>>0]  =  38470 * i;\n                        RGB_YUV_TABLE[(i+ 512)>>0]  =   7471 * i + 0x8000;\n                        RGB_YUV_TABLE[(i+ 768)>>0]  = -11059 * i;\n                        RGB_YUV_TABLE[(i+1024)>>0]  = -21709 * i;\n                        RGB_YUV_TABLE[(i+1280)>>0]  =  32768 * i + 0x807FFF;\n                        RGB_YUV_TABLE[(i+1536)>>0]  = -27439 * i;\n                        RGB_YUV_TABLE[(i+1792)>>0]  = - 5329 * i;\n                    }\n                }\n\n                // IO functions\n                function writeBits(bs)\n                {\n                    var value = bs[0];\n                    var posval = bs[1]-1;\n                    while ( posval >= 0 ) {\n                        if (value & (1 << posval) ) {\n                            bytenew |= (1 << bytepos);\n                        }\n                        posval--;\n                        bytepos--;\n                        if (bytepos < 0) {\n                            if (bytenew == 0xFF) {\n                                writeByte(0xFF);\n                                writeByte(0);\n                            }\n                            else {\n                                writeByte(bytenew);\n                            }\n                            bytepos=7;\n                            bytenew=0;\n                        }\n                    }\n                }\n\n                function writeByte(value)\n                {\n                    byteout.push(clt[value]); // write char directly instead of converting later\n                }\n\n                function writeWord(value)\n                {\n                    writeByte((value>>8)&0xFF);\n                    writeByte((value   )&0xFF);\n                }\n\n                // DCT & quantization core\n                function fDCTQuant(data, fdtbl)\n                {\n                    var d0, d1, d2, d3, d4, d5, d6, d7;\n                    /* Pass 1: process rows. */\n                    var dataOff=0;\n                    var i;\n                    var I8 = 8;\n                    var I64 = 64;\n                    for (i=0; i<I8; ++i)\n                    {\n                        d0 = data[dataOff];\n                        d1 = data[dataOff+1];\n                        d2 = data[dataOff+2];\n                        d3 = data[dataOff+3];\n                        d4 = data[dataOff+4];\n                        d5 = data[dataOff+5];\n                        d6 = data[dataOff+6];\n                        d7 = data[dataOff+7];\n\n                        var tmp0 = d0 + d7;\n                        var tmp7 = d0 - d7;\n                        var tmp1 = d1 + d6;\n                        var tmp6 = d1 - d6;\n                        var tmp2 = d2 + d5;\n                        var tmp5 = d2 - d5;\n                        var tmp3 = d3 + d4;\n                        var tmp4 = d3 - d4;\n\n                        /* Even part */\n                        var tmp10 = tmp0 + tmp3;    /* phase 2 */\n                        var tmp13 = tmp0 - tmp3;\n                        var tmp11 = tmp1 + tmp2;\n                        var tmp12 = tmp1 - tmp2;\n\n                        data[dataOff] = tmp10 + tmp11; /* phase 3 */\n                        data[dataOff+4] = tmp10 - tmp11;\n\n                        var z1 = (tmp12 + tmp13) * 0.707106781; /* c4 */\n                        data[dataOff+2] = tmp13 + z1; /* phase 5 */\n                        data[dataOff+6] = tmp13 - z1;\n\n                        /* Odd part */\n                        tmp10 = tmp4 + tmp5; /* phase 2 */\n                        tmp11 = tmp5 + tmp6;\n                        tmp12 = tmp6 + tmp7;\n\n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\n                        var z5 = (tmp10 - tmp12) * 0.382683433; /* c6 */\n                        var z2 = 0.541196100 * tmp10 + z5; /* c2-c6 */\n                        var z4 = 1.306562965 * tmp12 + z5; /* c2+c6 */\n                        var z3 = tmp11 * 0.707106781; /* c4 */\n\n                        var z11 = tmp7 + z3;    /* phase 5 */\n                        var z13 = tmp7 - z3;\n\n                        data[dataOff+5] = z13 + z2; /* phase 6 */\n                        data[dataOff+3] = z13 - z2;\n                        data[dataOff+1] = z11 + z4;\n                        data[dataOff+7] = z11 - z4;\n\n                        dataOff += 8; /* advance pointer to next row */\n                    }\n\n                    /* Pass 2: process columns. */\n                    dataOff = 0;\n                    for (i=0; i<I8; ++i)\n                    {\n                        d0 = data[dataOff];\n                        d1 = data[dataOff + 8];\n                        d2 = data[dataOff + 16];\n                        d3 = data[dataOff + 24];\n                        d4 = data[dataOff + 32];\n                        d5 = data[dataOff + 40];\n                        d6 = data[dataOff + 48];\n                        d7 = data[dataOff + 56];\n\n                        var tmp0p2 = d0 + d7;\n                        var tmp7p2 = d0 - d7;\n                        var tmp1p2 = d1 + d6;\n                        var tmp6p2 = d1 - d6;\n                        var tmp2p2 = d2 + d5;\n                        var tmp5p2 = d2 - d5;\n                        var tmp3p2 = d3 + d4;\n                        var tmp4p2 = d3 - d4;\n\n                        /* Even part */\n                        var tmp10p2 = tmp0p2 + tmp3p2;  /* phase 2 */\n                        var tmp13p2 = tmp0p2 - tmp3p2;\n                        var tmp11p2 = tmp1p2 + tmp2p2;\n                        var tmp12p2 = tmp1p2 - tmp2p2;\n\n                        data[dataOff] = tmp10p2 + tmp11p2; /* phase 3 */\n                        data[dataOff+32] = tmp10p2 - tmp11p2;\n\n                        var z1p2 = (tmp12p2 + tmp13p2) * 0.707106781; /* c4 */\n                        data[dataOff+16] = tmp13p2 + z1p2; /* phase 5 */\n                        data[dataOff+48] = tmp13p2 - z1p2;\n\n                        /* Odd part */\n                        tmp10p2 = tmp4p2 + tmp5p2; /* phase 2 */\n                        tmp11p2 = tmp5p2 + tmp6p2;\n                        tmp12p2 = tmp6p2 + tmp7p2;\n\n                        /* The rotator is modified from fig 4-8 to avoid extra negations. */\n                        var z5p2 = (tmp10p2 - tmp12p2) * 0.382683433; /* c6 */\n                        var z2p2 = 0.541196100 * tmp10p2 + z5p2; /* c2-c6 */\n                        var z4p2 = 1.306562965 * tmp12p2 + z5p2; /* c2+c6 */\n                        var z3p2 = tmp11p2 * 0.707106781; /* c4 */\n\n                        var z11p2 = tmp7p2 + z3p2;  /* phase 5 */\n                        var z13p2 = tmp7p2 - z3p2;\n\n                        data[dataOff+40] = z13p2 + z2p2; /* phase 6 */\n                        data[dataOff+24] = z13p2 - z2p2;\n                        data[dataOff+ 8] = z11p2 + z4p2;\n                        data[dataOff+56] = z11p2 - z4p2;\n\n                        dataOff++; /* advance pointer to next column */\n                    }\n\n                    // Quantize/descale the coefficients\n                    var fDCTQuant;\n                    for (i=0; i<I64; ++i)\n                    {\n                        // Apply the quantization and scaling factor & Round to nearest integer\n                        fDCTQuant = data[i]*fdtbl[i];\n                        outputfDCTQuant[i] = (fDCTQuant > 0.0) ? ((fDCTQuant + 0.5)|0) : ((fDCTQuant - 0.5)|0);\n                        //outputfDCTQuant[i] = fround(fDCTQuant);\n\n                    }\n                    return outputfDCTQuant;\n                }\n\n                function writeAPP0()\n                {\n                    writeWord(0xFFE0); // marker\n                    writeWord(16); // length\n                    writeByte(0x4A); // J\n                    writeByte(0x46); // F\n                    writeByte(0x49); // I\n                    writeByte(0x46); // F\n                    writeByte(0); // = \"JFIF\",'\\0'\n                    writeByte(1); // versionhi\n                    writeByte(1); // versionlo\n                    writeByte(0); // xyunits\n                    writeWord(1); // xdensity\n                    writeWord(1); // ydensity\n                    writeByte(0); // thumbnwidth\n                    writeByte(0); // thumbnheight\n                }\n\n                function writeSOF0(width, height)\n                {\n                    writeWord(0xFFC0); // marker\n                    writeWord(17);   // length, truecolor YUV JPG\n                    writeByte(8);    // precision\n                    writeWord(height);\n                    writeWord(width);\n                    writeByte(3);    // nrofcomponents\n                    writeByte(1);    // IdY\n                    writeByte(0x11); // HVY\n                    writeByte(0);    // QTY\n                    writeByte(2);    // IdU\n                    writeByte(0x11); // HVU\n                    writeByte(1);    // QTU\n                    writeByte(3);    // IdV\n                    writeByte(0x11); // HVV\n                    writeByte(1);    // QTV\n                }\n\n                function writeDQT()\n                {\n                    writeWord(0xFFDB); // marker\n                    writeWord(132);    // length\n                    writeByte(0);\n                    for (var i=0; i<64; i++) {\n                        writeByte(YTable[i]);\n                    }\n                    writeByte(1);\n                    for (var j=0; j<64; j++) {\n                        writeByte(UVTable[j]);\n                    }\n                }\n\n                function writeDHT()\n                {\n                    writeWord(0xFFC4); // marker\n                    writeWord(0x01A2); // length\n\n                    writeByte(0); // HTYDCinfo\n                    for (var i=0; i<16; i++) {\n                        writeByte(std_dc_luminance_nrcodes[i+1]);\n                    }\n                    for (var j=0; j<=11; j++) {\n                        writeByte(std_dc_luminance_values[j]);\n                    }\n\n                    writeByte(0x10); // HTYACinfo\n                    for (var k=0; k<16; k++) {\n                        writeByte(std_ac_luminance_nrcodes[k+1]);\n                    }\n                    for (var l=0; l<=161; l++) {\n                        writeByte(std_ac_luminance_values[l]);\n                    }\n\n                    writeByte(1); // HTUDCinfo\n                    for (var m=0; m<16; m++) {\n                        writeByte(std_dc_chrominance_nrcodes[m+1]);\n                    }\n                    for (var n=0; n<=11; n++) {\n                        writeByte(std_dc_chrominance_values[n]);\n                    }\n\n                    writeByte(0x11); // HTUACinfo\n                    for (var o=0; o<16; o++) {\n                        writeByte(std_ac_chrominance_nrcodes[o+1]);\n                    }\n                    for (var p=0; p<=161; p++) {\n                        writeByte(std_ac_chrominance_values[p]);\n                    }\n                }\n\n                function writeSOS()\n                {\n                    writeWord(0xFFDA); // marker\n                    writeWord(12); // length\n                    writeByte(3); // nrofcomponents\n                    writeByte(1); // IdY\n                    writeByte(0); // HTY\n                    writeByte(2); // IdU\n                    writeByte(0x11); // HTU\n                    writeByte(3); // IdV\n                    writeByte(0x11); // HTV\n                    writeByte(0); // Ss\n                    writeByte(0x3f); // Se\n                    writeByte(0); // Bf\n                }\n\n                function processDU(CDU, fdtbl, DC, HTDC, HTAC){\n                    var EOB = HTAC[0x00];\n                    var M16zeroes = HTAC[0xF0];\n                    var pos;\n                    var I16 = 16;\n                    var I63 = 63;\n                    var I64 = 64;\n                    var DU_DCT = fDCTQuant(CDU, fdtbl);\n                    //ZigZag reorder\n                    for (var j=0;j<I64;++j) {\n                        DU[ZigZag[j]]=DU_DCT[j];\n                    }\n                    var Diff = DU[0] - DC; DC = DU[0];\n                    //Encode DC\n                    if (Diff==0) {\n                        writeBits(HTDC[0]); // Diff might be 0\n                    } else {\n                        pos = 32767+Diff;\n                        writeBits(HTDC[category[pos]]);\n                        writeBits(bitcode[pos]);\n                    }\n                    //Encode ACs\n                    var end0pos = 63; // was const... which is crazy\n                    for (; (end0pos>0)&&(DU[end0pos]==0); end0pos--) {};\n                    //end0pos = first element in reverse order !=0\n                    if ( end0pos == 0) {\n                        writeBits(EOB);\n                        return DC;\n                    }\n                    var i = 1;\n                    var lng;\n                    while ( i <= end0pos ) {\n                        var startpos = i;\n                        for (; (DU[i]==0) && (i<=end0pos); ++i) {}\n                        var nrzeroes = i-startpos;\n                        if ( nrzeroes >= I16 ) {\n                            lng = nrzeroes>>4;\n                            for (var nrmarker=1; nrmarker <= lng; ++nrmarker)\n                                writeBits(M16zeroes);\n                            nrzeroes = nrzeroes&0xF;\n                        }\n                        pos = 32767+DU[i];\n                        writeBits(HTAC[(nrzeroes<<4)+category[pos]]);\n                        writeBits(bitcode[pos]);\n                        i++;\n                    }\n                    if ( end0pos != I63 ) {\n                        writeBits(EOB);\n                    }\n                    return DC;\n                }\n\n                function initCharLookupTable(){\n                    var sfcc = String.fromCharCode;\n                    for(var i=0; i < 256; i++){ ///// ACHTUNG // 255\n                        clt[i] = sfcc(i);\n                    }\n                }\n\n                this.encode = function(image,quality) // image data object\n                {\n                    // var time_start = new Date().getTime();\n\n                    if(quality) setQuality(quality);\n\n                    // Initialize bit writer\n                    byteout = new Array();\n                    bytenew=0;\n                    bytepos=7;\n\n                    // Add JPEG headers\n                    writeWord(0xFFD8); // SOI\n                    writeAPP0();\n                    writeDQT();\n                    writeSOF0(image.width,image.height);\n                    writeDHT();\n                    writeSOS();\n\n\n                    // Encode 8x8 macroblocks\n                    var DCY=0;\n                    var DCU=0;\n                    var DCV=0;\n\n                    bytenew=0;\n                    bytepos=7;\n\n\n                    this.encode.displayName = \"_encode_\";\n\n                    var imageData = image.data;\n                    var width = image.width;\n                    var height = image.height;\n\n                    var quadWidth = width*4;\n                    var tripleWidth = width*3;\n\n                    var x, y = 0;\n                    var r, g, b;\n                    var start,p, col,row,pos;\n                    while(y < height){\n                        x = 0;\n                        while(x < quadWidth){\n                        start = quadWidth * y + x;\n                        p = start;\n                        col = -1;\n                        row = 0;\n\n                        for(pos=0; pos < 64; pos++){\n                            row = pos >> 3;// /8\n                            col = ( pos & 7 ) * 4; // %8\n                            p = start + ( row * quadWidth ) + col;\n\n                            if(y+row >= height){ // padding bottom\n                                p-= (quadWidth*(y+1+row-height));\n                            }\n\n                            if(x+col >= quadWidth){ // padding right\n                                p-= ((x+col) - quadWidth +4)\n                            }\n\n                            r = imageData[ p++ ];\n                            g = imageData[ p++ ];\n                            b = imageData[ p++ ];\n\n\n                            /* // calculate YUV values dynamically\n                            YDU[pos]=((( 0.29900)*r+( 0.58700)*g+( 0.11400)*b))-128; //-0x80\n                            UDU[pos]=(((-0.16874)*r+(-0.33126)*g+( 0.50000)*b));\n                            VDU[pos]=((( 0.50000)*r+(-0.41869)*g+(-0.08131)*b));\n                            */\n\n                            // use lookup table (slightly faster)\n                            YDU[pos] = ((RGB_YUV_TABLE[r]             + RGB_YUV_TABLE[(g +  256)>>0] + RGB_YUV_TABLE[(b +  512)>>0]) >> 16)-128;\n                            UDU[pos] = ((RGB_YUV_TABLE[(r +  768)>>0] + RGB_YUV_TABLE[(g + 1024)>>0] + RGB_YUV_TABLE[(b + 1280)>>0]) >> 16)-128;\n                            VDU[pos] = ((RGB_YUV_TABLE[(r + 1280)>>0] + RGB_YUV_TABLE[(g + 1536)>>0] + RGB_YUV_TABLE[(b + 1792)>>0]) >> 16)-128;\n\n                        }\n\n                        DCY = processDU(YDU, fdtbl_Y, DCY, YDC_HT, YAC_HT);\n                        DCU = processDU(UDU, fdtbl_UV, DCU, UVDC_HT, UVAC_HT);\n                        DCV = processDU(VDU, fdtbl_UV, DCV, UVDC_HT, UVAC_HT);\n                        x+=32;\n                        }\n                        y+=8;\n                    }\n\n\n                    ////////////////////////////////////////////////////////////////\n\n                    // Do the bit alignment of the EOI marker\n                    if ( bytepos >= 0 ) {\n                        var fillbits = [];\n                        fillbits[1] = bytepos+1;\n                        fillbits[0] = (1<<(bytepos+1))-1;\n                        writeBits(fillbits);\n                    }\n\n                    writeWord(0xFFD9); //EOI\n\n                    var jpegDataUri = 'data:image/jpeg;base64,' + btoa(byteout.join(''));\n\n                    byteout = [];\n\n                    // benchmarking\n                    // var duration = new Date().getTime() - time_start;\n                    // console.log('Encoding time: '+ currentQuality + 'ms');\n                    //\n\n                    return jpegDataUri\n            }\n\n            function setQuality(quality){\n                if (quality <= 0) {\n                    quality = 1;\n                }\n                if (quality > 100) {\n                    quality = 100;\n                }\n\n                if(currentQuality == quality) return // don't recalc if unchanged\n\n                var sf = 0;\n                if (quality < 50) {\n                    sf = Math.floor(5000 / quality);\n                } else {\n                    sf = Math.floor(200 - quality*2);\n                }\n\n                initQuantTables(sf);\n                currentQuality = quality;\n                // console.log('Quality set to: '+quality +'%');\n            }\n\n            function init(){\n                // var time_start = new Date().getTime();\n                if(!quality) quality = 50;\n                // Create tables\n                initCharLookupTable()\n                initHuffmanTbl();\n                initCategoryNumber();\n                initRGBYUVTable();\n\n                setQuality(quality);\n                // var duration = new Date().getTime() - time_start;\n                // console.log('Initialization '+ duration + 'ms');\n            }\n\n            init();\n\n        };\n\n        JPEGEncoder.encode = function( data, quality ) {\n            var encoder = new JPEGEncoder( quality );\n\n            return encoder.encode( data );\n        }\n\n        return JPEGEncoder;\n    });\n    /**\n     * @fileOverview Fix android canvas.toDataUrl bug.\n     */\n    define('runtime/html5/androidpatch',[\n        'runtime/html5/util',\n        'runtime/html5/jpegencoder',\n        'base'\n    ], function( Util, encoder, Base ) {\n        var origin = Util.canvasToDataUrl,\n            supportJpeg;\n\n        Util.canvasToDataUrl = function( canvas, type, quality ) {\n            var ctx, w, h, fragement, parts;\n\n            // 非android手机直接跳过。\n            if ( !Base.os.android ) {\n                return origin.apply( null, arguments );\n            }\n\n            // 检测是否canvas支持jpeg导出，根据数据格式来判断。\n            // JPEG 前两位分别是：255, 216\n            if ( type === 'image/jpeg' && typeof supportJpeg === 'undefined' ) {\n                fragement = origin.apply( null, arguments );\n\n                parts = fragement.split(',');\n\n                if ( ~parts[ 0 ].indexOf('base64') ) {\n                    fragement = atob( parts[ 1 ] );\n                } else {\n                    fragement = decodeURIComponent( parts[ 1 ] );\n                }\n\n                fragement = fragement.substring( 0, 2 );\n\n                supportJpeg = fragement.charCodeAt( 0 ) === 255 &&\n                        fragement.charCodeAt( 1 ) === 216;\n            }\n\n            // 只有在android环境下才修复\n            if ( type === 'image/jpeg' && !supportJpeg ) {\n                w = canvas.width;\n                h = canvas.height;\n                ctx = canvas.getContext('2d');\n\n                return encoder.encode( ctx.getImageData( 0, 0, w, h ), quality );\n            }\n\n            return origin.apply( null, arguments );\n        };\n    });\n    /**\n     * @fileOverview Image\n     */\n    define('runtime/html5/image',[\n        'base',\n        'runtime/html5/runtime',\n        'runtime/html5/util'\n    ], function( Base, Html5Runtime, Util ) {\n\n        var BLANK = 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D';\n\n        return Html5Runtime.register( 'Image', {\n\n            // flag: 标记是否被修改过。\n            modified: false,\n\n            init: function() {\n                var me = this,\n                    img = new Image();\n\n                img.onload = function() {\n\n                    me._info = {\n                        type: me.type,\n                        width: this.width,\n                        height: this.height\n                    };\n\n                    //debugger;\n\n                    // 读取meta信息。\n                    if ( !me._metas && 'image/jpeg' === me.type ) {\n                        Util.parseMeta( me._blob, function( error, ret ) {\n                            me._metas = ret;\n                            me.owner.trigger('load');\n                        });\n                    } else {\n                        me.owner.trigger('load');\n                    }\n                };\n\n                img.onerror = function() {\n                    me.owner.trigger('error');\n                };\n\n                me._img = img;\n            },\n\n            loadFromBlob: function( blob ) {\n                var me = this,\n                    img = me._img;\n\n                me._blob = blob;\n                me.type = blob.type;\n                img.src = Util.createObjectURL( blob.getSource() );\n                me.owner.once( 'load', function() {\n                    Util.revokeObjectURL( img.src );\n                });\n            },\n\n            resize: function( width, height ) {\n                var canvas = this._canvas ||\n                        (this._canvas = document.createElement('canvas'));\n\n                this._resize( this._img, canvas, width, height );\n                this._blob = null;    // 没用了，可以删掉了。\n                this.modified = true;\n                this.owner.trigger( 'complete', 'resize' );\n            },\n\n            crop: function( x, y, w, h, s ) {\n                var cvs = this._canvas ||\n                        (this._canvas = document.createElement('canvas')),\n                    opts = this.options,\n                    img = this._img,\n                    iw = img.naturalWidth,\n                    ih = img.naturalHeight,\n                    orientation = this.getOrientation();\n\n                s = s || 1;\n\n                // todo 解决 orientation 的问题。\n                // values that require 90 degree rotation\n                // if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n\n                //     switch ( orientation ) {\n                //         case 6:\n                //             tmp = x;\n                //             x = y;\n                //             y = iw * s - tmp - w;\n                //             console.log(ih * s, tmp, w)\n                //             break;\n                //     }\n\n                //     (w ^= h, h ^= w, w ^= h);\n                // }\n\n                cvs.width = w;\n                cvs.height = h;\n\n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n                this._renderImageToCanvas( cvs, img, -x, -y, iw * s, ih * s );\n\n                this._blob = null;    // 没用了，可以删掉了。\n                this.modified = true;\n                this.owner.trigger( 'complete', 'crop' );\n            },\n\n            getAsBlob: function( type ) {\n                var blob = this._blob,\n                    opts = this.options,\n                    canvas;\n\n                type = type || this.type;\n\n                // blob需要重新生成。\n                if ( this.modified || this.type !== type ) {\n                    canvas = this._canvas;\n\n                    if ( type === 'image/jpeg' ) {\n\n                        blob = Util.canvasToDataUrl( canvas, type, opts.quality );\n\n                        if ( opts.preserveHeaders && this._metas &&\n                                this._metas.imageHead ) {\n\n                            blob = Util.dataURL2ArrayBuffer( blob );\n                            blob = Util.updateImageHead( blob,\n                                    this._metas.imageHead );\n                            blob = Util.arrayBufferToBlob( blob, type );\n                            return blob;\n                        }\n                    } else {\n                        blob = Util.canvasToDataUrl( canvas, type );\n                    }\n\n                    blob = Util.dataURL2Blob( blob );\n                }\n\n                return blob;\n            },\n\n            getAsDataUrl: function( type ) {\n                var opts = this.options;\n\n                type = type || this.type;\n\n                if ( type === 'image/jpeg' ) {\n                    return Util.canvasToDataUrl( this._canvas, type, opts.quality );\n                } else {\n                    return this._canvas.toDataURL( type );\n                }\n            },\n\n            getOrientation: function() {\n                return this._metas && this._metas.exif &&\n                        this._metas.exif.get('Orientation') || 1;\n            },\n\n            info: function( val ) {\n\n                // setter\n                if ( val ) {\n                    this._info = val;\n                    return this;\n                }\n\n                // getter\n                return this._info;\n            },\n\n            meta: function( val ) {\n\n                // setter\n                if ( val ) {\n                    this._metas = val;\n                    return this;\n                }\n\n                // getter\n                return this._metas;\n            },\n\n            destroy: function() {\n                var canvas = this._canvas;\n                this._img.onload = null;\n\n                if ( canvas ) {\n                    canvas.getContext('2d')\n                            .clearRect( 0, 0, canvas.width, canvas.height );\n                    canvas.width = canvas.height = 0;\n                    this._canvas = null;\n                }\n\n                // 释放内存。非常重要，否则释放不了image的内存。\n                this._img.src = BLANK;\n                this._img = this._blob = null;\n            },\n\n            _resize: function( img, cvs, width, height ) {\n                var opts = this.options,\n                    naturalWidth = img.width,\n                    naturalHeight = img.height,\n                    orientation = this.getOrientation(),\n                    scale, w, h, x, y;\n\n                // values that require 90 degree rotation\n                if ( ~[ 5, 6, 7, 8 ].indexOf( orientation ) ) {\n\n                    // 交换width, height的值。\n                    width ^= height;\n                    height ^= width;\n                    width ^= height;\n                }\n\n                scale = Math[ opts.crop ? 'max' : 'min' ]( width / naturalWidth,\n                        height / naturalHeight );\n\n                // 不允许放大。\n                opts.allowMagnify || (scale = Math.min( 1, scale ));\n\n                w = naturalWidth * scale;\n                h = naturalHeight * scale;\n\n                if ( opts.crop ) {\n                    cvs.width = width;\n                    cvs.height = height;\n                } else {\n                    cvs.width = w;\n                    cvs.height = h;\n                }\n\n                x = (cvs.width - w) / 2;\n                y = (cvs.height - h) / 2;\n\n                opts.preserveHeaders || this._rotate2Orientaion( cvs, orientation );\n\n                this._renderImageToCanvas( cvs, img, x, y, w, h );\n            },\n\n            _rotate2Orientaion: function( canvas, orientation ) {\n                var width = canvas.width,\n                    height = canvas.height,\n                    ctx = canvas.getContext('2d');\n\n                switch ( orientation ) {\n                    case 5:\n                    case 6:\n                    case 7:\n                    case 8:\n                        canvas.width = height;\n                        canvas.height = width;\n                        break;\n                }\n\n                switch ( orientation ) {\n                    case 2:    // horizontal flip\n                        ctx.translate( width, 0 );\n                        ctx.scale( -1, 1 );\n                        break;\n\n                    case 3:    // 180 rotate left\n                        ctx.translate( width, height );\n                        ctx.rotate( Math.PI );\n                        break;\n\n                    case 4:    // vertical flip\n                        ctx.translate( 0, height );\n                        ctx.scale( 1, -1 );\n                        break;\n\n                    case 5:    // vertical flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.scale( 1, -1 );\n                        break;\n\n                    case 6:    // 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( 0, -height );\n                        break;\n\n                    case 7:    // horizontal flip + 90 rotate right\n                        ctx.rotate( 0.5 * Math.PI );\n                        ctx.translate( width, -height );\n                        ctx.scale( -1, 1 );\n                        break;\n\n                    case 8:    // 90 rotate left\n                        ctx.rotate( -0.5 * Math.PI );\n                        ctx.translate( -width, 0 );\n                        break;\n                }\n            },\n\n            // https://github.com/stomita/ios-imagefile-megapixel/\n            // blob/master/src/megapix-image.js\n            _renderImageToCanvas: (function() {\n\n                // 如果不是ios, 不需要这么复杂！\n                if ( !Base.os.ios ) {\n                    return function( canvas ) {\n                        var args = Base.slice( arguments, 1 ),\n                            ctx = canvas.getContext('2d');\n\n                        ctx.drawImage.apply( ctx, args );\n                    };\n                }\n\n                /**\n                 * Detecting vertical squash in loaded image.\n                 * Fixes a bug which squash image vertically while drawing into\n                 * canvas for some images.\n                 */\n                function detectVerticalSquash( img, iw, ih ) {\n                    var canvas = document.createElement('canvas'),\n                        ctx = canvas.getContext('2d'),\n                        sy = 0,\n                        ey = ih,\n                        py = ih,\n                        data, alpha, ratio;\n\n\n                    canvas.width = 1;\n                    canvas.height = ih;\n                    ctx.drawImage( img, 0, 0 );\n                    data = ctx.getImageData( 0, 0, 1, ih ).data;\n\n                    // search image edge pixel position in case\n                    // it is squashed vertically.\n                    while ( py > sy ) {\n                        alpha = data[ (py - 1) * 4 + 3 ];\n\n                        if ( alpha === 0 ) {\n                            ey = py;\n                        } else {\n                            sy = py;\n                        }\n\n                        py = (ey + sy) >> 1;\n                    }\n\n                    ratio = (py / ih);\n                    return (ratio === 0) ? 1 : ratio;\n                }\n\n                // fix ie7 bug\n                // http://stackoverflow.com/questions/11929099/\n                // html5-canvas-drawimage-ratio-bug-ios\n                if ( Base.os.ios >= 7 ) {\n                    return function( canvas, img, x, y, w, h ) {\n                        var iw = img.naturalWidth,\n                            ih = img.naturalHeight,\n                            vertSquashRatio = detectVerticalSquash( img, iw, ih );\n\n                        return canvas.getContext('2d').drawImage( img, 0, 0,\n                                iw * vertSquashRatio, ih * vertSquashRatio,\n                                x, y, w, h );\n                    };\n                }\n\n                /**\n                 * Detect subsampling in loaded image.\n                 * In iOS, larger images than 2M pixels may be\n                 * subsampled in rendering.\n                 */\n                function detectSubsampling( img ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        canvas, ctx;\n\n                    // subsampling may happen overmegapixel image\n                    if ( iw * ih > 1024 * 1024 ) {\n                        canvas = document.createElement('canvas');\n                        canvas.width = canvas.height = 1;\n                        ctx = canvas.getContext('2d');\n                        ctx.drawImage( img, -iw + 1, 0 );\n\n                        // subsampled image becomes half smaller in rendering size.\n                        // check alpha channel value to confirm image is covering\n                        // edge pixel or not. if alpha value is 0\n                        // image is not covering, hence subsampled.\n                        return ctx.getImageData( 0, 0, 1, 1 ).data[ 3 ] === 0;\n                    } else {\n                        return false;\n                    }\n                }\n\n\n                return function( canvas, img, x, y, width, height ) {\n                    var iw = img.naturalWidth,\n                        ih = img.naturalHeight,\n                        ctx = canvas.getContext('2d'),\n                        subsampled = detectSubsampling( img ),\n                        doSquash = this.type === 'image/jpeg',\n                        d = 1024,\n                        sy = 0,\n                        dy = 0,\n                        tmpCanvas, tmpCtx, vertSquashRatio, dw, dh, sx, dx;\n\n                    if ( subsampled ) {\n                        iw /= 2;\n                        ih /= 2;\n                    }\n\n                    ctx.save();\n                    tmpCanvas = document.createElement('canvas');\n                    tmpCanvas.width = tmpCanvas.height = d;\n\n                    tmpCtx = tmpCanvas.getContext('2d');\n                    vertSquashRatio = doSquash ?\n                            detectVerticalSquash( img, iw, ih ) : 1;\n\n                    dw = Math.ceil( d * width / iw );\n                    dh = Math.ceil( d * height / ih / vertSquashRatio );\n\n                    while ( sy < ih ) {\n                        sx = 0;\n                        dx = 0;\n                        while ( sx < iw ) {\n                            tmpCtx.clearRect( 0, 0, d, d );\n                            tmpCtx.drawImage( img, -sx, -sy );\n                            ctx.drawImage( tmpCanvas, 0, 0, d, d,\n                                    x + dx, y + dy, dw, dh );\n                            sx += d;\n                            dx += dw;\n                        }\n                        sy += d;\n                        dy += dh;\n                    }\n                    ctx.restore();\n                    tmpCanvas = tmpCtx = null;\n                };\n            })()\n        });\n    });\n\n    /**\n     * @fileOverview Transport\n     * @todo 支持chunked传输，优势：\n     * 可以将大文件分成小块，挨个传输，可以提高大文件成功率，当失败的时候，也只需要重传那小部分，\n     * 而不需要重头再传一次。另外断点续传也需要用chunked方式。\n     */\n    define('runtime/html5/transport',[\n        'base',\n        'runtime/html5/runtime'\n    ], function( Base, Html5Runtime ) {\n\n        var noop = Base.noop,\n            $ = Base.$;\n\n        return Html5Runtime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n            },\n\n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    formData, binary, fr;\n\n                if ( opts.sendAsBinary ) {\n                    server += opts.attachInfoToQuery !== false ? ((/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData )) : '';\n\n                    binary = blob.getSource();\n                } else {\n                    formData = new FormData();\n                    $.each( owner._formData, function( k, v ) {\n                        formData.append( k, v );\n                    });\n\n                    formData.append( opts.fileVal, blob.getSource(),\n                            opts.filename || owner._formData.name || '' );\n                }\n\n                if ( opts.withCredentials && 'withCredentials' in xhr ) {\n                    xhr.open( opts.method, server, true );\n                    xhr.withCredentials = true;\n                } else {\n                    xhr.open( opts.method, server );\n                }\n\n                this._setRequestHeader( xhr, opts.headers );\n\n                if ( binary ) {\n                    // 强制设置成 content-type 为文件流。\n                    xhr.overrideMimeType &&\n                            xhr.overrideMimeType('application/octet-stream');\n\n                    // android直接发送blob会导致服务端接收到的是空文件。\n                    // bug详情。\n                    // https://code.google.com/p/android/issues/detail?id=39882\n                    // 所以先用fileReader读取出来再通过arraybuffer的方式发送。\n                    if ( Base.os.android ) {\n                        fr = new FileReader();\n\n                        fr.onload = function() {\n                            xhr.send( this.result );\n                            fr = fr.onload = null;\n                        };\n\n                        fr.readAsArrayBuffer( binary );\n                    } else {\n                        xhr.send( binary );\n                    }\n                } else {\n                    xhr.send( formData );\n                }\n            },\n\n            getResponse: function() {\n                return this._response;\n            },\n\n            getResponseAsJson: function() {\n                return this._parseJson( this._response );\n            },\n\n            getResponseHeaders: function() {\n                return this._headers;\n            },\n\n            getStatus: function() {\n                return this._status;\n            },\n\n            abort: function() {\n                var xhr = this._xhr;\n\n                if ( xhr ) {\n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    xhr.abort();\n\n                    this._xhr = xhr = null;\n                }\n            },\n\n            destroy: function() {\n                this.abort();\n            },\n\n            _parseHeader: function(raw) {\n                var ret = {};\n\n                raw && raw.replace(/^([^\\:]+):(.*)$/mg, function(_, key, value) {\n                    ret[key.trim()] = value.trim();\n                });\n\n                return ret;\n            },\n\n            _initAjax: function() {\n                var me = this,\n                    xhr = new XMLHttpRequest(),\n                    opts = this.options;\n\n                if ( opts.withCredentials && !('withCredentials' in xhr) &&\n                        typeof XDomainRequest !== 'undefined' ) {\n                    xhr = new XDomainRequest();\n                }\n\n                xhr.upload.onprogress = function( e ) {\n                    var percentage = 0;\n\n                    if ( e.lengthComputable ) {\n                        percentage = e.loaded / e.total;\n                    }\n\n                    return me.trigger( 'progress', percentage );\n                };\n\n                xhr.onreadystatechange = function() {\n\n                    if ( xhr.readyState !== 4 ) {\n                        return;\n                    }\n\n                    xhr.upload.onprogress = noop;\n                    xhr.onreadystatechange = noop;\n                    me._xhr = null;\n                    me._status = xhr.status;\n\n                    if ( xhr.status >= 200 && xhr.status < 300 ) {\n                        me._response = xhr.responseText;\n                        me._headers = me._parseHeader(xhr.getAllResponseHeaders());\n                        return me.trigger('load');\n                    } else if ( xhr.status >= 500 && xhr.status < 600 ) {\n                        me._response = xhr.responseText;\n                        me._headers = me._parseHeader(xhr.getAllResponseHeaders());\n                        return me.trigger( 'error', 'server-'+status );\n                    }\n\n\n                    return me.trigger( 'error', me._status ? 'http-'+status : 'abort' );\n                };\n\n                me._xhr = xhr;\n                return xhr;\n            },\n\n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.setRequestHeader( key, val );\n                });\n            },\n\n            _parseJson: function( str ) {\n                var json;\n\n                try {\n                    json = JSON.parse( str );\n                } catch ( ex ) {\n                    json = {};\n                }\n\n                return json;\n            }\n        });\n    });\n\n    /**\n     * @fileOverview  Transport flash实现\n     */\n    define('runtime/html5/md5',[\n        'runtime/html5/runtime'\n    ], function( FlashRuntime ) {\n\n        /*\n         * Fastest md5 implementation around (JKM md5)\n         * Credits: Joseph Myers\n         *\n         * @see http://www.myersdaily.org/joseph/javascript/md5-text.html\n         * @see http://jsperf.com/md5-shootout/7\n         */\n\n        /* this function is much faster,\n          so if possible we use it. Some IEs\n          are the only ones I know of that\n          need the idiotic second function,\n          generated by an if clause.  */\n        var add32 = function (a, b) {\n            return (a + b) & 0xFFFFFFFF;\n        },\n\n        cmn = function (q, a, b, x, s, t) {\n            a = add32(add32(a, q), add32(x, t));\n            return add32((a << s) | (a >>> (32 - s)), b);\n        },\n\n        ff = function (a, b, c, d, x, s, t) {\n            return cmn((b & c) | ((~b) & d), a, b, x, s, t);\n        },\n\n        gg = function (a, b, c, d, x, s, t) {\n            return cmn((b & d) | (c & (~d)), a, b, x, s, t);\n        },\n\n        hh = function (a, b, c, d, x, s, t) {\n            return cmn(b ^ c ^ d, a, b, x, s, t);\n        },\n\n        ii = function (a, b, c, d, x, s, t) {\n            return cmn(c ^ (b | (~d)), a, b, x, s, t);\n        },\n\n        md5cycle = function (x, k) {\n            var a = x[0],\n                b = x[1],\n                c = x[2],\n                d = x[3];\n\n            a = ff(a, b, c, d, k[0], 7, -680876936);\n            d = ff(d, a, b, c, k[1], 12, -389564586);\n            c = ff(c, d, a, b, k[2], 17, 606105819);\n            b = ff(b, c, d, a, k[3], 22, -1044525330);\n            a = ff(a, b, c, d, k[4], 7, -176418897);\n            d = ff(d, a, b, c, k[5], 12, 1200080426);\n            c = ff(c, d, a, b, k[6], 17, -1473231341);\n            b = ff(b, c, d, a, k[7], 22, -45705983);\n            a = ff(a, b, c, d, k[8], 7, 1770035416);\n            d = ff(d, a, b, c, k[9], 12, -1958414417);\n            c = ff(c, d, a, b, k[10], 17, -42063);\n            b = ff(b, c, d, a, k[11], 22, -1990404162);\n            a = ff(a, b, c, d, k[12], 7, 1804603682);\n            d = ff(d, a, b, c, k[13], 12, -40341101);\n            c = ff(c, d, a, b, k[14], 17, -1502002290);\n            b = ff(b, c, d, a, k[15], 22, 1236535329);\n\n            a = gg(a, b, c, d, k[1], 5, -165796510);\n            d = gg(d, a, b, c, k[6], 9, -1069501632);\n            c = gg(c, d, a, b, k[11], 14, 643717713);\n            b = gg(b, c, d, a, k[0], 20, -373897302);\n            a = gg(a, b, c, d, k[5], 5, -701558691);\n            d = gg(d, a, b, c, k[10], 9, 38016083);\n            c = gg(c, d, a, b, k[15], 14, -660478335);\n            b = gg(b, c, d, a, k[4], 20, -405537848);\n            a = gg(a, b, c, d, k[9], 5, 568446438);\n            d = gg(d, a, b, c, k[14], 9, -1019803690);\n            c = gg(c, d, a, b, k[3], 14, -187363961);\n            b = gg(b, c, d, a, k[8], 20, 1163531501);\n            a = gg(a, b, c, d, k[13], 5, -1444681467);\n            d = gg(d, a, b, c, k[2], 9, -51403784);\n            c = gg(c, d, a, b, k[7], 14, 1735328473);\n            b = gg(b, c, d, a, k[12], 20, -1926607734);\n\n            a = hh(a, b, c, d, k[5], 4, -378558);\n            d = hh(d, a, b, c, k[8], 11, -2022574463);\n            c = hh(c, d, a, b, k[11], 16, 1839030562);\n            b = hh(b, c, d, a, k[14], 23, -35309556);\n            a = hh(a, b, c, d, k[1], 4, -1530992060);\n            d = hh(d, a, b, c, k[4], 11, 1272893353);\n            c = hh(c, d, a, b, k[7], 16, -155497632);\n            b = hh(b, c, d, a, k[10], 23, -1094730640);\n            a = hh(a, b, c, d, k[13], 4, 681279174);\n            d = hh(d, a, b, c, k[0], 11, -358537222);\n            c = hh(c, d, a, b, k[3], 16, -722521979);\n            b = hh(b, c, d, a, k[6], 23, 76029189);\n            a = hh(a, b, c, d, k[9], 4, -640364487);\n            d = hh(d, a, b, c, k[12], 11, -421815835);\n            c = hh(c, d, a, b, k[15], 16, 530742520);\n            b = hh(b, c, d, a, k[2], 23, -995338651);\n\n            a = ii(a, b, c, d, k[0], 6, -198630844);\n            d = ii(d, a, b, c, k[7], 10, 1126891415);\n            c = ii(c, d, a, b, k[14], 15, -1416354905);\n            b = ii(b, c, d, a, k[5], 21, -57434055);\n            a = ii(a, b, c, d, k[12], 6, 1700485571);\n            d = ii(d, a, b, c, k[3], 10, -1894986606);\n            c = ii(c, d, a, b, k[10], 15, -1051523);\n            b = ii(b, c, d, a, k[1], 21, -2054922799);\n            a = ii(a, b, c, d, k[8], 6, 1873313359);\n            d = ii(d, a, b, c, k[15], 10, -30611744);\n            c = ii(c, d, a, b, k[6], 15, -1560198380);\n            b = ii(b, c, d, a, k[13], 21, 1309151649);\n            a = ii(a, b, c, d, k[4], 6, -145523070);\n            d = ii(d, a, b, c, k[11], 10, -1120210379);\n            c = ii(c, d, a, b, k[2], 15, 718787259);\n            b = ii(b, c, d, a, k[9], 21, -343485551);\n\n            x[0] = add32(a, x[0]);\n            x[1] = add32(b, x[1]);\n            x[2] = add32(c, x[2]);\n            x[3] = add32(d, x[3]);\n        },\n\n        /* there needs to be support for Unicode here,\n           * unless we pretend that we can redefine the MD-5\n           * algorithm for multi-byte characters (perhaps\n           * by adding every four 16-bit characters and\n           * shortening the sum to 32 bits). Otherwise\n           * I suggest performing MD-5 as if every character\n           * was two bytes--e.g., 0040 0025 = @%--but then\n           * how will an ordinary MD-5 sum be matched?\n           * There is no way to standardize text to something\n           * like UTF-8 before transformation; speed cost is\n           * utterly prohibitive. The JavaScript standard\n           * itself needs to look at this: it should start\n           * providing access to strings as preformed UTF-8\n           * 8-bit unsigned value arrays.\n           */\n        md5blk = function (s) {\n            var md5blks = [],\n                i; /* Andy King said do it this way. */\n\n            for (i = 0; i < 64; i += 4) {\n                md5blks[i >> 2] = s.charCodeAt(i) + (s.charCodeAt(i + 1) << 8) + (s.charCodeAt(i + 2) << 16) + (s.charCodeAt(i + 3) << 24);\n            }\n            return md5blks;\n        },\n\n        md5blk_array = function (a) {\n            var md5blks = [],\n                i; /* Andy King said do it this way. */\n\n            for (i = 0; i < 64; i += 4) {\n                md5blks[i >> 2] = a[i] + (a[i + 1] << 8) + (a[i + 2] << 16) + (a[i + 3] << 24);\n            }\n            return md5blks;\n        },\n\n        md51 = function (s) {\n            var n = s.length,\n                state = [1732584193, -271733879, -1732584194, 271733878],\n                i,\n                length,\n                tail,\n                tmp,\n                lo,\n                hi;\n\n            for (i = 64; i <= n; i += 64) {\n                md5cycle(state, md5blk(s.substring(i - 64, i)));\n            }\n            s = s.substring(i - 64);\n            length = s.length;\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);\n            }\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n\n            // Beware that the final length might not fit in 32 bits so we take care of that\n            tmp = n * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n\n            tail[14] = lo;\n            tail[15] = hi;\n\n            md5cycle(state, tail);\n            return state;\n        },\n\n        md51_array = function (a) {\n            var n = a.length,\n                state = [1732584193, -271733879, -1732584194, 271733878],\n                i,\n                length,\n                tail,\n                tmp,\n                lo,\n                hi;\n\n            for (i = 64; i <= n; i += 64) {\n                md5cycle(state, md5blk_array(a.subarray(i - 64, i)));\n            }\n\n            // Not sure if it is a bug, however IE10 will always produce a sub array of length 1\n            // containing the last element of the parent array if the sub array specified starts\n            // beyond the length of the parent array - weird.\n            // https://connect.microsoft.com/IE/feedback/details/771452/typed-array-subarray-issue\n            a = (i - 64) < n ? a.subarray(i - 64) : new Uint8Array(0);\n\n            length = a.length;\n            tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= a[i] << ((i % 4) << 3);\n            }\n\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n\n            // Beware that the final length might not fit in 32 bits so we take care of that\n            tmp = n * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n\n            tail[14] = lo;\n            tail[15] = hi;\n\n            md5cycle(state, tail);\n\n            return state;\n        },\n\n        hex_chr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'],\n\n        rhex = function (n) {\n            var s = '',\n                j;\n            for (j = 0; j < 4; j += 1) {\n                s += hex_chr[(n >> (j * 8 + 4)) & 0x0F] + hex_chr[(n >> (j * 8)) & 0x0F];\n            }\n            return s;\n        },\n\n        hex = function (x) {\n            var i;\n            for (i = 0; i < x.length; i += 1) {\n                x[i] = rhex(x[i]);\n            }\n            return x.join('');\n        },\n\n        md5 = function (s) {\n            return hex(md51(s));\n        },\n\n\n\n        ////////////////////////////////////////////////////////////////////////////\n\n        /**\n         * SparkMD5 OOP implementation.\n         *\n         * Use this class to perform an incremental md5, otherwise use the\n         * static methods instead.\n         */\n        SparkMD5 = function () {\n            // call reset to init the instance\n            this.reset();\n        };\n\n\n        // In some cases the fast add32 function cannot be used..\n        if (md5('hello') !== '5d41402abc4b2a76b9719d911017c592') {\n            add32 = function (x, y) {\n                var lsw = (x & 0xFFFF) + (y & 0xFFFF),\n                    msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n                return (msw << 16) | (lsw & 0xFFFF);\n            };\n        }\n\n\n        /**\n         * Appends a string.\n         * A conversion will be applied if an utf8 string is detected.\n         *\n         * @param {String} str The string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.append = function (str) {\n            // converts the string to utf8 bytes if necessary\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\n                str = unescape(encodeURIComponent(str));\n            }\n\n            // then append as binary\n            this.appendBinary(str);\n\n            return this;\n        };\n\n        /**\n         * Appends a binary string.\n         *\n         * @param {String} contents The binary string to be appended\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.appendBinary = function (contents) {\n            this._buff += contents;\n            this._length += contents.length;\n\n            var length = this._buff.length,\n                i;\n\n            for (i = 64; i <= length; i += 64) {\n                md5cycle(this._state, md5blk(this._buff.substring(i - 64, i)));\n            }\n\n            this._buff = this._buff.substr(i - 64);\n\n            return this;\n        };\n\n        /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.prototype.end = function (raw) {\n            var buff = this._buff,\n                length = buff.length,\n                i,\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                ret;\n\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= buff.charCodeAt(i) << ((i % 4) << 3);\n            }\n\n            this._finish(tail, length);\n            ret = !!raw ? this._state : hex(this._state);\n\n            this.reset();\n\n            return ret;\n        };\n\n        /**\n         * Finish the final calculation based on the tail.\n         *\n         * @param {Array}  tail   The tail (will be modified)\n         * @param {Number} length The length of the remaining buffer\n         */\n        SparkMD5.prototype._finish = function (tail, length) {\n            var i = length,\n                tmp,\n                lo,\n                hi;\n\n            tail[i >> 2] |= 0x80 << ((i % 4) << 3);\n            if (i > 55) {\n                md5cycle(this._state, tail);\n                for (i = 0; i < 16; i += 1) {\n                    tail[i] = 0;\n                }\n            }\n\n            // Do the final computation based on the tail and length\n            // Beware that the final length may not fit in 32 bits so we take care of that\n            tmp = this._length * 8;\n            tmp = tmp.toString(16).match(/(.*?)(.{0,8})$/);\n            lo = parseInt(tmp[2], 16);\n            hi = parseInt(tmp[1], 16) || 0;\n\n            tail[14] = lo;\n            tail[15] = hi;\n            md5cycle(this._state, tail);\n        };\n\n        /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5} The instance itself\n         */\n        SparkMD5.prototype.reset = function () {\n            this._buff = \"\";\n            this._length = 0;\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\n\n            return this;\n        };\n\n        /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n        SparkMD5.prototype.destroy = function () {\n            delete this._state;\n            delete this._buff;\n            delete this._length;\n        };\n\n\n        /**\n         * Performs the md5 hash on a string.\n         * A conversion will be applied if utf8 string is detected.\n         *\n         * @param {String}  str The string\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.hash = function (str, raw) {\n            // converts the string to utf8 bytes if necessary\n            if (/[\\u0080-\\uFFFF]/.test(str)) {\n                str = unescape(encodeURIComponent(str));\n            }\n\n            var hash = md51(str);\n\n            return !!raw ? hash : hex(hash);\n        };\n\n        /**\n         * Performs the md5 hash on a binary string.\n         *\n         * @param {String}  content The binary string\n         * @param {Boolean} raw     True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.hashBinary = function (content, raw) {\n            var hash = md51(content);\n\n            return !!raw ? hash : hex(hash);\n        };\n\n        /**\n         * SparkMD5 OOP implementation for array buffers.\n         *\n         * Use this class to perform an incremental md5 ONLY for array buffers.\n         */\n        SparkMD5.ArrayBuffer = function () {\n            // call reset to init the instance\n            this.reset();\n        };\n\n        ////////////////////////////////////////////////////////////////////////////\n\n        /**\n         * Appends an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array to be appended\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n        SparkMD5.ArrayBuffer.prototype.append = function (arr) {\n            // TODO: we could avoid the concatenation here but the algorithm would be more complex\n            //       if you find yourself needing extra performance, please make a PR.\n            var buff = this._concatArrayBuffer(this._buff, arr),\n                length = buff.length,\n                i;\n\n            this._length += arr.byteLength;\n\n            for (i = 64; i <= length; i += 64) {\n                md5cycle(this._state, md5blk_array(buff.subarray(i - 64, i)));\n            }\n\n            // Avoids IE10 weirdness (documented above)\n            this._buff = (i - 64) < length ? buff.subarray(i - 64) : new Uint8Array(0);\n\n            return this;\n        };\n\n        /**\n         * Finishes the incremental computation, reseting the internal state and\n         * returning the result.\n         * Use the raw parameter to obtain the raw result instead of the hex one.\n         *\n         * @param {Boolean} raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.ArrayBuffer.prototype.end = function (raw) {\n            var buff = this._buff,\n                length = buff.length,\n                tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n                i,\n                ret;\n\n            for (i = 0; i < length; i += 1) {\n                tail[i >> 2] |= buff[i] << ((i % 4) << 3);\n            }\n\n            this._finish(tail, length);\n            ret = !!raw ? this._state : hex(this._state);\n\n            this.reset();\n\n            return ret;\n        };\n\n        SparkMD5.ArrayBuffer.prototype._finish = SparkMD5.prototype._finish;\n\n        /**\n         * Resets the internal state of the computation.\n         *\n         * @return {SparkMD5.ArrayBuffer} The instance itself\n         */\n        SparkMD5.ArrayBuffer.prototype.reset = function () {\n            this._buff = new Uint8Array(0);\n            this._length = 0;\n            this._state = [1732584193, -271733879, -1732584194, 271733878];\n\n            return this;\n        };\n\n        /**\n         * Releases memory used by the incremental buffer and other aditional\n         * resources. If you plan to use the instance again, use reset instead.\n         */\n        SparkMD5.ArrayBuffer.prototype.destroy = SparkMD5.prototype.destroy;\n\n        /**\n         * Concats two array buffers, returning a new one.\n         *\n         * @param  {ArrayBuffer} first  The first array buffer\n         * @param  {ArrayBuffer} second The second array buffer\n         *\n         * @return {ArrayBuffer} The new array buffer\n         */\n        SparkMD5.ArrayBuffer.prototype._concatArrayBuffer = function (first, second) {\n            var firstLength = first.length,\n                result = new Uint8Array(firstLength + second.byteLength);\n\n            result.set(first);\n            result.set(new Uint8Array(second), firstLength);\n\n            return result;\n        };\n\n        /**\n         * Performs the md5 hash on an array buffer.\n         *\n         * @param {ArrayBuffer} arr The array buffer\n         * @param {Boolean}     raw True to get the raw result, false to get the hex result\n         *\n         * @return {String|Array} The result\n         */\n        SparkMD5.ArrayBuffer.hash = function (arr, raw) {\n            var hash = md51_array(new Uint8Array(arr));\n\n            return !!raw ? hash : hex(hash);\n        };\n\n        return FlashRuntime.register( 'Md5', {\n            init: function() {\n                // do nothing.\n            },\n\n            loadFromBlob: function( file ) {\n                var blob = file.getSource(),\n                    chunkSize = 2 * 1024 * 1024,\n                    chunks = Math.ceil( blob.size / chunkSize ),\n                    chunk = 0,\n                    owner = this.owner,\n                    spark = new SparkMD5.ArrayBuffer(),\n                    me = this,\n                    blobSlice = blob.mozSlice || blob.webkitSlice || blob.slice,\n                    loadNext, fr;\n\n                fr = new FileReader();\n\n                loadNext = function() {\n                    var start, end;\n\n                    start = chunk * chunkSize;\n                    end = Math.min( start + chunkSize, blob.size );\n\n                    fr.onload = function( e ) {\n                        spark.append( e.target.result );\n                        owner.trigger( 'progress', {\n                            total: file.size,\n                            loaded: end\n                        });\n                    };\n\n                    fr.onloadend = function() {\n                        fr.onloadend = fr.onload = null;\n\n                        if ( ++chunk < chunks ) {\n                            setTimeout( loadNext, 1 );\n                        } else {\n                            setTimeout(function(){\n                                owner.trigger('load');\n                                me.result = spark.end();\n                                loadNext = file = blob = spark = null;\n                                owner.trigger('complete');\n                            }, 50 );\n                        }\n                    };\n\n                    fr.readAsArrayBuffer( blobSlice.call( blob, start, end ) );\n                };\n\n                loadNext();\n            },\n\n            getResult: function() {\n                return this.result;\n            }\n        });\n    });\n    /**\n     * @fileOverview FlashRuntime\n     */\n    define('runtime/flash/runtime',[\n        'base',\n        'runtime/runtime',\n        'runtime/compbase'\n    ], function( Base, Runtime, CompBase ) {\n\n        var $ = Base.$,\n            type = 'flash',\n            components = {};\n\n\n        function getFlashVersion() {\n            var version;\n\n            try {\n                version = navigator.plugins[ 'Shockwave Flash' ];\n                version = version.description;\n            } catch ( ex ) {\n                try {\n                    version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\n                            .GetVariable('$version');\n                } catch ( ex2 ) {\n                    version = '0.0';\n                }\n            }\n            version = version.match( /\\d+/g );\n            return parseFloat( version[ 0 ] + '.' + version[ 1 ], 10 );\n        }\n\n        function FlashRuntime() {\n            var pool = {},\n                clients = {},\n                destroy = this.destroy,\n                me = this,\n                jsreciver = Base.guid('webuploader_');\n\n            Runtime.apply( me, arguments );\n            me.type = type;\n\n\n            // 这个方法的调用者，实际上是RuntimeClient\n            me.exec = function( comp, fn/*, args...*/ ) {\n                var client = this,\n                    uid = client.uid,\n                    args = Base.slice( arguments, 2 ),\n                    instance;\n\n                clients[ uid ] = client;\n\n                if ( components[ comp ] ) {\n                    if ( !pool[ uid ] ) {\n                        pool[ uid ] = new components[ comp ]( client, me );\n                    }\n\n                    instance = pool[ uid ];\n\n                    if ( instance[ fn ] ) {\n                        return instance[ fn ].apply( instance, args );\n                    }\n                }\n\n                return me.flashExec.apply( client, arguments );\n            };\n\n            function handler( evt, obj ) {\n                var type = evt.type || evt,\n                    parts, uid;\n\n                parts = type.split('::');\n                uid = parts[ 0 ];\n                type = parts[ 1 ];\n\n                // console.log.apply( console, arguments );\n\n                if ( type === 'Ready' && uid === me.uid ) {\n                    me.trigger('ready');\n                } else if ( clients[ uid ] ) {\n                    clients[ uid ].trigger( type.toLowerCase(), evt, obj );\n                }\n\n                // Base.log( evt, obj );\n            }\n\n            // flash的接受器。\n            window[ jsreciver ] = function() {\n                var args = arguments;\n\n                // 为了能捕获得到。\n                setTimeout(function() {\n                    handler.apply( null, args );\n                }, 1 );\n            };\n\n            this.jsreciver = jsreciver;\n\n            this.destroy = function() {\n                // @todo 删除池子中的所有实例\n                return destroy && destroy.apply( this, arguments );\n            };\n\n            this.flashExec = function( comp, fn ) {\n                var flash = me.getFlash(),\n                    args = Base.slice( arguments, 2 );\n\n                return flash.exec( this.uid, comp, fn, args );\n            };\n\n            // @todo\n        }\n\n        Base.inherits( Runtime, {\n            constructor: FlashRuntime,\n\n            init: function() {\n                var container = this.getContainer(),\n                    opts = this.options,\n                    html;\n\n                // if not the minimal height, shims are not initialized\n                // in older browsers (e.g FF3.6, IE6,7,8, Safari 4.0,5.0, etc)\n                container.css({\n                    position: 'absolute',\n                    top: '-8px',\n                    left: '-8px',\n                    width: '9px',\n                    height: '9px',\n                    overflow: 'hidden'\n                });\n\n                // insert flash object\n                html = '<object id=\"' + this.uid + '\" type=\"application/' +\n                        'x-shockwave-flash\" data=\"' +  opts.swf + '\" ';\n\n                if ( Base.browser.ie ) {\n                    html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\n                }\n\n                html += 'width=\"100%\" height=\"100%\" style=\"outline:0\">'  +\n                    '<param name=\"movie\" value=\"' + opts.swf + '\" />' +\n                    '<param name=\"flashvars\" value=\"uid=' + this.uid +\n                    '&jsreciver=' + this.jsreciver + '\" />' +\n                    '<param name=\"wmode\" value=\"transparent\" />' +\n                    '<param name=\"allowscriptaccess\" value=\"always\" />' +\n                '</object>';\n\n                container.html( html );\n            },\n\n            getFlash: function() {\n                if ( this._flash ) {\n                    return this._flash;\n                }\n\n                this._flash = $( '#' + this.uid ).get( 0 );\n                return this._flash;\n            }\n\n        });\n\n        FlashRuntime.register = function( name, component ) {\n            component = components[ name ] = Base.inherits( CompBase, $.extend({\n\n                // @todo fix this later\n                flashExec: function() {\n                    var owner = this.owner,\n                        runtime = this.getRuntime();\n\n                    return runtime.flashExec.apply( owner, arguments );\n                }\n            }, component ) );\n\n            return component;\n        };\n\n        if ( getFlashVersion() >= 11.4 ) {\n            Runtime.addRuntime( type, FlashRuntime );\n        }\n\n        return FlashRuntime;\n    });\n    /**\n     * @fileOverview FilePicker\n     */\n    define('runtime/flash/filepicker',[\n        'base',\n        'runtime/flash/runtime'\n    ], function( Base, FlashRuntime ) {\n        var $ = Base.$;\n\n        return FlashRuntime.register( 'FilePicker', {\n            init: function( opts ) {\n                var copy = $.extend({}, opts ),\n                    len, i;\n\n                // 修复Flash再没有设置title的情况下无法弹出flash文件选择框的bug.\n                len = copy.accept && copy.accept.length;\n                for (  i = 0; i < len; i++ ) {\n                    if ( !copy.accept[ i ].title ) {\n                        copy.accept[ i ].title = 'Files';\n                    }\n                }\n\n                delete copy.button;\n                delete copy.id;\n                delete copy.container;\n\n                this.flashExec( 'FilePicker', 'init', copy );\n            },\n\n            destroy: function() {\n                this.flashExec( 'FilePicker', 'destroy' );\n            }\n        });\n    });\n    /**\n     * @fileOverview 图片压缩\n     */\n    define('runtime/flash/image',[\n        'runtime/flash/runtime'\n    ], function( FlashRuntime ) {\n\n        return FlashRuntime.register( 'Image', {\n            // init: function( options ) {\n            //     var owner = this.owner;\n\n            //     this.flashExec( 'Image', 'init', options );\n            //     owner.on( 'load', function() {\n            //         debugger;\n            //     });\n            // },\n\n            loadFromBlob: function( blob ) {\n                var owner = this.owner;\n\n                owner.info() && this.flashExec( 'Image', 'info', owner.info() );\n                owner.meta() && this.flashExec( 'Image', 'meta', owner.meta() );\n\n                this.flashExec( 'Image', 'loadFromBlob', blob.uid );\n            }\n        });\n    });\n    /**\n     * @fileOverview  Transport flash实现\n     */\n    define('runtime/flash/transport',[\n        'base',\n        'runtime/flash/runtime',\n        'runtime/client'\n    ], function( Base, FlashRuntime, RuntimeClient ) {\n        var $ = Base.$;\n\n        return FlashRuntime.register( 'Transport', {\n            init: function() {\n                this._status = 0;\n                this._response = null;\n                this._responseJson = null;\n            },\n\n            send: function() {\n                var owner = this.owner,\n                    opts = this.options,\n                    xhr = this._initAjax(),\n                    blob = owner._blob,\n                    server = opts.server,\n                    binary;\n\n                xhr.connectRuntime( blob.ruid );\n\n                if ( opts.sendAsBinary ) {\n                    server += (/\\?/.test( server ) ? '&' : '?') +\n                            $.param( owner._formData );\n\n                    binary = blob.uid;\n                } else {\n                    $.each( owner._formData, function( k, v ) {\n                        xhr.exec( 'append', k, v );\n                    });\n\n                    xhr.exec( 'appendBlob', opts.fileVal, blob.uid,\n                            opts.filename || owner._formData.name || '' );\n                }\n\n                this._setRequestHeader( xhr, opts.headers );\n                xhr.exec( 'send', {\n                    method: opts.method,\n                    url: server,\n                    forceURLStream: opts.forceURLStream,\n                    mimeType: 'application/octet-stream'\n                }, binary );\n            },\n\n            getStatus: function() {\n                return this._status;\n            },\n\n            getResponse: function() {\n                return this._response || '';\n            },\n\n            getResponseAsJson: function() {\n                return this._responseJson;\n            },\n\n            getResponseHeaders: function() {\n                // flash 暂不支持\n                return {};\n            },\n\n            abort: function() {\n                var xhr = this._xhr;\n\n                if ( xhr ) {\n                    xhr.exec('abort');\n                    xhr.destroy();\n                    this._xhr = xhr = null;\n                }\n            },\n\n            destroy: function() {\n                this.abort();\n            },\n\n            _initAjax: function() {\n                var me = this,\n                    xhr = new RuntimeClient('XMLHttpRequest');\n\n                xhr.on( 'uploadprogress progress', function( e ) {\n                    var percent = e.loaded / e.total;\n                    percent = Math.min( 1, Math.max( 0, percent ) );\n                    return me.trigger( 'progress', percent );\n                });\n\n                xhr.on( 'load', function() {\n                    var status = xhr.exec('getStatus'),\n                        readBody = false,\n                        err = '',\n                        p;\n\n                    xhr.off();\n                    me._xhr = null;\n\n                    if ( status >= 200 && status < 300 ) {\n                        readBody = true;\n                    } else if ( status >= 500 && status < 600 ) {\n                        readBody = true;\n                        err = 'server-'+status;\n                    } else {\n                        err = 'http-'+status;\n                    }\n\n                    if ( readBody ) {\n                        me._response = xhr.exec('getResponse');\n                        me._response = decodeURIComponent( me._response );\n\n                        // flash 处理可能存在 bug, 没辙只能靠 js 了\n                        // try {\n                        //     me._responseJson = xhr.exec('getResponseAsJson');\n                        // } catch ( error ) {\n\n                        p = function( s ) {\n                            try {\n                                if (window.JSON && window.JSON.parse) {\n                                    return JSON.parse(s);\n                                }\n\n                                return new Function('return ' + s).call();\n                            } catch ( err ) {\n                                return {};\n                            }\n                        };\n                        me._responseJson  = me._response ? p(me._response) : {};\n\n                        // }\n                    }\n\n                    xhr.destroy();\n                    xhr = null;\n\n                    return err ? me.trigger( 'error', err ) : me.trigger('load');\n                });\n\n                xhr.on( 'error', function() {\n                    var status = xhr.exec('getStatus'),err = status?'http-'+status:'http';\n                    xhr.off();\n                    me._xhr = null;\n                    me.trigger( 'error', err );\n                });\n\n                me._xhr = xhr;\n                return xhr;\n            },\n\n            _setRequestHeader: function( xhr, headers ) {\n                $.each( headers, function( key, val ) {\n                    xhr.exec( 'setRequestHeader', key, val );\n                });\n            }\n        });\n    });\n\n    /**\n     * @fileOverview Blob Html实现\n     */\n    define('runtime/flash/blob',[\n        'runtime/flash/runtime',\n        'lib/blob'\n    ], function( FlashRuntime, Blob ) {\n\n        return FlashRuntime.register( 'Blob', {\n            slice: function( start, end ) {\n                var blob = this.flashExec( 'Blob', 'slice', start, end );\n\n                return new Blob( this.getRuid(), blob );\n            }\n        });\n    });\n    /**\n     * @fileOverview  Md5 flash实现\n     */\n    define('runtime/flash/md5',[\n        'runtime/flash/runtime'\n    ], function( FlashRuntime ) {\n\n        return FlashRuntime.register( 'Md5', {\n            init: function() {\n                // do nothing.\n            },\n\n            loadFromBlob: function( blob ) {\n                return this.flashExec( 'Md5', 'loadFromBlob', blob.uid );\n            }\n        });\n    });\n    /**\n     * @fileOverview 完全版本。\n     */\n    define('preset/all',[\n        'base',\n\n        // widgets\n        'widgets/filednd',\n        'widgets/filepaste',\n        'widgets/filepicker',\n        'widgets/image',\n        'widgets/queue',\n        'widgets/runtime',\n        'widgets/upload',\n        'widgets/validator',\n        'widgets/md5',\n\n        // runtimes\n        // html5\n        'runtime/html5/blob',\n        'runtime/html5/dnd',\n        'runtime/html5/filepaste',\n        'runtime/html5/filepicker',\n        'runtime/html5/imagemeta/exif',\n        'runtime/html5/androidpatch',\n        'runtime/html5/image',\n        'runtime/html5/transport',\n        'runtime/html5/md5',\n\n        // flash\n        'runtime/flash/filepicker',\n        'runtime/flash/image',\n        'runtime/flash/transport',\n        'runtime/flash/blob',\n        'runtime/flash/md5'\n    ], function( Base ) {\n        return Base;\n    });\n    /**\n     * @fileOverview 日志组件，主要用来收集错误信息，可以帮助 webuploader 更好的定位问题和发展。\n     *\n     * 如果您不想要启用此功能，请在打包的时候去掉 log 模块。\n     *\n     * 或者可以在初始化的时候通过 options.disableWidgets 属性禁用。\n     *\n     * 如：\n     * WebUploader.create({\n     *     ...\n     *\n     *     disableWidgets: 'log',\n     *\n     *     ...\n     * })\n     */\n    define('widgets/log',[\n        'base',\n        'uploader',\n        'widgets/widget'\n    ], function( Base, Uploader ) {\n        var $ = Base.$,\n            logUrl = ' http://static.tieba.baidu.com/tb/pms/img/st.gif??',\n            product = (location.hostname || location.host || 'protected').toLowerCase(),\n\n            // 只针对 baidu 内部产品用户做统计功能。\n            enable = product && /baidu/i.exec(product),\n            base;\n\n        if (!enable) {\n            return;\n        }\n\n        base = {\n            dv: 3,\n            master: 'webuploader',\n            online: /test/.exec(product) ? 0 : 1,\n            module: '',\n            product: product,\n            type: 0\n        };\n\n        function send(data) {\n            var obj = $.extend({}, base, data),\n                url = logUrl.replace(/^(.*)\\?/, '$1' + $.param( obj )),\n                image = new Image();\n\n            image.src = url;\n        }\n\n        return Uploader.register({\n            name: 'log',\n\n            init: function() {\n                var owner = this.owner,\n                    count = 0,\n                    size = 0;\n\n                owner\n                    .on('error', function(code) {\n                        send({\n                            type: 2,\n                            c_error_code: code\n                        });\n                    })\n                    .on('uploadError', function(file, reason) {\n                        send({\n                            type: 2,\n                            c_error_code: 'UPLOAD_ERROR',\n                            c_reason: '' + reason\n                        });\n                    })\n                    .on('uploadComplete', function(file) {\n                        count++;\n                        size += file.size;\n                    }).\n                    on('uploadFinished', function() {\n                        send({\n                            c_count: count,\n                            c_size: size\n                        });\n                        count = size = 0;\n                    });\n\n                send({\n                    c_usage: 1\n                });\n            }\n        });\n    });\n    /**\n     * @fileOverview Uploader上传类\n     */\n    define('webuploader',[\n        'preset/all',\n        'widgets/log'\n    ], function( preset ) {\n        return preset;\n    });\n    return require('webuploader');\n});\n"]}]}