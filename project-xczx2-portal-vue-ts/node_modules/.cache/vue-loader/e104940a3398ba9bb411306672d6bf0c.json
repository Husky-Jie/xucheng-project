{"remainingRequest":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\src\\module-organization\\pages\\course-manage\\course-list.vue?vue&type=style&index=0&id=38e7a12e&lang=scss&scoped=true&","dependencies":[{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\src\\module-organization\\pages\\course-manage\\course-list.vue","mtime":1665299012946},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\css-loader\\dist\\cjs.js","mtime":1660903053592},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1660903053930},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\postcss-loader\\src\\index.js","mtime":1576202027988},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1660903055666},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660903053464},{"path":"D:\\itcast2023\\xc_edu3.1\\code_402\\project-xczx2-portal-vue-ts\\node_modules\\vue-loader\\lib\\index.js","mtime":1660903053930}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi53b3Jrc3BhY2UgLmJhbm5lciAuYnRuLWFkZCB7DQogIGZsb2F0OiByaWdodDsNCn0NCg0KLnNlYXJjaGVyIHsNCiAgbWFyZ2luLXRvcDogMTZweDsNCg0KICBkaXYgew0KICAgIHdpZHRoOiAyMThweDsNCiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogIH0NCn0NCg0KLmRhdGFMaXN0IHsNCiAgbWFyZ2luLXRvcDogMTZweDsNCn0NCg0KLmRhdGFMaXN0LXBhZ2luYXRpb24gew0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIHdpZHRoOiAxMDAlOw0KfQ0K"},{"version":3,"sources":["course-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwWA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"course-list.vue","sourceRoot":"src/module-organization/pages/course-manage","sourcesContent":["<template>\r\n  <div class=\"workspace\">\r\n    <div class=\"banner\">\r\n      <span class=\"primary-title\">课程管理</span>\r\n      <el-button\r\n        type=\"primary\"\r\n        size=\"medium\"\r\n        class=\"btn-add el-button\"\r\n        @click=\"handleShowTypeDlg\"\r\n      >+添加课程</el-button>\r\n    </div>\r\n\r\n    <!-- 搜索栏 -->\r\n    <div class=\"searcher\">\r\n      <el-input\r\n        class=\"el-input\"\r\n        placeholder=\"课程名称\"\r\n        suffix-icon=\"el-icon-search\"\r\n        v-model=\"listQueryData.courseName\"\r\n      />\r\n      <el-select v-model=\"listQueryData.auditStatus\" placeholder=\"请选择\">\r\n        <el-option\r\n          v-for=\"item in aduitStatusOptions\" \r\n          :key=\"item.code\"\r\n          :label=\"item.desc\"\r\n          :value=\"item.code\"\r\n        ></el-option>\r\n      </el-select>\r\n     <el-select v-model=\"listQueryData.publishStatus\" placeholder=\"请选择\">\r\n        <el-option\r\n          v-for=\"item in coursePublishStatus\"\r\n          :key=\"item.code\"\r\n          :label=\"item.desc\"\r\n          :value=\"item.code\"\r\n        ></el-option>\r\n      </el-select>\r\n    </div>\r\n\r\n    <!-- 数据列表 -->\r\n    <el-table\r\n      class=\"dataList\"\r\n      v-loading=\"listLoading\"\r\n      :data=\"listData.items\"\r\n      border\r\n      style=\"width: 100%\"\r\n      :header-cell-style=\"{textAlign: 'center'}\"\r\n    >\r\n      <el-table-column prop=\"name\" label=\"课程名称\" width=\"250\"></el-table-column>\r\n      <el-table-column prop=\"subsectionNum\" label=\"任务数\" align=\"center\" width=\"100\"></el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" width=\"160\">\r\n        <template slot-scope=\"scope\">\r\n          <div>{{scope.row.createDate | dateTimeFormat}}</div>\r\n        </template>\r\n      </el-table-column>\r\n      <!--<el-table-column prop=\"learners\" label=\"报名人数\" align=\"center\" width=\"100\"></el-table-column>-->\r\n      <el-table-column label=\"是否付费\" align=\"center\" width=\"80\">\r\n        <template slot-scope=\"scope\">\r\n          <div>{{scope.row.charge | chargeText}}</div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"审核状态\" align=\"center\" width=\"100\">\r\n        <template slot-scope=\"scope\">\r\n          <div>\r\n            {{scope.row.auditStatus | auditStatusText}}\r\n            <br />\r\n            <el-button\r\n              v-if=\"scope.row.auditStatus == '202001'\"\r\n              type=\"text\"\r\n              size=\"mini\"\r\n              @click=\"showMessageBox(scope.row.auditMind, '审核未通过')\"\r\n            >查看审核意见</el-button>\r\n            <el-button\r\n              v-else-if=\"scope.row.auditStatus == '202005'\"\r\n              type=\"text\"\r\n              size=\"mini\"\r\n              @click=\"handleViewDetail(scope.$index, scope.row)\"\r\n            >查看课程详情</el-button>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"类型\" align=\"center\" width=\"80\">\r\n        <template slot-scope=\"scope\">\r\n          <div>{{scope.row.teachmode | teachmodeText}}</div>\r\n        </template>\r\n      </el-table-column>\r\n      <!-- TODO: 增加友好提示 -->\r\n      <el-table-column label=\"操作\" align=\"center\">\r\n        <template slot-scope=\"scope\">\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            @click=\"handleEdit(scope.$index, scope.row)\"\r\n          >编辑</el-button>\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            :disabled=\"scope.row.auditStatus != '202002'\"\r\n            @click=\"handleDelete(scope.$index, scope.row)\"\r\n          >删除</el-button>\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            @click=\"handlePreview(scope.$index, scope.row)\"\r\n          >预览</el-button>\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            :disabled=\"scope.row.auditStatus == '202003'\"\r\n            @click=\"handleCommit(scope.$index, scope.row)\"\r\n          >提交审核</el-button>\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            :disabled=\"scope.row.status == '203002' || scope.row.auditStatus != '202004' \"\r\n            @click=\"handlePublish(scope.$index, scope.row)\"\r\n          >发布</el-button>\r\n          <el-button\r\n            type=\"text\"\r\n            size=\"mini\"\r\n            :disabled=\"scope.row.status != '203002'\"\r\n            @click=\"handleOffline(scope.$index, scope.row)\"\r\n          >下架</el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <!-- 翻页控制 -->\r\n    <div class=\"dataList-pagination\">\r\n      <Pagination\r\n        v-show=\"listData.counts > 0\"\r\n        :total=\"listData.counts\"\r\n        :page.sync=\"listQuery.pageNo\"\r\n        :limit.sync=\"listQuery.pageSize\"\r\n        @pagination=\"getList\"\r\n      />\r\n    </div>\r\n\r\n    <!-- 类型提示框 -->\r\n    <CourseAddTypeDialog :dialogVisible.sync=\"typeDialogVisible\"></CourseAddTypeDialog>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { Component, Prop, Watch, Vue } from 'vue-property-decorator'\r\nimport { mixins } from 'vue-class-component'\r\nimport Pagination from '@/components/pagination/index.vue'\r\nimport CourseAddTypeDialog from './course-addtype-dialog.vue'\r\nimport { IKVData } from '@/api/types' // 通用 interface\r\nimport {\r\n  AUDIT_STATUS,\r\n  COURSE_CHARGE_TYPE_STATUS,\r\n  COUSE_PUBLIC_STATUS,\r\n  COUSE_TYPE_STATUS\r\n} from '@/api/constants' // 通用常量定义\r\nimport {\r\n  list,\r\n  commitCourse,\r\n  publishCourse,\r\n  offlineCourse,\r\n  removeCourse\r\n} from '@/api/courses' // api interface 课程\r\nimport { ICoursePageList, ICourseBaseDTO } from '@/entity/course-page-list'\r\nimport MixinTools from '@/utils/mixins.vue'\r\n\r\n@Component({\r\n  name: 'CourseList',\r\n  components: {\r\n    Pagination,\r\n    CourseAddTypeDialog\r\n  },\r\n  filters: {\r\n    auditStatusText: function(value: string) {\r\n      let finds = AUDIT_STATUS.filter(item => {\r\n        return item.code == value\r\n      })\r\n      if (finds && finds.length > 0) {\r\n        return finds[0].desc\r\n      }\r\n    },\r\n    chargeText: function(value: string) {\r\n      let finds = COURSE_CHARGE_TYPE_STATUS.filter(item => {\r\n        return item.code == value\r\n      })\r\n      if (finds && finds.length > 0) {\r\n        return finds[0].desc\r\n      }\r\n    },\r\n    teachmodeText: function(value: string) {\r\n      let finds = COUSE_TYPE_STATUS.filter(item => {\r\n        return item.code == value\r\n      })\r\n      if (finds && finds.length > 0) {\r\n        return finds[0].desc\r\n      }\r\n    }\r\n  }\r\n})\r\nexport default class extends mixins(MixinTools) {\r\n  // 数据\r\n  // 审核类型\r\n  private aduitStatusOptions: IKVData[] = AUDIT_STATUS\r\n\r\n  private coursePublishStatus: IKVData[] = COUSE_PUBLIC_STATUS\r\n\r\n  // 类型选择弹出对话框\r\n  private typeDialogVisible: boolean = false // 是否显示\r\n\r\n  // 查询\r\n  private listData: ICoursePageList = {} // 数据体\r\n  private listLoading: boolean = false // 是否载入中\r\n  // api params\r\n  private listQuery = {\r\n    pageNo: 1,\r\n    pageSize: 10\r\n  }\r\n  // api post body\r\n  private listQueryData = {\r\n    courseName: '',\r\n    auditStatus: ''\r\n  }\r\n\r\n  // 业务函数\r\n  private async getList() {\r\n    this.listLoading = true\r\n    this.listData = await list(this.listQuery, this.listQueryData)\r\n    this.listLoading = false\r\n  }\r\n\r\n  // 生命周期 life\r\n  created() {\r\n    // this.getList();\r\n  }\r\n\r\n  // 事件 handle\r\n  private async handlePreview(index: number, row: ICourseBaseDTO) {\r\n    if (row.id) {\r\n      window.open(\r\n        `${process.env.VUE_APP_SERVER_API_URL}/content/coursepreview/${row.id}`,\r\n        '_blank'\r\n      )\r\n      // window.open(\r\n      //   `${process.env.VUE_APP_SERVER_API_URL}/content/course/preview/${row.courseBaseId}/${row.companyId}`,\r\n      //   '_blank'\r\n      // )\r\n    }\r\n  }\r\n  private handleEdit(index: number, row: ICourseBaseDTO) {\r\n    this.$router.push({\r\n      path: `/organization/course-add?courseBaseId=${row.id}&teachmode=${row.teachmode}`\r\n      //path: `/organization/course-add?courseBaseId=${row.courseBaseId}&teachmode=${row.teachmode}`\r\n    })\r\n  }\r\n  private async handleCommit(index: number, row: ICourseBaseDTO) {\r\n   \r\n    this.$confirm('请确认课程信息编辑完成，是否提交平台审核?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          if (row.id) {\r\n           commitCourse(row.id).then(() => {\r\n            this.$message.success('提交成功')\r\n           }\r\n           \r\n           )\r\n          this.getList()\r\n          }\r\n        }).catch(() => {\r\n          \r\n        });\r\n\r\n  }\r\n  private async handlePublish(index: number, row: ICourseBaseDTO) {\r\n    // if (row.courseBaseId) {\r\n    //   await publishCourse(row.courseBaseId)\r\n    //   await this.getList()\r\n    // }\r\n\r\n    this.$confirm('课程发布后将在网站公开，是否继续发布课程?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          if (row.id) {\r\n            publishCourse(row.id).then(() => {\r\n            this.$message.success('操作成功，请稍后在课程搜索中搜索课程')\r\n           }\r\n           \r\n           )\r\n          this.getList()\r\n          }\r\n        }).catch(() => {\r\n          \r\n        });\r\n  }\r\n  private async handleViewDetail(index: number, row: ICourseBaseDTO) {\r\n    if (row.coursePubId) {\r\n      window.open(\r\n        `${process.env.VUE_APP_SERVER_QINIU_URL}/course_pub/${row.coursePubId}.html`,\r\n        '_blank'\r\n      )\r\n    }\r\n  }\r\n  //课程下架\r\n  private async handleOffline(index: number, row: ICourseBaseDTO) {\r\n    // if (row.courseBaseId) {\r\n    //   await offlineCourse(row.courseBaseId)\r\n    //   await this.getList()\r\n    // }\r\n\r\n    this.$confirm('课程下架后无法在网站查询，但不影响现有学生学习，是否继续下架课程?', '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          if (row.id) {\r\n            offlineCourse(row.id).then(() => {\r\n            this.$message.success('操作成功，稍后在课程搜索中将无法查询到课程。')\r\n           }\r\n           \r\n           )\r\n          this.getList()\r\n          }\r\n        }).catch(() => {\r\n          \r\n        });\r\n  }\r\n  private async handleDelete(index: number, row: ICourseBaseDTO) {\r\n    try {\r\n      await this.showDeleteConfirm()\r\n      console.log(row)\r\n      if (row.id) {\r\n        await removeCourse(row.id)\r\n        await this.getList()\r\n      }\r\n    } catch (error) {}\r\n  }\r\n  private handleShowTypeDlg() {\r\n    this.typeDialogVisible = true\r\n  }\r\n\r\n  // 监控 watch\r\n  // 搜索栏\r\n  @Watch('listQueryData', { deep: true, immediate: true })\r\n  private watchListQueryData(newVal: string) {\r\n    if (newVal == '') {\r\n      return\r\n    }\r\n    this.getList()\r\n  }\r\n  // 翻页 pageSize\r\n  @Watch('listQuery.pageSize', { immediate: true })\r\n  private watchListQueryPageSize(newVal: number) {\r\n    this.listQuery.pageNo = 1\r\n  }\r\n}\r\n</script>\r\n\r\n\r\n<style lang=\"scss\" scoped>\r\n.workspace .banner .btn-add {\r\n  float: right;\r\n}\r\n\r\n.searcher {\r\n  margin-top: 16px;\r\n\r\n  div {\r\n    width: 218px;\r\n    margin-right: 10px;\r\n  }\r\n}\r\n\r\n.dataList {\r\n  margin-top: 16px;\r\n}\r\n\r\n.dataList-pagination {\r\n  text-align: center;\r\n  width: 100%;\r\n}\r\n</style>\r\n"]}]}